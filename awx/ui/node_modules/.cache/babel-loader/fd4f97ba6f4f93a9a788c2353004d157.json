{"ast":null,"code":"import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{i18n}from\"@lingui/core\";import React,{useCallback}from'react';import{Button}from'@patternfly/react-core';import{OutlinedThumbsUpIcon}from'@patternfly/react-icons';import{WorkflowApprovalsAPI}from'api';import useRequest,{useDismissableError}from'hooks/useRequest';import AlertModal from'components/AlertModal';import ErrorDetail from'components/ErrorDetail';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";function WorkflowApprovalButton(_ref){var isDetailView=_ref.isDetailView,workflowApproval=_ref.workflowApproval,onHandleToast=_ref.onHandleToast;var id=workflowApproval.id;var hasBeenActedOn=Object.keys(workflowApproval.summary_fields.approved_or_denied_by||{}).length>0||workflowApproval.status==='canceled';var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:return _context.abrupt(\"return\",WorkflowApprovalsAPI.approve(id));case 1:case\"end\":return _context.stop();}}},_callee);})),[id]),{}),approveApprovalError=_useRequest.error,approveWorkflowApprovals=_useRequest.request;var handleApprove=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return approveWorkflowApprovals();case 2:onHandleToast(workflowApproval.id,/*i18n*/i18n._(\"Successfully Approved\"));case 3:case\"end\":return _context2.stop();}}},_callee2);}));return function handleApprove(){return _ref3.apply(this,arguments);};}();var _useDismissableError=useDismissableError(approveApprovalError),approveError=_useDismissableError.error,dismissApproveError=_useDismissableError.dismissError;return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Button,{isDisabled:hasBeenActedOn,variant:isDetailView?'primary':'plain',ouiaId:\"workflow-approve-button\",onClick:function onClick(){return handleApprove();},\"aria-label\":hasBeenActedOn?/*i18n*/i18n._(\"This workflow has already been acted on\"):/*i18n*/i18n._(\"Approve\"),children:isDetailView?/*i18n*/i18n._(\"Approve\"):/*#__PURE__*/_jsx(OutlinedThumbsUpIcon,{})}),approveError&&/*#__PURE__*/_jsxs(AlertModal,{isOpen:approveError,variant:\"error\",title:/*i18n*/i18n._(\"Error!\"),onClose:dismissApproveError,children:[/*i18n*/i18n._(\"Failed to approve {0}.\",{0:workflowApproval.name}),/*#__PURE__*/_jsx(ErrorDetail,{error:approveError})]})]});}export default WorkflowApprovalButton;","map":{"version":3,"names":["React","useCallback","Button","OutlinedThumbsUpIcon","WorkflowApprovalsAPI","useRequest","useDismissableError","AlertModal","ErrorDetail","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","WorkflowApprovalButton","_ref","isDetailView","workflowApproval","onHandleToast","id","hasBeenActedOn","Object","keys","summary_fields","approved_or_denied_by","length","status","_useRequest","_asyncToGenerator","_regeneratorRuntime","mark","_callee","wrap","_callee$","_context","prev","next","abrupt","approve","stop","approveApprovalError","error","approveWorkflowApprovals","request","handleApprove","_ref3","_callee2","_callee2$","_context2","i18n","_","apply","arguments","_useDismissableError","approveError","dismissApproveError","dismissError","children","isDisabled","variant","ouiaId","onClick","isOpen","title","onClose","0","name"],"sources":["/awx_devel/awx/ui/src/screens/WorkflowApproval/shared/WorkflowApprovalButton.js"],"sourcesContent":["import React, { useCallback } from 'react';\nimport { t } from '@lingui/macro';\nimport { Button } from '@patternfly/react-core';\nimport { OutlinedThumbsUpIcon } from '@patternfly/react-icons';\nimport { WorkflowApprovalsAPI } from 'api';\nimport useRequest, { useDismissableError } from 'hooks/useRequest';\n\nimport AlertModal from 'components/AlertModal';\nimport ErrorDetail from 'components/ErrorDetail';\n\nfunction WorkflowApprovalButton({\n  isDetailView,\n  workflowApproval,\n  onHandleToast,\n}) {\n  const { id } = workflowApproval;\n  const hasBeenActedOn =\n    Object.keys(workflowApproval.summary_fields.approved_or_denied_by || {})\n      .length > 0 || workflowApproval.status === 'canceled';\n  const { error: approveApprovalError, request: approveWorkflowApprovals } =\n    useRequest(\n      useCallback(async () => WorkflowApprovalsAPI.approve(id), [id]),\n      {}\n    );\n\n  const handleApprove = async () => {\n    await approveWorkflowApprovals();\n    onHandleToast(workflowApproval.id, t`Successfully Approved`);\n  };\n\n  const { error: approveError, dismissError: dismissApproveError } =\n    useDismissableError(approveApprovalError);\n\n  return (\n    <>\n      <Button\n        isDisabled={hasBeenActedOn}\n        variant={isDetailView ? 'primary' : 'plain'}\n        ouiaId=\"workflow-approve-button\"\n        onClick={() => handleApprove()}\n        aria-label={\n          hasBeenActedOn\n            ? t`This workflow has already been acted on`\n            : t`Approve`\n        }\n      >\n        {isDetailView ? t`Approve` : <OutlinedThumbsUpIcon />}\n      </Button>\n      {approveError && (\n        <AlertModal\n          isOpen={approveError}\n          variant=\"error\"\n          title={t`Error!`}\n          onClose={dismissApproveError}\n        >\n          {t`Failed to approve ${workflowApproval.name}.`}\n          <ErrorDetail error={approveError} />\n        </AlertModal>\n      )}\n    </>\n  );\n}\nexport default WorkflowApprovalButton;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}