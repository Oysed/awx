{"ast":null,"code":"import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _taggedTemplateLiteral from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral.js\";var _templateObject;import{i18n}from\"@lingui/core\";import React from'react';import{useField}from'formik';import styled from'styled-components';import{Alert}from'@patternfly/react-core';import InventoryStep from'./InventoryStep';import StepName from'./StepName';import{jsx as _jsx}from\"react/jsx-runtime\";var InventoryAlert=styled(Alert)(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  margin-bottom: 16px;\\n\"])));var STEP_ID='inventory';export default function useInventoryStep(launchConfig,resource,visitedSteps){var _useField=useField('inventory'),_useField2=_slicedToArray(_useField,3),meta=_useField2[1],helpers=_useField2[2];var formError=!resource||(resource===null||resource===void 0?void 0:resource.type)==='workflow_job_template'?false:Object.keys(visitedSteps).includes(STEP_ID)&&meta.touched&&!meta.value;return{step:getStep(launchConfig,formError,resource),initialValues:getInitialValues(launchConfig,resource),isReady:true,contentError:null,hasError:launchConfig.ask_inventory_on_launch&&formError,setTouched:function setTouched(setFieldTouched){setFieldTouched('inventory',true,false);},validate:function validate(){if(meta.touched&&!meta.value&&resource.type==='job_template'){helpers.setError(/*i18n*/i18n._(\"An inventory must be selected\"));}}};}function getStep(launchConfig,formError,resource){if(!launchConfig.ask_inventory_on_launch){return null;}return{id:STEP_ID,name:/*#__PURE__*/_jsx(StepName,{hasErrors:formError,id:\"inventory-step\",children:/*i18n*/i18n._(\"Inventory\")}),component:/*#__PURE__*/_jsx(InventoryStep,{warningMessage:resource.type==='workflow_job_template'?/*#__PURE__*/_jsx(InventoryAlert,{ouiaId:\"InventoryStep-alert\",variant:\"warning\",isInline:true,title:/*i18n*/i18n._(\"This inventory is applied to all workflow nodes within this workflow ({0}) that prompt for an inventory.\",{0:resource.name})}):null}),enableNext:true};}function getInitialValues(launchConfig,resource){var _resource$summary_fie;if(!launchConfig.ask_inventory_on_launch){return{};}return{inventory:(resource===null||resource===void 0?void 0:(_resource$summary_fie=resource.summary_fields)===null||_resource$summary_fie===void 0?void 0:_resource$summary_fie.inventory)||null};}","map":{"version":3,"names":["React","useField","styled","Alert","InventoryStep","StepName","jsx","_jsx","InventoryAlert","_templateObject","_taggedTemplateLiteral","STEP_ID","useInventoryStep","launchConfig","resource","visitedSteps","_useField","_useField2","_slicedToArray","meta","helpers","formError","type","Object","keys","includes","touched","value","step","getStep","initialValues","getInitialValues","isReady","contentError","hasError","ask_inventory_on_launch","setTouched","setFieldTouched","validate","setError","i18n","_","id","name","hasErrors","children","component","warningMessage","ouiaId","variant","isInline","title","0","enableNext","_resource$summary_fie","inventory","summary_fields"],"sources":["/awx_devel/awx/ui/src/components/LaunchPrompt/steps/useInventoryStep.js"],"sourcesContent":["import React from 'react';\nimport { t } from '@lingui/macro';\nimport { useField } from 'formik';\nimport styled from 'styled-components';\nimport { Alert } from '@patternfly/react-core';\nimport InventoryStep from './InventoryStep';\nimport StepName from './StepName';\n\nconst InventoryAlert = styled(Alert)`\n  margin-bottom: 16px;\n`;\n\nconst STEP_ID = 'inventory';\n\nexport default function useInventoryStep(launchConfig, resource, visitedSteps) {\n  const [, meta, helpers] = useField('inventory');\n  const formError =\n    !resource || resource?.type === 'workflow_job_template'\n      ? false\n      : Object.keys(visitedSteps).includes(STEP_ID) &&\n        meta.touched &&\n        !meta.value;\n\n  return {\n    step: getStep(launchConfig, formError, resource),\n    initialValues: getInitialValues(launchConfig, resource),\n    isReady: true,\n    contentError: null,\n    hasError: launchConfig.ask_inventory_on_launch && formError,\n    setTouched: (setFieldTouched) => {\n      setFieldTouched('inventory', true, false);\n    },\n    validate: () => {\n      if (meta.touched && !meta.value && resource.type === 'job_template') {\n        helpers.setError(t`An inventory must be selected`);\n      }\n    },\n  };\n}\nfunction getStep(launchConfig, formError, resource) {\n  if (!launchConfig.ask_inventory_on_launch) {\n    return null;\n  }\n  return {\n    id: STEP_ID,\n    name: (\n      <StepName hasErrors={formError} id=\"inventory-step\">\n        {t`Inventory`}\n      </StepName>\n    ),\n    component: (\n      <InventoryStep\n        warningMessage={\n          resource.type === 'workflow_job_template' ? (\n            <InventoryAlert\n              ouiaId=\"InventoryStep-alert\"\n              variant=\"warning\"\n              isInline\n              title={t`This inventory is applied to all workflow nodes within this workflow (${resource.name}) that prompt for an inventory.`}\n            />\n          ) : null\n        }\n      />\n    ),\n    enableNext: true,\n  };\n}\n\nfunction getInitialValues(launchConfig, resource) {\n  if (!launchConfig.ask_inventory_on_launch) {\n    return {};\n  }\n\n  return {\n    inventory: resource?.summary_fields?.inventory || null,\n  };\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}