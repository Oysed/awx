{"ast":null,"code":"import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{i18n}from\"@lingui/core\";import React,{useState,useEffect,useCallback}from'react';import{Switch,Tooltip}from'@patternfly/react-core';import useRequest from'hooks/useRequest';import{InstancesAPI}from'api';import{useConfig}from'contexts/Config';import ErrorDetail from'../ErrorDetail';import AlertModal from'../AlertModal';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";function InstanceToggle(_ref){var className=_ref.className,fetchInstances=_ref.fetchInstances,instance=_ref.instance,onToggle=_ref.onToggle;var _useConfig=useConfig(),_useConfig$me=_useConfig.me,me=_useConfig$me===void 0?{}:_useConfig$me;var _useState=useState(instance.enabled),_useState2=_slicedToArray(_useState,2),isEnabled=_useState2[0],setIsEnabled=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),showError=_useState4[0],setShowError=_useState4[1];var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return InstancesAPI.update(instance.id,{enabled:!isEnabled});case 2:_context.next=4;return fetchInstances();case 4:return _context.abrupt(\"return\",!isEnabled);case 5:case\"end\":return _context.stop();}}},_callee);})),[instance,isEnabled,fetchInstances]),instance.enabled),result=_useRequest.result,isLoading=_useRequest.isLoading,error=_useRequest.error,toggleInstance=_useRequest.request;useEffect(function(){if(result!==isEnabled){setIsEnabled(result);if(onToggle){onToggle(result);}}},[result,isEnabled,onToggle]);useEffect(function(){if(error){setShowError(true);}},[error]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Tooltip,{content:/*i18n*/i18n._(\"Set the instance enabled or disabled. If disabled, jobs will not be assigned to this instance.\"),position:\"top\",children:/*#__PURE__*/_jsx(Switch,{className:className,css:\"display: inline-flex;\",id:\"host-\".concat(instance.id,\"-toggle\"),label:/*i18n*/i18n._(\"Enabled\"),labelOff:/*i18n*/i18n._(\"Disabled\"),isChecked:isEnabled,isDisabled:isLoading||!(me!==null&&me!==void 0&&me.is_superuser),onChange:toggleInstance,ouiaId:\"host-\".concat(instance.id,\"-toggle\"),\"aria-label\":/*i18n*/i18n._(\"Toggle instance\")})}),showError&&error&&!isLoading&&/*#__PURE__*/_jsxs(AlertModal,{variant:\"error\",title:/*i18n*/i18n._(\"Error!\"),isOpen:error&&!isLoading,onClose:function onClose(){return setShowError(false);},children:[/*i18n*/i18n._(\"Failed to toggle instance.\"),/*#__PURE__*/_jsx(ErrorDetail,{error:error})]})]});}export default InstanceToggle;","map":{"version":3,"names":["React","useState","useEffect","useCallback","Switch","Tooltip","useRequest","InstancesAPI","useConfig","ErrorDetail","AlertModal","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","InstanceToggle","_ref","className","fetchInstances","instance","onToggle","_useConfig","_useConfig$me","me","_useState","enabled","_useState2","_slicedToArray","isEnabled","setIsEnabled","_useState3","_useState4","showError","setShowError","_useRequest","_asyncToGenerator","_regeneratorRuntime","mark","_callee","wrap","_callee$","_context","prev","next","update","id","abrupt","stop","result","isLoading","error","toggleInstance","request","children","content","i18n","_","position","css","concat","label","labelOff","isChecked","isDisabled","is_superuser","onChange","ouiaId","variant","title","isOpen","onClose"],"sources":["/awx_devel/awx/ui/src/components/InstanceToggle/InstanceToggle.js"],"sourcesContent":["import React, { useState, useEffect, useCallback } from 'react';\n\nimport { t } from '@lingui/macro';\nimport { Switch, Tooltip } from '@patternfly/react-core';\nimport useRequest from 'hooks/useRequest';\nimport { InstancesAPI } from 'api';\nimport { useConfig } from 'contexts/Config';\nimport ErrorDetail from '../ErrorDetail';\nimport AlertModal from '../AlertModal';\n\nfunction InstanceToggle({ className, fetchInstances, instance, onToggle }) {\n  const { me = {} } = useConfig();\n  const [isEnabled, setIsEnabled] = useState(instance.enabled);\n  const [showError, setShowError] = useState(false);\n\n  const {\n    result,\n    isLoading,\n    error,\n    request: toggleInstance,\n  } = useRequest(\n    useCallback(async () => {\n      await InstancesAPI.update(instance.id, { enabled: !isEnabled });\n      await fetchInstances();\n      return !isEnabled;\n    }, [instance, isEnabled, fetchInstances]),\n    instance.enabled\n  );\n\n  useEffect(() => {\n    if (result !== isEnabled) {\n      setIsEnabled(result);\n      if (onToggle) {\n        onToggle(result);\n      }\n    }\n  }, [result, isEnabled, onToggle]);\n\n  useEffect(() => {\n    if (error) {\n      setShowError(true);\n    }\n  }, [error]);\n\n  return (\n    <>\n      <Tooltip\n        content={t`Set the instance enabled or disabled. If disabled, jobs will not be assigned to this instance.`}\n        position=\"top\"\n      >\n        <Switch\n          className={className}\n          css=\"display: inline-flex;\"\n          id={`host-${instance.id}-toggle`}\n          label={t`Enabled`}\n          labelOff={t`Disabled`}\n          isChecked={isEnabled}\n          isDisabled={isLoading || !me?.is_superuser}\n          onChange={toggleInstance}\n          ouiaId={`host-${instance.id}-toggle`}\n          aria-label={t`Toggle instance`}\n        />\n      </Tooltip>\n      {showError && error && !isLoading && (\n        <AlertModal\n          variant=\"error\"\n          title={t`Error!`}\n          isOpen={error && !isLoading}\n          onClose={() => setShowError(false)}\n        >\n          {t`Failed to toggle instance.`}\n          <ErrorDetail error={error} />\n        </AlertModal>\n      )}\n    </>\n  );\n}\n\nexport default InstanceToggle;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}