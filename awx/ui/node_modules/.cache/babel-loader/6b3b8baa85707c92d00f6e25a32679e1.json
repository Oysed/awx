{"ast":null,"code":"import{i18n}from\"@lingui/core\";import React,{useContext}from'react';import{WorkflowDispatchContext,WorkflowStateContext}from'contexts/Workflow';import{getAddedAndRemoved}from'util/lists';import NodeModal from'./NodeModal';import{jsx as _jsx}from\"react/jsx-runtime\";function NodeAddModal(){var dispatch=useContext(WorkflowDispatchContext);var _useContext=useContext(WorkflowStateContext),addNodeSource=_useContext.addNodeSource;var addNode=function addNode(values,config){var approvalName=values.approvalName,approvalDescription=values.approvalDescription,timeoutMinutes=values.timeoutMinutes,timeoutSeconds=values.timeoutSeconds,linkType=values.linkType,convergence=values.convergence,identifier=values.identifier;if(values){var _config$defaults;var _getAddedAndRemoved=getAddedAndRemoved(config===null||config===void 0?void 0:(_config$defaults=config.defaults)===null||_config$defaults===void 0?void 0:_config$defaults.credentials,values===null||values===void 0?void 0:values.credentials),added=_getAddedAndRemoved.added,removed=_getAddedAndRemoved.removed;values.addedCredentials=added;values.removedCredentials=removed;}var node={linkType:linkType,all_parents_must_converge:convergence==='all',identifier:identifier};delete values.convergence;delete values.linkType;if(values.nodeType==='workflow_approval_template'){node.nodeResource={description:approvalDescription,name:approvalName,timeout:Number(timeoutMinutes)*60+Number(timeoutSeconds),type:'workflow_approval_template'};}else{node.nodeResource=values.nodeResource;if((values===null||values===void 0?void 0:values.nodeType)==='job_template'||(values===null||values===void 0?void 0:values.nodeType)==='workflow_job_template'){node.promptValues=values;}if((values===null||values===void 0?void 0:values.nodeType)==='system_job_template'){node.promptValues={extra_data:values===null||values===void 0?void 0:values.extra_data};}}dispatch({type:'CREATE_NODE',node:node});};return/*#__PURE__*/_jsx(NodeModal,{askLinkType:addNodeSource!==1,onSave:addNode,title:/*i18n*/i18n._(\"Add Node\")});}export default NodeAddModal;","map":{"version":3,"names":["React","useContext","WorkflowDispatchContext","WorkflowStateContext","getAddedAndRemoved","NodeModal","jsx","_jsx","NodeAddModal","dispatch","_useContext","addNodeSource","addNode","values","config","approvalName","approvalDescription","timeoutMinutes","timeoutSeconds","linkType","convergence","identifier","_config$defaults","_getAddedAndRemoved","defaults","credentials","added","removed","addedCredentials","removedCredentials","node","all_parents_must_converge","nodeType","nodeResource","description","name","timeout","Number","type","promptValues","extra_data","askLinkType","onSave","title","i18n","_"],"sources":["/awx_devel/awx/ui/src/screens/Template/WorkflowJobTemplateVisualizer/Modals/NodeModals/NodeAddModal.js"],"sourcesContent":["import React, { useContext } from 'react';\n\nimport { t } from '@lingui/macro';\nimport {\n  WorkflowDispatchContext,\n  WorkflowStateContext,\n} from 'contexts/Workflow';\nimport { getAddedAndRemoved } from 'util/lists';\nimport NodeModal from './NodeModal';\n\nfunction NodeAddModal() {\n  const dispatch = useContext(WorkflowDispatchContext);\n  const { addNodeSource } = useContext(WorkflowStateContext);\n\n  const addNode = (values, config) => {\n    const {\n      approvalName,\n      approvalDescription,\n      timeoutMinutes,\n      timeoutSeconds,\n      linkType,\n      convergence,\n      identifier,\n    } = values;\n\n    if (values) {\n      const { added, removed } = getAddedAndRemoved(\n        config?.defaults?.credentials,\n        values?.credentials\n      );\n\n      values.addedCredentials = added;\n      values.removedCredentials = removed;\n    }\n\n    const node = {\n      linkType,\n      all_parents_must_converge: convergence === 'all',\n      identifier,\n    };\n\n    delete values.convergence;\n\n    delete values.linkType;\n\n    if (values.nodeType === 'workflow_approval_template') {\n      node.nodeResource = {\n        description: approvalDescription,\n        name: approvalName,\n        timeout: Number(timeoutMinutes) * 60 + Number(timeoutSeconds),\n        type: 'workflow_approval_template',\n      };\n    } else {\n      node.nodeResource = values.nodeResource;\n      if (\n        values?.nodeType === 'job_template' ||\n        values?.nodeType === 'workflow_job_template'\n      ) {\n        node.promptValues = values;\n      }\n      if (values?.nodeType === 'system_job_template') {\n        node.promptValues = {\n          extra_data: values?.extra_data,\n        };\n      }\n    }\n\n    dispatch({\n      type: 'CREATE_NODE',\n      node,\n    });\n  };\n\n  return (\n    <NodeModal\n      askLinkType={addNodeSource !== 1}\n      onSave={addNode}\n      title={t`Add Node`}\n    />\n  );\n}\n\nexport default NodeAddModal;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}