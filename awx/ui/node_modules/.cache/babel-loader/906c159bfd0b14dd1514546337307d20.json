{"ast":null,"code":"import _taggedTemplateLiteral from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral.js\";var _templateObject,_templateObject2;import{i18n}from\"@lingui/core\";import React,{useEffect,useRef,useCallback}from'react';import ReactAce from'react-ace';import'ace-builds/src-noconflict/mode-json';import'ace-builds/src-noconflict/mode-javascript';import'ace-builds/src-noconflict/mode-yaml';import'ace-builds/src-noconflict/mode-django';import'ace-builds/src-noconflict/theme-github';import styled from'styled-components';import debounce from'util/debounce';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var LINE_HEIGHT=24;var PADDING=12;var FocusWrapper=styled.div(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  && + .keyboard-help-text {\\n    opacity: 0;\\n    transition: opacity 0.1s linear;\\n  }\\n\\n  &:focus-within + .keyboard-help-text {\\n    opacity: 1;\\n  }\\n\\n  & .ace_hidden-cursors .ace_cursor {\\n    opacity: 0;\\n  }\\n\"])));var AceEditor=styled(ReactAce)(_templateObject2||(_templateObject2=_taggedTemplateLiteral([\"\\n  font-family: var(--pf-global--FontFamily--monospace);\\n  max-height: 90vh;\\n\\n  & .ace_gutter,\\n  & .ace_scroller {\\n    padding-top: 4px;\\n    padding-bottom: 4px;\\n  }\\n\\n  & .ace_mobile-menu {\\n    display: none;\\n  }\\n\\n  \",\"\\n\\n  \",\"\\n\"])),function(props){return props.hasErrors&&\"\\n    && {\\n      --pf-c-form-control--PaddingRight: var(--pf-c-form-control--invalid--PaddingRight);\\n      --pf-c-form-control--BorderBottomColor: var(--pf-c-form-control--invalid--BorderBottomColor);\\n      padding-right: 24px;\\n      padding-bottom: var(--pf-c-form-control--invalid--PaddingBottom);\\n      background: var(--pf-c-form-control--invalid--Background);\\n      border-bottom-width: var(--pf-c-form-control--invalid--BorderBottomWidth);\\n    }\";},function(props){return props.setOptions.readOnly&&\"\\n    && .ace_cursor {\\n      opacity: 0;\\n    }\\n    \";});AceEditor.displayName='AceEditor';function CodeEditor(_ref){var id=_ref.id,value=_ref.value,onChange=_ref.onChange,onFocus=_ref.onFocus,onBlur=_ref.onBlur,mode=_ref.mode,readOnly=_ref.readOnly,hasErrors=_ref.hasErrors,rows=_ref.rows,fullHeight=_ref.fullHeight,className=_ref.className;if(rows&&typeof rows!=='number'&&rows!=='auto'){// eslint-disable-next-line no-console\nconsole.warn(\"CodeEditor: Unexpected value for 'rows': \".concat(rows,\"; expected number or 'auto'\"));}var wrapper=useRef(null);var editor=useRef(null);useEffect(function(){var _editor$current$refEd;var editorInput=(_editor$current$refEd=editor.current.refEditor)===null||_editor$current$refEd===void 0?void 0:_editor$current$refEd.querySelector('textarea');if(!editorInput){return;}if(!readOnly){editorInput.tabIndex=-1;}editorInput.id=id;},[readOnly,id]);var listen=useCallback(function(event){if(wrapper.current===document.activeElement&&event.key==='Enter'){var _editor$current$refEd2;var editorInput=(_editor$current$refEd2=editor.current.refEditor)===null||_editor$current$refEd2===void 0?void 0:_editor$current$refEd2.querySelector('textarea');if(!editorInput){return;}event.preventDefault();event.stopPropagation();editorInput.focus();}},[]);useEffect(function(){var wrapperEl=wrapper.current;wrapperEl.addEventListener('keydown',listen);return function(){wrapperEl.removeEventListener('keydown',listen);};});var aceModes={javascript:'json',yaml:'yaml',jinja2:'django'};var numRows=rows==='auto'?value.split('\\n').length:rows;var height=fullHeight?'50vh':\"\".concat(numRows*LINE_HEIGHT+PADDING,\"px\");return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(FocusWrapper,{ref:wrapper,tabIndex:readOnly?-1:0,children:/*#__PURE__*/_jsx(AceEditor,{mode:aceModes[mode]||'text',className:\"pf-c-form-control \".concat(className),theme:\"github\",onChange:debounce(onChange,250),value:value,onFocus:onFocus,onBlur:onBlur,name:\"\".concat(id,\"-editor\")||'code-editor',editorProps:{$blockScrolling:true},fontSize:16,width:\"100%\",height:height,hasErrors:hasErrors,setOptions:{readOnly:readOnly,highlightActiveLine:!readOnly,highlightGutterLine:!readOnly,useWorker:false,showPrintMargin:false},commands:[{name:'escape',bindKey:{win:'Esc',mac:'Esc'},exec:function exec(){wrapper.current.focus();}},{name:'tab escape',bindKey:{win:'Shift-Tab',mac:'Shift-Tab'},exec:function exec(){wrapper.current.focus();}}],ref:editor})}),!readOnly&&/*#__PURE__*/_jsx(\"div\",{className:\"pf-c-form__helper-text keyboard-help-text\",\"aria-live\":\"polite\",children:/*i18n*/i18n._(\"Press Enter to edit. Press ESC to stop editing.\")})]});}CodeEditor.defaultProps={readOnly:false,onChange:function onChange(){},rows:6,fullHeight:false,hasErrors:false,className:''};export default CodeEditor;","map":{"version":3,"names":["React","useEffect","useRef","useCallback","ReactAce","styled","debounce","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","LINE_HEIGHT","PADDING","FocusWrapper","div","_templateObject","_taggedTemplateLiteral","AceEditor","_templateObject2","props","hasErrors","setOptions","readOnly","displayName","CodeEditor","_ref","id","value","onChange","onFocus","onBlur","mode","rows","fullHeight","className","console","warn","concat","wrapper","editor","_editor$current$refEd","editorInput","current","refEditor","querySelector","tabIndex","listen","event","document","activeElement","key","_editor$current$refEd2","preventDefault","stopPropagation","focus","wrapperEl","addEventListener","removeEventListener","aceModes","javascript","yaml","jinja2","numRows","split","length","height","children","ref","theme","name","editorProps","$blockScrolling","fontSize","width","highlightActiveLine","highlightGutterLine","useWorker","showPrintMargin","commands","bindKey","win","mac","exec","i18n","_","defaultProps"],"sources":["/awx_devel/awx/ui/src/components/CodeEditor/CodeEditor.js"],"sourcesContent":["import React, { useEffect, useRef, useCallback } from 'react';\nimport { oneOf, bool, number, string, func, oneOfType } from 'prop-types';\n\nimport ReactAce from 'react-ace';\nimport 'ace-builds/src-noconflict/mode-json';\nimport 'ace-builds/src-noconflict/mode-javascript';\nimport 'ace-builds/src-noconflict/mode-yaml';\nimport 'ace-builds/src-noconflict/mode-django';\nimport 'ace-builds/src-noconflict/theme-github';\n\nimport { t } from '@lingui/macro';\nimport styled from 'styled-components';\nimport debounce from 'util/debounce';\n\nconst LINE_HEIGHT = 24;\nconst PADDING = 12;\n\nconst FocusWrapper = styled.div`\n  && + .keyboard-help-text {\n    opacity: 0;\n    transition: opacity 0.1s linear;\n  }\n\n  &:focus-within + .keyboard-help-text {\n    opacity: 1;\n  }\n\n  & .ace_hidden-cursors .ace_cursor {\n    opacity: 0;\n  }\n`;\n\nconst AceEditor = styled(ReactAce)`\n  font-family: var(--pf-global--FontFamily--monospace);\n  max-height: 90vh;\n\n  & .ace_gutter,\n  & .ace_scroller {\n    padding-top: 4px;\n    padding-bottom: 4px;\n  }\n\n  & .ace_mobile-menu {\n    display: none;\n  }\n\n  ${(props) =>\n    props.hasErrors &&\n    `\n    && {\n      --pf-c-form-control--PaddingRight: var(--pf-c-form-control--invalid--PaddingRight);\n      --pf-c-form-control--BorderBottomColor: var(--pf-c-form-control--invalid--BorderBottomColor);\n      padding-right: 24px;\n      padding-bottom: var(--pf-c-form-control--invalid--PaddingBottom);\n      background: var(--pf-c-form-control--invalid--Background);\n      border-bottom-width: var(--pf-c-form-control--invalid--BorderBottomWidth);\n    }`}\n\n  ${(props) =>\n    props.setOptions.readOnly &&\n    `\n    && .ace_cursor {\n      opacity: 0;\n    }\n    `}\n`;\nAceEditor.displayName = 'AceEditor';\n\nfunction CodeEditor({\n  id,\n  value,\n  onChange,\n  onFocus,\n  onBlur,\n  mode,\n  readOnly,\n  hasErrors,\n  rows,\n  fullHeight,\n  className,\n}) {\n  if (rows && typeof rows !== 'number' && rows !== 'auto') {\n    // eslint-disable-next-line no-console\n    console.warn(\n      `CodeEditor: Unexpected value for 'rows': ${rows}; expected number or 'auto'`\n    );\n  }\n\n  const wrapper = useRef(null);\n  const editor = useRef(null);\n\n  useEffect(() => {\n    const editorInput = editor.current.refEditor?.querySelector('textarea');\n    if (!editorInput) {\n      return;\n    }\n    if (!readOnly) {\n      editorInput.tabIndex = -1;\n    }\n    editorInput.id = id;\n  }, [readOnly, id]);\n\n  const listen = useCallback((event) => {\n    if (wrapper.current === document.activeElement && event.key === 'Enter') {\n      const editorInput = editor.current.refEditor?.querySelector('textarea');\n      if (!editorInput) {\n        return;\n      }\n      event.preventDefault();\n      event.stopPropagation();\n      editorInput.focus();\n    }\n  }, []);\n\n  useEffect(() => {\n    const wrapperEl = wrapper.current;\n    wrapperEl.addEventListener('keydown', listen);\n\n    return () => {\n      wrapperEl.removeEventListener('keydown', listen);\n    };\n  });\n\n  const aceModes = {\n    javascript: 'json',\n    yaml: 'yaml',\n    jinja2: 'django',\n  };\n\n  const numRows = rows === 'auto' ? value.split('\\n').length : rows;\n  const height = fullHeight ? '50vh' : `${numRows * LINE_HEIGHT + PADDING}px`;\n\n  return (\n    <>\n      <FocusWrapper ref={wrapper} tabIndex={readOnly ? -1 : 0}>\n        <AceEditor\n          mode={aceModes[mode] || 'text'}\n          className={`pf-c-form-control ${className}`}\n          theme=\"github\"\n          onChange={debounce(onChange, 250)}\n          value={value}\n          onFocus={onFocus}\n          onBlur={onBlur}\n          name={`${id}-editor` || 'code-editor'}\n          editorProps={{ $blockScrolling: true }}\n          fontSize={16}\n          width=\"100%\"\n          height={height}\n          hasErrors={hasErrors}\n          setOptions={{\n            readOnly,\n            highlightActiveLine: !readOnly,\n            highlightGutterLine: !readOnly,\n            useWorker: false,\n            showPrintMargin: false,\n          }}\n          commands={[\n            {\n              name: 'escape',\n              bindKey: { win: 'Esc', mac: 'Esc' },\n              exec: () => {\n                wrapper.current.focus();\n              },\n            },\n            {\n              name: 'tab escape',\n              bindKey: { win: 'Shift-Tab', mac: 'Shift-Tab' },\n              exec: () => {\n                wrapper.current.focus();\n              },\n            },\n          ]}\n          ref={editor}\n        />\n      </FocusWrapper>\n      {!readOnly && (\n        <div\n          className=\"pf-c-form__helper-text keyboard-help-text\"\n          aria-live=\"polite\"\n        >\n          {t`Press Enter to edit. Press ESC to stop editing.`}\n        </div>\n      )}\n    </>\n  );\n}\nCodeEditor.propTypes = {\n  value: string.isRequired,\n  onChange: func,\n  mode: oneOf(['javascript', 'yaml', 'jinja2']).isRequired,\n  readOnly: bool,\n  hasErrors: bool,\n  fullHeight: bool,\n  rows: oneOfType([number, string]),\n  className: string,\n};\nCodeEditor.defaultProps = {\n  readOnly: false,\n  onChange: () => {},\n  rows: 6,\n  fullHeight: false,\n  hasErrors: false,\n  className: '',\n};\n\nexport default CodeEditor;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}