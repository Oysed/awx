{"ast":null,"code":"import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{i18n}from\"@lingui/core\";import React,{useEffect,useCallback}from'react';import{useHistory}from'react-router-dom';import{useField}from'formik';import{Form,FormGroup}from'@patternfly/react-core';import{ExecutionEnvironmentsAPI}from'api';import{parseQueryString,getQSConfig,mergeParams}from'util/qs';import{getSearchableKeys}from'components/PaginatedTable';import useRequest from'hooks/useRequest';import Popover from'../Popover';import ContentError from'../ContentError';import ContentLoading from'../ContentLoading';import OptionsList from'../OptionsList';import{jsx as _jsx}from\"react/jsx-runtime\";var QS_CONFIG=getQSConfig('execution_environments',{page:1,page_size:5,order_by:'name'});function AdHocExecutionEnvironmentStep(_ref){var organizationId=_ref.organizationId;var history=useHistory();var _useField=useField('execution_environment'),_useField2=_slicedToArray(_useField,3),executionEnvironmentField=_useField2[0],executionEnvironmentHelpers=_useField2[2];var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _actionsResponse$data,_actionsResponse$data2;var params,globallyAvailableParams,organizationIdParams,_yield$Promise$all,_yield$Promise$all2,_yield$Promise$all2$,results,count,actionsResponse;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:params=parseQueryString(QS_CONFIG,history.location.search);globallyAvailableParams={or__organization__isnull:'True'};organizationIdParams=organizationId?{or__organization__id:organizationId}:{};_context.next=5;return Promise.all([ExecutionEnvironmentsAPI.read(mergeParams(params,_objectSpread(_objectSpread({},globallyAvailableParams),organizationIdParams))),ExecutionEnvironmentsAPI.readOptions()]);case 5:_yield$Promise$all=_context.sent;_yield$Promise$all2=_slicedToArray(_yield$Promise$all,2);_yield$Promise$all2$=_yield$Promise$all2[0].data;results=_yield$Promise$all2$.results;count=_yield$Promise$all2$.count;actionsResponse=_yield$Promise$all2[1];return _context.abrupt(\"return\",{executionEnvironments:results,executionEnvironmentsCount:count,relatedSearchableKeys:((actionsResponse===null||actionsResponse===void 0?void 0:(_actionsResponse$data=actionsResponse.data)===null||_actionsResponse$data===void 0?void 0:_actionsResponse$data.related_search_fields)||[]).map(function(val){return val.slice(0,-8);}),searchableKeys:getSearchableKeys((_actionsResponse$data2=actionsResponse.data.actions)===null||_actionsResponse$data2===void 0?void 0:_actionsResponse$data2.GET)});case 12:case\"end\":return _context.stop();}}},_callee);})),[history.location.search,organizationId]),{executionEnvironments:[],executionEnvironmentsCount:0,relatedSearchableKeys:[],searchableKeys:[]}),error=_useRequest.error,isLoading=_useRequest.isLoading,fetchExecutionEnvironments=_useRequest.request,_useRequest$result=_useRequest.result,executionEnvironments=_useRequest$result.executionEnvironments,executionEnvironmentsCount=_useRequest$result.executionEnvironmentsCount,relatedSearchableKeys=_useRequest$result.relatedSearchableKeys,searchableKeys=_useRequest$result.searchableKeys;useEffect(function(){fetchExecutionEnvironments();},[fetchExecutionEnvironments]);if(error){return/*#__PURE__*/_jsx(ContentError,{error:error});}if(isLoading){return/*#__PURE__*/_jsx(ContentLoading,{});}return/*#__PURE__*/_jsx(Form,{autoComplete:\"off\",children:/*#__PURE__*/_jsx(FormGroup,{fieldId:\"execution_enviroment\",label:/*i18n*/i18n._(\"Execution Environment\"),\"aria-label\":/*i18n*/i18n._(\"Execution Environment\"),labelIcon:/*#__PURE__*/_jsx(Popover,{content:/*i18n*/i18n._(\"Select the Execution Environment you want this command to run inside.\")}),children:/*#__PURE__*/_jsx(OptionsList,{isLoading:isLoading,value:executionEnvironmentField.value||[],options:executionEnvironments,optionCount:executionEnvironmentsCount,header:/*i18n*/i18n._(\"Execution Environments\"),qsConfig:QS_CONFIG,searchColumns:[{name:/*i18n*/i18n._(\"Name\"),key:'name__icontains',isDefault:true},{name:/*i18n*/i18n._(\"Created By (Username)\"),key:'created_by__username'},{name:/*i18n*/i18n._(\"Modified By (Username)\"),key:'modified_by__username'}],sortColumns:[{name:/*i18n*/i18n._(\"Name\"),key:'name'}],name:\"execution_environment\",searchableKeys:searchableKeys,relatedSearchableKeys:relatedSearchableKeys,selectItem:function selectItem(value){executionEnvironmentHelpers.setValue([value]);},deselectItem:function deselectItem(){executionEnvironmentHelpers.setValue([]);}})})});}export default AdHocExecutionEnvironmentStep;","map":{"version":3,"names":["React","useEffect","useCallback","useHistory","useField","Form","FormGroup","ExecutionEnvironmentsAPI","parseQueryString","getQSConfig","mergeParams","getSearchableKeys","useRequest","Popover","ContentError","ContentLoading","OptionsList","jsx","_jsx","QS_CONFIG","page","page_size","order_by","AdHocExecutionEnvironmentStep","_ref","organizationId","history","_useField","_useField2","_slicedToArray","executionEnvironmentField","executionEnvironmentHelpers","_useRequest","_asyncToGenerator","_regeneratorRuntime","mark","_callee","_actionsResponse$data","_actionsResponse$data2","params","globallyAvailableParams","organizationIdParams","_yield$Promise$all","_yield$Promise$all2","_yield$Promise$all2$","results","count","actionsResponse","wrap","_callee$","_context","prev","next","location","search","or__organization__isnull","or__organization__id","Promise","all","read","_objectSpread","readOptions","sent","data","abrupt","executionEnvironments","executionEnvironmentsCount","relatedSearchableKeys","related_search_fields","map","val","slice","searchableKeys","actions","GET","stop","error","isLoading","fetchExecutionEnvironments","request","_useRequest$result","result","autoComplete","children","fieldId","label","i18n","_","labelIcon","content","value","options","optionCount","header","qsConfig","searchColumns","name","key","isDefault","sortColumns","selectItem","setValue","deselectItem"],"sources":["/awx_devel/awx/ui/src/components/AdHocCommands/AdHocExecutionEnvironmentStep.js"],"sourcesContent":["import React, { useEffect, useCallback } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport { t } from '@lingui/macro';\nimport { useField } from 'formik';\nimport { Form, FormGroup } from '@patternfly/react-core';\nimport { ExecutionEnvironmentsAPI } from 'api';\n\nimport { parseQueryString, getQSConfig, mergeParams } from 'util/qs';\nimport { getSearchableKeys } from 'components/PaginatedTable';\nimport useRequest from 'hooks/useRequest';\nimport Popover from '../Popover';\nimport ContentError from '../ContentError';\nimport ContentLoading from '../ContentLoading';\nimport OptionsList from '../OptionsList';\n\nconst QS_CONFIG = getQSConfig('execution_environments', {\n  page: 1,\n  page_size: 5,\n  order_by: 'name',\n});\nfunction AdHocExecutionEnvironmentStep({ organizationId }) {\n  const history = useHistory();\n  const [executionEnvironmentField, , executionEnvironmentHelpers] = useField(\n    'execution_environment'\n  );\n  const {\n    error,\n    isLoading,\n    request: fetchExecutionEnvironments,\n    result: {\n      executionEnvironments,\n      executionEnvironmentsCount,\n      relatedSearchableKeys,\n      searchableKeys,\n    },\n  } = useRequest(\n    useCallback(async () => {\n      const params = parseQueryString(QS_CONFIG, history.location.search);\n      const globallyAvailableParams = { or__organization__isnull: 'True' };\n      const organizationIdParams = organizationId\n        ? { or__organization__id: organizationId }\n        : {};\n\n      const [\n        {\n          data: { results, count },\n        },\n        actionsResponse,\n      ] = await Promise.all([\n        ExecutionEnvironmentsAPI.read(\n          mergeParams(params, {\n            ...globallyAvailableParams,\n            ...organizationIdParams,\n          })\n        ),\n        ExecutionEnvironmentsAPI.readOptions(),\n      ]);\n      return {\n        executionEnvironments: results,\n        executionEnvironmentsCount: count,\n        relatedSearchableKeys: (\n          actionsResponse?.data?.related_search_fields || []\n        ).map((val) => val.slice(0, -8)),\n        searchableKeys: getSearchableKeys(actionsResponse.data.actions?.GET),\n      };\n    }, [history.location.search, organizationId]),\n    {\n      executionEnvironments: [],\n      executionEnvironmentsCount: 0,\n      relatedSearchableKeys: [],\n      searchableKeys: [],\n    }\n  );\n\n  useEffect(() => {\n    fetchExecutionEnvironments();\n  }, [fetchExecutionEnvironments]);\n\n  if (error) {\n    return <ContentError error={error} />;\n  }\n  if (isLoading) {\n    return <ContentLoading />;\n  }\n\n  return (\n    <Form autoComplete=\"off\">\n      <FormGroup\n        fieldId=\"execution_enviroment\"\n        label={t`Execution Environment`}\n        aria-label={t`Execution Environment`}\n        labelIcon={\n          <Popover\n            content={t`Select the Execution Environment you want this command to run inside.`}\n          />\n        }\n      >\n        <OptionsList\n          isLoading={isLoading}\n          value={executionEnvironmentField.value || []}\n          options={executionEnvironments}\n          optionCount={executionEnvironmentsCount}\n          header={t`Execution Environments`}\n          qsConfig={QS_CONFIG}\n          searchColumns={[\n            {\n              name: t`Name`,\n              key: 'name__icontains',\n              isDefault: true,\n            },\n            {\n              name: t`Created By (Username)`,\n              key: 'created_by__username',\n            },\n            {\n              name: t`Modified By (Username)`,\n              key: 'modified_by__username',\n            },\n          ]}\n          sortColumns={[\n            {\n              name: t`Name`,\n              key: 'name',\n            },\n          ]}\n          name=\"execution_environment\"\n          searchableKeys={searchableKeys}\n          relatedSearchableKeys={relatedSearchableKeys}\n          selectItem={(value) => {\n            executionEnvironmentHelpers.setValue([value]);\n          }}\n          deselectItem={() => {\n            executionEnvironmentHelpers.setValue([]);\n          }}\n        />\n      </FormGroup>\n    </Form>\n  );\n}\nexport default AdHocExecutionEnvironmentStep;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}