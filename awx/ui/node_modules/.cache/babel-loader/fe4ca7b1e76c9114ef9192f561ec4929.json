{"ast":null,"code":"import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import React,{useCallback,useEffect,useState}from'react';import{useHistory}from'react-router-dom';import{Card,PageSection}from'@patternfly/react-core';import useRequest from'hooks/useRequest';import ContentError from'components/ContentError';import{ApplicationsAPI}from'api';import{CardBody}from'components/Card';import ApplicationForm from'../shared/ApplicationForm';import{jsx as _jsx}from\"react/jsx-runtime\";function ApplicationAdd(_ref){var onSuccessfulAdd=_ref.onSuccessfulAdd;var history=useHistory();var _useState=useState(null),_useState2=_slicedToArray(_useState,2),submitError=_useState2[0],setSubmitError=_useState2[1];var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _yield$ApplicationsAP,_yield$ApplicationsAP2,authChoices,clientChoices,authorization,clientType;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return ApplicationsAPI.readOptions();case 2:_yield$ApplicationsAP=_context.sent;_yield$ApplicationsAP2=_yield$ApplicationsAP.data.actions.GET;authChoices=_yield$ApplicationsAP2.authorization_grant_type.choices;clientChoices=_yield$ApplicationsAP2.client_type.choices;authorization=authChoices.map(function(choice){return{value:choice[0],label:choice[1],key:choice[0]};});clientType=clientChoices.map(function(choice){return{value:choice[0],label:choice[1],key:choice[0]};});return _context.abrupt(\"return\",{authorizationOptions:authorization,clientTypeOptions:clientType});case 9:case\"end\":return _context.stop();}}},_callee);})),[]),{authorizationOptions:[],clientTypeOptions:[]}),error=_useRequest.error,fetchOptions=_useRequest.request,_useRequest$result=_useRequest.result,authorizationOptions=_useRequest$result.authorizationOptions,clientTypeOptions=_useRequest$result.clientTypeOptions;var handleSubmit=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(_ref3){var values,_yield$ApplicationsAP3,data;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:values=Object.assign({},_ref3);values.organization=values.organization.id;_context2.prev=2;_context2.next=5;return ApplicationsAPI.create(values);case 5:_yield$ApplicationsAP3=_context2.sent;data=_yield$ApplicationsAP3.data;onSuccessfulAdd(data);history.push(\"/applications/\".concat(data.id,\"/details\"));_context2.next=14;break;case 11:_context2.prev=11;_context2.t0=_context2[\"catch\"](2);setSubmitError(_context2.t0);case 14:case\"end\":return _context2.stop();}}},_callee2,null,[[2,11]]);}));return function handleSubmit(_x){return _ref4.apply(this,arguments);};}();var handleCancel=function handleCancel(){history.push(\"/applications\");};useEffect(function(){fetchOptions();},[fetchOptions]);if(error){return/*#__PURE__*/_jsx(ContentError,{error:error});}return/*#__PURE__*/_jsx(PageSection,{children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(CardBody,{children:/*#__PURE__*/_jsx(ApplicationForm,{onSubmit:handleSubmit,onCancel:handleCancel,authorizationOptions:authorizationOptions,clientTypeOptions:clientTypeOptions,submitError:submitError})})})});}export default ApplicationAdd;","map":{"version":3,"names":["React","useCallback","useEffect","useState","useHistory","Card","PageSection","useRequest","ContentError","ApplicationsAPI","CardBody","ApplicationForm","jsx","_jsx","ApplicationAdd","_ref","onSuccessfulAdd","history","_useState","_useState2","_slicedToArray","submitError","setSubmitError","_useRequest","_asyncToGenerator","_regeneratorRuntime","mark","_callee","_yield$ApplicationsAP","_yield$ApplicationsAP2","authChoices","clientChoices","authorization","clientType","wrap","_callee$","_context","prev","next","readOptions","sent","data","actions","GET","authorization_grant_type","choices","client_type","map","choice","value","label","key","abrupt","authorizationOptions","clientTypeOptions","stop","error","fetchOptions","request","_useRequest$result","result","handleSubmit","_ref4","_callee2","_ref3","values","_yield$ApplicationsAP3","_callee2$","_context2","Object","assign","organization","id","create","push","concat","t0","_x","apply","arguments","handleCancel","children","onSubmit","onCancel"],"sources":["/awx_devel/awx/ui/src/screens/Application/ApplicationAdd/ApplicationAdd.js"],"sourcesContent":["import React, { useCallback, useEffect, useState } from 'react';\nimport { useHistory } from 'react-router-dom';\n\nimport { Card, PageSection } from '@patternfly/react-core';\nimport useRequest from 'hooks/useRequest';\nimport ContentError from 'components/ContentError';\nimport { ApplicationsAPI } from 'api';\nimport { CardBody } from 'components/Card';\nimport ApplicationForm from '../shared/ApplicationForm';\n\nfunction ApplicationAdd({ onSuccessfulAdd }) {\n  const history = useHistory();\n  const [submitError, setSubmitError] = useState(null);\n\n  const {\n    error,\n    request: fetchOptions,\n    result: { authorizationOptions, clientTypeOptions },\n  } = useRequest(\n    useCallback(async () => {\n      const {\n        data: {\n          actions: {\n            GET: {\n              authorization_grant_type: { choices: authChoices },\n              client_type: { choices: clientChoices },\n            },\n          },\n        },\n      } = await ApplicationsAPI.readOptions();\n\n      const authorization = authChoices.map((choice) => ({\n        value: choice[0],\n        label: choice[1],\n        key: choice[0],\n      }));\n      const clientType = clientChoices.map((choice) => ({\n        value: choice[0],\n        label: choice[1],\n        key: choice[0],\n      }));\n\n      return {\n        authorizationOptions: authorization,\n        clientTypeOptions: clientType,\n      };\n    }, []),\n    {\n      authorizationOptions: [],\n      clientTypeOptions: [],\n    }\n  );\n  const handleSubmit = async ({ ...values }) => {\n    values.organization = values.organization.id;\n    try {\n      const { data } = await ApplicationsAPI.create(values);\n      onSuccessfulAdd(data);\n      history.push(`/applications/${data.id}/details`);\n    } catch (err) {\n      setSubmitError(err);\n    }\n  };\n\n  const handleCancel = () => {\n    history.push(`/applications`);\n  };\n\n  useEffect(() => {\n    fetchOptions();\n  }, [fetchOptions]);\n\n  if (error) {\n    return <ContentError error={error} />;\n  }\n  return (\n    <PageSection>\n      <Card>\n        <CardBody>\n          <ApplicationForm\n            onSubmit={handleSubmit}\n            onCancel={handleCancel}\n            authorizationOptions={authorizationOptions}\n            clientTypeOptions={clientTypeOptions}\n            submitError={submitError}\n          />\n        </CardBody>\n      </Card>\n    </PageSection>\n  );\n}\nexport default ApplicationAdd;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}