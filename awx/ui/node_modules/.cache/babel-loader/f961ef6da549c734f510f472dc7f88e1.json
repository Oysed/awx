{"ast":null,"code":"import _createForOfIteratorHelper from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _taggedTemplateLiteral from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral.js\";var _templateObject,_templateObject2;import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{i18n}from\"@lingui/core\";import React,{useCallback,useEffect,useReducer}from'react';import{useHistory}from'react-router-dom';import styled from'styled-components';import{WorkflowDispatchContext,WorkflowStateContext}from'contexts/Workflow';import{getAddedAndRemoved}from'util/lists';import{stringIsUUID}from'util/strings';import AlertModal from'components/AlertModal';import ErrorDetail from'components/ErrorDetail';import{layoutGraph}from'components/Workflow/WorkflowUtils';import ContentError from'components/ContentError';import ContentLoading from'components/ContentLoading';import workflowReducer from'components/Workflow/workflowReducer';import useRequest,{useDismissableError}from'hooks/useRequest';import{OrganizationsAPI,WorkflowApprovalTemplatesAPI,WorkflowJobTemplateNodesAPI,WorkflowJobTemplatesAPI}from'api';import{DeleteAllNodesModal,UnsavedChangesModal}from'./Modals';import{LinkAddModal,LinkDeleteModal,LinkEditModal}from'./Modals/LinkModals';import{NodeAddModal,NodeEditModal,NodeDeleteModal,NodeViewModal}from'./Modals/NodeModals';import VisualizerGraph from'./VisualizerGraph';import VisualizerStartScreen from'./VisualizerStartScreen';import VisualizerToolbar from'./VisualizerToolbar';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var CenteredContent=styled.div(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  align-items: center;\\n  display: flex;\\n  flex-flow: column;\\n  height: 100%;\\n  justify-content: center;\\n\"])));var Wrapper=styled.div(_templateObject2||(_templateObject2=_taggedTemplateLiteral([\"\\n  display: flex;\\n  flex-flow: column;\\n  height: 100%;\\n\"])));var replaceIdentifier=function replaceIdentifier(node){if(stringIsUUID(node.originalNodeObject.identifier)&&typeof node.identifier==='string'&&node.identifier!==''){return true;}if(!stringIsUUID(node.originalNodeObject.identifier)&&node.originalNodeObject.identifier!==node.identifier){return true;}return false;};var getAggregatedCredentials=function getAggregatedCredentials(){var originalNodeOverride=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var templateDefaultCredentials=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];var theArray=[];var isCredentialOverriden=function isCredentialOverriden(templateDefaultCred){var credentialHasOverride=false;originalNodeOverride.forEach(function(overrideCred){if(templateDefaultCred.credential_type===overrideCred.credential_type){var _overrideCred$inputs,_overrideCred$inputs2,_overrideCred$inputs3;if(!templateDefaultCred.vault_id&&!((_overrideCred$inputs=overrideCred.inputs)!==null&&_overrideCred$inputs!==void 0&&_overrideCred$inputs.vault_id)||templateDefaultCred.vault_id&&(_overrideCred$inputs2=overrideCred.inputs)!==null&&_overrideCred$inputs2!==void 0&&_overrideCred$inputs2.vault_id&&templateDefaultCred.vault_id===((_overrideCred$inputs3=overrideCred.inputs)===null||_overrideCred$inputs3===void 0?void 0:_overrideCred$inputs3.vault_id)){credentialHasOverride=true;}}});return credentialHasOverride;};if(templateDefaultCredentials.length>0){templateDefaultCredentials.forEach(function(defaultCred){if(!isCredentialOverriden(defaultCred)){theArray.push(defaultCred);}});}theArray=theArray.concat(originalNodeOverride);return theArray;};var fetchWorkflowNodes=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(templateId){var pageNo,workflowNodes,_yield$WorkflowJobTem,data,_args=arguments;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:pageNo=_args.length>1&&_args[1]!==undefined?_args[1]:1;workflowNodes=_args.length>2&&_args[2]!==undefined?_args[2]:[];_context.next=4;return WorkflowJobTemplatesAPI.readNodes(templateId,{page_size:200,page:pageNo});case 4:_yield$WorkflowJobTem=_context.sent;data=_yield$WorkflowJobTem.data;if(!data.next){_context.next=8;break;}return _context.abrupt(\"return\",fetchWorkflowNodes(templateId,pageNo+1,workflowNodes.concat(data.results)));case 8:return _context.abrupt(\"return\",workflowNodes.concat(data.results));case 9:case\"end\":return _context.stop();}}},_callee);}));return function fetchWorkflowNodes(_x){return _ref.apply(this,arguments);};}();function Visualizer(_ref2){var _template$summary_fie,_template$summary_fie2;var template=_ref2.template;var history=useHistory();var _useReducer=useReducer(workflowReducer,{addLinkSourceNode:null,addLinkTargetNode:null,addNodeSource:null,addNodeTarget:null,addingLink:false,contentError:null,defaultOrganization:null,isLoading:true,linkToDelete:null,linkToEdit:null,links:[],nextNodeId:0,nodePositions:null,nodeToDelete:null,nodeToEdit:null,nodeToView:null,nodes:[],showDeleteAllNodesModal:false,showLegend:false,showTools:false,showUnsavedChangesModal:false,unsavedChanges:false}),_useReducer2=_slicedToArray(_useReducer,2),state=_useReducer2[0],dispatch=_useReducer2[1];var addLinkSourceNode=state.addLinkSourceNode,addLinkTargetNode=state.addLinkTargetNode,addNodeSource=state.addNodeSource,contentError=state.contentError,defaultOrganization=state.defaultOrganization,isLoading=state.isLoading,linkToDelete=state.linkToDelete,linkToEdit=state.linkToEdit,links=state.links,nodeToDelete=state.nodeToDelete,nodeToEdit=state.nodeToEdit,nodeToView=state.nodeToView,nodes=state.nodes,showDeleteAllNodesModal=state.showDeleteAllNodesModal,showUnsavedChangesModal=state.showUnsavedChangesModal,unsavedChanges=state.unsavedChanges;var handleVisualizerClose=function handleVisualizerClose(){if(unsavedChanges){dispatch({type:'TOGGLE_UNSAVED_CHANGES_MODAL'});}else{history.push(\"/templates/workflow_job_template/\".concat(template.id,\"/details\"));}};var associateNodes=function associateNodes(newLinks,originalLinkMap){var associateNodeRequests=[];newLinks.forEach(function(link){switch(link.linkType){case'success':associateNodeRequests.push(WorkflowJobTemplateNodesAPI.associateSuccessNode(originalLinkMap[link.source.id].id,originalLinkMap[link.target.id].id));break;case'failure':associateNodeRequests.push(WorkflowJobTemplateNodesAPI.associateFailureNode(originalLinkMap[link.source.id].id,originalLinkMap[link.target.id].id));break;case'always':associateNodeRequests.push(WorkflowJobTemplateNodesAPI.associateAlwaysNode(originalLinkMap[link.source.id].id,originalLinkMap[link.target.id].id));break;default:}});return associateNodeRequests;};var disassociateNodes=function disassociateNodes(originalLinkMap,deletedNodeIds,linkMap){var disassociateNodeRequests=[];Object.keys(originalLinkMap).forEach(function(key){var node=originalLinkMap[key];node.success_nodes.forEach(function(successNodeId){if(!deletedNodeIds.includes(successNodeId)&&(!linkMap[node.id]||!linkMap[node.id][successNodeId]||linkMap[node.id][successNodeId]!=='success')){disassociateNodeRequests.push(WorkflowJobTemplateNodesAPI.disassociateSuccessNode(node.id,successNodeId));}});node.failure_nodes.forEach(function(failureNodeId){if(!deletedNodeIds.includes(failureNodeId)&&(!linkMap[node.id]||!linkMap[node.id][failureNodeId]||linkMap[node.id][failureNodeId]!=='failure')){disassociateNodeRequests.push(WorkflowJobTemplateNodesAPI.disassociateFailuresNode(node.id,failureNodeId));}});node.always_nodes.forEach(function(alwaysNodeId){if(!deletedNodeIds.includes(alwaysNodeId)&&(!linkMap[node.id]||!linkMap[node.id][alwaysNodeId]||linkMap[node.id][alwaysNodeId]!=='always')){disassociateNodeRequests.push(WorkflowJobTemplateNodesAPI.disassociateAlwaysNode(node.id,alwaysNodeId));}});});return disassociateNodeRequests;};useEffect(function(){function fetchData(){return _fetchData.apply(this,arguments);}function _fetchData(){_fetchData=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var _results$,_yield$OrganizationsA,results,workflowNodes;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return OrganizationsAPI.read({page_size:1,page:1});case 3:_yield$OrganizationsA=_context2.sent;results=_yield$OrganizationsA.data.results;dispatch({type:'SET_DEFAULT_ORGANIZATION',value:(_results$=results[0])===null||_results$===void 0?void 0:_results$.id});_context2.next=8;return fetchWorkflowNodes(template.id);case 8:workflowNodes=_context2.sent;dispatch({type:'GENERATE_NODES_AND_LINKS',nodes:workflowNodes});_context2.next=15;break;case 12:_context2.prev=12;_context2.t0=_context2[\"catch\"](0);dispatch({type:'SET_CONTENT_ERROR',value:_context2.t0});case 15:_context2.prev=15;dispatch({type:'SET_IS_LOADING',value:false});return _context2.finish(15);case 18:case\"end\":return _context2.stop();}}},_callee2,null,[[0,12,15,18]]);}));return _fetchData.apply(this,arguments);}fetchData();},[template.id]);// Update positions of nodes/links\nuseEffect(function(){if(nodes){var newNodePositions={};var nonDeletedNodes=nodes.filter(function(node){return!node.isDeleted;});var g=layoutGraph(nonDeletedNodes,links);g.nodes().forEach(function(node){newNodePositions[node]=g.node(node);});dispatch({type:'SET_NODE_POSITIONS',value:newNodePositions});}},[links,nodes]);var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var nodeRequests,approvalTemplateRequests,originalLinkMap,deletedNodeIds,associateCredentialRequests,disassociateCredentialRequests,associateLabelRequests,disassociateLabelRequests,instanceGroupRequests,generateLinkMapAndNewLinks,_generateLinkMapAndNe,_generateLinkMapAndNe2,linkMap,newLinks;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:nodeRequests=[];approvalTemplateRequests=[];originalLinkMap={};deletedNodeIds=[];associateCredentialRequests=[];disassociateCredentialRequests=[];associateLabelRequests=[];disassociateLabelRequests=[];instanceGroupRequests=[];generateLinkMapAndNewLinks=function generateLinkMapAndNewLinks(){var linkMap={};var newLinks=[];links.forEach(function(link){if(link.source.id!==1){var realLinkSourceId=originalLinkMap[link.source.id].id;var realLinkTargetId=originalLinkMap[link.target.id].id;if(!linkMap[realLinkSourceId]){linkMap[realLinkSourceId]={};}linkMap[realLinkSourceId][realLinkTargetId]=link.linkType;switch(link.linkType){case'success':if(!originalLinkMap[link.source.id].success_nodes.includes(originalLinkMap[link.target.id].id)){newLinks.push(link);}break;case'failure':if(!originalLinkMap[link.source.id].failure_nodes.includes(originalLinkMap[link.target.id].id)){newLinks.push(link);}break;case'always':if(!originalLinkMap[link.source.id].always_nodes.includes(originalLinkMap[link.target.id].id)){newLinks.push(link);}break;default:}}});return[linkMap,newLinks];};nodes.forEach(function(node){// node with id=1 is the artificial start node\nif(node.id===1){return;}if(node.originalNodeObject&&!node.isDeleted){var _node$originalNodeObj=node.originalNodeObject,id=_node$originalNodeObj.id,success_nodes=_node$originalNodeObj.success_nodes,failure_nodes=_node$originalNodeObj.failure_nodes,always_nodes=_node$originalNodeObj.always_nodes;originalLinkMap[node.id]={id:id,success_nodes:success_nodes,failure_nodes:failure_nodes,always_nodes:always_nodes};}if(node.isDeleted&&node.originalNodeObject){deletedNodeIds.push(node.originalNodeObject.id);nodeRequests.push(WorkflowJobTemplateNodesAPI.destroy(node.originalNodeObject.id));}else if(!node.isDeleted&&!node.originalNodeObject){if(node.fullUnifiedJobTemplate.type==='workflow_approval_template'){nodeRequests.push(WorkflowJobTemplatesAPI.createNode(template.id,_objectSpread({all_parents_must_converge:node.all_parents_must_converge},node.identifier&&{identifier:node.identifier})).then(function(_ref4){var data=_ref4.data;node.originalNodeObject=data;originalLinkMap[node.id]={id:data.id,success_nodes:[],failure_nodes:[],always_nodes:[]};approvalTemplateRequests.push(WorkflowJobTemplateNodesAPI.createApprovalTemplate(data.id,{name:node.fullUnifiedJobTemplate.name,description:node.fullUnifiedJobTemplate.description,timeout:node.fullUnifiedJobTemplate.timeout}));}));}else{var _node$promptValues,_node$promptValues$ex,_node$promptValues2,_node$promptValues2$i;nodeRequests.push(WorkflowJobTemplatesAPI.createNode(template.id,_objectSpread(_objectSpread({},node.promptValues),{},{execution_environment:((_node$promptValues=node.promptValues)===null||_node$promptValues===void 0?void 0:(_node$promptValues$ex=_node$promptValues.execution_environment)===null||_node$promptValues$ex===void 0?void 0:_node$promptValues$ex.id)||null,inventory:((_node$promptValues2=node.promptValues)===null||_node$promptValues2===void 0?void 0:(_node$promptValues2$i=_node$promptValues2.inventory)===null||_node$promptValues2$i===void 0?void 0:_node$promptValues2$i.id)||null,unified_job_template:node.fullUnifiedJobTemplate.id,all_parents_must_converge:node.all_parents_must_converge},node.identifier&&{identifier:node.identifier})).then(function(_ref5){var _node$promptValues3,_node$promptValues3$a,_node$promptValues4,_node$promptValues4$l,_node$promptValues5,_node$promptValues5$i;var data=_ref5.data;node.originalNodeObject=data;originalLinkMap[node.id]={id:data.id,success_nodes:[],failure_nodes:[],always_nodes:[]};if(((_node$promptValues3=node.promptValues)===null||_node$promptValues3===void 0?void 0:(_node$promptValues3$a=_node$promptValues3.addedCredentials)===null||_node$promptValues3$a===void 0?void 0:_node$promptValues3$a.length)>0){node.promptValues.addedCredentials.forEach(function(cred){associateCredentialRequests.push(WorkflowJobTemplateNodesAPI.associateCredentials(data.id,cred.id));});}if(((_node$promptValues4=node.promptValues)===null||_node$promptValues4===void 0?void 0:(_node$promptValues4$l=_node$promptValues4.labels)===null||_node$promptValues4$l===void 0?void 0:_node$promptValues4$l.length)>0){node.promptValues.labels.forEach(function(label){associateLabelRequests.push(WorkflowJobTemplateNodesAPI.associateLabel(data.id,label,node.fullUnifiedJobTemplate.organization||defaultOrganization));});}if(((_node$promptValues5=node.promptValues)===null||_node$promptValues5===void 0?void 0:(_node$promptValues5$i=_node$promptValues5.instance_groups)===null||_node$promptValues5$i===void 0?void 0:_node$promptValues5$i.length)>0){/* eslint-disable no-await-in-loop, no-restricted-syntax */var _iterator=_createForOfIteratorHelper(node.promptValues.instance_groups),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var group=_step.value;instanceGroupRequests.push(WorkflowJobTemplateNodesAPI.associateInstanceGroup(data.id,group.id));}}catch(err){_iterator.e(err);}finally{_iterator.f();}}}));}}else if(node.isEdited){if(node.fullUnifiedJobTemplate.type==='workflow_approval_template'){var _node$originalNodeObj2;if(((_node$originalNodeObj2=node.originalNodeObject.summary_fields.unified_job_template)===null||_node$originalNodeObj2===void 0?void 0:_node$originalNodeObj2.unified_job_type)==='workflow_approval'){nodeRequests.push(WorkflowJobTemplateNodesAPI.update(node.originalNodeObject.id,_objectSpread({all_parents_must_converge:node.all_parents_must_converge},replaceIdentifier(node)&&{identifier:node.identifier})).then(function(_ref6){var data=_ref6.data;node.originalNodeObject=data;approvalTemplateRequests.push(WorkflowApprovalTemplatesAPI.update(node.originalNodeObject.summary_fields.unified_job_template.id,{name:node.fullUnifiedJobTemplate.name,description:node.fullUnifiedJobTemplate.description,timeout:node.fullUnifiedJobTemplate.timeout}));}));}else{nodeRequests.push(WorkflowJobTemplateNodesAPI.update(node.originalNodeObject.id,_objectSpread({all_parents_must_converge:node.all_parents_must_converge},replaceIdentifier(node)&&{identifier:node.identifier})).then(function(_ref7){var data=_ref7.data;node.originalNodeObject=data;approvalTemplateRequests.push(WorkflowJobTemplateNodesAPI.createApprovalTemplate(node.originalNodeObject.id,{name:node.fullUnifiedJobTemplate.name,description:node.fullUnifiedJobTemplate.description,timeout:node.fullUnifiedJobTemplate.timeout}));}));}}else{var _node$promptValues6,_node$promptValues6$e,_node$promptValues7,_node$promptValues7$i;nodeRequests.push(WorkflowJobTemplateNodesAPI.update(node.originalNodeObject.id,_objectSpread(_objectSpread({},node.promptValues),{},{execution_environment:((_node$promptValues6=node.promptValues)===null||_node$promptValues6===void 0?void 0:(_node$promptValues6$e=_node$promptValues6.execution_environment)===null||_node$promptValues6$e===void 0?void 0:_node$promptValues6$e.id)||null,inventory:((_node$promptValues7=node.promptValues)===null||_node$promptValues7===void 0?void 0:(_node$promptValues7$i=_node$promptValues7.inventory)===null||_node$promptValues7$i===void 0?void 0:_node$promptValues7$i.id)||null,unified_job_template:node.fullUnifiedJobTemplate.id,all_parents_must_converge:node.all_parents_must_converge},replaceIdentifier(node)&&{identifier:node.identifier})).then(function(){var _node$launchConfig,_node$launchConfig$de,_node$promptValues8,_node$promptValues9,_node$promptValues10;var _getAddedAndRemoved=getAddedAndRemoved(getAggregatedCredentials(node===null||node===void 0?void 0:node.originalNodeCredentials,(_node$launchConfig=node.launchConfig)===null||_node$launchConfig===void 0?void 0:(_node$launchConfig$de=_node$launchConfig.defaults)===null||_node$launchConfig$de===void 0?void 0:_node$launchConfig$de.credentials),(_node$promptValues8=node.promptValues)===null||_node$promptValues8===void 0?void 0:_node$promptValues8.credentials),addedCredentials=_getAddedAndRemoved.added,removedCredentials=_getAddedAndRemoved.removed;var _getAddedAndRemoved2=getAddedAndRemoved(node===null||node===void 0?void 0:node.originalNodeLabels,(_node$promptValues9=node.promptValues)===null||_node$promptValues9===void 0?void 0:_node$promptValues9.labels),addedLabels=_getAddedAndRemoved2.added,removedLabels=_getAddedAndRemoved2.removed;if(addedCredentials.length>0){addedCredentials.forEach(function(cred){associateCredentialRequests.push(WorkflowJobTemplateNodesAPI.associateCredentials(node.originalNodeObject.id,cred.id));});}if((removedCredentials===null||removedCredentials===void 0?void 0:removedCredentials.length)>0){removedCredentials.forEach(function(cred){return disassociateCredentialRequests.push(WorkflowJobTemplateNodesAPI.disassociateCredentials(node.originalNodeObject.id,cred.id));});}if(addedLabels.length>0){addedLabels.forEach(function(label){associateLabelRequests.push(WorkflowJobTemplateNodesAPI.associateLabel(node.originalNodeObject.id,label,node.fullUnifiedJobTemplate.organization||defaultOrganization));});}if((removedLabels===null||removedLabels===void 0?void 0:removedLabels.length)>0){removedLabels.forEach(function(label){return disassociateLabelRequests.push(WorkflowJobTemplateNodesAPI.disassociateLabel(node.originalNodeObject.id,label,node.fullUnifiedJobTemplate.organization||defaultOrganization));});}if((_node$promptValues10=node.promptValues)!==null&&_node$promptValues10!==void 0&&_node$promptValues10.instance_groups){var _node$promptValues11;instanceGroupRequests.push(WorkflowJobTemplateNodesAPI.orderInstanceGroups(node.originalNodeObject.id,(_node$promptValues11=node.promptValues)===null||_node$promptValues11===void 0?void 0:_node$promptValues11.instance_groups,(node===null||node===void 0?void 0:node.originalNodeInstanceGroups)||[]));}}));}}});_context3.next=13;return Promise.all(nodeRequests);case 13:_context3.next=15;return Promise.all(approvalTemplateRequests);case 15:_generateLinkMapAndNe=generateLinkMapAndNewLinks(originalLinkMap),_generateLinkMapAndNe2=_slicedToArray(_generateLinkMapAndNe,2),linkMap=_generateLinkMapAndNe2[0],newLinks=_generateLinkMapAndNe2[1];_context3.next=18;return Promise.all(disassociateNodes(originalLinkMap,deletedNodeIds,linkMap));case 18:_context3.next=20;return Promise.all(associateNodes(newLinks,originalLinkMap));case 20:_context3.next=22;return Promise.all([].concat(disassociateCredentialRequests,disassociateLabelRequests));case 22:_context3.next=24;return Promise.all([].concat(associateCredentialRequests,associateLabelRequests,instanceGroupRequests));case 24:history.push(\"/templates/workflow_job_template/\".concat(template.id,\"/details\"));case 25:case\"end\":return _context3.stop();}}},_callee3);})),[links,nodes,history,defaultOrganization,template.id]),{}),saveVisualizerError=_useRequest.error,isSavingVisualizer=_useRequest.isLoading,saveVisualizer=_useRequest.request;var _useDismissableError=useDismissableError(saveVisualizerError),nodeRequestError=_useDismissableError.error,dismissNodeRequestError=_useDismissableError.dismissError;if(isLoading||isSavingVisualizer){return/*#__PURE__*/_jsx(CenteredContent,{children:/*#__PURE__*/_jsx(ContentLoading,{})});}if(contentError){return/*#__PURE__*/_jsx(CenteredContent,{children:/*#__PURE__*/_jsx(ContentError,{error:contentError})});}var readOnly=!(template!==null&&template!==void 0&&(_template$summary_fie=template.summary_fields)!==null&&_template$summary_fie!==void 0&&(_template$summary_fie2=_template$summary_fie.user_capabilities)!==null&&_template$summary_fie2!==void 0&&_template$summary_fie2.edit);return/*#__PURE__*/_jsx(WorkflowStateContext.Provider,{value:state,children:/*#__PURE__*/_jsxs(WorkflowDispatchContext.Provider,{value:dispatch,children:[/*#__PURE__*/_jsxs(Wrapper,{children:[/*#__PURE__*/_jsx(VisualizerToolbar,{onClose:handleVisualizerClose,onSave:function onSave(){return saveVisualizer(nodes);},hasUnsavedChanges:unsavedChanges,template:template,readOnly:readOnly}),links.length>0?/*#__PURE__*/_jsx(VisualizerGraph,{readOnly:readOnly}):/*#__PURE__*/_jsx(VisualizerStartScreen,{readOnly:readOnly})]}),nodeToDelete&&/*#__PURE__*/_jsx(NodeDeleteModal,{}),linkToDelete&&/*#__PURE__*/_jsx(LinkDeleteModal,{}),linkToEdit&&/*#__PURE__*/_jsx(LinkEditModal,{}),addLinkSourceNode&&addLinkTargetNode&&/*#__PURE__*/_jsx(LinkAddModal,{}),addNodeSource&&/*#__PURE__*/_jsx(NodeAddModal,{}),nodeToEdit&&/*#__PURE__*/_jsx(NodeEditModal,{}),showUnsavedChangesModal&&/*#__PURE__*/_jsx(UnsavedChangesModal,{onExit:function onExit(){return history.push(\"/templates/workflow_job_template/\".concat(template.id,\"/details\"));},onSaveAndExit:function onSaveAndExit(){return saveVisualizer(nodes);}}),showDeleteAllNodesModal&&/*#__PURE__*/_jsx(DeleteAllNodesModal,{}),nodeToView&&/*#__PURE__*/_jsx(NodeViewModal,{readOnly:readOnly}),nodeRequestError&&/*#__PURE__*/_jsxs(AlertModal,{isOpen:true,variant:\"error\",title:/*i18n*/i18n._(\"Error saving the workflow!\"),onClose:dismissNodeRequestError,\"aria-label\":/*i18n*/i18n._(\"Error saving the workflow!\"),children:[/*i18n*/i18n._(\"There was an error saving the workflow.\"),/*#__PURE__*/_jsx(ErrorDetail,{error:nodeRequestError})]})]})});}export default Visualizer;","map":{"version":3,"names":["React","useCallback","useEffect","useReducer","useHistory","styled","WorkflowDispatchContext","WorkflowStateContext","getAddedAndRemoved","stringIsUUID","AlertModal","ErrorDetail","layoutGraph","ContentError","ContentLoading","workflowReducer","useRequest","useDismissableError","OrganizationsAPI","WorkflowApprovalTemplatesAPI","WorkflowJobTemplateNodesAPI","WorkflowJobTemplatesAPI","DeleteAllNodesModal","UnsavedChangesModal","LinkAddModal","LinkDeleteModal","LinkEditModal","NodeAddModal","NodeEditModal","NodeDeleteModal","NodeViewModal","VisualizerGraph","VisualizerStartScreen","VisualizerToolbar","jsx","_jsx","jsxs","_jsxs","CenteredContent","div","_templateObject","_taggedTemplateLiteral","Wrapper","_templateObject2","replaceIdentifier","node","originalNodeObject","identifier","getAggregatedCredentials","originalNodeOverride","arguments","length","undefined","templateDefaultCredentials","theArray","isCredentialOverriden","templateDefaultCred","credentialHasOverride","forEach","overrideCred","credential_type","_overrideCred$inputs","_overrideCred$inputs2","_overrideCred$inputs3","vault_id","inputs","defaultCred","push","concat","fetchWorkflowNodes","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","templateId","pageNo","workflowNodes","_yield$WorkflowJobTem","data","_args","wrap","_callee$","_context","prev","next","readNodes","page_size","page","sent","abrupt","results","stop","_x","apply","Visualizer","_ref2","_template$summary_fie","_template$summary_fie2","template","history","_useReducer","addLinkSourceNode","addLinkTargetNode","addNodeSource","addNodeTarget","addingLink","contentError","defaultOrganization","isLoading","linkToDelete","linkToEdit","links","nextNodeId","nodePositions","nodeToDelete","nodeToEdit","nodeToView","nodes","showDeleteAllNodesModal","showLegend","showTools","showUnsavedChangesModal","unsavedChanges","_useReducer2","_slicedToArray","state","dispatch","handleVisualizerClose","type","id","associateNodes","newLinks","originalLinkMap","associateNodeRequests","link","linkType","associateSuccessNode","source","target","associateFailureNode","associateAlwaysNode","disassociateNodes","deletedNodeIds","linkMap","disassociateNodeRequests","Object","keys","key","success_nodes","successNodeId","includes","disassociateSuccessNode","failure_nodes","failureNodeId","disassociateFailuresNode","always_nodes","alwaysNodeId","disassociateAlwaysNode","fetchData","_fetchData","_callee2","_results$","_yield$OrganizationsA","_callee2$","_context2","read","value","t0","finish","newNodePositions","nonDeletedNodes","filter","isDeleted","g","_useRequest","_callee3","nodeRequests","approvalTemplateRequests","associateCredentialRequests","disassociateCredentialRequests","associateLabelRequests","disassociateLabelRequests","instanceGroupRequests","generateLinkMapAndNewLinks","_generateLinkMapAndNe","_generateLinkMapAndNe2","_callee3$","_context3","realLinkSourceId","realLinkTargetId","_node$originalNodeObj","destroy","fullUnifiedJobTemplate","createNode","_objectSpread","all_parents_must_converge","then","_ref4","createApprovalTemplate","name","description","timeout","_node$promptValues","_node$promptValues$ex","_node$promptValues2","_node$promptValues2$i","promptValues","execution_environment","inventory","unified_job_template","_ref5","_node$promptValues3","_node$promptValues3$a","_node$promptValues4","_node$promptValues4$l","_node$promptValues5","_node$promptValues5$i","addedCredentials","cred","associateCredentials","labels","label","associateLabel","organization","instance_groups","_iterator","_createForOfIteratorHelper","_step","s","n","done","group","associateInstanceGroup","err","e","f","isEdited","_node$originalNodeObj2","summary_fields","unified_job_type","update","_ref6","_ref7","_node$promptValues6","_node$promptValues6$e","_node$promptValues7","_node$promptValues7$i","_node$launchConfig","_node$launchConfig$de","_node$promptValues8","_node$promptValues9","_node$promptValues10","_getAddedAndRemoved","originalNodeCredentials","launchConfig","defaults","credentials","added","removedCredentials","removed","_getAddedAndRemoved2","originalNodeLabels","addedLabels","removedLabels","disassociateCredentials","disassociateLabel","_node$promptValues11","orderInstanceGroups","originalNodeInstanceGroups","Promise","all","saveVisualizerError","error","isSavingVisualizer","saveVisualizer","request","_useDismissableError","nodeRequestError","dismissNodeRequestError","dismissError","children","readOnly","user_capabilities","edit","Provider","onClose","onSave","hasUnsavedChanges","onExit","onSaveAndExit","isOpen","variant","title","i18n","_"],"sources":["/awx_devel/awx/ui/src/screens/Template/WorkflowJobTemplateVisualizer/Visualizer.js"],"sourcesContent":["import React, { useCallback, useEffect, useReducer } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport styled from 'styled-components';\nimport { shape } from 'prop-types';\nimport { t } from '@lingui/macro';\nimport {\n  WorkflowDispatchContext,\n  WorkflowStateContext,\n} from 'contexts/Workflow';\nimport { getAddedAndRemoved } from 'util/lists';\nimport { stringIsUUID } from 'util/strings';\nimport AlertModal from 'components/AlertModal';\nimport ErrorDetail from 'components/ErrorDetail';\nimport { layoutGraph } from 'components/Workflow/WorkflowUtils';\nimport ContentError from 'components/ContentError';\nimport ContentLoading from 'components/ContentLoading';\nimport workflowReducer from 'components/Workflow/workflowReducer';\nimport useRequest, { useDismissableError } from 'hooks/useRequest';\nimport {\n  OrganizationsAPI,\n  WorkflowApprovalTemplatesAPI,\n  WorkflowJobTemplateNodesAPI,\n  WorkflowJobTemplatesAPI,\n} from 'api';\nimport { DeleteAllNodesModal, UnsavedChangesModal } from './Modals';\nimport {\n  LinkAddModal,\n  LinkDeleteModal,\n  LinkEditModal,\n} from './Modals/LinkModals';\nimport {\n  NodeAddModal,\n  NodeEditModal,\n  NodeDeleteModal,\n  NodeViewModal,\n} from './Modals/NodeModals';\nimport VisualizerGraph from './VisualizerGraph';\nimport VisualizerStartScreen from './VisualizerStartScreen';\nimport VisualizerToolbar from './VisualizerToolbar';\n\nconst CenteredContent = styled.div`\n  align-items: center;\n  display: flex;\n  flex-flow: column;\n  height: 100%;\n  justify-content: center;\n`;\n\nconst Wrapper = styled.div`\n  display: flex;\n  flex-flow: column;\n  height: 100%;\n`;\n\nconst replaceIdentifier = (node) => {\n  if (\n    stringIsUUID(node.originalNodeObject.identifier) &&\n    typeof node.identifier === 'string' &&\n    node.identifier !== ''\n  ) {\n    return true;\n  }\n\n  if (\n    !stringIsUUID(node.originalNodeObject.identifier) &&\n    node.originalNodeObject.identifier !== node.identifier\n  ) {\n    return true;\n  }\n\n  return false;\n};\nconst getAggregatedCredentials = (\n  originalNodeOverride = [],\n  templateDefaultCredentials = []\n) => {\n  let theArray = [];\n\n  const isCredentialOverriden = (templateDefaultCred) => {\n    let credentialHasOverride = false;\n    originalNodeOverride.forEach((overrideCred) => {\n      if (\n        templateDefaultCred.credential_type === overrideCred.credential_type\n      ) {\n        if (\n          (!templateDefaultCred.vault_id && !overrideCred.inputs?.vault_id) ||\n          (templateDefaultCred.vault_id &&\n            overrideCred.inputs?.vault_id &&\n            templateDefaultCred.vault_id === overrideCred.inputs?.vault_id)\n        ) {\n          credentialHasOverride = true;\n        }\n      }\n    });\n\n    return credentialHasOverride;\n  };\n\n  if (templateDefaultCredentials.length > 0) {\n    templateDefaultCredentials.forEach((defaultCred) => {\n      if (!isCredentialOverriden(defaultCred)) {\n        theArray.push(defaultCred);\n      }\n    });\n  }\n\n  theArray = theArray.concat(originalNodeOverride);\n\n  return theArray;\n};\n\nconst fetchWorkflowNodes = async (\n  templateId,\n  pageNo = 1,\n  workflowNodes = []\n) => {\n  const { data } = await WorkflowJobTemplatesAPI.readNodes(templateId, {\n    page_size: 200,\n    page: pageNo,\n  });\n  if (data.next) {\n    return fetchWorkflowNodes(\n      templateId,\n      pageNo + 1,\n      workflowNodes.concat(data.results)\n    );\n  }\n  return workflowNodes.concat(data.results);\n};\n\nfunction Visualizer({ template }) {\n  const history = useHistory();\n  const [state, dispatch] = useReducer(workflowReducer, {\n    addLinkSourceNode: null,\n    addLinkTargetNode: null,\n    addNodeSource: null,\n    addNodeTarget: null,\n    addingLink: false,\n    contentError: null,\n    defaultOrganization: null,\n    isLoading: true,\n    linkToDelete: null,\n    linkToEdit: null,\n    links: [],\n    nextNodeId: 0,\n    nodePositions: null,\n    nodeToDelete: null,\n    nodeToEdit: null,\n    nodeToView: null,\n    nodes: [],\n    showDeleteAllNodesModal: false,\n    showLegend: false,\n    showTools: false,\n    showUnsavedChangesModal: false,\n    unsavedChanges: false,\n  });\n\n  const {\n    addLinkSourceNode,\n    addLinkTargetNode,\n    addNodeSource,\n    contentError,\n    defaultOrganization,\n    isLoading,\n    linkToDelete,\n    linkToEdit,\n    links,\n    nodeToDelete,\n    nodeToEdit,\n    nodeToView,\n    nodes,\n    showDeleteAllNodesModal,\n    showUnsavedChangesModal,\n    unsavedChanges,\n  } = state;\n\n  const handleVisualizerClose = () => {\n    if (unsavedChanges) {\n      dispatch({ type: 'TOGGLE_UNSAVED_CHANGES_MODAL' });\n    } else {\n      history.push(`/templates/workflow_job_template/${template.id}/details`);\n    }\n  };\n\n  const associateNodes = (newLinks, originalLinkMap) => {\n    const associateNodeRequests = [];\n    newLinks.forEach((link) => {\n      switch (link.linkType) {\n        case 'success':\n          associateNodeRequests.push(\n            WorkflowJobTemplateNodesAPI.associateSuccessNode(\n              originalLinkMap[link.source.id].id,\n              originalLinkMap[link.target.id].id\n            )\n          );\n          break;\n        case 'failure':\n          associateNodeRequests.push(\n            WorkflowJobTemplateNodesAPI.associateFailureNode(\n              originalLinkMap[link.source.id].id,\n              originalLinkMap[link.target.id].id\n            )\n          );\n          break;\n        case 'always':\n          associateNodeRequests.push(\n            WorkflowJobTemplateNodesAPI.associateAlwaysNode(\n              originalLinkMap[link.source.id].id,\n              originalLinkMap[link.target.id].id\n            )\n          );\n          break;\n        default:\n      }\n    });\n\n    return associateNodeRequests;\n  };\n\n  const disassociateNodes = (originalLinkMap, deletedNodeIds, linkMap) => {\n    const disassociateNodeRequests = [];\n    Object.keys(originalLinkMap).forEach((key) => {\n      const node = originalLinkMap[key];\n      node.success_nodes.forEach((successNodeId) => {\n        if (\n          !deletedNodeIds.includes(successNodeId) &&\n          (!linkMap[node.id] ||\n            !linkMap[node.id][successNodeId] ||\n            linkMap[node.id][successNodeId] !== 'success')\n        ) {\n          disassociateNodeRequests.push(\n            WorkflowJobTemplateNodesAPI.disassociateSuccessNode(\n              node.id,\n              successNodeId\n            )\n          );\n        }\n      });\n      node.failure_nodes.forEach((failureNodeId) => {\n        if (\n          !deletedNodeIds.includes(failureNodeId) &&\n          (!linkMap[node.id] ||\n            !linkMap[node.id][failureNodeId] ||\n            linkMap[node.id][failureNodeId] !== 'failure')\n        ) {\n          disassociateNodeRequests.push(\n            WorkflowJobTemplateNodesAPI.disassociateFailuresNode(\n              node.id,\n              failureNodeId\n            )\n          );\n        }\n      });\n      node.always_nodes.forEach((alwaysNodeId) => {\n        if (\n          !deletedNodeIds.includes(alwaysNodeId) &&\n          (!linkMap[node.id] ||\n            !linkMap[node.id][alwaysNodeId] ||\n            linkMap[node.id][alwaysNodeId] !== 'always')\n        ) {\n          disassociateNodeRequests.push(\n            WorkflowJobTemplateNodesAPI.disassociateAlwaysNode(\n              node.id,\n              alwaysNodeId\n            )\n          );\n        }\n      });\n    });\n\n    return disassociateNodeRequests;\n  };\n\n  useEffect(() => {\n    async function fetchData() {\n      try {\n        const {\n          data: { results },\n        } = await OrganizationsAPI.read({ page_size: 1, page: 1 });\n        dispatch({\n          type: 'SET_DEFAULT_ORGANIZATION',\n          value: results[0]?.id,\n        });\n\n        const workflowNodes = await fetchWorkflowNodes(template.id);\n        dispatch({\n          type: 'GENERATE_NODES_AND_LINKS',\n          nodes: workflowNodes,\n        });\n      } catch (error) {\n        dispatch({ type: 'SET_CONTENT_ERROR', value: error });\n      } finally {\n        dispatch({ type: 'SET_IS_LOADING', value: false });\n      }\n    }\n    fetchData();\n  }, [template.id]);\n\n  // Update positions of nodes/links\n  useEffect(() => {\n    if (nodes) {\n      const newNodePositions = {};\n      const nonDeletedNodes = nodes.filter((node) => !node.isDeleted);\n      const g = layoutGraph(nonDeletedNodes, links);\n\n      g.nodes().forEach((node) => {\n        newNodePositions[node] = g.node(node);\n      });\n\n      dispatch({ type: 'SET_NODE_POSITIONS', value: newNodePositions });\n    }\n  }, [links, nodes]);\n\n  const {\n    error: saveVisualizerError,\n    isLoading: isSavingVisualizer,\n    request: saveVisualizer,\n  } = useRequest(\n    useCallback(async () => {\n      const nodeRequests = [];\n      const approvalTemplateRequests = [];\n      const originalLinkMap = {};\n      const deletedNodeIds = [];\n      const associateCredentialRequests = [];\n      const disassociateCredentialRequests = [];\n      const associateLabelRequests = [];\n      const disassociateLabelRequests = [];\n      const instanceGroupRequests = [];\n\n      const generateLinkMapAndNewLinks = () => {\n        const linkMap = {};\n        const newLinks = [];\n\n        links.forEach((link) => {\n          if (link.source.id !== 1) {\n            const realLinkSourceId = originalLinkMap[link.source.id].id;\n            const realLinkTargetId = originalLinkMap[link.target.id].id;\n            if (!linkMap[realLinkSourceId]) {\n              linkMap[realLinkSourceId] = {};\n            }\n            linkMap[realLinkSourceId][realLinkTargetId] = link.linkType;\n            switch (link.linkType) {\n              case 'success':\n                if (\n                  !originalLinkMap[link.source.id].success_nodes.includes(\n                    originalLinkMap[link.target.id].id\n                  )\n                ) {\n                  newLinks.push(link);\n                }\n                break;\n              case 'failure':\n                if (\n                  !originalLinkMap[link.source.id].failure_nodes.includes(\n                    originalLinkMap[link.target.id].id\n                  )\n                ) {\n                  newLinks.push(link);\n                }\n                break;\n              case 'always':\n                if (\n                  !originalLinkMap[link.source.id].always_nodes.includes(\n                    originalLinkMap[link.target.id].id\n                  )\n                ) {\n                  newLinks.push(link);\n                }\n                break;\n              default:\n            }\n          }\n        });\n\n        return [linkMap, newLinks];\n      };\n\n      nodes.forEach((node) => {\n        // node with id=1 is the artificial start node\n        if (node.id === 1) {\n          return;\n        }\n        if (node.originalNodeObject && !node.isDeleted) {\n          const { id, success_nodes, failure_nodes, always_nodes } =\n            node.originalNodeObject;\n          originalLinkMap[node.id] = {\n            id,\n            success_nodes,\n            failure_nodes,\n            always_nodes,\n          };\n        }\n        if (node.isDeleted && node.originalNodeObject) {\n          deletedNodeIds.push(node.originalNodeObject.id);\n          nodeRequests.push(\n            WorkflowJobTemplateNodesAPI.destroy(node.originalNodeObject.id)\n          );\n        } else if (!node.isDeleted && !node.originalNodeObject) {\n          if (\n            node.fullUnifiedJobTemplate.type === 'workflow_approval_template'\n          ) {\n            nodeRequests.push(\n              WorkflowJobTemplatesAPI.createNode(template.id, {\n                all_parents_must_converge: node.all_parents_must_converge,\n                ...(node.identifier && { identifier: node.identifier }),\n              }).then(({ data }) => {\n                node.originalNodeObject = data;\n                originalLinkMap[node.id] = {\n                  id: data.id,\n                  success_nodes: [],\n                  failure_nodes: [],\n                  always_nodes: [],\n                };\n                approvalTemplateRequests.push(\n                  WorkflowJobTemplateNodesAPI.createApprovalTemplate(data.id, {\n                    name: node.fullUnifiedJobTemplate.name,\n                    description: node.fullUnifiedJobTemplate.description,\n                    timeout: node.fullUnifiedJobTemplate.timeout,\n                  })\n                );\n              })\n            );\n          } else {\n            nodeRequests.push(\n              WorkflowJobTemplatesAPI.createNode(template.id, {\n                ...node.promptValues,\n                execution_environment:\n                  node.promptValues?.execution_environment?.id || null,\n                inventory: node.promptValues?.inventory?.id || null,\n                unified_job_template: node.fullUnifiedJobTemplate.id,\n                all_parents_must_converge: node.all_parents_must_converge,\n                ...(node.identifier && { identifier: node.identifier }),\n              }).then(({ data }) => {\n                node.originalNodeObject = data;\n                originalLinkMap[node.id] = {\n                  id: data.id,\n                  success_nodes: [],\n                  failure_nodes: [],\n                  always_nodes: [],\n                };\n\n                if (node.promptValues?.addedCredentials?.length > 0) {\n                  node.promptValues.addedCredentials.forEach((cred) => {\n                    associateCredentialRequests.push(\n                      WorkflowJobTemplateNodesAPI.associateCredentials(\n                        data.id,\n                        cred.id\n                      )\n                    );\n                  });\n                }\n\n                if (node.promptValues?.labels?.length > 0) {\n                  node.promptValues.labels.forEach((label) => {\n                    associateLabelRequests.push(\n                      WorkflowJobTemplateNodesAPI.associateLabel(\n                        data.id,\n                        label,\n                        node.fullUnifiedJobTemplate.organization ||\n                          defaultOrganization\n                      )\n                    );\n                  });\n                }\n                if (node.promptValues?.instance_groups?.length > 0)\n                  /* eslint-disable no-await-in-loop, no-restricted-syntax */\n                  for (const group of node.promptValues.instance_groups) {\n                    instanceGroupRequests.push(\n                      WorkflowJobTemplateNodesAPI.associateInstanceGroup(\n                        data.id,\n                        group.id\n                      )\n                    );\n                  }\n              })\n            );\n          }\n        } else if (node.isEdited) {\n          if (\n            node.fullUnifiedJobTemplate.type === 'workflow_approval_template'\n          ) {\n            if (\n              node.originalNodeObject.summary_fields.unified_job_template\n                ?.unified_job_type === 'workflow_approval'\n            ) {\n              nodeRequests.push(\n                WorkflowJobTemplateNodesAPI.update(node.originalNodeObject.id, {\n                  all_parents_must_converge: node.all_parents_must_converge,\n                  ...(replaceIdentifier(node) && {\n                    identifier: node.identifier,\n                  }),\n                }).then(({ data }) => {\n                  node.originalNodeObject = data;\n                  approvalTemplateRequests.push(\n                    WorkflowApprovalTemplatesAPI.update(\n                      node.originalNodeObject.summary_fields\n                        .unified_job_template.id,\n                      {\n                        name: node.fullUnifiedJobTemplate.name,\n                        description: node.fullUnifiedJobTemplate.description,\n                        timeout: node.fullUnifiedJobTemplate.timeout,\n                      }\n                    )\n                  );\n                })\n              );\n            } else {\n              nodeRequests.push(\n                WorkflowJobTemplateNodesAPI.update(node.originalNodeObject.id, {\n                  all_parents_must_converge: node.all_parents_must_converge,\n                  ...(replaceIdentifier(node) && {\n                    identifier: node.identifier,\n                  }),\n                }).then(({ data }) => {\n                  node.originalNodeObject = data;\n                  approvalTemplateRequests.push(\n                    WorkflowJobTemplateNodesAPI.createApprovalTemplate(\n                      node.originalNodeObject.id,\n                      {\n                        name: node.fullUnifiedJobTemplate.name,\n                        description: node.fullUnifiedJobTemplate.description,\n                        timeout: node.fullUnifiedJobTemplate.timeout,\n                      }\n                    )\n                  );\n                })\n              );\n            }\n          } else {\n            nodeRequests.push(\n              WorkflowJobTemplateNodesAPI.update(node.originalNodeObject.id, {\n                ...node.promptValues,\n                execution_environment:\n                  node.promptValues?.execution_environment?.id || null,\n                inventory: node.promptValues?.inventory?.id || null,\n                unified_job_template: node.fullUnifiedJobTemplate.id,\n                all_parents_must_converge: node.all_parents_must_converge,\n                ...(replaceIdentifier(node) && {\n                  identifier: node.identifier,\n                }),\n              }).then(() => {\n                const { added: addedCredentials, removed: removedCredentials } =\n                  getAddedAndRemoved(\n                    getAggregatedCredentials(\n                      node?.originalNodeCredentials,\n                      node.launchConfig?.defaults?.credentials\n                    ),\n                    node.promptValues?.credentials\n                  );\n\n                const { added: addedLabels, removed: removedLabels } =\n                  getAddedAndRemoved(\n                    node?.originalNodeLabels,\n                    node.promptValues?.labels\n                  );\n\n                if (addedCredentials.length > 0) {\n                  addedCredentials.forEach((cred) => {\n                    associateCredentialRequests.push(\n                      WorkflowJobTemplateNodesAPI.associateCredentials(\n                        node.originalNodeObject.id,\n                        cred.id\n                      )\n                    );\n                  });\n                }\n                if (removedCredentials?.length > 0) {\n                  removedCredentials.forEach((cred) =>\n                    disassociateCredentialRequests.push(\n                      WorkflowJobTemplateNodesAPI.disassociateCredentials(\n                        node.originalNodeObject.id,\n                        cred.id\n                      )\n                    )\n                  );\n                }\n\n                if (addedLabels.length > 0) {\n                  addedLabels.forEach((label) => {\n                    associateLabelRequests.push(\n                      WorkflowJobTemplateNodesAPI.associateLabel(\n                        node.originalNodeObject.id,\n                        label,\n                        node.fullUnifiedJobTemplate.organization ||\n                          defaultOrganization\n                      )\n                    );\n                  });\n                }\n                if (removedLabels?.length > 0) {\n                  removedLabels.forEach((label) =>\n                    disassociateLabelRequests.push(\n                      WorkflowJobTemplateNodesAPI.disassociateLabel(\n                        node.originalNodeObject.id,\n                        label,\n                        node.fullUnifiedJobTemplate.organization ||\n                          defaultOrganization\n                      )\n                    )\n                  );\n                }\n\n                if (node.promptValues?.instance_groups) {\n                  instanceGroupRequests.push(\n                    WorkflowJobTemplateNodesAPI.orderInstanceGroups(\n                      node.originalNodeObject.id,\n                      node.promptValues?.instance_groups,\n                      node?.originalNodeInstanceGroups || []\n                    )\n                  );\n                }\n              })\n            );\n          }\n        }\n      });\n\n      await Promise.all(nodeRequests);\n      // Creating approval templates needs to happen after the node has been created\n      // since we reference the node in the approval template request.\n      await Promise.all(approvalTemplateRequests);\n      const [linkMap, newLinks] = generateLinkMapAndNewLinks(originalLinkMap);\n      await Promise.all(\n        disassociateNodes(originalLinkMap, deletedNodeIds, linkMap)\n      );\n      await Promise.all(associateNodes(newLinks, originalLinkMap));\n\n      await Promise.all([\n        ...disassociateCredentialRequests,\n        ...disassociateLabelRequests,\n      ]);\n      await Promise.all([\n        ...associateCredentialRequests,\n        ...associateLabelRequests,\n        ...instanceGroupRequests,\n      ]);\n\n      history.push(`/templates/workflow_job_template/${template.id}/details`);\n    }, [links, nodes, history, defaultOrganization, template.id]),\n    {}\n  );\n\n  const { error: nodeRequestError, dismissError: dismissNodeRequestError } =\n    useDismissableError(saveVisualizerError);\n\n  if (isLoading || isSavingVisualizer) {\n    return (\n      <CenteredContent>\n        <ContentLoading />\n      </CenteredContent>\n    );\n  }\n\n  if (contentError) {\n    return (\n      <CenteredContent>\n        <ContentError error={contentError} />\n      </CenteredContent>\n    );\n  }\n\n  const readOnly = !template?.summary_fields?.user_capabilities?.edit;\n\n  return (\n    <WorkflowStateContext.Provider value={state}>\n      <WorkflowDispatchContext.Provider value={dispatch}>\n        <Wrapper>\n          <VisualizerToolbar\n            onClose={handleVisualizerClose}\n            onSave={() => saveVisualizer(nodes)}\n            hasUnsavedChanges={unsavedChanges}\n            template={template}\n            readOnly={readOnly}\n          />\n          {links.length > 0 ? (\n            <VisualizerGraph readOnly={readOnly} />\n          ) : (\n            <VisualizerStartScreen readOnly={readOnly} />\n          )}\n        </Wrapper>\n        {nodeToDelete && <NodeDeleteModal />}\n        {linkToDelete && <LinkDeleteModal />}\n        {linkToEdit && <LinkEditModal />}\n        {addLinkSourceNode && addLinkTargetNode && <LinkAddModal />}\n        {addNodeSource && <NodeAddModal />}\n        {nodeToEdit && <NodeEditModal />}\n        {showUnsavedChangesModal && (\n          <UnsavedChangesModal\n            onExit={() =>\n              history.push(\n                `/templates/workflow_job_template/${template.id}/details`\n              )\n            }\n            onSaveAndExit={() => saveVisualizer(nodes)}\n          />\n        )}\n        {showDeleteAllNodesModal && <DeleteAllNodesModal />}\n        {nodeToView && <NodeViewModal readOnly={readOnly} />}\n        {nodeRequestError && (\n          <AlertModal\n            isOpen\n            variant=\"error\"\n            title={t`Error saving the workflow!`}\n            onClose={dismissNodeRequestError}\n            aria-label={t`Error saving the workflow!`}\n          >\n            {t`There was an error saving the workflow.`}\n            <ErrorDetail error={nodeRequestError} />\n          </AlertModal>\n        )}\n      </WorkflowDispatchContext.Provider>\n    </WorkflowStateContext.Provider>\n  );\n}\n\nVisualizer.propTypes = {\n  template: shape().isRequired,\n};\n\nexport default Visualizer;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}