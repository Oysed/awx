{"ast":null,"code":"import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _objectWithoutProperties from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js\";import _createForOfIteratorHelper from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";var _excluded=[\"instance_groups\",\"organization\"];import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import React,{useCallback,useEffect}from'react';import{useHistory}from'react-router-dom';import{Card,PageSection}from'@patternfly/react-core';import{CardBody}from'components/Card';import useRequest from'hooks/useRequest';import{InventoriesAPI}from'api';import SmartInventoryForm from'../shared/SmartInventoryForm';import parseHostFilter from'../shared/utils';import{jsx as _jsx}from\"react/jsx-runtime\";function SmartInventoryAdd(){var history=useHistory();var _useRequest=useRequest(useCallback(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(values,groupsToAssociate){var _yield$InventoriesAPI,invId,_iterator,_step,group;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return InventoriesAPI.create(values);case 2:_yield$InventoriesAPI=_context.sent;invId=_yield$InventoriesAPI.data.id;/* eslint-disable no-await-in-loop, no-restricted-syntax */ // Resolve Promises sequentially to maintain order and avoid race condition\n_iterator=_createForOfIteratorHelper(groupsToAssociate);_context.prev=5;_iterator.s();case 7:if((_step=_iterator.n()).done){_context.next=13;break;}group=_step.value;_context.next=11;return InventoriesAPI.associateInstanceGroup(invId,group.id);case 11:_context.next=7;break;case 13:_context.next=18;break;case 15:_context.prev=15;_context.t0=_context[\"catch\"](5);_iterator.e(_context.t0);case 18:_context.prev=18;_iterator.f();return _context.finish(18);case 21:return _context.abrupt(\"return\",invId);case 22:case\"end\":return _context.stop();}}},_callee,null,[[5,15,18,21]]);}));return function(_x,_x2){return _ref.apply(this,arguments);};}(),[])),submitError=_useRequest.error,submitRequest=_useRequest.request,inventoryId=_useRequest.result;var handleSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(form){var modifiedForm,instance_groups,organization,remainingForm;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:modifiedForm=parseHostFilter(form);instance_groups=modifiedForm.instance_groups,organization=modifiedForm.organization,remainingForm=_objectWithoutProperties(modifiedForm,_excluded);_context2.next=4;return submitRequest(_objectSpread({organization:organization===null||organization===void 0?void 0:organization.id},remainingForm),instance_groups);case 4:case\"end\":return _context2.stop();}}},_callee2);}));return function handleSubmit(_x3){return _ref2.apply(this,arguments);};}();var handleCancel=function handleCancel(){history.push({pathname:'/inventories',search:''});};useEffect(function(){if(inventoryId){history.push({pathname:\"/inventories/smart_inventory/\".concat(inventoryId,\"/details\"),search:''});}},[inventoryId,history]);return/*#__PURE__*/_jsx(PageSection,{children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(CardBody,{children:/*#__PURE__*/_jsx(SmartInventoryForm,{onCancel:handleCancel,onSubmit:handleSubmit,submitError:submitError})})})});}export default SmartInventoryAdd;","map":{"version":3,"names":["React","useCallback","useEffect","useHistory","Card","PageSection","CardBody","useRequest","InventoriesAPI","SmartInventoryForm","parseHostFilter","jsx","_jsx","SmartInventoryAdd","history","_useRequest","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","values","groupsToAssociate","_yield$InventoriesAPI","invId","_iterator","_step","group","wrap","_callee$","_context","prev","next","create","sent","data","id","_createForOfIteratorHelper","s","n","done","value","associateInstanceGroup","t0","e","f","finish","abrupt","stop","_x","_x2","apply","arguments","submitError","error","submitRequest","request","inventoryId","result","handleSubmit","_ref2","_callee2","form","modifiedForm","instance_groups","organization","remainingForm","_callee2$","_context2","_objectWithoutProperties","_excluded","_objectSpread","_x3","handleCancel","push","pathname","search","concat","children","onCancel","onSubmit"],"sources":["/awx_devel/awx/ui/src/screens/Inventory/SmartInventoryAdd/SmartInventoryAdd.js"],"sourcesContent":["import React, { useCallback, useEffect } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport { Card, PageSection } from '@patternfly/react-core';\nimport { CardBody } from 'components/Card';\nimport useRequest from 'hooks/useRequest';\nimport { InventoriesAPI } from 'api';\nimport SmartInventoryForm from '../shared/SmartInventoryForm';\nimport parseHostFilter from '../shared/utils';\n\nfunction SmartInventoryAdd() {\n  const history = useHistory();\n\n  const {\n    error: submitError,\n    request: submitRequest,\n    result: inventoryId,\n  } = useRequest(\n    useCallback(async (values, groupsToAssociate) => {\n      const {\n        data: { id: invId },\n      } = await InventoriesAPI.create(values);\n\n      /* eslint-disable no-await-in-loop, no-restricted-syntax */\n      // Resolve Promises sequentially to maintain order and avoid race condition\n      for (const group of groupsToAssociate) {\n        await InventoriesAPI.associateInstanceGroup(invId, group.id);\n      }\n      /* eslint-enable no-await-in-loop, no-restricted-syntax */\n      return invId;\n    }, [])\n  );\n\n  const handleSubmit = async (form) => {\n    const modifiedForm = parseHostFilter(form);\n\n    const { instance_groups, organization, ...remainingForm } = modifiedForm;\n\n    await submitRequest(\n      {\n        organization: organization?.id,\n        ...remainingForm,\n      },\n      instance_groups\n    );\n  };\n\n  const handleCancel = () => {\n    history.push({\n      pathname: '/inventories',\n      search: '',\n    });\n  };\n\n  useEffect(() => {\n    if (inventoryId) {\n      history.push({\n        pathname: `/inventories/smart_inventory/${inventoryId}/details`,\n        search: '',\n      });\n    }\n  }, [inventoryId, history]);\n\n  return (\n    <PageSection>\n      <Card>\n        <CardBody>\n          <SmartInventoryForm\n            onCancel={handleCancel}\n            onSubmit={handleSubmit}\n            submitError={submitError}\n          />\n        </CardBody>\n      </Card>\n    </PageSection>\n  );\n}\n\nexport default SmartInventoryAdd;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}