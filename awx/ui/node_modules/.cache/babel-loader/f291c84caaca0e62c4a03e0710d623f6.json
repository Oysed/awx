{"ast":null,"code":"import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _taggedTemplateLiteral from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral.js\";var _templateObject;import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{i18n}from\"@lingui/core\";import React,{useEffect,useCallback}from'react';import{useHistory}from'react-router-dom';import styled from'styled-components';import{useField}from'formik';import{Form,FormGroup,Alert}from'@patternfly/react-core';import{CredentialsAPI}from'api';import{getQSConfig,parseQueryString,mergeParams}from'util/qs';import useRequest from'hooks/useRequest';import{required}from'util/validators';import{getSearchableKeys}from'components/PaginatedTable';import Popover from'../Popover';import ContentError from'../ContentError';import ContentLoading from'../ContentLoading';import OptionsList from'../OptionsList';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var CredentialErrorAlert=styled(Alert)(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  margin-bottom: 20px;\\n\"])));var QS_CONFIG=getQSConfig('credentials',{page:1,page_size:5,order_by:'name'});function AdHocCredentialStep(_ref){var credentialTypeId=_ref.credentialTypeId;var history=useHistory();var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _actionsResponse$data,_actionsResponse$data2;var params,_yield$Promise$all,_yield$Promise$all2,_yield$Promise$all2$,results,count,actionsResponse;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:params=parseQueryString(QS_CONFIG,history.location.search);_context.next=3;return Promise.all([CredentialsAPI.read(mergeParams(params,{credential_type:credentialTypeId})),CredentialsAPI.readOptions()]);case 3:_yield$Promise$all=_context.sent;_yield$Promise$all2=_slicedToArray(_yield$Promise$all,2);_yield$Promise$all2$=_yield$Promise$all2[0].data;results=_yield$Promise$all2$.results;count=_yield$Promise$all2$.count;actionsResponse=_yield$Promise$all2[1];return _context.abrupt(\"return\",{credentials:results,credentialCount:count,relatedSearchableKeys:((actionsResponse===null||actionsResponse===void 0?void 0:(_actionsResponse$data=actionsResponse.data)===null||_actionsResponse$data===void 0?void 0:_actionsResponse$data.related_search_fields)||[]).map(function(val){return val.slice(0,-8);}),searchableKeys:getSearchableKeys((_actionsResponse$data2=actionsResponse.data.actions)===null||_actionsResponse$data2===void 0?void 0:_actionsResponse$data2.GET)});case 10:case\"end\":return _context.stop();}}},_callee);})),[credentialTypeId,history.location.search]),{credentials:[],credentialCount:0,relatedSearchableKeys:[],searchableKeys:[]}),error=_useRequest.error,isLoading=_useRequest.isLoading,fetchCredentials=_useRequest.request,_useRequest$result=_useRequest.result,credentials=_useRequest$result.credentials,credentialCount=_useRequest$result.credentialCount,relatedSearchableKeys=_useRequest$result.relatedSearchableKeys,searchableKeys=_useRequest$result.searchableKeys;useEffect(function(){fetchCredentials();},[fetchCredentials]);var _useField=useField({name:'credentials',validate:required(null)}),_useField2=_slicedToArray(_useField,3),field=_useField2[0],meta=_useField2[1],helpers=_useField2[2];if(error){return/*#__PURE__*/_jsx(ContentError,{error:error});}if(isLoading){return/*#__PURE__*/_jsx(ContentLoading,{});}return/*#__PURE__*/_jsxs(_Fragment,{children:[meta.touched&&meta.error&&/*#__PURE__*/_jsx(CredentialErrorAlert,{variant:\"danger\",isInline:true,title:meta.error}),/*#__PURE__*/_jsx(Form,{autoComplete:\"off\",children:/*#__PURE__*/_jsx(FormGroup,{fieldId:\"credential\",label:/*i18n*/i18n._(\"Machine Credential\"),\"aria-label\":/*i18n*/i18n._(\"Machine Credential\"),isRequired:true,validated:!meta.touched||!meta.error?'default':'error',helperTextInvalid:meta.error,labelIcon:/*#__PURE__*/_jsx(Popover,{content:/*i18n*/i18n._(\"Select the credential you want to use when accessing the remote hosts to run the command. Choose the credential containing the username and SSH key or password that Ansible will need to log into the remote hosts.\")}),children:/*#__PURE__*/_jsx(OptionsList,{value:field.value||[],options:credentials,optionCount:credentialCount,header:/*i18n*/i18n._(\"Machine Credential\"),readOnly:true,qsConfig:QS_CONFIG,searchColumns:[{name:/*i18n*/i18n._(\"Name\"),key:'name__icontains',isDefault:true},{name:/*i18n*/i18n._(\"Created By (Username)\"),key:'created_by__username__icontains'},{name:/*i18n*/i18n._(\"Modified By (Username)\"),key:'modified_by__username__icontains'}],sortColumns:[{name:/*i18n*/i18n._(\"Name\"),key:'name'}],name:\"credential\",selectItem:function selectItem(value){helpers.setValue([value]);},deselectItem:function deselectItem(){helpers.setValue([]);},searchableKeys:searchableKeys,relatedSearchableKeys:relatedSearchableKeys})})})]});}export default AdHocCredentialStep;","map":{"version":3,"names":["React","useEffect","useCallback","useHistory","styled","useField","Form","FormGroup","Alert","CredentialsAPI","getQSConfig","parseQueryString","mergeParams","useRequest","required","getSearchableKeys","Popover","ContentError","ContentLoading","OptionsList","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","CredentialErrorAlert","_templateObject","_taggedTemplateLiteral","QS_CONFIG","page","page_size","order_by","AdHocCredentialStep","_ref","credentialTypeId","history","_useRequest","_asyncToGenerator","_regeneratorRuntime","mark","_callee","_actionsResponse$data","_actionsResponse$data2","params","_yield$Promise$all","_yield$Promise$all2","_yield$Promise$all2$","results","count","actionsResponse","wrap","_callee$","_context","prev","next","location","search","Promise","all","read","credential_type","readOptions","sent","_slicedToArray","data","abrupt","credentials","credentialCount","relatedSearchableKeys","related_search_fields","map","val","slice","searchableKeys","actions","GET","stop","error","isLoading","fetchCredentials","request","_useRequest$result","result","_useField","name","validate","_useField2","field","meta","helpers","children","touched","variant","isInline","title","autoComplete","fieldId","label","i18n","_","isRequired","validated","helperTextInvalid","labelIcon","content","value","options","optionCount","header","readOnly","qsConfig","searchColumns","key","isDefault","sortColumns","selectItem","setValue","deselectItem"],"sources":["/awx_devel/awx/ui/src/components/AdHocCommands/AdHocCredentialStep.js"],"sourcesContent":["import React, { useEffect, useCallback } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport { t } from '@lingui/macro';\nimport styled from 'styled-components';\nimport PropTypes from 'prop-types';\nimport { useField } from 'formik';\nimport { Form, FormGroup, Alert } from '@patternfly/react-core';\nimport { CredentialsAPI } from 'api';\nimport { getQSConfig, parseQueryString, mergeParams } from 'util/qs';\nimport useRequest from 'hooks/useRequest';\nimport { required } from 'util/validators';\nimport { getSearchableKeys } from 'components/PaginatedTable';\nimport Popover from '../Popover';\n\nimport ContentError from '../ContentError';\nimport ContentLoading from '../ContentLoading';\nimport OptionsList from '../OptionsList';\n\nconst CredentialErrorAlert = styled(Alert)`\n  margin-bottom: 20px;\n`;\n\nconst QS_CONFIG = getQSConfig('credentials', {\n  page: 1,\n  page_size: 5,\n  order_by: 'name',\n});\n\nfunction AdHocCredentialStep({ credentialTypeId }) {\n  const history = useHistory();\n  const {\n    error,\n    isLoading,\n    request: fetchCredentials,\n    result: {\n      credentials,\n      credentialCount,\n      relatedSearchableKeys,\n      searchableKeys,\n    },\n  } = useRequest(\n    useCallback(async () => {\n      const params = parseQueryString(QS_CONFIG, history.location.search);\n\n      const [\n        {\n          data: { results, count },\n        },\n        actionsResponse,\n      ] = await Promise.all([\n        CredentialsAPI.read(\n          mergeParams(params, { credential_type: credentialTypeId })\n        ),\n        CredentialsAPI.readOptions(),\n      ]);\n\n      return {\n        credentials: results,\n        credentialCount: count,\n        relatedSearchableKeys: (\n          actionsResponse?.data?.related_search_fields || []\n        ).map((val) => val.slice(0, -8)),\n        searchableKeys: getSearchableKeys(actionsResponse.data.actions?.GET),\n      };\n    }, [credentialTypeId, history.location.search]),\n    {\n      credentials: [],\n      credentialCount: 0,\n      relatedSearchableKeys: [],\n      searchableKeys: [],\n    }\n  );\n\n  useEffect(() => {\n    fetchCredentials();\n  }, [fetchCredentials]);\n\n  const [field, meta, helpers] = useField({\n    name: 'credentials',\n    validate: required(null),\n  });\n\n  if (error) {\n    return <ContentError error={error} />;\n  }\n  if (isLoading) {\n    return <ContentLoading />;\n  }\n  return (\n    <>\n      {meta.touched && meta.error && (\n        <CredentialErrorAlert variant=\"danger\" isInline title={meta.error} />\n      )}\n      <Form autoComplete=\"off\">\n        <FormGroup\n          fieldId=\"credential\"\n          label={t`Machine Credential`}\n          aria-label={t`Machine Credential`}\n          isRequired\n          validated={!meta.touched || !meta.error ? 'default' : 'error'}\n          helperTextInvalid={meta.error}\n          labelIcon={\n            <Popover\n              content={t`Select the credential you want to use when accessing the remote hosts to run the command. Choose the credential containing the username and SSH key or password that Ansible will need to log into the remote hosts.`}\n            />\n          }\n        >\n          <OptionsList\n            value={field.value || []}\n            options={credentials}\n            optionCount={credentialCount}\n            header={t`Machine Credential`}\n            readOnly\n            qsConfig={QS_CONFIG}\n            searchColumns={[\n              {\n                name: t`Name`,\n                key: 'name__icontains',\n                isDefault: true,\n              },\n              {\n                name: t`Created By (Username)`,\n                key: 'created_by__username__icontains',\n              },\n              {\n                name: t`Modified By (Username)`,\n                key: 'modified_by__username__icontains',\n              },\n            ]}\n            sortColumns={[\n              {\n                name: t`Name`,\n                key: 'name',\n              },\n            ]}\n            name=\"credential\"\n            selectItem={(value) => {\n              helpers.setValue([value]);\n            }}\n            deselectItem={() => {\n              helpers.setValue([]);\n            }}\n            searchableKeys={searchableKeys}\n            relatedSearchableKeys={relatedSearchableKeys}\n          />\n        </FormGroup>\n      </Form>\n    </>\n  );\n}\n\nAdHocCredentialStep.propTypes = {\n  credentialTypeId: PropTypes.number.isRequired,\n};\nexport default AdHocCredentialStep;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}