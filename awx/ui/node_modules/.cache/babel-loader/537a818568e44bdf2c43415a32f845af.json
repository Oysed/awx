{"ast":null,"code":"import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{i18n}from\"@lingui/core\";import React,{useCallback,useEffect}from'react';import{useLocation}from'react-router-dom';import{FormGroup}from'@patternfly/react-core';import{ApplicationsAPI}from'api';import{Application}from'types';import{getSearchableKeys}from'components/PaginatedTable';import{getQSConfig,parseQueryString}from'util/qs';import useRequest from'hooks/useRequest';import Lookup from'./Lookup';import OptionsList from'../OptionsList';import LookupErrorMessage from'./shared/LookupErrorMessage';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var QS_CONFIG=getQSConfig('applications',{page:1,page_size:5,order_by:'name'});function ApplicationLookup(_ref){var onChange=_ref.onChange,value=_ref.value,label=_ref.label,fieldName=_ref.fieldName,validate=_ref.validate;var location=useLocation();var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _actionsResponse$data,_actionsResponse$data2,_actionsResponse$data3;var params,_yield$Promise$all,_yield$Promise$all2,_yield$Promise$all2$,results,count,actionsResponse;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:params=parseQueryString(QS_CONFIG,location.search);_context.next=3;return Promise.all([ApplicationsAPI.read(params),ApplicationsAPI.readOptions]);case 3:_yield$Promise$all=_context.sent;_yield$Promise$all2=_slicedToArray(_yield$Promise$all,2);_yield$Promise$all2$=_yield$Promise$all2[0].data;results=_yield$Promise$all2$.results;count=_yield$Promise$all2$.count;actionsResponse=_yield$Promise$all2[1];return _context.abrupt(\"return\",{applications:results,itemCount:count,relatedSearchableKeys:((actionsResponse===null||actionsResponse===void 0?void 0:(_actionsResponse$data=actionsResponse.data)===null||_actionsResponse$data===void 0?void 0:_actionsResponse$data.related_search_fields)||[]).map(function(val){return val.slice(0,-8);}),searchableKeys:getSearchableKeys(actionsResponse===null||actionsResponse===void 0?void 0:(_actionsResponse$data2=actionsResponse.data)===null||_actionsResponse$data2===void 0?void 0:(_actionsResponse$data3=_actionsResponse$data2.actions)===null||_actionsResponse$data3===void 0?void 0:_actionsResponse$data3.GET)});case 10:case\"end\":return _context.stop();}}},_callee);})),[location]),{applications:[],itemCount:0,relatedSearchableKeys:[],searchableKeys:[]}),error=_useRequest.error,_useRequest$result=_useRequest.result,applications=_useRequest$result.applications,itemCount=_useRequest$result.itemCount,relatedSearchableKeys=_useRequest$result.relatedSearchableKeys,searchableKeys=_useRequest$result.searchableKeys,fetchApplications=_useRequest.request;var checkApplicationName=useCallback(/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(name){var _yield$ApplicationsAP,_yield$ApplicationsAP2,nameMatchResults,nameMatchCount;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(name){_context2.next=3;break;}onChange(null);return _context2.abrupt(\"return\");case 3:_context2.prev=3;_context2.next=6;return ApplicationsAPI.read({name:name});case 6:_yield$ApplicationsAP=_context2.sent;_yield$ApplicationsAP2=_yield$ApplicationsAP.data;nameMatchResults=_yield$ApplicationsAP2.results;nameMatchCount=_yield$ApplicationsAP2.count;onChange(nameMatchCount?nameMatchResults[0]:null);_context2.next=16;break;case 13:_context2.prev=13;_context2.t0=_context2[\"catch\"](3);onChange(null);case 16:case\"end\":return _context2.stop();}}},_callee2,null,[[3,13]]);}));return function(_x){return _ref3.apply(this,arguments);};}(),[onChange]);useEffect(function(){fetchApplications();},[fetchApplications]);return/*#__PURE__*/_jsxs(FormGroup,{fieldId:\"application\",label:label,children:[/*#__PURE__*/_jsx(Lookup,{id:\"application\",header:/*i18n*/i18n._(\"Application\"),value:value,onChange:onChange,onUpdate:fetchApplications,onDebounce:checkApplicationName,fieldName:fieldName,validate:validate,qsConfig:QS_CONFIG,renderOptionsList:function renderOptionsList(_ref4){var state=_ref4.state,dispatch=_ref4.dispatch,canDelete=_ref4.canDelete;return/*#__PURE__*/_jsx(OptionsList,{value:state.selectedItems,options:applications,optionCount:itemCount,header:/*i18n*/i18n._(\"Applications\"),qsConfig:QS_CONFIG,searchColumns:[{name:/*i18n*/i18n._(\"Name\"),key:'name__icontains',isDefault:true},{name:/*i18n*/i18n._(\"Description\"),key:'description__icontains'}],sortColumns:[{name:/*i18n*/i18n._(\"Name\"),key:'name'},{name:/*i18n*/i18n._(\"Created\"),key:'created'},{name:/*i18n*/i18n._(\"Organization\"),key:'organization'},{name:/*i18n*/i18n._(\"Description\"),key:'description'}],searchableKeys:searchableKeys,relatedSearchableKeys:relatedSearchableKeys,readOnly:!canDelete,name:\"application\",selectItem:function selectItem(item){return dispatch({type:'SELECT_ITEM',item:item});},deselectItem:function deselectItem(item){return dispatch({type:'DESELECT_ITEM',item:item});}});}}),/*#__PURE__*/_jsx(LookupErrorMessage,{error:error})]});}ApplicationLookup.defaultProps={value:null,validate:function validate(){return undefined;},fieldName:'application'};export default ApplicationLookup;","map":{"version":3,"names":["React","useCallback","useEffect","useLocation","FormGroup","ApplicationsAPI","Application","getSearchableKeys","getQSConfig","parseQueryString","useRequest","Lookup","OptionsList","LookupErrorMessage","jsx","_jsx","jsxs","_jsxs","QS_CONFIG","page","page_size","order_by","ApplicationLookup","_ref","onChange","value","label","fieldName","validate","location","_useRequest","_asyncToGenerator","_regeneratorRuntime","mark","_callee","_actionsResponse$data","_actionsResponse$data2","_actionsResponse$data3","params","_yield$Promise$all","_yield$Promise$all2","_yield$Promise$all2$","results","count","actionsResponse","wrap","_callee$","_context","prev","next","search","Promise","all","read","readOptions","sent","_slicedToArray","data","abrupt","applications","itemCount","relatedSearchableKeys","related_search_fields","map","val","slice","searchableKeys","actions","GET","stop","error","_useRequest$result","result","fetchApplications","request","checkApplicationName","_ref3","_callee2","name","_yield$ApplicationsAP","_yield$ApplicationsAP2","nameMatchResults","nameMatchCount","_callee2$","_context2","t0","_x","apply","arguments","fieldId","children","id","header","i18n","_","onUpdate","onDebounce","qsConfig","renderOptionsList","_ref4","state","dispatch","canDelete","selectedItems","options","optionCount","searchColumns","key","isDefault","sortColumns","readOnly","selectItem","item","type","deselectItem","defaultProps","undefined"],"sources":["/awx_devel/awx/ui/src/components/Lookup/ApplicationLookup.js"],"sourcesContent":["import React, { useCallback, useEffect } from 'react';\nimport { func, node, string } from 'prop-types';\nimport { useLocation } from 'react-router-dom';\nimport { t } from '@lingui/macro';\nimport { FormGroup } from '@patternfly/react-core';\nimport { ApplicationsAPI } from 'api';\nimport { Application } from 'types';\nimport { getSearchableKeys } from 'components/PaginatedTable';\nimport { getQSConfig, parseQueryString } from 'util/qs';\nimport useRequest from 'hooks/useRequest';\nimport Lookup from './Lookup';\nimport OptionsList from '../OptionsList';\nimport LookupErrorMessage from './shared/LookupErrorMessage';\n\nconst QS_CONFIG = getQSConfig('applications', {\n  page: 1,\n  page_size: 5,\n  order_by: 'name',\n});\n\nfunction ApplicationLookup({ onChange, value, label, fieldName, validate }) {\n  const location = useLocation();\n  const {\n    error,\n    result: { applications, itemCount, relatedSearchableKeys, searchableKeys },\n    request: fetchApplications,\n  } = useRequest(\n    useCallback(async () => {\n      const params = parseQueryString(QS_CONFIG, location.search);\n\n      const [\n        {\n          data: { results, count },\n        },\n        actionsResponse,\n      ] = await Promise.all([\n        ApplicationsAPI.read(params),\n        ApplicationsAPI.readOptions,\n      ]);\n      return {\n        applications: results,\n        itemCount: count,\n        relatedSearchableKeys: (\n          actionsResponse?.data?.related_search_fields || []\n        ).map((val) => val.slice(0, -8)),\n        searchableKeys: getSearchableKeys(actionsResponse?.data?.actions?.GET),\n      };\n    }, [location]),\n    {\n      applications: [],\n      itemCount: 0,\n      relatedSearchableKeys: [],\n      searchableKeys: [],\n    }\n  );\n\n  const checkApplicationName = useCallback(\n    async (name) => {\n      if (!name) {\n        onChange(null);\n        return;\n      }\n\n      try {\n        const {\n          data: { results: nameMatchResults, count: nameMatchCount },\n        } = await ApplicationsAPI.read({ name });\n        onChange(nameMatchCount ? nameMatchResults[0] : null);\n      } catch {\n        onChange(null);\n      }\n    },\n    [onChange]\n  );\n\n  useEffect(() => {\n    fetchApplications();\n  }, [fetchApplications]);\n  return (\n    <FormGroup fieldId=\"application\" label={label}>\n      <Lookup\n        id=\"application\"\n        header={t`Application`}\n        value={value}\n        onChange={onChange}\n        onUpdate={fetchApplications}\n        onDebounce={checkApplicationName}\n        fieldName={fieldName}\n        validate={validate}\n        qsConfig={QS_CONFIG}\n        renderOptionsList={({ state, dispatch, canDelete }) => (\n          <OptionsList\n            value={state.selectedItems}\n            options={applications}\n            optionCount={itemCount}\n            header={t`Applications`}\n            qsConfig={QS_CONFIG}\n            searchColumns={[\n              {\n                name: t`Name`,\n                key: 'name__icontains',\n                isDefault: true,\n              },\n              {\n                name: t`Description`,\n                key: 'description__icontains',\n              },\n            ]}\n            sortColumns={[\n              {\n                name: t`Name`,\n                key: 'name',\n              },\n              {\n                name: t`Created`,\n                key: 'created',\n              },\n              {\n                name: t`Organization`,\n                key: 'organization',\n              },\n              {\n                name: t`Description`,\n                key: 'description',\n              },\n            ]}\n            searchableKeys={searchableKeys}\n            relatedSearchableKeys={relatedSearchableKeys}\n            readOnly={!canDelete}\n            name=\"application\"\n            selectItem={(item) => dispatch({ type: 'SELECT_ITEM', item })}\n            deselectItem={(item) => dispatch({ type: 'DESELECT_ITEM', item })}\n          />\n        )}\n      />\n      <LookupErrorMessage error={error} />\n    </FormGroup>\n  );\n}\nApplicationLookup.propTypes = {\n  label: node.isRequired,\n  onChange: func.isRequired,\n  value: Application,\n  validate: func,\n  fieldName: string,\n};\n\nApplicationLookup.defaultProps = {\n  value: null,\n  validate: () => undefined,\n  fieldName: 'application',\n};\n\nexport default ApplicationLookup;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}