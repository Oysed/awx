{"ast":null,"code":"import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{useEffect,useState,useCallback}from'react';import{useLocation,useHistory}from'react-router-dom';import{parseQueryString,updateQueryString}from'util/qs';import useIsMounted from'./useIsMounted';/*\n * The useRequest hook accepts a request function and returns an object with\n * five values:\n *   request: a function to call to invoke the request\n *   result: the value returned from the request function (once invoked)\n *   isLoading: boolean state indicating whether the request is in active/in flight\n *   error: any caught error resulting from the request\n *   setValue: setter to explicitly set the result value\n *\n * The hook also accepts an optional second parameter which is a default\n * value to set as result before the first time the request is made.\n */export default function useRequest(makeRequest,initialValue){var _useState=useState(initialValue),_useState2=_slicedToArray(_useState,2),result=_useState2[0],setResult=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),error=_useState4[0],setError=_useState4[1];var _useState5=useState((initialValue===null||initialValue===void 0?void 0:initialValue.isLoading)||false),_useState6=_slicedToArray(_useState5,2),isLoading=_useState6[0],setIsLoading=_useState6[1];var isMounted=useIsMounted();return{result:result,error:error,isLoading:isLoading,request:useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var response,_args=arguments;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setIsLoading(true);_context.prev=1;_context.next=4;return makeRequest.apply(void 0,_args);case 4:response=_context.sent;if(isMounted.current){setResult(response);setError(null);}_context.next=11;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](1);if(isMounted.current){setError(_context.t0);setResult(initialValue);}case 11:_context.prev=11;if(isMounted.current){setIsLoading(false);}return _context.finish(11);case 14:case\"end\":return _context.stop();}}},_callee,null,[[1,8,11,14]]);})),/* eslint-disable-next-line react-hooks/exhaustive-deps */[makeRequest]),setValue:setResult};}/*\n * Provides controls for \"dismissing\" an error message\n *\n * Params: an error object\n * Returns: { error, dismissError }\n *   The returned error object is the same object passed in via the paremeter,\n *   until the dismissError function is called, at which point the returned\n *   error will be set to null on the subsequent render.\n */export function useDismissableError(error){var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),showError=_useState8[0],setShowError=_useState8[1];useEffect(function(){if(error){setShowError(true);}},[error]);return{error:showError?error:null,dismissError:function dismissError(){setShowError(false);}};}/*\n * Hook to assist with deletion of items from a paginated item list. The page\n * url will be navigated back one page on a paginated list if needed to prevent\n * the UI from re-loading an empty set and displaying a \"No items found\"\n * message.\n *\n * Params: a callback function that will be invoked in order to delete items,\n *   and an object with structure { qsConfig, allItemsSelected, fetchItems }\n * Returns: { isLoading, deleteItems, deletionError, clearDeletionError }\n */export function useDeleteItems(makeRequest){var _ref2=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},_ref2$qsConfig=_ref2.qsConfig,qsConfig=_ref2$qsConfig===void 0?null:_ref2$qsConfig,_ref2$allItemsSelecte=_ref2.allItemsSelected,allItemsSelected=_ref2$allItemsSelecte===void 0?false:_ref2$allItemsSelecte,_ref2$fetchItems=_ref2.fetchItems,fetchItems=_ref2$fetchItems===void 0?null:_ref2$fetchItems;var location=useLocation();var history=useHistory();var _useRequest=useRequest(makeRequest,null),requestError=_useRequest.error,isLoading=_useRequest.isLoading,request=_useRequest.request;var _useDismissableError=useDismissableError(requestError),error=_useDismissableError.error,dismissError=_useDismissableError.dismissError;var deleteItems=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var params,qs;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return request();case 2:if(qsConfig){_context2.next=4;break;}return _context2.abrupt(\"return\");case 4:params=parseQueryString(qsConfig,location.search);if(params.page>1&&allItemsSelected){qs=updateQueryString(qsConfig,location.search,{page:params.page-1});history.push(\"\".concat(location.pathname,\"?\").concat(qs));}else{fetchItems();}case 6:case\"end\":return _context2.stop();}}},_callee2);}));return function deleteItems(){return _ref3.apply(this,arguments);};}();return{isLoading:isLoading,deleteItems:deleteItems,deletionError:error,clearDeletionError:dismissError};}","map":{"version":3,"names":["useEffect","useState","useCallback","useLocation","useHistory","parseQueryString","updateQueryString","useIsMounted","useRequest","makeRequest","initialValue","_useState","_useState2","_slicedToArray","result","setResult","_useState3","_useState4","error","setError","_useState5","isLoading","_useState6","setIsLoading","isMounted","request","_asyncToGenerator","_regeneratorRuntime","mark","_callee","response","_args","arguments","wrap","_callee$","_context","prev","next","apply","sent","current","t0","finish","stop","setValue","useDismissableError","_useState7","_useState8","showError","setShowError","dismissError","useDeleteItems","_ref2","length","undefined","_ref2$qsConfig","qsConfig","_ref2$allItemsSelecte","allItemsSelected","_ref2$fetchItems","fetchItems","location","history","_useRequest","requestError","_useDismissableError","deleteItems","_ref3","_callee2","params","qs","_callee2$","_context2","abrupt","search","page","push","concat","pathname","deletionError","clearDeletionError"],"sources":["/awx_devel/awx/ui/src/hooks/useRequest.js"],"sourcesContent":["import { useEffect, useState, useCallback } from 'react';\nimport { useLocation, useHistory } from 'react-router-dom';\nimport { parseQueryString, updateQueryString } from 'util/qs';\nimport useIsMounted from './useIsMounted';\n\n/*\n * The useRequest hook accepts a request function and returns an object with\n * five values:\n *   request: a function to call to invoke the request\n *   result: the value returned from the request function (once invoked)\n *   isLoading: boolean state indicating whether the request is in active/in flight\n *   error: any caught error resulting from the request\n *   setValue: setter to explicitly set the result value\n *\n * The hook also accepts an optional second parameter which is a default\n * value to set as result before the first time the request is made.\n */\nexport default function useRequest(makeRequest, initialValue) {\n  const [result, setResult] = useState(initialValue);\n  const [error, setError] = useState(null);\n  const [isLoading, setIsLoading] = useState(initialValue?.isLoading || false);\n  const isMounted = useIsMounted();\n\n  return {\n    result,\n    error,\n    isLoading,\n    request: useCallback(\n      async (...args) => {\n        setIsLoading(true);\n        try {\n          const response = await makeRequest(...args);\n          if (isMounted.current) {\n            setResult(response);\n            setError(null);\n          }\n        } catch (err) {\n          if (isMounted.current) {\n            setError(err);\n            setResult(initialValue);\n          }\n        } finally {\n          if (isMounted.current) {\n            setIsLoading(false);\n          }\n        }\n      },\n      /* eslint-disable-next-line react-hooks/exhaustive-deps */\n      [makeRequest]\n    ),\n    setValue: setResult,\n  };\n}\n\n/*\n * Provides controls for \"dismissing\" an error message\n *\n * Params: an error object\n * Returns: { error, dismissError }\n *   The returned error object is the same object passed in via the paremeter,\n *   until the dismissError function is called, at which point the returned\n *   error will be set to null on the subsequent render.\n */\nexport function useDismissableError(error) {\n  const [showError, setShowError] = useState(false);\n\n  useEffect(() => {\n    if (error) {\n      setShowError(true);\n    }\n  }, [error]);\n\n  return {\n    error: showError ? error : null,\n    dismissError: () => {\n      setShowError(false);\n    },\n  };\n}\n\n/*\n * Hook to assist with deletion of items from a paginated item list. The page\n * url will be navigated back one page on a paginated list if needed to prevent\n * the UI from re-loading an empty set and displaying a \"No items found\"\n * message.\n *\n * Params: a callback function that will be invoked in order to delete items,\n *   and an object with structure { qsConfig, allItemsSelected, fetchItems }\n * Returns: { isLoading, deleteItems, deletionError, clearDeletionError }\n */\nexport function useDeleteItems(\n  makeRequest,\n  { qsConfig = null, allItemsSelected = false, fetchItems = null } = {}\n) {\n  const location = useLocation();\n  const history = useHistory();\n  const {\n    error: requestError,\n    isLoading,\n    request,\n  } = useRequest(makeRequest, null);\n  const { error, dismissError } = useDismissableError(requestError);\n\n  const deleteItems = async () => {\n    await request();\n    if (!qsConfig) {\n      return;\n    }\n    const params = parseQueryString(qsConfig, location.search);\n    if (params.page > 1 && allItemsSelected) {\n      const qs = updateQueryString(qsConfig, location.search, {\n        page: params.page - 1,\n      });\n      history.push(`${location.pathname}?${qs}`);\n    } else {\n      fetchItems();\n    }\n  };\n\n  return {\n    isLoading,\n    deleteItems,\n    deletionError: error,\n    clearDeletionError: dismissError,\n  };\n}\n"],"mappings":"wTAAA,OAASA,SAAS,CAAEC,QAAQ,CAAEC,WAAW,KAAQ,OAAO,CACxD,OAASC,WAAW,CAAEC,UAAU,KAAQ,kBAAkB,CAC1D,OAASC,gBAAgB,CAAEC,iBAAiB,KAAQ,SAAS,CAC7D,MAAO,CAAAC,YAAY,KAAM,gBAAgB,CAEzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GACA,cAAe,SAAS,CAAAC,UAAUA,CAACC,WAAW,CAAEC,YAAY,CAAE,CAC5D,IAAAC,SAAA,CAA4BV,QAAQ,CAACS,YAAY,CAAC,CAAAE,UAAA,CAAAC,cAAA,CAAAF,SAAA,IAA3CG,MAAM,CAAAF,UAAA,IAAEG,SAAS,CAAAH,UAAA,IACxB,IAAAI,UAAA,CAA0Bf,QAAQ,CAAC,IAAI,CAAC,CAAAgB,UAAA,CAAAJ,cAAA,CAAAG,UAAA,IAAjCE,KAAK,CAAAD,UAAA,IAAEE,QAAQ,CAAAF,UAAA,IACtB,IAAAG,UAAA,CAAkCnB,QAAQ,CAAC,CAAAS,YAAY,SAAZA,YAAY,iBAAZA,YAAY,CAAEW,SAAS,GAAI,KAAK,CAAC,CAAAC,UAAA,CAAAT,cAAA,CAAAO,UAAA,IAArEC,SAAS,CAAAC,UAAA,IAAEC,YAAY,CAAAD,UAAA,IAC9B,GAAM,CAAAE,SAAS,CAAGjB,YAAY,CAAC,CAAC,CAEhC,MAAO,CACLO,MAAM,CAANA,MAAM,CACNI,KAAK,CAALA,KAAK,CACLG,SAAS,CAATA,SAAS,CACTI,OAAO,CAAEvB,WAAW,cAAAwB,iBAAA,cAAAC,mBAAA,CAAAC,IAAA,CAClB,SAAAC,QAAA,MAAAC,QAAA,CAAAC,KAAA,CAAAC,SAAA,QAAAL,mBAAA,CAAAM,IAAA,UAAAC,SAAAC,QAAA,kBAAAA,QAAA,CAAAC,IAAA,CAAAD,QAAA,CAAAE,IAAA,SACEd,YAAY,CAAC,IAAI,CAAC,CAACY,QAAA,CAAAC,IAAA,GAAAD,QAAA,CAAAE,IAAA,SAEM,CAAA5B,WAAW,CAAA6B,KAAA,QAAAP,KAAQ,CAAC,QAArCD,QAAQ,CAAAK,QAAA,CAAAI,IAAA,CACd,GAAIf,SAAS,CAACgB,OAAO,CAAE,CACrBzB,SAAS,CAACe,QAAQ,CAAC,CACnBX,QAAQ,CAAC,IAAI,CAAC,CAChB,CAACgB,QAAA,CAAAE,IAAA,iBAAAF,QAAA,CAAAC,IAAA,GAAAD,QAAA,CAAAM,EAAA,CAAAN,QAAA,aAED,GAAIX,SAAS,CAACgB,OAAO,CAAE,CACrBrB,QAAQ,CAAAgB,QAAA,CAAAM,EAAI,CAAC,CACb1B,SAAS,CAACL,YAAY,CAAC,CACzB,CAAC,QAAAyB,QAAA,CAAAC,IAAA,IAED,GAAIZ,SAAS,CAACgB,OAAO,CAAE,CACrBjB,YAAY,CAAC,KAAK,CAAC,CACrB,CAAC,OAAAY,QAAA,CAAAO,MAAA,8BAAAP,QAAA,CAAAQ,IAAA,OAAAd,OAAA,sBAEJ,GACD,0DACA,CAACpB,WAAW,CACd,CAAC,CACDmC,QAAQ,CAAE7B,SACZ,CAAC,CACH,CAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GACA,MAAO,SAAS,CAAA8B,mBAAmBA,CAAC3B,KAAK,CAAE,CACzC,IAAA4B,UAAA,CAAkC7C,QAAQ,CAAC,KAAK,CAAC,CAAA8C,UAAA,CAAAlC,cAAA,CAAAiC,UAAA,IAA1CE,SAAS,CAAAD,UAAA,IAAEE,YAAY,CAAAF,UAAA,IAE9B/C,SAAS,CAAC,UAAM,CACd,GAAIkB,KAAK,CAAE,CACT+B,YAAY,CAAC,IAAI,CAAC,CACpB,CACF,CAAC,CAAE,CAAC/B,KAAK,CAAC,CAAC,CAEX,MAAO,CACLA,KAAK,CAAE8B,SAAS,CAAG9B,KAAK,CAAG,IAAI,CAC/BgC,YAAY,CAAE,SAAAA,aAAA,CAAM,CAClBD,YAAY,CAAC,KAAK,CAAC,CACrB,CACF,CAAC,CACH,CAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GACA,MAAO,SAAS,CAAAE,cAAcA,CAC5B1C,WAAW,CAEX,KAAA2C,KAAA,CAAApB,SAAA,CAAAqB,MAAA,IAAArB,SAAA,MAAAsB,SAAA,CAAAtB,SAAA,IADmE,CAAC,CAAC,CAAAuB,cAAA,CAAAH,KAAA,CAAnEI,QAAQ,CAARA,QAAQ,CAAAD,cAAA,UAAG,IAAI,CAAAA,cAAA,CAAAE,qBAAA,CAAAL,KAAA,CAAEM,gBAAgB,CAAhBA,gBAAgB,CAAAD,qBAAA,UAAG,KAAK,CAAAA,qBAAA,CAAAE,gBAAA,CAAAP,KAAA,CAAEQ,UAAU,CAAVA,UAAU,CAAAD,gBAAA,UAAG,IAAI,CAAAA,gBAAA,CAE9D,GAAM,CAAAE,QAAQ,CAAG1D,WAAW,CAAC,CAAC,CAC9B,GAAM,CAAA2D,OAAO,CAAG1D,UAAU,CAAC,CAAC,CAC5B,IAAA2D,WAAA,CAIIvD,UAAU,CAACC,WAAW,CAAE,IAAI,CAAC,CAHxBuD,YAAY,CAAAD,WAAA,CAAnB7C,KAAK,CACLG,SAAS,CAAA0C,WAAA,CAAT1C,SAAS,CACTI,OAAO,CAAAsC,WAAA,CAAPtC,OAAO,CAET,IAAAwC,oBAAA,CAAgCpB,mBAAmB,CAACmB,YAAY,CAAC,CAAzD9C,KAAK,CAAA+C,oBAAA,CAAL/C,KAAK,CAAEgC,YAAY,CAAAe,oBAAA,CAAZf,YAAY,CAE3B,GAAM,CAAAgB,WAAW,6BAAAC,KAAA,CAAAzC,iBAAA,cAAAC,mBAAA,CAAAC,IAAA,CAAG,SAAAwC,SAAA,MAAAC,MAAA,CAAAC,EAAA,QAAA3C,mBAAA,CAAAM,IAAA,UAAAsC,UAAAC,SAAA,kBAAAA,SAAA,CAAApC,IAAA,CAAAoC,SAAA,CAAAnC,IAAA,SAAAmC,SAAA,CAAAnC,IAAA,SACZ,CAAAZ,OAAO,CAAC,CAAC,WACV+B,QAAQ,EAAAgB,SAAA,CAAAnC,IAAA,iBAAAmC,SAAA,CAAAC,MAAA,kBAGPJ,MAAM,CAAGhE,gBAAgB,CAACmD,QAAQ,CAAEK,QAAQ,CAACa,MAAM,CAAC,CAC1D,GAAIL,MAAM,CAACM,IAAI,CAAG,CAAC,EAAIjB,gBAAgB,CAAE,CACjCY,EAAE,CAAGhE,iBAAiB,CAACkD,QAAQ,CAAEK,QAAQ,CAACa,MAAM,CAAE,CACtDC,IAAI,CAAEN,MAAM,CAACM,IAAI,CAAG,CACtB,CAAC,CAAC,CACFb,OAAO,CAACc,IAAI,IAAAC,MAAA,CAAIhB,QAAQ,CAACiB,QAAQ,MAAAD,MAAA,CAAIP,EAAE,CAAE,CAAC,CAC5C,CAAC,IAAM,CACLV,UAAU,CAAC,CAAC,CACd,CAAC,wBAAAY,SAAA,CAAA7B,IAAA,OAAAyB,QAAA,GACF,kBAdK,CAAAF,WAAWA,CAAA,SAAAC,KAAA,CAAA7B,KAAA,MAAAN,SAAA,OAchB,CAED,MAAO,CACLX,SAAS,CAATA,SAAS,CACT6C,WAAW,CAAXA,WAAW,CACXa,aAAa,CAAE7D,KAAK,CACpB8D,kBAAkB,CAAE9B,YACtB,CAAC,CACH"},"metadata":{},"sourceType":"module"}