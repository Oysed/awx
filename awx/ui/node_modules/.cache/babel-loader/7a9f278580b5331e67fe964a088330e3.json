{"ast":null,"code":"import _createForOfIteratorHelper from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import React,{useCallback,useEffect,useState}from'react';import{useHistory}from'react-router-dom';import{PageSection,Card}from'@patternfly/react-core';import useRequest from'hooks/useRequest';import{CredentialsAPI,OrganizationsAPI}from'api';import{CardBody}from'components/Card';import ContentError from'components/ContentError';import ContentLoading from'components/ContentLoading';import OrganizationForm from'../shared/OrganizationForm';import{jsx as _jsx}from\"react/jsx-runtime\";function OrganizationAdd(){var history=useHistory();var _useState=useState(null),_useState2=_slicedToArray(_useState,2),formError=_useState2[0],setFormError=_useState2[1];var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _yield$CredentialsAPI,results;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return CredentialsAPI.read({credential_type__kind:'galaxy',managed:true});case 2:_yield$CredentialsAPI=_context.sent;results=_yield$CredentialsAPI.data.results;return _context.abrupt(\"return\",results[0]||null);case 5:case\"end\":return _context.stop();}}},_callee);})),[]),null),isLoading=_useRequest.isLoading,defaultGalaxyCredentialError=_useRequest.error,fetchDefaultGalaxyCredential=_useRequest.request,defaultGalaxyCredential=_useRequest.result;useEffect(function(){fetchDefaultGalaxyCredential();},[fetchDefaultGalaxyCredential]);var handleSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(values,groupsToAssociate){var _values$default_envir,_yield$OrganizationsA,response,_iterator,_step,group,_iterator2,_step2,credential;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return OrganizationsAPI.create(_objectSpread(_objectSpread({},values),{},{default_environment:(_values$default_envir=values.default_environment)===null||_values$default_envir===void 0?void 0:_values$default_envir.id}));case 3:_yield$OrganizationsA=_context2.sent;response=_yield$OrganizationsA.data;/* eslint-disable no-await-in-loop, no-restricted-syntax */ // Resolve Promises sequentially to maintain order and avoid race condition\n_iterator=_createForOfIteratorHelper(groupsToAssociate);_context2.prev=6;_iterator.s();case 8:if((_step=_iterator.n()).done){_context2.next=14;break;}group=_step.value;_context2.next=12;return OrganizationsAPI.associateInstanceGroup(response.id,group.id);case 12:_context2.next=8;break;case 14:_context2.next=19;break;case 16:_context2.prev=16;_context2.t0=_context2[\"catch\"](6);_iterator.e(_context2.t0);case 19:_context2.prev=19;_iterator.f();return _context2.finish(19);case 22:_iterator2=_createForOfIteratorHelper(values.galaxy_credentials);_context2.prev=23;_iterator2.s();case 25:if((_step2=_iterator2.n()).done){_context2.next=31;break;}credential=_step2.value;_context2.next=29;return OrganizationsAPI.associateGalaxyCredential(response.id,credential.id);case 29:_context2.next=25;break;case 31:_context2.next=36;break;case 33:_context2.prev=33;_context2.t1=_context2[\"catch\"](23);_iterator2.e(_context2.t1);case 36:_context2.prev=36;_iterator2.f();return _context2.finish(36);case 39:/* eslint-enable no-await-in-loop, no-restricted-syntax */history.push(\"/organizations/\".concat(response.id));_context2.next=45;break;case 42:_context2.prev=42;_context2.t2=_context2[\"catch\"](0);setFormError(_context2.t2);case 45:case\"end\":return _context2.stop();}}},_callee2,null,[[0,42],[6,16,19,22],[23,33,36,39]]);}));return function handleSubmit(_x,_x2){return _ref2.apply(this,arguments);};}();var handleCancel=function handleCancel(){history.push('/organizations');};if(defaultGalaxyCredentialError){return/*#__PURE__*/_jsx(PageSection,{children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(CardBody,{children:/*#__PURE__*/_jsx(ContentError,{error:defaultGalaxyCredentialError})})})});}if(isLoading){return/*#__PURE__*/_jsx(PageSection,{children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(CardBody,{children:/*#__PURE__*/_jsx(ContentLoading,{})})})});}return/*#__PURE__*/_jsx(PageSection,{children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(CardBody,{children:/*#__PURE__*/_jsx(OrganizationForm,{onSubmit:handleSubmit,onCancel:handleCancel,submitError:formError,defaultGalaxyCredential:defaultGalaxyCredential})})})});}export{OrganizationAdd as _OrganizationAdd};export default OrganizationAdd;","map":{"version":3,"names":["React","useCallback","useEffect","useState","useHistory","PageSection","Card","useRequest","CredentialsAPI","OrganizationsAPI","CardBody","ContentError","ContentLoading","OrganizationForm","jsx","_jsx","OrganizationAdd","history","_useState","_useState2","_slicedToArray","formError","setFormError","_useRequest","_asyncToGenerator","_regeneratorRuntime","mark","_callee","_yield$CredentialsAPI","results","wrap","_callee$","_context","prev","next","read","credential_type__kind","managed","sent","data","abrupt","stop","isLoading","defaultGalaxyCredentialError","error","fetchDefaultGalaxyCredential","request","defaultGalaxyCredential","result","handleSubmit","_ref2","_callee2","values","groupsToAssociate","_values$default_envir","_yield$OrganizationsA","response","_iterator","_step","group","_iterator2","_step2","credential","_callee2$","_context2","create","_objectSpread","default_environment","id","_createForOfIteratorHelper","s","n","done","value","associateInstanceGroup","t0","e","f","finish","galaxy_credentials","associateGalaxyCredential","t1","push","concat","t2","_x","_x2","apply","arguments","handleCancel","children","onSubmit","onCancel","submitError","_OrganizationAdd"],"sources":["/awx_devel/awx/ui/src/screens/Organization/OrganizationAdd/OrganizationAdd.js"],"sourcesContent":["import React, { useCallback, useEffect, useState } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport { PageSection, Card } from '@patternfly/react-core';\nimport useRequest from 'hooks/useRequest';\nimport { CredentialsAPI, OrganizationsAPI } from 'api';\nimport { CardBody } from 'components/Card';\nimport ContentError from 'components/ContentError';\nimport ContentLoading from 'components/ContentLoading';\nimport OrganizationForm from '../shared/OrganizationForm';\n\nfunction OrganizationAdd() {\n  const history = useHistory();\n  const [formError, setFormError] = useState(null);\n\n  const {\n    isLoading,\n    error: defaultGalaxyCredentialError,\n    request: fetchDefaultGalaxyCredential,\n    result: defaultGalaxyCredential,\n  } = useRequest(\n    useCallback(async () => {\n      const {\n        data: { results },\n      } = await CredentialsAPI.read({\n        credential_type__kind: 'galaxy',\n        managed: true,\n      });\n\n      return results[0] || null;\n    }, []),\n    null\n  );\n\n  useEffect(() => {\n    fetchDefaultGalaxyCredential();\n  }, [fetchDefaultGalaxyCredential]);\n\n  const handleSubmit = async (values, groupsToAssociate) => {\n    try {\n      const { data: response } = await OrganizationsAPI.create({\n        ...values,\n        default_environment: values.default_environment?.id,\n      });\n      /* eslint-disable no-await-in-loop, no-restricted-syntax */\n      // Resolve Promises sequentially to maintain order and avoid race condition\n      for (const group of groupsToAssociate) {\n        await OrganizationsAPI.associateInstanceGroup(response.id, group.id);\n      }\n      for (const credential of values.galaxy_credentials) {\n        await OrganizationsAPI.associateGalaxyCredential(\n          response.id,\n          credential.id\n        );\n      }\n      /* eslint-enable no-await-in-loop, no-restricted-syntax */\n\n      history.push(`/organizations/${response.id}`);\n    } catch (error) {\n      setFormError(error);\n    }\n  };\n\n  const handleCancel = () => {\n    history.push('/organizations');\n  };\n\n  if (defaultGalaxyCredentialError) {\n    return (\n      <PageSection>\n        <Card>\n          <CardBody>\n            <ContentError error={defaultGalaxyCredentialError} />\n          </CardBody>\n        </Card>\n      </PageSection>\n    );\n  }\n\n  if (isLoading) {\n    return (\n      <PageSection>\n        <Card>\n          <CardBody>\n            <ContentLoading />\n          </CardBody>\n        </Card>\n      </PageSection>\n    );\n  }\n\n  return (\n    <PageSection>\n      <Card>\n        <CardBody>\n          <OrganizationForm\n            onSubmit={handleSubmit}\n            onCancel={handleCancel}\n            submitError={formError}\n            defaultGalaxyCredential={defaultGalaxyCredential}\n          />\n        </CardBody>\n      </Card>\n    </PageSection>\n  );\n}\n\nexport { OrganizationAdd as _OrganizationAdd };\nexport default OrganizationAdd;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}