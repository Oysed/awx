{"ast":null,"code":"import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _taggedTemplateLiteral from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral.js\";var _templateObject;import{i18n}from\"@lingui/core\";import React,{useState,useEffect,useContext}from'react';import{Button,Tooltip,DropdownItem}from'@patternfly/react-core';import styled from'styled-components';import{KebabifiedContext}from'contexts/Kebabified';import AlertModal from'../AlertModal';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var ModalNote=styled.div(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  margin-bottom: var(--pf-global--spacer--xl);\\n\"])));function DisassociateButton(_ref){var _ref$itemsToDisassoci=_ref.itemsToDisassociate,itemsToDisassociate=_ref$itemsToDisassoci===void 0?[]:_ref$itemsToDisassoci,_ref$modalNote=_ref.modalNote,modalNote=_ref$modalNote===void 0?'':_ref$modalNote,_ref$modalTitle=_ref.modalTitle,modalTitle=_ref$modalTitle===void 0?/*i18n*/i18n._(\"Disassociate?\"):_ref$modalTitle,onDisassociate=_ref.onDisassociate,_ref$verifyCannotDisa=_ref.verifyCannotDisassociate,verifyCannotDisassociate=_ref$verifyCannotDisa===void 0?true:_ref$verifyCannotDisa,_ref$isProtectedInsta=_ref.isProtectedInstanceGroup,isProtectedInstanceGroup=_ref$isProtectedInsta===void 0?false:_ref$isProtectedInsta;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isOpen=_useState2[0],setIsOpen=_useState2[1];var _useContext=useContext(KebabifiedContext),isKebabified=_useContext.isKebabified,onKebabModalChange=_useContext.onKebabModalChange;var handleDisassociate=function handleDisassociate(){onDisassociate();setIsOpen(false);};useEffect(function(){if(isKebabified){onKebabModalChange(isOpen);}},[isKebabified,isOpen,onKebabModalChange]);function cannotDisassociateAllOthers(item){var _item$summary_fields,_item$summary_fields$;return!((_item$summary_fields=item.summary_fields)!==null&&_item$summary_fields!==void 0&&(_item$summary_fields$=_item$summary_fields.user_capabilities)!==null&&_item$summary_fields$!==void 0&&_item$summary_fields$.delete);}function cannotDisassociateInstances(item){return item.node_type==='control'||isProtectedInstanceGroup&&item.node_type==='hybrid';}var cannotDisassociate=itemsToDisassociate.some(function(i){return i.type==='instance';})?cannotDisassociateInstances:cannotDisassociateAllOthers;function renderTooltip(){if(verifyCannotDisassociate){var itemsUnableToDisassociate=itemsToDisassociate.filter(cannotDisassociate).map(function(item){var _item$name;return(_item$name=item.name)!==null&&_item$name!==void 0?_item$name:item.hostname;}).join(', ');if(cannotDisassociate?itemsToDisassociate.some(cannotDisassociateInstances):itemsToDisassociate.some(cannotDisassociateAllOthers)){return/*#__PURE__*/_jsx(\"div\",{children:/*i18n*/i18n._(\"You do not have permission to disassociate the following: {itemsUnableToDisassociate}\",{itemsUnableToDisassociate:itemsUnableToDisassociate})});}}if(itemsToDisassociate.length){return(/*i18n*/i18n._(\"Disassociate\"));}return(/*i18n*/i18n._(\"Select a row to disassociate\"));}var isDisabled=false;if(verifyCannotDisassociate){isDisabled=itemsToDisassociate.some(cannotDisassociate);}// NOTE: Once PF supports tooltips on disabled elements,\n// we can delete the extra <div> around the <DeleteButton> below.\n// See: https://github.com/patternfly/patternfly-react/issues/1894\nreturn/*#__PURE__*/_jsxs(_Fragment,{children:[isKebabified?/*#__PURE__*/_jsx(DropdownItem,{\"aria-label\":/*i18n*/i18n._(\"disassociate\"),isDisabled:isDisabled||!itemsToDisassociate.length,component:\"button\",ouiaId:\"disassociate-tooltip\",onClick:function onClick(){return setIsOpen(true);},children:/*i18n*/i18n._(\"Disassociate\")},\"add\"):/*#__PURE__*/_jsx(Tooltip,{content:renderTooltip(),ouiaId:\"disassociate-tooltip\",position:\"top\",children:/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(Button,{ouiaId:\"disassociate-button\",variant:\"secondary\",\"aria-label\":/*i18n*/i18n._(\"Disassociate\"),onClick:function onClick(){return setIsOpen(true);},isDisabled:isDisabled||!itemsToDisassociate.length,children:/*i18n*/i18n._(\"Disassociate\")})})}),isOpen&&/*#__PURE__*/_jsxs(AlertModal,{isOpen:isOpen,title:modalTitle,variant:\"warning\",onClose:function onClose(){return setIsOpen(false);},actions:[/*#__PURE__*/_jsx(Button,{ouiaId:\"disassociate-modal-confirm\",variant:\"danger\",\"aria-label\":/*i18n*/i18n._(\"confirm disassociate\"),onClick:handleDisassociate,children:/*i18n*/i18n._(\"Disassociate\")},\"disassociate\"),/*#__PURE__*/_jsx(Button,{ouiaId:\"disassociate-modal-cancel\",variant:\"link\",\"aria-label\":/*i18n*/i18n._(\"Cancel\"),onClick:function onClick(){return setIsOpen(false);},children:/*i18n*/i18n._(\"Cancel\")},\"cancel\")],children:[modalNote&&/*#__PURE__*/_jsx(ModalNote,{children:modalNote}),/*#__PURE__*/_jsx(\"div\",{children:/*i18n*/i18n._(\"This action will disassociate the following:\")}),itemsToDisassociate.map(function(item){return/*#__PURE__*/_jsxs(\"span\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:item.hostname?item.hostname:item.name}),/*#__PURE__*/_jsx(\"br\",{})]},item.id);})]})]});}DisassociateButton.defaultProps={itemsToDisassociate:[],modalNote:'',modalTitle:''};export default DisassociateButton;","map":{"version":3,"names":["React","useState","useEffect","useContext","Button","Tooltip","DropdownItem","styled","KebabifiedContext","AlertModal","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","ModalNote","div","_templateObject","_taggedTemplateLiteral","DisassociateButton","_ref","_ref$itemsToDisassoci","itemsToDisassociate","_ref$modalNote","modalNote","_ref$modalTitle","modalTitle","i18n","_","onDisassociate","_ref$verifyCannotDisa","verifyCannotDisassociate","_ref$isProtectedInsta","isProtectedInstanceGroup","_useState","_useState2","_slicedToArray","isOpen","setIsOpen","_useContext","isKebabified","onKebabModalChange","handleDisassociate","cannotDisassociateAllOthers","item","_item$summary_fields","_item$summary_fields$","summary_fields","user_capabilities","delete","cannotDisassociateInstances","node_type","cannotDisassociate","some","i","type","renderTooltip","itemsUnableToDisassociate","filter","map","_item$name","name","hostname","join","children","length","isDisabled","component","ouiaId","onClick","content","position","variant","title","onClose","actions","id","defaultProps"],"sources":["/awx_devel/awx/ui/src/components/DisassociateButton/DisassociateButton.js"],"sourcesContent":["import React, { useState, useEffect, useContext } from 'react';\nimport {\n  arrayOf,\n  func,\n  shape,\n  string,\n  oneOfType,\n  number,\n  node,\n} from 'prop-types';\n\nimport { t } from '@lingui/macro';\nimport { Button, Tooltip, DropdownItem } from '@patternfly/react-core';\nimport styled from 'styled-components';\nimport { KebabifiedContext } from 'contexts/Kebabified';\n\nimport AlertModal from '../AlertModal';\n\nconst ModalNote = styled.div`\n  margin-bottom: var(--pf-global--spacer--xl);\n`;\n\nfunction DisassociateButton({\n  itemsToDisassociate = [],\n  modalNote = '',\n  modalTitle = t`Disassociate?`,\n  onDisassociate,\n  verifyCannotDisassociate = true,\n  isProtectedInstanceGroup = false,\n}) {\n  const [isOpen, setIsOpen] = useState(false);\n  const { isKebabified, onKebabModalChange } = useContext(KebabifiedContext);\n\n  const handleDisassociate = () => {\n    onDisassociate();\n    setIsOpen(false);\n  };\n\n  useEffect(() => {\n    if (isKebabified) {\n      onKebabModalChange(isOpen);\n    }\n  }, [isKebabified, isOpen, onKebabModalChange]);\n\n  function cannotDisassociateAllOthers(item) {\n    return !item.summary_fields?.user_capabilities?.delete;\n  }\n  function cannotDisassociateInstances(item) {\n    return (\n      item.node_type === 'control' ||\n      (isProtectedInstanceGroup && item.node_type === 'hybrid')\n    );\n  }\n\n  const cannotDisassociate = itemsToDisassociate.some(\n    (i) => i.type === 'instance'\n  )\n    ? cannotDisassociateInstances\n    : cannotDisassociateAllOthers;\n\n  function renderTooltip() {\n    if (verifyCannotDisassociate) {\n      const itemsUnableToDisassociate = itemsToDisassociate\n        .filter(cannotDisassociate)\n        .map((item) => item.name ?? item.hostname)\n        .join(', ');\n      if (\n        cannotDisassociate\n          ? itemsToDisassociate.some(cannotDisassociateInstances)\n          : itemsToDisassociate.some(cannotDisassociateAllOthers)\n      ) {\n        return (\n          <div>\n            {t`You do not have permission to disassociate the following: ${itemsUnableToDisassociate}`}\n          </div>\n        );\n      }\n    }\n\n    if (itemsToDisassociate.length) {\n      return t`Disassociate`;\n    }\n    return t`Select a row to disassociate`;\n  }\n\n  let isDisabled = false;\n  if (verifyCannotDisassociate) {\n    isDisabled = itemsToDisassociate.some(cannotDisassociate);\n  }\n\n  // NOTE: Once PF supports tooltips on disabled elements,\n  // we can delete the extra <div> around the <DeleteButton> below.\n  // See: https://github.com/patternfly/patternfly-react/issues/1894\n  return (\n    <>\n      {isKebabified ? (\n        <DropdownItem\n          key=\"add\"\n          aria-label={t`disassociate`}\n          isDisabled={isDisabled || !itemsToDisassociate.length}\n          component=\"button\"\n          ouiaId=\"disassociate-tooltip\"\n          onClick={() => setIsOpen(true)}\n        >\n          {t`Disassociate`}\n        </DropdownItem>\n      ) : (\n        <Tooltip\n          content={renderTooltip()}\n          ouiaId=\"disassociate-tooltip\"\n          position=\"top\"\n        >\n          <div>\n            <Button\n              ouiaId=\"disassociate-button\"\n              variant=\"secondary\"\n              aria-label={t`Disassociate`}\n              onClick={() => setIsOpen(true)}\n              isDisabled={isDisabled || !itemsToDisassociate.length}\n            >\n              {t`Disassociate`}\n            </Button>\n          </div>\n        </Tooltip>\n      )}\n\n      {isOpen && (\n        <AlertModal\n          isOpen={isOpen}\n          title={modalTitle}\n          variant=\"warning\"\n          onClose={() => setIsOpen(false)}\n          actions={[\n            <Button\n              ouiaId=\"disassociate-modal-confirm\"\n              key=\"disassociate\"\n              variant=\"danger\"\n              aria-label={t`confirm disassociate`}\n              onClick={handleDisassociate}\n            >\n              {t`Disassociate`}\n            </Button>,\n            <Button\n              ouiaId=\"disassociate-modal-cancel\"\n              key=\"cancel\"\n              variant=\"link\"\n              aria-label={t`Cancel`}\n              onClick={() => setIsOpen(false)}\n            >\n              {t`Cancel`}\n            </Button>,\n          ]}\n        >\n          {modalNote && <ModalNote>{modalNote}</ModalNote>}\n\n          <div>{t`This action will disassociate the following:`}</div>\n\n          {itemsToDisassociate.map((item) => (\n            <span key={item.id}>\n              <strong>{item.hostname ? item.hostname : item.name}</strong>\n              <br />\n            </span>\n          ))}\n        </AlertModal>\n      )}\n    </>\n  );\n}\n\nDisassociateButton.defaultProps = {\n  itemsToDisassociate: [],\n  modalNote: '',\n  modalTitle: '',\n};\n\nDisassociateButton.propTypes = {\n  itemsToDisassociate: oneOfType([\n    arrayOf(\n      shape({\n        id: number.isRequired,\n        name: string.isRequired,\n      })\n    ),\n    arrayOf(\n      shape({\n        id: number.isRequired,\n        hostname: string.isRequired,\n      })\n    ),\n  ]),\n  modalNote: node,\n  modalTitle: string,\n  onDisassociate: func.isRequired,\n};\n\nexport default DisassociateButton;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}