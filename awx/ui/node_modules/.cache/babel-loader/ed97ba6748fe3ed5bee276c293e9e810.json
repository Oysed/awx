{"ast":null,"code":"import*as d3 from'd3';import{truncateString}from'../../../util/strings';import{NODE_STATE_COLOR_KEY,NODE_TYPE_SYMBOL_KEY,LINK_STATE_COLOR_KEY,LABEL_TEXT_MAX_LENGTH,ICONS}from'../constants';export function getWidth(selector){return selector?d3.select(selector).node().clientWidth:700;}export function getHeight(selector){return selector?d3.select(selector).node().clientHeight:600;}export function renderStateColor(nodeState){return NODE_STATE_COLOR_KEY[nodeState]?NODE_STATE_COLOR_KEY[nodeState]:'';}export function renderLinkStatusColor(linkState){return LINK_STATE_COLOR_KEY[linkState]?LINK_STATE_COLOR_KEY[linkState]:'#ccc';}export function renderLabelText(nodeState,name){if(typeof nodeState==='string'&&typeof name==='string'){return\"\".concat(truncateString(name,LABEL_TEXT_MAX_LENGTH));}return\"\";}export function renderNodeType(nodeType){return NODE_TYPE_SYMBOL_KEY[nodeType]?NODE_TYPE_SYMBOL_KEY[nodeType]:\"\";}export function renderNodeIcon(selectedNode){if(selectedNode){var nodeType=selectedNode.node_type;return NODE_TYPE_SYMBOL_KEY[nodeType]?NODE_TYPE_SYMBOL_KEY[nodeType]:\"\";}return false;}export function renderLabelIcons(nodeState){if(nodeState){var nodeLabelIconMapper={ready:'checkmark',installed:'clock',unavailable:'exclaimation','deprovision-fail':'exclaimation','provision-fail':'exclaimation',provisioning:'plus',deprovisioning:'minus'};return ICONS[nodeLabelIconMapper[nodeState]]?ICONS[nodeLabelIconMapper[nodeState]]:\"\";}return false;}export function renderIconPosition(nodeState,bbox){if(nodeState){var iconPositionMapper={ready:\"translate(\".concat(bbox.x-4.5,\", \").concat(bbox.y-4.5,\"), scale(0.02)\"),installed:\"translate(\".concat(bbox.x-6.5,\", \").concat(bbox.y-6.5,\"), scale(0.025)\"),unavailable:\"translate(\".concat(bbox.x-2,\", \").concat(bbox.y-4.4,\"), scale(0.02)\"),'provision-fail':\"translate(\".concat(bbox.x-2,\", \").concat(bbox.y-4,\"), scale(0.02)\"),'deprovision-fail':\"translate(\".concat(bbox.x-2,\", \").concat(bbox.y-4,\"), scale(0.02)\"),provisioning:\"translate(\".concat(bbox.x-4.5,\", \").concat(bbox.y-4.5,\"), scale(0.02)\"),deprovisioning:\"translate(\".concat(bbox.x-4.5,\", \").concat(bbox.y-4.5,\"), scale(0.02)\")};return iconPositionMapper[nodeState]?iconPositionMapper[nodeState]:\"\";}return false;}export function redirectToDetailsPage(selectedNode,history){if(selectedNode&&history){var nodeId=selectedNode.id;var constructedURL=\"/instances/\".concat(nodeId,\"/details\");history.push(constructedURL);}return false;}export function renderLinkState(linkState){var linkPattern={established:null,adding:3,removing:3};return linkPattern[linkState]?linkPattern[linkState]:null;}// DEBUG TOOLS\nexport function getRandomInt(min,max){min=Math.ceil(min);max=Math.floor(max);return Math.floor(Math.random()*(max-min+1))+min;}var generateRandomLinks=function generateRandomLinks(n,r){var links=[];function getRandomLinkState(){return['established','adding','removing'][getRandomInt(0,3)];}for(var i=0;i<r;i++){var link={source:n[getRandomInt(0,n.length-1)].hostname,target:n[getRandomInt(0,n.length-1)].hostname,link_state:getRandomLinkState()};if(link.source!==link.target){links.push(link);}}return{nodes:n,links:links};};export var generateRandomNodes=function generateRandomNodes(n){var nodes=[];function getRandomType(){return['hybrid','execution','control','hop'][getRandomInt(0,3)];}function getRandomState(){return['ready','provisioning','deprovisioning','installed','provision-fail','deprovision-fail','unavailable'][getRandomInt(0,6)];}for(var i=0;i<n;i++){var id=i+1;var randomType=getRandomType();var randomState=getRandomState();var node={id:id,hostname:\"node-\".concat(id),node_type:randomType,node_state:randomState,enabled:Math.random()<0.9};nodes.push(node);}return generateRandomLinks(nodes,getRandomInt(1,n-1));};","map":{"version":3,"names":["d3","truncateString","NODE_STATE_COLOR_KEY","NODE_TYPE_SYMBOL_KEY","LINK_STATE_COLOR_KEY","LABEL_TEXT_MAX_LENGTH","ICONS","getWidth","selector","select","node","clientWidth","getHeight","clientHeight","renderStateColor","nodeState","renderLinkStatusColor","linkState","renderLabelText","name","concat","renderNodeType","nodeType","renderNodeIcon","selectedNode","node_type","renderLabelIcons","nodeLabelIconMapper","ready","installed","unavailable","provisioning","deprovisioning","renderIconPosition","bbox","iconPositionMapper","x","y","redirectToDetailsPage","history","nodeId","id","constructedURL","push","renderLinkState","linkPattern","established","adding","removing","getRandomInt","min","max","Math","ceil","floor","random","generateRandomLinks","n","r","links","getRandomLinkState","i","link","source","length","hostname","target","link_state","nodes","generateRandomNodes","getRandomType","getRandomState","randomType","randomState","node_state","enabled"],"sources":["/awx_devel/awx/ui/src/screens/TopologyView/utils/helpers.js"],"sourcesContent":["import * as d3 from 'd3';\nimport { truncateString } from '../../../util/strings';\n\nimport {\n  NODE_STATE_COLOR_KEY,\n  NODE_TYPE_SYMBOL_KEY,\n  LINK_STATE_COLOR_KEY,\n  LABEL_TEXT_MAX_LENGTH,\n  ICONS,\n} from '../constants';\n\nexport function getWidth(selector) {\n  return selector ? d3.select(selector).node().clientWidth : 700;\n}\n\nexport function getHeight(selector) {\n  return selector ? d3.select(selector).node().clientHeight : 600;\n}\n\nexport function renderStateColor(nodeState) {\n  return NODE_STATE_COLOR_KEY[nodeState] ? NODE_STATE_COLOR_KEY[nodeState] : '';\n}\n\nexport function renderLinkStatusColor(linkState) {\n  return LINK_STATE_COLOR_KEY[linkState]\n    ? LINK_STATE_COLOR_KEY[linkState]\n    : '#ccc';\n}\n\nexport function renderLabelText(nodeState, name) {\n  if (typeof nodeState === 'string' && typeof name === 'string') {\n    return `${truncateString(name, LABEL_TEXT_MAX_LENGTH)}`;\n  }\n  return ``;\n}\n\nexport function renderNodeType(nodeType) {\n  return NODE_TYPE_SYMBOL_KEY[nodeType] ? NODE_TYPE_SYMBOL_KEY[nodeType] : ``;\n}\n\nexport function renderNodeIcon(selectedNode) {\n  if (selectedNode) {\n    const { node_type: nodeType } = selectedNode;\n    return NODE_TYPE_SYMBOL_KEY[nodeType] ? NODE_TYPE_SYMBOL_KEY[nodeType] : ``;\n  }\n  return false;\n}\n\nexport function renderLabelIcons(nodeState) {\n  if (nodeState) {\n    const nodeLabelIconMapper = {\n      ready: 'checkmark',\n      installed: 'clock',\n      unavailable: 'exclaimation',\n      'deprovision-fail': 'exclaimation',\n      'provision-fail': 'exclaimation',\n      provisioning: 'plus',\n      deprovisioning: 'minus',\n    };\n    return ICONS[nodeLabelIconMapper[nodeState]]\n      ? ICONS[nodeLabelIconMapper[nodeState]]\n      : ``;\n  }\n  return false;\n}\nexport function renderIconPosition(nodeState, bbox) {\n  if (nodeState) {\n    const iconPositionMapper = {\n      ready: `translate(${bbox.x - 4.5}, ${bbox.y - 4.5}), scale(0.02)`,\n      installed: `translate(${bbox.x - 6.5}, ${bbox.y - 6.5}), scale(0.025)`,\n      unavailable: `translate(${bbox.x - 2}, ${bbox.y - 4.4}), scale(0.02)`,\n      'provision-fail': `translate(${bbox.x - 2}, ${bbox.y - 4}), scale(0.02)`,\n      'deprovision-fail': `translate(${bbox.x - 2}, ${\n        bbox.y - 4\n      }), scale(0.02)`,\n      provisioning: `translate(${bbox.x - 4.5}, ${bbox.y - 4.5}), scale(0.02)`,\n      deprovisioning: `translate(${bbox.x - 4.5}, ${\n        bbox.y - 4.5\n      }), scale(0.02)`,\n    };\n    return iconPositionMapper[nodeState] ? iconPositionMapper[nodeState] : ``;\n  }\n  return false;\n}\n\nexport function redirectToDetailsPage(selectedNode, history) {\n  if (selectedNode && history) {\n    const { id: nodeId } = selectedNode;\n    const constructedURL = `/instances/${nodeId}/details`;\n    history.push(constructedURL);\n  }\n  return false;\n}\n\nexport function renderLinkState(linkState) {\n  const linkPattern = {\n    established: null,\n    adding: 3,\n    removing: 3,\n  };\n  return linkPattern[linkState] ? linkPattern[linkState] : null;\n}\n// DEBUG TOOLS\nexport function getRandomInt(min, max) {\n  min = Math.ceil(min);\n  max = Math.floor(max);\n  return Math.floor(Math.random() * (max - min + 1)) + min;\n}\n\nconst generateRandomLinks = (n, r) => {\n  const links = [];\n  function getRandomLinkState() {\n    return ['established', 'adding', 'removing'][getRandomInt(0, 3)];\n  }\n  for (let i = 0; i < r; i++) {\n    const link = {\n      source: n[getRandomInt(0, n.length - 1)].hostname,\n      target: n[getRandomInt(0, n.length - 1)].hostname,\n      link_state: getRandomLinkState(),\n    };\n    if (link.source !== link.target) {\n      links.push(link);\n    }\n  }\n\n  return { nodes: n, links };\n};\n\nexport const generateRandomNodes = (n) => {\n  const nodes = [];\n  function getRandomType() {\n    return ['hybrid', 'execution', 'control', 'hop'][getRandomInt(0, 3)];\n  }\n  function getRandomState() {\n    return [\n      'ready',\n      'provisioning',\n      'deprovisioning',\n      'installed',\n      'provision-fail',\n      'deprovision-fail',\n      'unavailable',\n    ][getRandomInt(0, 6)];\n  }\n  for (let i = 0; i < n; i++) {\n    const id = i + 1;\n    const randomType = getRandomType();\n    const randomState = getRandomState();\n    const node = {\n      id,\n      hostname: `node-${id}`,\n      node_type: randomType,\n      node_state: randomState,\n      enabled: Math.random() < 0.9,\n    };\n    nodes.push(node);\n  }\n  return generateRandomLinks(nodes, getRandomInt(1, n - 1));\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}