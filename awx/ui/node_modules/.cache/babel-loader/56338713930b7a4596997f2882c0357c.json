{"ast":null,"code":"import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{i18n}from\"@lingui/core\";import React,{useCallback,useEffect}from'react';import{CaretLeftIcon}from'@patternfly/react-icons';import{Card,PageSection}from'@patternfly/react-core';import{Switch,useParams,useLocation,useRouteMatch,Route,Redirect,Link}from'react-router-dom';import useRequest from'hooks/useRequest';import{ResourceAccessList}from'components/ResourceAccessList';import ContentError from'components/ContentError';import ContentLoading from'components/ContentLoading';import RoutedTabs from'components/RoutedTabs';import RelatedTemplateList from'components/RelatedTemplateList';import{CredentialsAPI}from'api';import CredentialDetail from'./CredentialDetail';import CredentialEdit from'./CredentialEdit';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var unacceptableCredentialTypes=['centrify_vault_kv','aim','conjur','hashivault_kv','hashivault_ssh','azure_kv','thycotic_dsv','thycotic_tss','galaxy_api_token','insights','registry','scm'];function Credential(_ref){var setBreadcrumb=_ref.setBreadcrumb;var _useLocation=useLocation(),pathname=_useLocation.pathname;var match=useRouteMatch({path:'/credentials/:id'});var _useParams=useParams(),id=_useParams.id;var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _yield$CredentialsAPI,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return CredentialsAPI.readDetail(id);case 2:_yield$CredentialsAPI=_context.sent;data=_yield$CredentialsAPI.data;return _context.abrupt(\"return\",{credential:data});case 5:case\"end\":return _context.stop();}}},_callee);})),[id]),{credential:null}),fetchCredential=_useRequest.request,credential=_useRequest.result.credential,hasContentLoading=_useRequest.isLoading,contentError=_useRequest.error;useEffect(function(){fetchCredential();},[fetchCredential,pathname]);useEffect(function(){if(credential){setBreadcrumb(credential);}},[credential,setBreadcrumb]);var tabsArray=[{name:/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(CaretLeftIcon,{}),/*i18n*/i18n._(\"Back to Credentials\")]}),link:\"/credentials\",id:99,persistentFilterKey:'credentials'},{name:/*i18n*/i18n._(\"Details\"),link:\"/credentials/\".concat(id,\"/details\"),id:0},{name:/*i18n*/i18n._(\"Access\"),link:\"/credentials/\".concat(id,\"/access\"),id:1}];if(!unacceptableCredentialTypes.includes(credential===null||credential===void 0?void 0:credential.kind)&&credential!==null){tabsArray.push({name:/*i18n*/i18n._(\"Job Templates\"),link:\"/credentials/\".concat(id,\"/job_templates\"),id:2});}var showCardHeader=true;if(pathname.endsWith('edit')||pathname.endsWith('add')){showCardHeader=false;}if(!hasContentLoading&&contentError){return/*#__PURE__*/_jsx(PageSection,{children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(ContentError,{error:contentError,children:contentError.response&&contentError.response.status===404&&/*#__PURE__*/_jsxs(\"span\",{children:[/*i18n*/i18n._(\"Credential not found.\"),' ',/*#__PURE__*/_jsx(Link,{to:\"/credentials\",children:/*i18n*/i18n._(\"View all Credentials.\")})]})})})});}if(hasContentLoading){return/*#__PURE__*/_jsx(ContentLoading,{});}return/*#__PURE__*/_jsx(PageSection,{children:/*#__PURE__*/_jsxs(Card,{children:[showCardHeader&&/*#__PURE__*/_jsx(RoutedTabs,{tabsArray:tabsArray}),!hasContentLoading&&credential&&/*#__PURE__*/_jsxs(Switch,{children:[/*#__PURE__*/_jsx(Redirect,{from:\"/credentials/:id\",to:\"/credentials/:id/details\",exact:true}),credential&&[/*#__PURE__*/_jsx(Route,{path:\"/credentials/:id/details\",children:/*#__PURE__*/_jsx(CredentialDetail,{credential:credential})},\"details\"),/*#__PURE__*/_jsx(Route,{path:\"/credentials/:id/edit\",children:/*#__PURE__*/_jsx(CredentialEdit,{credential:credential})},\"edit\"),/*#__PURE__*/_jsx(Route,{path:\"/credentials/:id/access\",children:/*#__PURE__*/_jsx(ResourceAccessList,{resource:credential,apiModel:CredentialsAPI})},\"access\"),/*#__PURE__*/_jsx(Route,{path:\"/credentials/:id/job_templates\",children:/*#__PURE__*/_jsx(RelatedTemplateList,{searchParams:{credentials__id:credential.id},resourceName:[credential.name,credential.kind]})},\"job_templates\"),/*#__PURE__*/_jsx(Route,{path:\"*\",children:!hasContentLoading&&/*#__PURE__*/_jsx(ContentError,{isNotFound:true,children:match.params.id&&/*#__PURE__*/_jsx(Link,{to:\"/credentials/\".concat(match.params.id,\"/details\"),children:/*i18n*/i18n._(\"View Credential Details\")})})},\"not-found\")],/*#__PURE__*/_jsx(Route,{path:\"*\",children:!hasContentLoading&&/*#__PURE__*/_jsx(ContentError,{isNotFound:true,children:id&&/*#__PURE__*/_jsx(Link,{to:\"/credentials/\".concat(id,\"/details\"),children:/*i18n*/i18n._(\"View Credential Details\")})})},\"not-found\")]})]})});}export default Credential;","map":{"version":3,"names":["React","useCallback","useEffect","CaretLeftIcon","Card","PageSection","Switch","useParams","useLocation","useRouteMatch","Route","Redirect","Link","useRequest","ResourceAccessList","ContentError","ContentLoading","RoutedTabs","RelatedTemplateList","CredentialsAPI","CredentialDetail","CredentialEdit","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","unacceptableCredentialTypes","Credential","_ref","setBreadcrumb","_useLocation","pathname","match","path","_useParams","id","_useRequest","_asyncToGenerator","_regeneratorRuntime","mark","_callee","_yield$CredentialsAPI","data","wrap","_callee$","_context","prev","next","readDetail","sent","abrupt","credential","stop","fetchCredential","request","result","hasContentLoading","isLoading","contentError","error","tabsArray","name","children","i18n","_","link","persistentFilterKey","concat","includes","kind","push","showCardHeader","endsWith","response","status","to","from","exact","resource","apiModel","searchParams","credentials__id","resourceName","isNotFound","params"],"sources":["/awx_devel/awx/ui/src/screens/Credential/Credential.js"],"sourcesContent":["import React, { useCallback, useEffect } from 'react';\nimport { t } from '@lingui/macro';\n\nimport { CaretLeftIcon } from '@patternfly/react-icons';\nimport { Card, PageSection } from '@patternfly/react-core';\nimport {\n  Switch,\n  useParams,\n  useLocation,\n  useRouteMatch,\n  Route,\n  Redirect,\n  Link,\n} from 'react-router-dom';\nimport useRequest from 'hooks/useRequest';\nimport { ResourceAccessList } from 'components/ResourceAccessList';\nimport ContentError from 'components/ContentError';\nimport ContentLoading from 'components/ContentLoading';\nimport RoutedTabs from 'components/RoutedTabs';\nimport RelatedTemplateList from 'components/RelatedTemplateList';\nimport { CredentialsAPI } from 'api';\nimport CredentialDetail from './CredentialDetail';\nimport CredentialEdit from './CredentialEdit';\n\nconst unacceptableCredentialTypes = [\n  'centrify_vault_kv',\n  'aim',\n  'conjur',\n  'hashivault_kv',\n  'hashivault_ssh',\n  'azure_kv',\n  'thycotic_dsv',\n  'thycotic_tss',\n  'galaxy_api_token',\n  'insights',\n  'registry',\n  'scm',\n];\n\nfunction Credential({ setBreadcrumb }) {\n  const { pathname } = useLocation();\n\n  const match = useRouteMatch({\n    path: '/credentials/:id',\n  });\n  const { id } = useParams();\n\n  const {\n    request: fetchCredential,\n    result: { credential },\n    isLoading: hasContentLoading,\n    error: contentError,\n  } = useRequest(\n    useCallback(async () => {\n      const { data } = await CredentialsAPI.readDetail(id);\n      return {\n        credential: data,\n      };\n    }, [id]),\n    {\n      credential: null,\n    }\n  );\n\n  useEffect(() => {\n    fetchCredential();\n  }, [fetchCredential, pathname]);\n\n  useEffect(() => {\n    if (credential) {\n      setBreadcrumb(credential);\n    }\n  }, [credential, setBreadcrumb]);\n\n  const tabsArray = [\n    {\n      name: (\n        <>\n          <CaretLeftIcon />\n          {t`Back to Credentials`}\n        </>\n      ),\n      link: `/credentials`,\n      id: 99,\n      persistentFilterKey: 'credentials',\n    },\n    { name: t`Details`, link: `/credentials/${id}/details`, id: 0 },\n    {\n      name: t`Access`,\n      link: `/credentials/${id}/access`,\n      id: 1,\n    },\n  ];\n  if (\n    !unacceptableCredentialTypes.includes(credential?.kind) &&\n    credential !== null\n  ) {\n    tabsArray.push({\n      name: t`Job Templates`,\n      link: `/credentials/${id}/job_templates`,\n      id: 2,\n    });\n  }\n  let showCardHeader = true;\n\n  if (pathname.endsWith('edit') || pathname.endsWith('add')) {\n    showCardHeader = false;\n  }\n\n  if (!hasContentLoading && contentError) {\n    return (\n      <PageSection>\n        <Card>\n          <ContentError error={contentError}>\n            {contentError.response && contentError.response.status === 404 && (\n              <span>\n                {t`Credential not found.`}{' '}\n                <Link to=\"/credentials\">{t`View all Credentials.`}</Link>\n              </span>\n            )}\n          </ContentError>\n        </Card>\n      </PageSection>\n    );\n  }\n  if (hasContentLoading) {\n    return <ContentLoading />;\n  }\n\n  return (\n    <PageSection>\n      <Card>\n        {showCardHeader && <RoutedTabs tabsArray={tabsArray} />}\n        {!hasContentLoading && credential && (\n          <Switch>\n            <Redirect\n              from=\"/credentials/:id\"\n              to=\"/credentials/:id/details\"\n              exact\n            />\n            {credential && [\n              <Route key=\"details\" path=\"/credentials/:id/details\">\n                <CredentialDetail credential={credential} />\n              </Route>,\n              <Route key=\"edit\" path=\"/credentials/:id/edit\">\n                <CredentialEdit credential={credential} />\n              </Route>,\n              <Route key=\"access\" path=\"/credentials/:id/access\">\n                <ResourceAccessList\n                  resource={credential}\n                  apiModel={CredentialsAPI}\n                />\n              </Route>,\n              <Route key=\"job_templates\" path=\"/credentials/:id/job_templates\">\n                <RelatedTemplateList\n                  searchParams={{ credentials__id: credential.id }}\n                  resourceName={[credential.name, credential.kind]}\n                />\n              </Route>,\n              <Route key=\"not-found\" path=\"*\">\n                {!hasContentLoading && (\n                  <ContentError isNotFound>\n                    {match.params.id && (\n                      <Link to={`/credentials/${match.params.id}/details`}>\n                        {t`View Credential Details`}\n                      </Link>\n                    )}\n                  </ContentError>\n                )}\n              </Route>,\n            ]}\n            <Route key=\"not-found\" path=\"*\">\n              {!hasContentLoading && (\n                <ContentError isNotFound>\n                  {id && (\n                    <Link to={`/credentials/${id}/details`}>\n                      {t`View Credential Details`}\n                    </Link>\n                  )}\n                </ContentError>\n              )}\n            </Route>\n          </Switch>\n        )}\n      </Card>\n    </PageSection>\n  );\n}\n\nexport default Credential;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}