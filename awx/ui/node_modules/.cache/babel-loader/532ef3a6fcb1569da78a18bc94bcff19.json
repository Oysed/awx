{"ast":null,"code":"import _defineProperty from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useEffect,useState}from'react';import{useFormikContext}from'formik';import useCredentialPasswordsStep from'./useAdHocCredentialPasswordStep';import useAdHocDetailsStep from'./useAdHocDetailsStep';import useAdHocExecutionEnvironmentStep from'./useAdHocExecutionEnvironmentStep';import useAdHocCredentialStep from'./useAdHocCredentialStep';import useAdHocPreviewStep from'./useAdHocPreviewStep';function showCredentialPasswordsStep(credential){if(!(credential!==null&&credential!==void 0&&credential.inputs)){return false;}var inputs=credential.inputs;if((inputs===null||inputs===void 0?void 0:inputs.password)==='ASK'||(inputs===null||inputs===void 0?void 0:inputs.become_password)==='ASK'||(inputs===null||inputs===void 0?void 0:inputs.ssh_key_unlock)==='ASK'){return true;}return false;}export default function useAdHocLaunchSteps(moduleOptions,organizationId,credentialTypeId){var _useFormikContext=useFormikContext(),values=_useFormikContext.values,resetForm=_useFormikContext.resetForm,touched=_useFormikContext.touched;var _useState=useState({}),_useState2=_slicedToArray(_useState,2),visited=_useState2[0],setVisited=_useState2[1];var steps=[useAdHocDetailsStep(visited,moduleOptions),useAdHocExecutionEnvironmentStep(organizationId),useAdHocCredentialStep(visited,credentialTypeId),useCredentialPasswordsStep(showCredentialPasswordsStep(values.credentials[0]),visited)];useEffect(function(){var _values$credentials$,_values$credentials$2,_values$credentials$3,_values$credentials$4;var newFormValues=_objectSpread({},values);if(!((_values$credentials$=values.credentials[0])!==null&&_values$credentials$!==void 0&&_values$credentials$.inputs)){return;}if((((_values$credentials$2=values.credentials[0].inputs)===null||_values$credentials$2===void 0?void 0:_values$credentials$2.password)||((_values$credentials$3=values.credentials[0].inputs)===null||_values$credentials$3===void 0?void 0:_values$credentials$3.become_password)||((_values$credentials$4=values.credentials[0].inputs)===null||_values$credentials$4===void 0?void 0:_values$credentials$4.ssh_key_unlock))==='ASK')newFormValues.credential_passwords={};Object.keys(values.credentials[0].inputs).forEach(function(inputKey){if(inputKey==='become_password'||inputKey==='ssh_key_unlock'){newFormValues.credential_passwords[inputKey]='';}if(inputKey==='password'){newFormValues.credential_passwords.ssh_password='';}});resetForm({values:newFormValues,touched:touched});// eslint-disable-next-line react-hooks/exhaustive-deps\n},[values.credentials.length]);var hasErrors=steps.some(function(step){return step.hasError;});steps.push(useAdHocPreviewStep(hasErrors));return{steps:steps.map(function(s){return s.step;}).filter(function(s){return s!=null;}),validateStep:function validateStep(stepId){return steps.find(function(s){return(s===null||s===void 0?void 0:s.step.id)===stepId;}).validate();},visitStep:function visitStep(prevStepId,setFieldTouched){setVisited(_objectSpread(_objectSpread({},visited),{},_defineProperty({},prevStepId,true)));steps.find(function(s){var _s$step;return(s===null||s===void 0?void 0:(_s$step=s.step)===null||_s$step===void 0?void 0:_s$step.id)===prevStepId;}).setTouched(setFieldTouched);},visitAllSteps:function visitAllSteps(setFieldTouched){setVisited({details:true,executionEnvironment:true,credentials:true,credentialPasswords:true,preview:true});steps.forEach(function(s){return s.setTouched(setFieldTouched);});}};}","map":{"version":3,"names":["useEffect","useState","useFormikContext","useCredentialPasswordsStep","useAdHocDetailsStep","useAdHocExecutionEnvironmentStep","useAdHocCredentialStep","useAdHocPreviewStep","showCredentialPasswordsStep","credential","inputs","password","become_password","ssh_key_unlock","useAdHocLaunchSteps","moduleOptions","organizationId","credentialTypeId","_useFormikContext","values","resetForm","touched","_useState","_useState2","_slicedToArray","visited","setVisited","steps","credentials","_values$credentials$","_values$credentials$2","_values$credentials$3","_values$credentials$4","newFormValues","_objectSpread","credential_passwords","Object","keys","forEach","inputKey","ssh_password","length","hasErrors","some","step","hasError","push","map","s","filter","validateStep","stepId","find","id","validate","visitStep","prevStepId","setFieldTouched","_defineProperty","_s$step","setTouched","visitAllSteps","details","executionEnvironment","credentialPasswords","preview"],"sources":["/awx_devel/awx/ui/src/components/AdHocCommands/useAdHocLaunchSteps.js"],"sourcesContent":["import { useEffect, useState } from 'react';\nimport { useFormikContext } from 'formik';\nimport useCredentialPasswordsStep from './useAdHocCredentialPasswordStep';\nimport useAdHocDetailsStep from './useAdHocDetailsStep';\nimport useAdHocExecutionEnvironmentStep from './useAdHocExecutionEnvironmentStep';\nimport useAdHocCredentialStep from './useAdHocCredentialStep';\nimport useAdHocPreviewStep from './useAdHocPreviewStep';\n\nfunction showCredentialPasswordsStep(credential) {\n  if (!credential?.inputs) {\n    return false;\n  }\n  const { inputs } = credential;\n  if (\n    inputs?.password === 'ASK' ||\n    inputs?.become_password === 'ASK' ||\n    inputs?.ssh_key_unlock === 'ASK'\n  ) {\n    return true;\n  }\n\n  return false;\n}\n\nexport default function useAdHocLaunchSteps(\n  moduleOptions,\n  organizationId,\n  credentialTypeId\n) {\n  const { values, resetForm, touched } = useFormikContext();\n\n  const [visited, setVisited] = useState({});\n  const steps = [\n    useAdHocDetailsStep(visited, moduleOptions),\n    useAdHocExecutionEnvironmentStep(organizationId),\n    useAdHocCredentialStep(visited, credentialTypeId),\n    useCredentialPasswordsStep(\n      showCredentialPasswordsStep(values.credentials[0]),\n      visited\n    ),\n  ];\n\n  useEffect(() => {\n    const newFormValues = { ...values };\n\n    if (!values.credentials[0]?.inputs) {\n      return;\n    }\n    if (\n      (values.credentials[0].inputs?.password ||\n        values.credentials[0].inputs?.become_password ||\n        values.credentials[0].inputs?.ssh_key_unlock) === 'ASK'\n    )\n      newFormValues.credential_passwords = {};\n    Object.keys(values.credentials[0].inputs).forEach((inputKey) => {\n      if (inputKey === 'become_password' || inputKey === 'ssh_key_unlock') {\n        newFormValues.credential_passwords[inputKey] = '';\n      }\n      if (inputKey === 'password') {\n        newFormValues.credential_passwords.ssh_password = '';\n      }\n    });\n    resetForm({\n      values: newFormValues,\n      touched,\n    });\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [values.credentials.length]);\n\n  const hasErrors = steps.some((step) => step.hasError);\n\n  steps.push(useAdHocPreviewStep(hasErrors));\n  return {\n    steps: steps.map((s) => s.step).filter((s) => s != null),\n    validateStep: (stepId) =>\n      steps.find((s) => s?.step.id === stepId).validate(),\n    visitStep: (prevStepId, setFieldTouched) => {\n      setVisited({\n        ...visited,\n        [prevStepId]: true,\n      });\n      steps.find((s) => s?.step?.id === prevStepId).setTouched(setFieldTouched);\n    },\n    visitAllSteps: (setFieldTouched) => {\n      setVisited({\n        details: true,\n        executionEnvironment: true,\n        credentials: true,\n        credentialPasswords: true,\n        preview: true,\n      });\n      steps.forEach((s) => s.setTouched(setFieldTouched));\n    },\n  };\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}