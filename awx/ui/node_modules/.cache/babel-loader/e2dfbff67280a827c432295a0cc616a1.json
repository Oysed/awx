{"ast":null,"code":"import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{i18n}from\"@lingui/core\";import React,{useCallback}from'react';import{Formik,useField}from'formik';import{Button,Tooltip,Wizard,WizardContextConsumer,WizardFooter}from'@patternfly/react-core';import{CredentialsAPI}from'api';import useRequest from'hooks/useRequest';import CredentialsStep from'./CredentialsStep';import MetadataStep from'./MetadataStep';import{CredentialPluginTestAlert}from'..';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function CredentialPluginWizard(_ref){var handleSubmit=_ref.handleSubmit,onClose=_ref.onClose;var _useField=useField('credential'),_useField2=_slicedToArray(_useField,1),selectedCredential=_useField2[0];var _useField3=useField('inputs'),_useField4=_slicedToArray(_useField3,1),inputValues=_useField4[0];var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:return _context.abrupt(\"return\",CredentialsAPI.test(selectedCredential.value.id,{metadata:inputValues.value}));case 1:case\"end\":return _context.stop();}}},_callee);})),[selectedCredential,inputValues]),null),testPluginSuccess=_useRequest.result,testPluginError=_useRequest.error,testPluginMetadata=_useRequest.request;var steps=[{id:1,name:/*i18n*/i18n._(\"Credential\"),key:'credential',component:/*#__PURE__*/_jsx(CredentialsStep,{}),enableNext:!!selectedCredential.value},{id:2,name:/*i18n*/i18n._(\"Metadata\"),key:'metadata',component:/*#__PURE__*/_jsx(MetadataStep,{}),canJumpTo:!!selectedCredential.value}];var CustomFooter=/*#__PURE__*/_jsx(WizardFooter,{children:/*#__PURE__*/_jsx(WizardContextConsumer,{children:function children(_ref3){var activeStep=_ref3.activeStep,onNext=_ref3.onNext,onBack=_ref3.onBack;return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Button,{ouiaId:\"credential-plugin-prompt-next\",id:\"credential-plugin-prompt-next\",variant:\"primary\",onClick:onNext,isDisabled:!selectedCredential.value,children:activeStep.key==='metadata'?/*i18n*/i18n._(\"OK\"):/*i18n*/i18n._(\"Next\")}),activeStep&&activeStep.key==='metadata'&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Tooltip,{content:/*i18n*/i18n._(\"Click this button to verify connection to the secret management system using the selected credential and specified inputs.\"),position:\"right\",children:/*#__PURE__*/_jsx(Button,{ouiaId:\"credential-plugin-prompt-test\",id:\"credential-plugin-prompt-test\",variant:\"secondary\",onClick:function onClick(){return testPluginMetadata();},children:/*i18n*/i18n._(\"Test\")})}),/*#__PURE__*/_jsx(Button,{ouiaId:\"credential-plugin-prompt-back\",id:\"credential-plugin-prompt-back\",variant:\"secondary\",onClick:onBack,children:/*i18n*/i18n._(\"Back\")})]}),/*#__PURE__*/_jsx(Button,{ouiaId:\"credential-plugin-prompt-cancel\",id:\"credential-plugin-prompt-cancel\",variant:\"link\",onClick:onClose,children:/*i18n*/i18n._(\"Cancel\")})]});}})});return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Wizard,{isOpen:true,onClose:onClose,title:/*i18n*/i18n._(\"External Secret Management System\"),steps:steps,onSave:handleSubmit,footer:CustomFooter}),selectedCredential.value&&/*#__PURE__*/_jsx(CredentialPluginTestAlert,{credentialName:selectedCredential.value.name,successResponse:testPluginSuccess,errorResponse:testPluginError})]});}function CredentialPluginPrompt(_ref4){var onClose=_ref4.onClose,onSubmit=_ref4.onSubmit,initialValues=_ref4.initialValues;return/*#__PURE__*/_jsx(Formik,{initialValues:{credential:(initialValues===null||initialValues===void 0?void 0:initialValues.credential)||null,inputs:(initialValues===null||initialValues===void 0?void 0:initialValues.inputs)||{}},onSubmit:onSubmit,children:function children(_ref5){var handleSubmit=_ref5.handleSubmit;return/*#__PURE__*/_jsx(CredentialPluginWizard,{handleSubmit:handleSubmit,onClose:onClose});}});}CredentialPluginPrompt.defaultProps={initialValues:{}};export default CredentialPluginPrompt;","map":{"version":3,"names":["React","useCallback","Formik","useField","Button","Tooltip","Wizard","WizardContextConsumer","WizardFooter","CredentialsAPI","useRequest","CredentialsStep","MetadataStep","CredentialPluginTestAlert","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","CredentialPluginWizard","_ref","handleSubmit","onClose","_useField","_useField2","_slicedToArray","selectedCredential","_useField3","_useField4","inputValues","_useRequest","_asyncToGenerator","_regeneratorRuntime","mark","_callee","wrap","_callee$","_context","prev","next","abrupt","test","value","id","metadata","stop","testPluginSuccess","result","testPluginError","error","testPluginMetadata","request","steps","name","i18n","_","key","component","enableNext","canJumpTo","CustomFooter","children","_ref3","activeStep","onNext","onBack","ouiaId","variant","onClick","isDisabled","content","position","isOpen","title","onSave","footer","credentialName","successResponse","errorResponse","CredentialPluginPrompt","_ref4","onSubmit","initialValues","credential","inputs","_ref5","defaultProps"],"sources":["/awx_devel/awx/ui/src/screens/Credential/shared/CredentialPlugins/CredentialPluginPrompt/CredentialPluginPrompt.js"],"sourcesContent":["import React, { useCallback } from 'react';\nimport { func, shape } from 'prop-types';\nimport { Formik, useField } from 'formik';\nimport { t } from '@lingui/macro';\nimport {\n  Button,\n  Tooltip,\n  Wizard,\n  WizardContextConsumer,\n  WizardFooter,\n} from '@patternfly/react-core';\nimport { CredentialsAPI } from 'api';\nimport useRequest from 'hooks/useRequest';\nimport CredentialsStep from './CredentialsStep';\nimport MetadataStep from './MetadataStep';\nimport { CredentialPluginTestAlert } from '..';\n\nfunction CredentialPluginWizard({ handleSubmit, onClose }) {\n  const [selectedCredential] = useField('credential');\n  const [inputValues] = useField('inputs');\n\n  const {\n    result: testPluginSuccess,\n    error: testPluginError,\n    request: testPluginMetadata,\n  } = useRequest(\n    useCallback(\n      async () =>\n        CredentialsAPI.test(selectedCredential.value.id, {\n          metadata: inputValues.value,\n        }),\n      [selectedCredential, inputValues]\n    ),\n    null\n  );\n\n  const steps = [\n    {\n      id: 1,\n      name: t`Credential`,\n      key: 'credential',\n      component: <CredentialsStep />,\n      enableNext: !!selectedCredential.value,\n    },\n    {\n      id: 2,\n      name: t`Metadata`,\n      key: 'metadata',\n      component: <MetadataStep />,\n      canJumpTo: !!selectedCredential.value,\n    },\n  ];\n\n  const CustomFooter = (\n    <WizardFooter>\n      <WizardContextConsumer>\n        {({ activeStep, onNext, onBack }) => (\n          <>\n            <Button\n              ouiaId=\"credential-plugin-prompt-next\"\n              id=\"credential-plugin-prompt-next\"\n              variant=\"primary\"\n              onClick={onNext}\n              isDisabled={!selectedCredential.value}\n            >\n              {activeStep.key === 'metadata' ? t`OK` : t`Next`}\n            </Button>\n            {activeStep && activeStep.key === 'metadata' && (\n              <>\n                <Tooltip\n                  content={t`Click this button to verify connection to the secret management system using the selected credential and specified inputs.`}\n                  position=\"right\"\n                >\n                  <Button\n                    ouiaId=\"credential-plugin-prompt-test\"\n                    id=\"credential-plugin-prompt-test\"\n                    variant=\"secondary\"\n                    onClick={() => testPluginMetadata()}\n                  >\n                    {t`Test`}\n                  </Button>\n                </Tooltip>\n\n                <Button\n                  ouiaId=\"credential-plugin-prompt-back\"\n                  id=\"credential-plugin-prompt-back\"\n                  variant=\"secondary\"\n                  onClick={onBack}\n                >\n                  {t`Back`}\n                </Button>\n              </>\n            )}\n            <Button\n              ouiaId=\"credential-plugin-prompt-cancel\"\n              id=\"credential-plugin-prompt-cancel\"\n              variant=\"link\"\n              onClick={onClose}\n            >\n              {t`Cancel`}\n            </Button>\n          </>\n        )}\n      </WizardContextConsumer>\n    </WizardFooter>\n  );\n\n  return (\n    <>\n      <Wizard\n        isOpen\n        onClose={onClose}\n        title={t`External Secret Management System`}\n        steps={steps}\n        onSave={handleSubmit}\n        footer={CustomFooter}\n      />\n      {selectedCredential.value && (\n        <CredentialPluginTestAlert\n          credentialName={selectedCredential.value.name}\n          successResponse={testPluginSuccess}\n          errorResponse={testPluginError}\n        />\n      )}\n    </>\n  );\n}\n\nfunction CredentialPluginPrompt({ onClose, onSubmit, initialValues }) {\n  return (\n    <Formik\n      initialValues={{\n        credential: initialValues?.credential || null,\n        inputs: initialValues?.inputs || {},\n      }}\n      onSubmit={onSubmit}\n    >\n      {({ handleSubmit }) => (\n        <CredentialPluginWizard handleSubmit={handleSubmit} onClose={onClose} />\n      )}\n    </Formik>\n  );\n}\n\nCredentialPluginPrompt.propTypes = {\n  onClose: func.isRequired,\n  onSubmit: func.isRequired,\n  initialValues: shape({}),\n};\n\nCredentialPluginPrompt.defaultProps = {\n  initialValues: {},\n};\n\nexport default CredentialPluginPrompt;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}