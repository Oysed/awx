{"ast":null,"code":"import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{Trans}from\"@lingui/react\";import{i18n}from\"@lingui/core\";import React,{useContext,useEffect,useState}from'react';import{Button,DropdownItem,Tooltip}from'@patternfly/react-core';import{KebabifiedContext}from'contexts/Kebabified';import{isJobRunning}from'util/jobs';import{Job}from'types';import AlertModal from'../AlertModal';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";function cannotCancelBecausePermissions(job){return!job.summary_fields.user_capabilities.start&&isJobRunning(job.status);}function cannotCancelBecauseNotRunning(job){return!isJobRunning(job.status);}function JobListCancelButton(_ref){var jobsToCancel=_ref.jobsToCancel,onCancel=_ref.onCancel;var _useContext=useContext(KebabifiedContext),isKebabified=_useContext.isKebabified,onKebabModalChange=_useContext.onKebabModalChange;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isModalOpen=_useState2[0],setIsModalOpen=_useState2[1];var numJobsToCancel=jobsToCancel.length;var handleCancelJob=function handleCancelJob(){onCancel();toggleModal();};var toggleModal=function toggleModal(){setIsModalOpen(!isModalOpen);};useEffect(function(){if(isKebabified){onKebabModalChange(isModalOpen);}},[isKebabified,isModalOpen,onKebabModalChange]);var renderTooltip=function renderTooltip(){var cannotCancelPermissions=jobsToCancel.filter(cannotCancelBecausePermissions).map(function(job){return job.name;});var cannotCancelNotRunning=jobsToCancel.filter(cannotCancelBecauseNotRunning).map(function(job){return job.name;});var numJobsUnableToCancel=cannotCancelPermissions.concat(cannotCancelNotRunning).length;if(numJobsUnableToCancel>0){return/*#__PURE__*/_jsxs(\"div\",{children:[cannotCancelPermissions.length>0&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Trans,{id:\"{0, plural, one {You do not have permission to cancel the following job:} other {You do not have permission to cancel the following jobs:}}\",values:{0:cannotCancelPermissions.length}}),cannotCancelPermissions.map(function(job,i){return/*#__PURE__*/_jsxs(\"strong\",{children:[' ',job,i!==cannotCancelPermissions.length-1?',':'']},job);})]}),cannotCancelNotRunning.length>0&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Trans,{id:\"{0, plural, one {You cannot cancel the following job because it is not running:} other {You cannot cancel the following jobs because they are not running:}}\",values:{0:cannotCancelNotRunning.length}}),cannotCancelNotRunning.map(function(job,i){return/*#__PURE__*/_jsxs(\"strong\",{children:[' ',job,i!==cannotCancelNotRunning.length-1?',':'']},job);})]})]});}if(numJobsToCancel>0){return/*#__PURE__*/_jsx(Trans,{id:\"{numJobsToCancel, plural, one {{0}} other {{1}}}\",values:{0:/*i18n*/i18n._(\"Cancel selected job\"),1:/*i18n*/i18n._(\"Cancel selected jobs\"),numJobsToCancel:numJobsToCancel}});}return(/*i18n*/i18n._(\"Select a job to cancel\"));};var isDisabled=jobsToCancel.length===0||jobsToCancel.some(cannotCancelBecausePermissions)||jobsToCancel.some(cannotCancelBecauseNotRunning);var cancelJobText=/*#__PURE__*/_jsx(Trans,{id:\"{numJobsToCancel, plural, one {Cancel job} other {Cancel jobs}}\",values:{numJobsToCancel:numJobsToCancel}});return/*#__PURE__*/_jsxs(_Fragment,{children:[isKebabified?/*#__PURE__*/_jsx(DropdownItem,{isDisabled:isDisabled,component:\"button\",\"aria-labelledby\":\"jobs-list-cancel-button\",onClick:toggleModal,ouiaId:\"cancel-job-dropdown-item\",children:cancelJobText},\"cancel-job\"):/*#__PURE__*/_jsx(Tooltip,{content:renderTooltip(),position:\"top\",children:/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(Button,{id:\"jobs-list-cancel-button\",ouiaId:\"cancel-job-button\",variant:\"secondary\",\"aria-labelledby\":\"jobs-list-cancel-button\",onClick:toggleModal,isDisabled:isDisabled,children:cancelJobText})})}),isModalOpen&&/*#__PURE__*/_jsxs(AlertModal,{variant:\"danger\",title:cancelJobText,isOpen:isModalOpen,onClose:toggleModal,actions:[/*#__PURE__*/_jsx(Button,{ouiaId:\"cancel-job-confirm-button\",id:\"cancel-job-confirm-button\",variant:\"danger\",\"aria-labelledby\":\"cancel-job-confirm-button\",onClick:handleCancelJob,children:cancelJobText},\"delete\"),/*#__PURE__*/_jsx(Button,{ouiaId:\"cancel-job-return-button\",id:\"cancel-job-return-button\",variant:\"secondary\",\"aria-label\":/*i18n*/i18n._(\"Return\"),onClick:toggleModal,children:/*i18n*/i18n._(\"Return\")},\"cancel\")],children:[/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(Trans,{id:\"{numJobsToCancel, plural, one {This action will cancel the following job:} other {This action will cancel the following jobs:}}\",values:{numJobsToCancel:numJobsToCancel}})}),jobsToCancel.map(function(job){return/*#__PURE__*/_jsxs(\"span\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:job.name}),/*#__PURE__*/_jsx(\"br\",{})]},job.id);})]})]});}JobListCancelButton.defaultProps={jobsToCancel:[],onCancel:function onCancel(){}};export default JobListCancelButton;","map":{"version":3,"names":["React","useContext","useEffect","useState","Button","DropdownItem","Tooltip","KebabifiedContext","isJobRunning","Job","AlertModal","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","cannotCancelBecausePermissions","job","summary_fields","user_capabilities","start","status","cannotCancelBecauseNotRunning","JobListCancelButton","_ref","jobsToCancel","onCancel","_useContext","isKebabified","onKebabModalChange","_useState","_useState2","_slicedToArray","isModalOpen","setIsModalOpen","numJobsToCancel","length","handleCancelJob","toggleModal","renderTooltip","cannotCancelPermissions","filter","map","name","cannotCancelNotRunning","numJobsUnableToCancel","concat","children","Trans","id","values","0","i","i18n","_","1","isDisabled","some","cancelJobText","component","onClick","ouiaId","content","position","variant","title","isOpen","onClose","actions","defaultProps"],"sources":["/awx_devel/awx/ui/src/components/JobList/JobListCancelButton.js"],"sourcesContent":["import React, { useContext, useEffect, useState } from 'react';\n\nimport { t, Plural } from '@lingui/macro';\nimport { arrayOf, func } from 'prop-types';\nimport { Button, DropdownItem, Tooltip } from '@patternfly/react-core';\nimport { KebabifiedContext } from 'contexts/Kebabified';\nimport { isJobRunning } from 'util/jobs';\nimport { Job } from 'types';\nimport AlertModal from '../AlertModal';\n\nfunction cannotCancelBecausePermissions(job) {\n  return (\n    !job.summary_fields.user_capabilities.start && isJobRunning(job.status)\n  );\n}\n\nfunction cannotCancelBecauseNotRunning(job) {\n  return !isJobRunning(job.status);\n}\n\nfunction JobListCancelButton({ jobsToCancel, onCancel }) {\n  const { isKebabified, onKebabModalChange } = useContext(KebabifiedContext);\n  const [isModalOpen, setIsModalOpen] = useState(false);\n  const numJobsToCancel = jobsToCancel.length;\n\n  const handleCancelJob = () => {\n    onCancel();\n    toggleModal();\n  };\n\n  const toggleModal = () => {\n    setIsModalOpen(!isModalOpen);\n  };\n\n  useEffect(() => {\n    if (isKebabified) {\n      onKebabModalChange(isModalOpen);\n    }\n  }, [isKebabified, isModalOpen, onKebabModalChange]);\n\n  const renderTooltip = () => {\n    const cannotCancelPermissions = jobsToCancel\n      .filter(cannotCancelBecausePermissions)\n      .map((job) => job.name);\n    const cannotCancelNotRunning = jobsToCancel\n      .filter(cannotCancelBecauseNotRunning)\n      .map((job) => job.name);\n    const numJobsUnableToCancel = cannotCancelPermissions.concat(\n      cannotCancelNotRunning\n    ).length;\n    if (numJobsUnableToCancel > 0) {\n      return (\n        <div>\n          {cannotCancelPermissions.length > 0 && (\n            <div>\n              <Plural\n                value={cannotCancelPermissions.length}\n                one=\"You do not have permission to cancel the following job:\"\n                other=\"You do not have permission to cancel the following jobs:\"\n              />\n              {cannotCancelPermissions.map((job, i) => (\n                <strong key={job}>\n                  {' '}\n                  {job}\n                  {i !== cannotCancelPermissions.length - 1 ? ',' : ''}\n                </strong>\n              ))}\n            </div>\n          )}\n          {cannotCancelNotRunning.length > 0 && (\n            <div>\n              <Plural\n                value={cannotCancelNotRunning.length}\n                one=\"You cannot cancel the following job because it is not running:\"\n                other=\"You cannot cancel the following jobs because they are not running:\"\n              />\n              {cannotCancelNotRunning.map((job, i) => (\n                <strong key={job}>\n                  {' '}\n                  {job}\n                  {i !== cannotCancelNotRunning.length - 1 ? ',' : ''}\n                </strong>\n              ))}\n            </div>\n          )}\n        </div>\n      );\n    }\n    if (numJobsToCancel > 0) {\n      return (\n        <Plural\n          value={numJobsToCancel}\n          one={t`Cancel selected job`}\n          other={t`Cancel selected jobs`}\n        />\n      );\n    }\n    return t`Select a job to cancel`;\n  };\n\n  const isDisabled =\n    jobsToCancel.length === 0 ||\n    jobsToCancel.some(cannotCancelBecausePermissions) ||\n    jobsToCancel.some(cannotCancelBecauseNotRunning);\n  const cancelJobText = (\n    <Plural value={numJobsToCancel} one=\"Cancel job\" other=\"Cancel jobs\" />\n  );\n\n  return (\n    <>\n      {isKebabified ? (\n        <DropdownItem\n          key=\"cancel-job\"\n          isDisabled={isDisabled}\n          component=\"button\"\n          aria-labelledby=\"jobs-list-cancel-button\"\n          onClick={toggleModal}\n          ouiaId=\"cancel-job-dropdown-item\"\n        >\n          {cancelJobText}\n        </DropdownItem>\n      ) : (\n        <Tooltip content={renderTooltip()} position=\"top\">\n          <div>\n            <Button\n              id=\"jobs-list-cancel-button\"\n              ouiaId=\"cancel-job-button\"\n              variant=\"secondary\"\n              aria-labelledby=\"jobs-list-cancel-button\"\n              onClick={toggleModal}\n              isDisabled={isDisabled}\n            >\n              {cancelJobText}\n            </Button>\n          </div>\n        </Tooltip>\n      )}\n      {isModalOpen && (\n        <AlertModal\n          variant=\"danger\"\n          title={cancelJobText}\n          isOpen={isModalOpen}\n          onClose={toggleModal}\n          actions={[\n            <Button\n              ouiaId=\"cancel-job-confirm-button\"\n              id=\"cancel-job-confirm-button\"\n              key=\"delete\"\n              variant=\"danger\"\n              aria-labelledby=\"cancel-job-confirm-button\"\n              onClick={handleCancelJob}\n            >\n              {cancelJobText}\n            </Button>,\n            <Button\n              ouiaId=\"cancel-job-return-button\"\n              id=\"cancel-job-return-button\"\n              key=\"cancel\"\n              variant=\"secondary\"\n              aria-label={t`Return`}\n              onClick={toggleModal}\n            >\n              {t`Return`}\n            </Button>,\n          ]}\n        >\n          <div>\n            <Plural\n              value={numJobsToCancel}\n              one=\"This action will cancel the following job:\"\n              other=\"This action will cancel the following jobs:\"\n            />\n          </div>\n          {jobsToCancel.map((job) => (\n            <span key={job.id}>\n              <strong>{job.name}</strong>\n              <br />\n            </span>\n          ))}\n        </AlertModal>\n      )}\n    </>\n  );\n}\n\nJobListCancelButton.propTypes = {\n  jobsToCancel: arrayOf(Job),\n  onCancel: func,\n};\n\nJobListCancelButton.defaultProps = {\n  jobsToCancel: [],\n  onCancel: () => {},\n};\n\nexport default JobListCancelButton;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}