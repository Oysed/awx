{"ast":null,"code":"import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{i18n}from\"@lingui/core\";import React,{useEffect,useState}from'react';import{Alert,AlertActionCloseButton,AlertGroup}from'@patternfly/react-core';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function CredentialPluginTestAlert(_ref){var credentialName=_ref.credentialName,successResponse=_ref.successResponse,errorResponse=_ref.errorResponse;var _useState=useState(''),_useState2=_slicedToArray(_useState,2),testMessage=_useState2[0],setTestMessage=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),testVariant=_useState4[0],setTestVariant=_useState4[1];useEffect(function(){if(errorResponse){var _errorResponse$respon,_errorResponse$respon2;if(errorResponse!==null&&errorResponse!==void 0&&(_errorResponse$respon=errorResponse.response)!==null&&_errorResponse$respon!==void 0&&(_errorResponse$respon2=_errorResponse$respon.data)!==null&&_errorResponse$respon2!==void 0&&_errorResponse$respon2.inputs){if(errorResponse.response.data.inputs.startsWith('HTTP')){var _errorResponse$respon3=errorResponse.response.data.inputs.split('\\n'),_errorResponse$respon4=_slicedToArray(_errorResponse$respon3,2),errorCode=_errorResponse$respon4[0],errorStr=_errorResponse$respon4[1];try{var errorJSON=JSON.parse(errorStr);setTestMessage(\"\".concat(errorCode).concat(errorJSON!==null&&errorJSON!==void 0&&errorJSON.errors[0]?\": \".concat(errorJSON.errors[0]):''));}catch(_unused){setTestMessage(errorResponse.response.data.inputs);}}else{setTestMessage(errorResponse.response.data.inputs);}}else{setTestMessage(/*i18n*/i18n._(\"Something went wrong with the request to test this credential and metadata.\"));}setTestVariant('danger');}else if(successResponse){setTestMessage(/*i18n*/i18n._(\"Test passed\"));setTestVariant('success');}},[successResponse,errorResponse]);return/*#__PURE__*/_jsx(AlertGroup,{isToast:true,children:testMessage&&testVariant&&/*#__PURE__*/_jsx(Alert,{actionClose:/*#__PURE__*/_jsx(AlertActionCloseButton,{onClose:function onClose(){setTestMessage(null);setTestVariant(null);}}),title:/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"b\",{id:\"credential-plugin-test-name\",children:credentialName}),/*#__PURE__*/_jsx(\"p\",{id:\"credential-plugin-test-message\",children:testMessage})]}),variant:testVariant,ouiaId:\"credential-plugin-test-alert\"})});}CredentialPluginTestAlert.defaultProps={successResponse:null,errorResponse:null};export default CredentialPluginTestAlert;","map":{"version":3,"names":["React","useEffect","useState","Alert","AlertActionCloseButton","AlertGroup","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","CredentialPluginTestAlert","_ref","credentialName","successResponse","errorResponse","_useState","_useState2","_slicedToArray","testMessage","setTestMessage","_useState3","_useState4","testVariant","setTestVariant","_errorResponse$respon","_errorResponse$respon2","response","data","inputs","startsWith","_errorResponse$respon3","split","_errorResponse$respon4","errorCode","errorStr","errorJSON","JSON","parse","concat","errors","_unused","i18n","_","isToast","children","actionClose","onClose","title","id","variant","ouiaId","defaultProps"],"sources":["/awx_devel/awx/ui/src/screens/Credential/shared/CredentialPlugins/CredentialPluginTestAlert.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\n\nimport { t } from '@lingui/macro';\nimport { string, shape } from 'prop-types';\nimport {\n  Alert,\n  AlertActionCloseButton,\n  AlertGroup,\n} from '@patternfly/react-core';\n\nfunction CredentialPluginTestAlert({\n  credentialName,\n  successResponse,\n  errorResponse,\n}) {\n  const [testMessage, setTestMessage] = useState('');\n  const [testVariant, setTestVariant] = useState(false);\n  useEffect(() => {\n    if (errorResponse) {\n      if (errorResponse?.response?.data?.inputs) {\n        if (errorResponse.response.data.inputs.startsWith('HTTP')) {\n          const [errorCode, errorStr] =\n            errorResponse.response.data.inputs.split('\\n');\n          try {\n            const errorJSON = JSON.parse(errorStr);\n            setTestMessage(\n              `${errorCode}${\n                errorJSON?.errors[0] ? `: ${errorJSON.errors[0]}` : ''\n              }`\n            );\n          } catch {\n            setTestMessage(errorResponse.response.data.inputs);\n          }\n        } else {\n          setTestMessage(errorResponse.response.data.inputs);\n        }\n      } else {\n        setTestMessage(\n          t`Something went wrong with the request to test this credential and metadata.`\n        );\n      }\n      setTestVariant('danger');\n    } else if (successResponse) {\n      setTestMessage(t`Test passed`);\n      setTestVariant('success');\n    }\n  }, [successResponse, errorResponse]);\n\n  return (\n    <AlertGroup isToast>\n      {testMessage && testVariant && (\n        <Alert\n          actionClose={\n            <AlertActionCloseButton\n              onClose={() => {\n                setTestMessage(null);\n                setTestVariant(null);\n              }}\n            />\n          }\n          title={\n            <>\n              <b id=\"credential-plugin-test-name\">{credentialName}</b>\n              <p id=\"credential-plugin-test-message\">{testMessage}</p>\n            </>\n          }\n          variant={testVariant}\n          ouiaId=\"credential-plugin-test-alert\"\n        />\n      )}\n    </AlertGroup>\n  );\n}\n\nCredentialPluginTestAlert.propTypes = {\n  credentialName: string.isRequired,\n  successResponse: shape({}),\n  errorResponse: shape({}),\n};\n\nCredentialPluginTestAlert.defaultProps = {\n  successResponse: null,\n  errorResponse: null,\n};\n\nexport default CredentialPluginTestAlert;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}