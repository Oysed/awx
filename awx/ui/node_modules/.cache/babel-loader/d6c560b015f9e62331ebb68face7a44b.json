{"ast":null,"code":"import _toConsumableArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _objectWithoutProperties from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";var _excluded=[\"instanceGroups\",\"organization\"];import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import React,{useState,useEffect}from'react';import{useHistory}from'react-router-dom';import{object}from'prop-types';import{CardBody}from'components/Card';import{InventoriesAPI}from'api';import{getAddedAndRemoved}from'util/lists';import ContentLoading from'components/ContentLoading';import useIsMounted from'hooks/useIsMounted';import InventoryForm from'../shared/InventoryForm';import{jsx as _jsx}from\"react/jsx-runtime\";function InventoryEdit(_ref){var inventory=_ref.inventory;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),error=_useState2[0],setError=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),associatedInstanceGroups=_useState4[0],setInstanceGroups=_useState4[1];var _useState5=useState(true),_useState6=_slicedToArray(_useState5,2),contentLoading=_useState6[0],setContentLoading=_useState6[1];var history=useHistory();var isMounted=useIsMounted();useEffect(function(){var loadData=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _yield$InventoriesAPI,loadedInstanceGroups;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return InventoriesAPI.readInstanceGroups(inventory.id);case 3:_yield$InventoriesAPI=_context.sent;loadedInstanceGroups=_yield$InventoriesAPI.data.results;if(isMounted.current){_context.next=7;break;}return _context.abrupt(\"return\");case 7:setInstanceGroups(loadedInstanceGroups);_context.next=13;break;case 10:_context.prev=10;_context.t0=_context[\"catch\"](0);setError(_context.t0);case 13:_context.prev=13;if(isMounted.current){setContentLoading(false);}return _context.finish(13);case 16:case\"end\":return _context.stop();}}},_callee,null,[[0,10,13,16]]);}));return function loadData(){return _ref2.apply(this,arguments);};}();loadData();/* eslint-disable-next-line react-hooks/exhaustive-deps */},[inventory.id,contentLoading,inventory]);var handleCancel=function handleCancel(){var url=inventory.kind==='smart'?\"/inventories/smart_inventory/\".concat(inventory.id,\"/details\"):\"/inventories/inventory/\".concat(inventory.id,\"/details\");history.push(\"\".concat(url));};var handleSubmit=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(values){var instanceGroups,organization,remainingValues,url;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:instanceGroups=values.instanceGroups,organization=values.organization,remainingValues=_objectWithoutProperties(values,_excluded);_context2.prev=1;_context2.next=4;return InventoriesAPI.update(inventory.id,_objectSpread({organization:organization.id},remainingValues));case 4:_context2.next=6;return InventoriesAPI.orderInstanceGroups(inventory.id,instanceGroups,associatedInstanceGroups);case 6:_context2.next=8;return submitLabels(values.organization.id,values.labels);case 8:url=history.location.pathname.search('smart')>-1?\"/inventories/smart_inventory/\".concat(inventory.id,\"/details\"):\"/inventories/inventory/\".concat(inventory.id,\"/details\");history.push(\"\".concat(url));_context2.next=15;break;case 12:_context2.prev=12;_context2.t0=_context2[\"catch\"](1);setError(_context2.t0);case 15:case\"end\":return _context2.stop();}}},_callee2,null,[[1,12]]);}));return function handleSubmit(_x){return _ref3.apply(this,arguments);};}();var submitLabels=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(orgId){var labels,_getAddedAndRemoved,added,removed,disassociationPromises,associationPromises,results,_args3=arguments;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:labels=_args3.length>1&&_args3[1]!==undefined?_args3[1]:[];_getAddedAndRemoved=getAddedAndRemoved(inventory.summary_fields.labels.results,labels),added=_getAddedAndRemoved.added,removed=_getAddedAndRemoved.removed;disassociationPromises=removed.map(function(label){return InventoriesAPI.disassociateLabel(inventory.id,label);});associationPromises=added.map(function(label){return InventoriesAPI.associateLabel(inventory.id,label,orgId);});_context3.next=6;return Promise.all([].concat(_toConsumableArray(disassociationPromises),_toConsumableArray(associationPromises)));case 6:results=_context3.sent;return _context3.abrupt(\"return\",results);case 8:case\"end\":return _context3.stop();}}},_callee3);}));return function submitLabels(_x2){return _ref4.apply(this,arguments);};}();if(contentLoading){return/*#__PURE__*/_jsx(ContentLoading,{});}return/*#__PURE__*/_jsx(CardBody,{children:/*#__PURE__*/_jsx(InventoryForm,{onCancel:handleCancel,onSubmit:handleSubmit,inventory:inventory,instanceGroups:associatedInstanceGroups,submitError:error})});}InventoryEdit.propType={inventory:object.isRequired};export{InventoryEdit as _InventoryEdit};export default InventoryEdit;","map":{"version":3,"names":["React","useState","useEffect","useHistory","object","CardBody","InventoriesAPI","getAddedAndRemoved","ContentLoading","useIsMounted","InventoryForm","jsx","_jsx","InventoryEdit","_ref","inventory","_useState","_useState2","_slicedToArray","error","setError","_useState3","_useState4","associatedInstanceGroups","setInstanceGroups","_useState5","_useState6","contentLoading","setContentLoading","history","isMounted","loadData","_ref2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","_yield$InventoriesAPI","loadedInstanceGroups","wrap","_callee$","_context","prev","next","readInstanceGroups","id","sent","data","results","current","abrupt","t0","finish","stop","apply","arguments","handleCancel","url","kind","concat","push","handleSubmit","_ref3","_callee2","values","instanceGroups","organization","remainingValues","_callee2$","_context2","_objectWithoutProperties","_excluded","update","_objectSpread","orderInstanceGroups","submitLabels","labels","location","pathname","search","_x","_ref4","_callee3","orgId","_getAddedAndRemoved","added","removed","disassociationPromises","associationPromises","_args3","_callee3$","_context3","length","undefined","summary_fields","map","label","disassociateLabel","associateLabel","Promise","all","_toConsumableArray","_x2","children","onCancel","onSubmit","submitError","propType","isRequired","_InventoryEdit"],"sources":["/awx_devel/awx/ui/src/screens/Inventory/InventoryEdit/InventoryEdit.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport { object } from 'prop-types';\n\nimport { CardBody } from 'components/Card';\nimport { InventoriesAPI } from 'api';\nimport { getAddedAndRemoved } from 'util/lists';\nimport ContentLoading from 'components/ContentLoading';\nimport useIsMounted from 'hooks/useIsMounted';\nimport InventoryForm from '../shared/InventoryForm';\n\nfunction InventoryEdit({ inventory }) {\n  const [error, setError] = useState(null);\n  const [associatedInstanceGroups, setInstanceGroups] = useState(null);\n  const [contentLoading, setContentLoading] = useState(true);\n  const history = useHistory();\n  const isMounted = useIsMounted();\n\n  useEffect(() => {\n    const loadData = async () => {\n      try {\n        const {\n          data: { results: loadedInstanceGroups },\n        } = await InventoriesAPI.readInstanceGroups(inventory.id);\n        if (!isMounted.current) {\n          return;\n        }\n        setInstanceGroups(loadedInstanceGroups);\n      } catch (err) {\n        setError(err);\n      } finally {\n        if (isMounted.current) {\n          setContentLoading(false);\n        }\n      }\n    };\n    loadData();\n    /* eslint-disable-next-line react-hooks/exhaustive-deps */\n  }, [inventory.id, contentLoading, inventory]);\n\n  const handleCancel = () => {\n    const url =\n      inventory.kind === 'smart'\n        ? `/inventories/smart_inventory/${inventory.id}/details`\n        : `/inventories/inventory/${inventory.id}/details`;\n\n    history.push(`${url}`);\n  };\n\n  const handleSubmit = async (values) => {\n    const { instanceGroups, organization, ...remainingValues } = values;\n    try {\n      await InventoriesAPI.update(inventory.id, {\n        organization: organization.id,\n        ...remainingValues,\n      });\n      await InventoriesAPI.orderInstanceGroups(\n        inventory.id,\n        instanceGroups,\n        associatedInstanceGroups\n      );\n      await submitLabels(values.organization.id, values.labels);\n\n      const url =\n        history.location.pathname.search('smart') > -1\n          ? `/inventories/smart_inventory/${inventory.id}/details`\n          : `/inventories/inventory/${inventory.id}/details`;\n      history.push(`${url}`);\n    } catch (err) {\n      setError(err);\n    }\n  };\n\n  const submitLabels = async (orgId, labels = []) => {\n    const { added, removed } = getAddedAndRemoved(\n      inventory.summary_fields.labels.results,\n      labels\n    );\n\n    const disassociationPromises = removed.map((label) =>\n      InventoriesAPI.disassociateLabel(inventory.id, label)\n    );\n    const associationPromises = added.map((label) =>\n      InventoriesAPI.associateLabel(inventory.id, label, orgId)\n    );\n\n    const results = await Promise.all([\n      ...disassociationPromises,\n      ...associationPromises,\n    ]);\n    return results;\n  };\n\n  if (contentLoading) {\n    return <ContentLoading />;\n  }\n\n  return (\n    <CardBody>\n      <InventoryForm\n        onCancel={handleCancel}\n        onSubmit={handleSubmit}\n        inventory={inventory}\n        instanceGroups={associatedInstanceGroups}\n        submitError={error}\n      />\n    </CardBody>\n  );\n}\n\nInventoryEdit.propType = {\n  inventory: object.isRequired,\n};\n\nexport { InventoryEdit as _InventoryEdit };\nexport default InventoryEdit;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}