{"ast":null,"code":"import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _toConsumableArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useState,useEffect}from'react';import useWebsocket from'./useWebsocket';export default function useWsTemplates(initialTemplates){var _useState=useState(initialTemplates),_useState2=_slicedToArray(_useState,2),templates=_useState2[0],setTemplates=_useState2[1];var lastMessage=useWebsocket({jobs:['status_changed'],control:['limit_reached_1']});useEffect(function(){setTemplates(initialTemplates);},[initialTemplates]);useEffect(function(){if(!(lastMessage!==null&&lastMessage!==void 0&&lastMessage.unified_job_id)){return;}var index=templates.findIndex(function(t){return t.id===lastMessage.unified_job_template_id;});if(index===-1){return;}var template=templates[index];var updated=_toConsumableArray(templates);updated[index]=updateTemplate(template,lastMessage);setTemplates(updated);},[lastMessage]// eslint-disable-line react-hooks/exhaustive-deps\n);return templates;}function updateTemplate(template,message){var recentJobs=_toConsumableArray(template.summary_fields.recent_jobs||[]);var job={id:message.unified_job_id,status:message.status,finished:message.finished||null,type:message.type};var index=recentJobs.findIndex(function(j){return j.id===job.id;});if(index>-1){recentJobs[index]=_objectSpread(_objectSpread({},recentJobs[index]),job);}else{recentJobs.unshift(job);}return _objectSpread(_objectSpread({},template),{},{summary_fields:_objectSpread(_objectSpread({},template.summary_fields),{},{recent_jobs:recentJobs.slice(0,10)})});}","map":{"version":3,"names":["useState","useEffect","useWebsocket","useWsTemplates","initialTemplates","_useState","_useState2","_slicedToArray","templates","setTemplates","lastMessage","jobs","control","unified_job_id","index","findIndex","t","id","unified_job_template_id","template","updated","_toConsumableArray","updateTemplate","message","recentJobs","summary_fields","recent_jobs","job","status","finished","type","j","_objectSpread","unshift","slice"],"sources":["/awx_devel/awx/ui/src/hooks/useWsTemplates.js"],"sourcesContent":["import { useState, useEffect } from 'react';\nimport useWebsocket from './useWebsocket';\n\nexport default function useWsTemplates(initialTemplates) {\n  const [templates, setTemplates] = useState(initialTemplates);\n  const lastMessage = useWebsocket({\n    jobs: ['status_changed'],\n    control: ['limit_reached_1'],\n  });\n\n  useEffect(() => {\n    setTemplates(initialTemplates);\n  }, [initialTemplates]);\n\n  useEffect(\n    () => {\n      if (!lastMessage?.unified_job_id) {\n        return;\n      }\n      const index = templates.findIndex(\n        (t) => t.id === lastMessage.unified_job_template_id\n      );\n      if (index === -1) {\n        return;\n      }\n\n      const template = templates[index];\n      const updated = [...templates];\n      updated[index] = updateTemplate(template, lastMessage);\n      setTemplates(updated);\n    },\n    [lastMessage] // eslint-disable-line react-hooks/exhaustive-deps\n  );\n\n  return templates;\n}\n\nfunction updateTemplate(template, message) {\n  const recentJobs = [...(template.summary_fields.recent_jobs || [])];\n  const job = {\n    id: message.unified_job_id,\n    status: message.status,\n    finished: message.finished || null,\n    type: message.type,\n  };\n  const index = recentJobs.findIndex((j) => j.id === job.id);\n  if (index > -1) {\n    recentJobs[index] = {\n      ...recentJobs[index],\n      ...job,\n    };\n  } else {\n    recentJobs.unshift(job);\n  }\n\n  return {\n    ...template,\n    summary_fields: {\n      ...template.summary_fields,\n      recent_jobs: recentJobs.slice(0, 10),\n    },\n  };\n}\n"],"mappings":"4TAAA,OAASA,QAAQ,CAAEC,SAAS,KAAQ,OAAO,CAC3C,MAAO,CAAAC,YAAY,KAAM,gBAAgB,CAEzC,cAAe,SAAS,CAAAC,cAAcA,CAACC,gBAAgB,CAAE,CACvD,IAAAC,SAAA,CAAkCL,QAAQ,CAACI,gBAAgB,CAAC,CAAAE,UAAA,CAAAC,cAAA,CAAAF,SAAA,IAArDG,SAAS,CAAAF,UAAA,IAAEG,YAAY,CAAAH,UAAA,IAC9B,GAAM,CAAAI,WAAW,CAAGR,YAAY,CAAC,CAC/BS,IAAI,CAAE,CAAC,gBAAgB,CAAC,CACxBC,OAAO,CAAE,CAAC,iBAAiB,CAC7B,CAAC,CAAC,CAEFX,SAAS,CAAC,UAAM,CACdQ,YAAY,CAACL,gBAAgB,CAAC,CAChC,CAAC,CAAE,CAACA,gBAAgB,CAAC,CAAC,CAEtBH,SAAS,CACP,UAAM,CACJ,GAAI,EAACS,WAAW,SAAXA,WAAW,WAAXA,WAAW,CAAEG,cAAc,EAAE,CAChC,OACF,CACA,GAAM,CAAAC,KAAK,CAAGN,SAAS,CAACO,SAAS,CAC/B,SAACC,CAAC,QAAK,CAAAA,CAAC,CAACC,EAAE,GAAKP,WAAW,CAACQ,uBAAuB,EACrD,CAAC,CACD,GAAIJ,KAAK,GAAK,CAAC,CAAC,CAAE,CAChB,OACF,CAEA,GAAM,CAAAK,QAAQ,CAAGX,SAAS,CAACM,KAAK,CAAC,CACjC,GAAM,CAAAM,OAAO,CAAAC,kBAAA,CAAOb,SAAS,CAAC,CAC9BY,OAAO,CAACN,KAAK,CAAC,CAAGQ,cAAc,CAACH,QAAQ,CAAET,WAAW,CAAC,CACtDD,YAAY,CAACW,OAAO,CAAC,CACvB,CAAC,CACD,CAACV,WAAW,CAAE;AAChB,CAAC,CAED,MAAO,CAAAF,SAAS,CAClB,CAEA,QAAS,CAAAc,cAAcA,CAACH,QAAQ,CAAEI,OAAO,CAAE,CACzC,GAAM,CAAAC,UAAU,CAAAH,kBAAA,CAAQF,QAAQ,CAACM,cAAc,CAACC,WAAW,EAAI,EAAE,CAAE,CACnE,GAAM,CAAAC,GAAG,CAAG,CACVV,EAAE,CAAEM,OAAO,CAACV,cAAc,CAC1Be,MAAM,CAAEL,OAAO,CAACK,MAAM,CACtBC,QAAQ,CAAEN,OAAO,CAACM,QAAQ,EAAI,IAAI,CAClCC,IAAI,CAAEP,OAAO,CAACO,IAChB,CAAC,CACD,GAAM,CAAAhB,KAAK,CAAGU,UAAU,CAACT,SAAS,CAAC,SAACgB,CAAC,QAAK,CAAAA,CAAC,CAACd,EAAE,GAAKU,GAAG,CAACV,EAAE,GAAC,CAC1D,GAAIH,KAAK,CAAG,CAAC,CAAC,CAAE,CACdU,UAAU,CAACV,KAAK,CAAC,CAAAkB,aAAA,CAAAA,aAAA,IACZR,UAAU,CAACV,KAAK,CAAC,EACjBa,GAAG,CACP,CACH,CAAC,IAAM,CACLH,UAAU,CAACS,OAAO,CAACN,GAAG,CAAC,CACzB,CAEA,OAAAK,aAAA,CAAAA,aAAA,IACKb,QAAQ,MACXM,cAAc,CAAAO,aAAA,CAAAA,aAAA,IACTb,QAAQ,CAACM,cAAc,MAC1BC,WAAW,CAAEF,UAAU,CAACU,KAAK,CAAC,CAAC,CAAE,EAAE,CAAC,EACrC,GAEL"},"metadata":{},"sourceType":"module"}