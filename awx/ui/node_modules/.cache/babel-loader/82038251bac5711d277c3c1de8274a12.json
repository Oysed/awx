{"ast":null,"code":"import _toConsumableArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import React,{useState}from'react';import{Redirect,useHistory,useLocation,useRouteMatch}from'react-router-dom';import ContentLoading from'components/ContentLoading';import{CardBody}from'components/Card';import SurveyQuestionForm from'./SurveyQuestionForm';import{jsx as _jsx}from\"react/jsx-runtime\";export default function SurveyQuestionEdit(_ref){var survey=_ref.survey,updateSurvey=_ref.updateSurvey;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),formError=_useState2[0],setFormError=_useState2[1];var history=useHistory();var match=useRouteMatch();var _useLocation=useLocation(),search=_useLocation.search;var queryParams=new URLSearchParams(search);var questionVariable=decodeURIComponent(queryParams.get('question_variable'));if(!survey){return/*#__PURE__*/_jsx(ContentLoading,{});}var question=survey.spec.find(function(q){return q.variable===questionVariable;});if(!question){return/*#__PURE__*/_jsx(Redirect,{to:\"/templates/\".concat(match.params.templateType,\"/\").concat(match.params.id,\"/survey\")});}var navigateToList=function navigateToList(){var index=match.url.indexOf('/edit');history.push(match.url.substr(0,index));};var handleSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(formData){var submittedData,questionIndex,choices,defaultAnswers;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:submittedData=_objectSpread({},formData);_context.prev=1;if(!(submittedData.variable!==question.variable&&survey.spec.find(function(q){return q.variable===submittedData.variable;}))){_context.next=5;break;}setFormError(new Error(\"Survey already contains a question with variable named \\u201C\".concat(submittedData.variable,\"\\u201D\")));return _context.abrupt(\"return\");case 5:questionIndex=survey.spec.findIndex(function(q){return q.variable===questionVariable;});if(!(questionIndex===-1)){_context.next=8;break;}throw new Error('Question not found in spec');case 8:if(submittedData.type==='multiselect'||submittedData.type==='multiplechoice'){choices=[];defaultAnswers='';submittedData.formattedChoices.forEach(function(_ref3,i){var choice=_ref3.choice,isDefault=_ref3.isDefault;choices.push(choice);if(isDefault){defaultAnswers=i===submittedData.formattedChoices.length-1?defaultAnswers.concat(\"\".concat(choice)):defaultAnswers.concat(\"\".concat(choice,\"\\n\"));}});submittedData.default=defaultAnswers.trim();submittedData.choices=choices;}delete submittedData.formattedChoices;_context.next=12;return updateSurvey([].concat(_toConsumableArray(survey.spec.slice(0,questionIndex)),[submittedData],_toConsumableArray(survey.spec.slice(questionIndex+1))));case 12:navigateToList();_context.next=18;break;case 15:_context.prev=15;_context.t0=_context[\"catch\"](1);setFormError(_context.t0);case 18:case\"end\":return _context.stop();}}},_callee,null,[[1,15]]);}));return function handleSubmit(_x){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsx(CardBody,{children:/*#__PURE__*/_jsx(SurveyQuestionForm,{question:question,handleSubmit:handleSubmit,handleCancel:navigateToList,submitError:formError})});}","map":{"version":3,"names":["React","useState","Redirect","useHistory","useLocation","useRouteMatch","ContentLoading","CardBody","SurveyQuestionForm","jsx","_jsx","SurveyQuestionEdit","_ref","survey","updateSurvey","_useState","_useState2","_slicedToArray","formError","setFormError","history","match","_useLocation","search","queryParams","URLSearchParams","questionVariable","decodeURIComponent","get","question","spec","find","q","variable","to","concat","params","templateType","id","navigateToList","index","url","indexOf","push","substr","handleSubmit","_ref2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","formData","submittedData","questionIndex","choices","defaultAnswers","wrap","_callee$","_context","prev","next","_objectSpread","Error","abrupt","findIndex","type","formattedChoices","forEach","_ref3","i","choice","isDefault","length","default","trim","_toConsumableArray","slice","t0","stop","_x","apply","arguments","children","handleCancel","submitError"],"sources":["/awx_devel/awx/ui/src/screens/Template/Survey/SurveyQuestionEdit.js"],"sourcesContent":["import React, { useState } from 'react';\nimport {\n  Redirect,\n  useHistory,\n  useLocation,\n  useRouteMatch,\n} from 'react-router-dom';\nimport ContentLoading from 'components/ContentLoading';\nimport { CardBody } from 'components/Card';\nimport SurveyQuestionForm from './SurveyQuestionForm';\n\nexport default function SurveyQuestionEdit({ survey, updateSurvey }) {\n  const [formError, setFormError] = useState(null);\n  const history = useHistory();\n  const match = useRouteMatch();\n  const { search } = useLocation();\n  const queryParams = new URLSearchParams(search);\n  const questionVariable = decodeURIComponent(\n    queryParams.get('question_variable')\n  );\n\n  if (!survey) {\n    return <ContentLoading />;\n  }\n\n  const question = survey.spec.find((q) => q.variable === questionVariable);\n\n  if (!question) {\n    return (\n      <Redirect\n        to={`/templates/${match.params.templateType}/${match.params.id}/survey`}\n      />\n    );\n  }\n\n  const navigateToList = () => {\n    const index = match.url.indexOf('/edit');\n    history.push(match.url.substr(0, index));\n  };\n\n  const handleSubmit = async (formData) => {\n    const submittedData = { ...formData };\n    try {\n      if (\n        submittedData.variable !== question.variable &&\n        survey.spec.find((q) => q.variable === submittedData.variable)\n      ) {\n        setFormError(\n          new Error(\n            `Survey already contains a question with variable named “${submittedData.variable}”`\n          )\n        );\n        return;\n      }\n      const questionIndex = survey.spec.findIndex(\n        (q) => q.variable === questionVariable\n      );\n      if (questionIndex === -1) {\n        throw new Error('Question not found in spec');\n      }\n      if (\n        submittedData.type === 'multiselect' ||\n        submittedData.type === 'multiplechoice'\n      ) {\n        const choices = [];\n        let defaultAnswers = '';\n        submittedData.formattedChoices.forEach(({ choice, isDefault }, i) => {\n          choices.push(choice);\n          if (isDefault) {\n            defaultAnswers =\n              i === submittedData.formattedChoices.length - 1\n                ? defaultAnswers.concat(`${choice}`)\n                : defaultAnswers.concat(`${choice}\\n`);\n          }\n        });\n        submittedData.default = defaultAnswers.trim();\n        submittedData.choices = choices;\n      }\n      delete submittedData.formattedChoices;\n\n      await updateSurvey([\n        ...survey.spec.slice(0, questionIndex),\n        submittedData,\n        ...survey.spec.slice(questionIndex + 1),\n      ]);\n      navigateToList();\n    } catch (err) {\n      setFormError(err);\n    }\n  };\n\n  return (\n    <CardBody>\n      <SurveyQuestionForm\n        question={question}\n        handleSubmit={handleSubmit}\n        handleCancel={navigateToList}\n        submitError={formError}\n      />\n    </CardBody>\n  );\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}