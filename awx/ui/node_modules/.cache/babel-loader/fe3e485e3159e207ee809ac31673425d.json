{"ast":null,"code":"import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{i18n}from\"@lingui/core\";import React,{useCallback,useEffect,useState}from'react';import{SelectVariant,Select,SelectOption}from'@patternfly/react-core';import{ProjectsAPI}from'api';import useRequest from'hooks/useRequest';import{jsx as _jsx}from\"react/jsx-runtime\";function PlaybookSelect(_ref){var projectId=_ref.projectId,isValid=_ref.isValid,selected=_ref.selected,onBlur=_ref.onBlur,onError=_ref.onError,onChange=_ref.onChange;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isDisabled=_useState2[0],setIsDisabled=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isOpen=_useState4[0],setIsOpen=_useState4[1];var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _yield$ProjectsAPI$re,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(projectId){_context.next=2;break;}return _context.abrupt(\"return\",[]);case 2:_context.next=4;return ProjectsAPI.readPlaybooks(projectId);case 4:_yield$ProjectsAPI$re=_context.sent;data=_yield$ProjectsAPI$re.data;if(data.length===1){onChange(data[0]);}return _context.abrupt(\"return\",data);case 8:case\"end\":return _context.stop();}}},_callee);})),[projectId,onChange]),[]),options=_useRequest.result,fetchOptions=_useRequest.request,isLoading=_useRequest.isLoading,error=_useRequest.error;useEffect(function(){fetchOptions();},[fetchOptions]);useEffect(function(){if(error){if(error.response.status===403){setIsDisabled(true);}else{onError(error);}}},[error,onError]);return/*#__PURE__*/_jsx(Select,{ouiaId:\"JobTemplateForm-playbook\",isOpen:isOpen,variant:SelectVariant.typeahead,selections:selected,onToggle:setIsOpen,placeholderText:/*i18n*/i18n._(\"Select a playbook\"),typeAheadAriaLabel:/*i18n*/i18n._(\"Select a playbook\"),isCreatable:true,createText:\"\",onSelect:function onSelect(event,value){setIsOpen(false);onChange(value);},id:\"template-playbook\",validated:isValid?'default':'error',onBlur:onBlur,isDisabled:isLoading||isDisabled,maxHeight:\"1000%\",noResultsFoundText:/*i18n*/i18n._(\"No results found\"),children:options.map(function(opt){return/*#__PURE__*/_jsx(SelectOption,{value:opt},opt);})});}PlaybookSelect.defaultProps={projectId:null,onChange:function onChange(){}};export{PlaybookSelect as _PlaybookSelect};export default PlaybookSelect;","map":{"version":3,"names":["React","useCallback","useEffect","useState","SelectVariant","Select","SelectOption","ProjectsAPI","useRequest","jsx","_jsx","PlaybookSelect","_ref","projectId","isValid","selected","onBlur","onError","onChange","_useState","_useState2","_slicedToArray","isDisabled","setIsDisabled","_useState3","_useState4","isOpen","setIsOpen","_useRequest","_asyncToGenerator","_regeneratorRuntime","mark","_callee","_yield$ProjectsAPI$re","data","wrap","_callee$","_context","prev","next","abrupt","readPlaybooks","sent","length","stop","options","result","fetchOptions","request","isLoading","error","response","status","ouiaId","variant","typeahead","selections","onToggle","placeholderText","i18n","_","typeAheadAriaLabel","isCreatable","createText","onSelect","event","value","id","validated","maxHeight","noResultsFoundText","children","map","opt","defaultProps","_PlaybookSelect"],"sources":["/awx_devel/awx/ui/src/screens/Template/shared/PlaybookSelect.js"],"sourcesContent":["import React, { useCallback, useEffect, useState } from 'react';\nimport { func, number, string, oneOfType } from 'prop-types';\n\nimport { t } from '@lingui/macro';\nimport { SelectVariant, Select, SelectOption } from '@patternfly/react-core';\nimport { ProjectsAPI } from 'api';\nimport useRequest from 'hooks/useRequest';\n\nfunction PlaybookSelect({\n  projectId,\n  isValid,\n  selected,\n  onBlur,\n  onError,\n  onChange,\n}) {\n  const [isDisabled, setIsDisabled] = useState(false);\n  const [isOpen, setIsOpen] = useState(false);\n  const {\n    result: options,\n    request: fetchOptions,\n    isLoading,\n    error,\n  } = useRequest(\n    useCallback(async () => {\n      if (!projectId) {\n        return [];\n      }\n      const { data } = await ProjectsAPI.readPlaybooks(projectId);\n\n      if (data.length === 1) {\n        onChange(data[0]);\n      }\n      return data;\n    }, [projectId, onChange]),\n    []\n  );\n\n  useEffect(() => {\n    fetchOptions();\n  }, [fetchOptions]);\n\n  useEffect(() => {\n    if (error) {\n      if (error.response.status === 403) {\n        setIsDisabled(true);\n      } else {\n        onError(error);\n      }\n    }\n  }, [error, onError]);\n\n  return (\n    <Select\n      ouiaId=\"JobTemplateForm-playbook\"\n      isOpen={isOpen}\n      variant={SelectVariant.typeahead}\n      selections={selected}\n      onToggle={setIsOpen}\n      placeholderText={t`Select a playbook`}\n      typeAheadAriaLabel={t`Select a playbook`}\n      isCreatable\n      createText=\"\"\n      onSelect={(event, value) => {\n        setIsOpen(false);\n        onChange(value);\n      }}\n      id=\"template-playbook\"\n      validated={isValid ? 'default' : 'error'}\n      onBlur={onBlur}\n      isDisabled={isLoading || isDisabled}\n      maxHeight=\"1000%\"\n      noResultsFoundText={t`No results found`}\n    >\n      {options.map((opt) => (\n        <SelectOption key={opt} value={opt} />\n      ))}\n    </Select>\n  );\n}\nPlaybookSelect.propTypes = {\n  projectId: oneOfType([number, string]),\n  onChange: func,\n};\nPlaybookSelect.defaultProps = {\n  projectId: null,\n  onChange: () => {},\n};\n\nexport { PlaybookSelect as _PlaybookSelect };\nexport default PlaybookSelect;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}