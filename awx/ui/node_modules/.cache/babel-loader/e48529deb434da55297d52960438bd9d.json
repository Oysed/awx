{"ast":null,"code":"import _toConsumableArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _createForOfIteratorHelper from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _objectWithoutProperties from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";var _excluded=[\"instanceGroups\",\"organization\"];import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import React,{useState}from'react';import{useHistory}from'react-router-dom';import{PageSection,Card}from'@patternfly/react-core';import{CardBody}from'components/Card';import{InventoriesAPI}from'api';import InventoryForm from'../shared/InventoryForm';import{jsx as _jsx}from\"react/jsx-runtime\";function InventoryAdd(){var _useState=useState(null),_useState2=_slicedToArray(_useState,2),error=_useState2[0],setError=_useState2[1];var history=useHistory();var handleCancel=function handleCancel(){history.push('/inventories');};function submitLabels(_x,_x2){return _submitLabels.apply(this,arguments);}function _submitLabels(){_submitLabels=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(inventoryId,orgId){var labels,associationPromises,_args2=arguments;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:labels=_args2.length>2&&_args2[2]!==undefined?_args2[2]:[];associationPromises=labels.map(function(label){return InventoriesAPI.associateLabel(inventoryId,label,orgId);});return _context2.abrupt(\"return\",Promise.all(_toConsumableArray(associationPromises)));case 3:case\"end\":return _context2.stop();}}},_callee2);}));return _submitLabels.apply(this,arguments);}var handleSubmit=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(values){var instanceGroups,organization,remainingValues,_values$organization,_yield$InventoriesAPI,inventoryId,_iterator,_step,group,url;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:instanceGroups=values.instanceGroups,organization=values.organization,remainingValues=_objectWithoutProperties(values,_excluded);_context.prev=1;_context.next=4;return InventoriesAPI.create(_objectSpread({organization:organization.id},remainingValues));case 4:_yield$InventoriesAPI=_context.sent;inventoryId=_yield$InventoriesAPI.data.id;_context.next=8;return submitLabels(inventoryId,(_values$organization=values.organization)===null||_values$organization===void 0?void 0:_values$organization.id,values.labels);case 8:_iterator=_createForOfIteratorHelper(instanceGroups);_context.prev=9;_iterator.s();case 11:if((_step=_iterator.n()).done){_context.next=17;break;}group=_step.value;_context.next=15;return InventoriesAPI.associateInstanceGroup(inventoryId,group.id);case 15:_context.next=11;break;case 17:_context.next=22;break;case 19:_context.prev=19;_context.t0=_context[\"catch\"](9);_iterator.e(_context.t0);case 22:_context.prev=22;_iterator.f();return _context.finish(22);case 25:/* eslint-enable no-await-in-loop, no-restricted-syntax */url=history.location.pathname.startsWith('/inventories/smart_inventory')?\"/inventories/smart_inventory/\".concat(inventoryId,\"/details\"):\"/inventories/inventory/\".concat(inventoryId,\"/details\");history.push(\"\".concat(url));_context.next=32;break;case 29:_context.prev=29;_context.t1=_context[\"catch\"](1);setError(_context.t1);case 32:case\"end\":return _context.stop();}}},_callee,null,[[1,29],[9,19,22,25]]);}));return function handleSubmit(_x3){return _ref.apply(this,arguments);};}();return/*#__PURE__*/_jsx(PageSection,{children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(CardBody,{children:/*#__PURE__*/_jsx(InventoryForm,{onCancel:handleCancel,onSubmit:handleSubmit,submitError:error})})})});}export{InventoryAdd as _InventoryAdd};export default InventoryAdd;","map":{"version":3,"names":["React","useState","useHistory","PageSection","Card","CardBody","InventoriesAPI","InventoryForm","jsx","_jsx","InventoryAdd","_useState","_useState2","_slicedToArray","error","setError","history","handleCancel","push","submitLabels","_x","_x2","_submitLabels","apply","arguments","_asyncToGenerator","_regeneratorRuntime","mark","_callee2","inventoryId","orgId","labels","associationPromises","_args2","wrap","_callee2$","_context2","prev","next","length","undefined","map","label","associateLabel","abrupt","Promise","all","_toConsumableArray","stop","handleSubmit","_ref","_callee","values","instanceGroups","organization","remainingValues","_values$organization","_yield$InventoriesAPI","_iterator","_step","group","url","_callee$","_context","_objectWithoutProperties","_excluded","create","_objectSpread","id","sent","data","_createForOfIteratorHelper","s","n","done","value","associateInstanceGroup","t0","e","f","finish","location","pathname","startsWith","concat","t1","_x3","children","onCancel","onSubmit","submitError","_InventoryAdd"],"sources":["/awx_devel/awx/ui/src/screens/Inventory/InventoryAdd/InventoryAdd.js"],"sourcesContent":["import React, { useState } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport { PageSection, Card } from '@patternfly/react-core';\nimport { CardBody } from 'components/Card';\n\nimport { InventoriesAPI } from 'api';\nimport InventoryForm from '../shared/InventoryForm';\n\nfunction InventoryAdd() {\n  const [error, setError] = useState(null);\n  const history = useHistory();\n\n  const handleCancel = () => {\n    history.push('/inventories');\n  };\n\n  async function submitLabels(inventoryId, orgId, labels = []) {\n    const associationPromises = labels.map((label) =>\n      InventoriesAPI.associateLabel(inventoryId, label, orgId)\n    );\n\n    return Promise.all([...associationPromises]);\n  }\n\n  const handleSubmit = async (values) => {\n    const { instanceGroups, organization, ...remainingValues } = values;\n    try {\n      const {\n        data: { id: inventoryId },\n      } = await InventoriesAPI.create({\n        organization: organization.id,\n        ...remainingValues,\n      });\n      /* eslint-disable no-await-in-loop, no-restricted-syntax */\n      // Resolve Promises sequentially to maintain order and avoid race condition\n\n      await submitLabels(inventoryId, values.organization?.id, values.labels);\n      for (const group of instanceGroups) {\n        await InventoriesAPI.associateInstanceGroup(inventoryId, group.id);\n      }\n      /* eslint-enable no-await-in-loop, no-restricted-syntax */\n      const url = history.location.pathname.startsWith(\n        '/inventories/smart_inventory'\n      )\n        ? `/inventories/smart_inventory/${inventoryId}/details`\n        : `/inventories/inventory/${inventoryId}/details`;\n\n      history.push(`${url}`);\n    } catch (err) {\n      setError(err);\n    }\n  };\n\n  return (\n    <PageSection>\n      <Card>\n        <CardBody>\n          <InventoryForm\n            onCancel={handleCancel}\n            onSubmit={handleSubmit}\n            submitError={error}\n          />\n        </CardBody>\n      </Card>\n    </PageSection>\n  );\n}\n\nexport { InventoryAdd as _InventoryAdd };\nexport default InventoryAdd;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}