{"ast":null,"code":"import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{i18n}from\"@lingui/core\";import React from'react';import{useField}from'formik';import StepName from'components/LaunchPrompt/steps/StepName';import{stringIsUUID}from'util/strings';import NodeTypeStep from'./NodeTypeStep';import{jsx as _jsx}from\"react/jsx-runtime\";var STEP_ID='nodeType';export default function useNodeTypeStep(nodeToEdit){var _useField=useField('nodeType'),_useField2=_slicedToArray(_useField,2),meta=_useField2[1];var _useField3=useField('approvalName'),_useField4=_slicedToArray(_useField3,1),approvalNameField=_useField4[0];var _useField5=useField('nodeType'),_useField6=_slicedToArray(_useField5,2),nodeTypeField=_useField6[0];var _useField7=useField('identifier'),_useField8=_slicedToArray(_useField7,2),identifierMeta=_useField8[1];var _useField9=useField({name:'nodeResource',validate:function validate(value){if((value===null||value===void 0?void 0:value.type)==='job_template'&&(!(value!==null&&value!==void 0&&value.project)||(value===null||value===void 0?void 0:value.project)===null||(!(value!==null&&value!==void 0&&value.inventory)||(value===null||value===void 0?void 0:value.inventory)===null)&&!(value!==null&&value!==void 0&&value.ask_inventory_on_launch))){return(/*i18n*/i18n._(\"Job Templates with a missing inventory or project cannot be selected when creating or editing nodes.  Select another template or fix the missing fields to proceed.\"));}return undefined;}}),_useField10=_slicedToArray(_useField9,2),nodeResourceField=_useField10[0],nodeResourceMeta=_useField10[1];var formError=!!meta.error||!!nodeResourceMeta.error||identifierMeta.error;return{step:getStep(nodeTypeField,approvalNameField,nodeResourceField,formError,nodeToEdit),initialValues:getInitialValues(),isReady:true,contentError:null,hasError:formError,setTouched:function setTouched(setFieldTouched){setFieldTouched('nodeType',true,false);},validate:function validate(){}};}function getStep(nodeTypeField,approvalNameField,nodeResourceField,formError,nodeToEdit){var _nodeToEdit$originalN;var isEnabled=function isEnabled(){if(nodeTypeField.value!=='workflow_approval_template'&&nodeResourceField.value===null||nodeTypeField.value==='workflow_approval_template'&&approvalNameField.value===''||formError){return false;}return true;};return{id:STEP_ID,name:/*#__PURE__*/_jsx(StepName,{hasErrors:formError,id:\"node-type-step\",children:/*i18n*/i18n._(\"Node type\")}),component:/*#__PURE__*/_jsx(NodeTypeStep,{isIdentifierRequired:nodeToEdit&&nodeToEdit.originalNodeObject&&!stringIsUUID((_nodeToEdit$originalN=nodeToEdit.originalNodeObject)===null||_nodeToEdit$originalN===void 0?void 0:_nodeToEdit$originalN.identifier)}),enableNext:isEnabled()};}function getInitialValues(){return{approvalName:'',approvalDescription:'',timeoutMinutes:0,timeoutSeconds:0,nodeType:'job_template',convergence:'any',identifier:''};}","map":{"version":3,"names":["React","useField","StepName","stringIsUUID","NodeTypeStep","jsx","_jsx","STEP_ID","useNodeTypeStep","nodeToEdit","_useField","_useField2","_slicedToArray","meta","_useField3","_useField4","approvalNameField","_useField5","_useField6","nodeTypeField","_useField7","_useField8","identifierMeta","_useField9","name","validate","value","type","project","inventory","ask_inventory_on_launch","i18n","_","undefined","_useField10","nodeResourceField","nodeResourceMeta","formError","error","step","getStep","initialValues","getInitialValues","isReady","contentError","hasError","setTouched","setFieldTouched","_nodeToEdit$originalN","isEnabled","id","hasErrors","children","component","isIdentifierRequired","originalNodeObject","identifier","enableNext","approvalName","approvalDescription","timeoutMinutes","timeoutSeconds","nodeType","convergence"],"sources":["/awx_devel/awx/ui/src/screens/Template/WorkflowJobTemplateVisualizer/Modals/NodeModals/NodeTypeStep/useNodeTypeStep.js"],"sourcesContent":["import React from 'react';\nimport { t } from '@lingui/macro';\nimport { useField } from 'formik';\nimport StepName from 'components/LaunchPrompt/steps/StepName';\nimport { stringIsUUID } from 'util/strings';\nimport NodeTypeStep from './NodeTypeStep';\n\nconst STEP_ID = 'nodeType';\n\nexport default function useNodeTypeStep(nodeToEdit) {\n  const [, meta] = useField('nodeType');\n  const [approvalNameField] = useField('approvalName');\n  const [nodeTypeField, ,] = useField('nodeType');\n  const [, identifierMeta] = useField('identifier');\n  const [nodeResourceField, nodeResourceMeta] = useField({\n    name: 'nodeResource',\n    validate: (value) => {\n      if (\n        value?.type === 'job_template' &&\n        (!value?.project ||\n          value?.project === null ||\n          ((!value?.inventory || value?.inventory === null) &&\n            !value?.ask_inventory_on_launch))\n      ) {\n        return t`Job Templates with a missing inventory or project cannot be selected when creating or editing nodes.  Select another template or fix the missing fields to proceed.`;\n      }\n      return undefined;\n    },\n  });\n\n  const formError =\n    !!meta.error || !!nodeResourceMeta.error || identifierMeta.error;\n\n  return {\n    step: getStep(\n      nodeTypeField,\n      approvalNameField,\n      nodeResourceField,\n      formError,\n      nodeToEdit\n    ),\n    initialValues: getInitialValues(),\n    isReady: true,\n    contentError: null,\n    hasError: formError,\n    setTouched: (setFieldTouched) => {\n      setFieldTouched('nodeType', true, false);\n    },\n    validate: () => {},\n  };\n}\nfunction getStep(\n  nodeTypeField,\n  approvalNameField,\n  nodeResourceField,\n  formError,\n  nodeToEdit\n) {\n  const isEnabled = () => {\n    if (\n      (nodeTypeField.value !== 'workflow_approval_template' &&\n        nodeResourceField.value === null) ||\n      (nodeTypeField.value === 'workflow_approval_template' &&\n        approvalNameField.value === '') ||\n      formError\n    ) {\n      return false;\n    }\n    return true;\n  };\n  return {\n    id: STEP_ID,\n    name: (\n      <StepName hasErrors={formError} id=\"node-type-step\">\n        {t`Node type`}\n      </StepName>\n    ),\n    component: (\n      <NodeTypeStep\n        isIdentifierRequired={\n          nodeToEdit &&\n          nodeToEdit.originalNodeObject &&\n          !stringIsUUID(nodeToEdit.originalNodeObject?.identifier)\n        }\n      />\n    ),\n    enableNext: isEnabled(),\n  };\n}\n\nfunction getInitialValues() {\n  return {\n    approvalName: '',\n    approvalDescription: '',\n    timeoutMinutes: 0,\n    timeoutSeconds: 0,\n    nodeType: 'job_template',\n    convergence: 'any',\n    identifier: '',\n  };\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}