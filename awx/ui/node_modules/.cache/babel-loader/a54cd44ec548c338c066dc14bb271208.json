{"ast":null,"code":"import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import React,{useState}from'react';import{useHistory,useRouteMatch}from'react-router-dom';import{CardBody}from'components/Card';import SurveyQuestionForm from'./SurveyQuestionForm';import{jsx as _jsx}from\"react/jsx-runtime\";export default function SurveyQuestionAdd(_ref){var survey=_ref.survey,updateSurvey=_ref.updateSurvey;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),formError=_useState2[0],setFormError=_useState2[1];var history=useHistory();var match=useRouteMatch();var handleSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(question){var formData,_survey$spec,choices,defaultAnswers,newSpec;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:formData=_objectSpread({},question);_context.prev=1;if(!(survey!==null&&survey!==void 0&&(_survey$spec=survey.spec)!==null&&_survey$spec!==void 0&&_survey$spec.some(function(q){return q.variable===formData.variable;}))){_context.next=5;break;}setFormError(new Error(\"Survey already contains a question with variable named \\u201C\".concat(formData.variable,\"\\u201D\")));return _context.abrupt(\"return\");case 5:if(formData.type==='multiselect'||formData.type==='multiplechoice'){choices=[];defaultAnswers='';formData.formattedChoices.forEach(function(_ref3,i){var choice=_ref3.choice,isDefault=_ref3.isDefault;choices.push(choice);if(isDefault){defaultAnswers=i===formData.formattedChoices.length-1?defaultAnswers.concat(\"\".concat(choice)):defaultAnswers.concat(\"\".concat(choice,\"\\n\"));}});formData.default=defaultAnswers.trim();formData.choices=choices;}delete formData.formattedChoices;newSpec=survey!==null&&survey!==void 0&&survey.spec?survey.spec.concat(formData):[formData];_context.next=10;return updateSurvey(newSpec);case 10:history.push(match.url.replace('/add',''));_context.next=16;break;case 13:_context.prev=13;_context.t0=_context[\"catch\"](1);setFormError(_context.t0);case 16:case\"end\":return _context.stop();}}},_callee,null,[[1,13]]);}));return function handleSubmit(_x){return _ref2.apply(this,arguments);};}();var handleCancel=function handleCancel(){history.push(match.url.replace('/add',''));};return/*#__PURE__*/_jsx(CardBody,{children:/*#__PURE__*/_jsx(SurveyQuestionForm,{handleSubmit:handleSubmit,handleCancel:handleCancel,submitError:formError})});}","map":{"version":3,"names":["React","useState","useHistory","useRouteMatch","CardBody","SurveyQuestionForm","jsx","_jsx","SurveyQuestionAdd","_ref","survey","updateSurvey","_useState","_useState2","_slicedToArray","formError","setFormError","history","match","handleSubmit","_ref2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","question","formData","_survey$spec","choices","defaultAnswers","newSpec","wrap","_callee$","_context","prev","next","_objectSpread","spec","some","q","variable","Error","concat","abrupt","type","formattedChoices","forEach","_ref3","i","choice","isDefault","push","length","default","trim","url","replace","t0","stop","_x","apply","arguments","handleCancel","children","submitError"],"sources":["/awx_devel/awx/ui/src/screens/Template/Survey/SurveyQuestionAdd.js"],"sourcesContent":["import React, { useState } from 'react';\nimport { useHistory, useRouteMatch } from 'react-router-dom';\nimport { CardBody } from 'components/Card';\nimport SurveyQuestionForm from './SurveyQuestionForm';\n\nexport default function SurveyQuestionAdd({ survey, updateSurvey }) {\n  const [formError, setFormError] = useState(null);\n  const history = useHistory();\n  const match = useRouteMatch();\n\n  const handleSubmit = async (question) => {\n    const formData = { ...question };\n    try {\n      if (survey?.spec?.some((q) => q.variable === formData.variable)) {\n        setFormError(\n          new Error(\n            `Survey already contains a question with variable named “${formData.variable}”`\n          )\n        );\n        return;\n      }\n      if (\n        formData.type === 'multiselect' ||\n        formData.type === 'multiplechoice'\n      ) {\n        const choices = [];\n        let defaultAnswers = '';\n        formData.formattedChoices.forEach(({ choice, isDefault }, i) => {\n          choices.push(choice);\n          if (isDefault) {\n            defaultAnswers =\n              i === formData.formattedChoices.length - 1\n                ? defaultAnswers.concat(`${choice}`)\n                : defaultAnswers.concat(`${choice}\\n`);\n          }\n        });\n        formData.default = defaultAnswers.trim();\n        formData.choices = choices;\n      }\n      delete formData.formattedChoices;\n      const newSpec = survey?.spec ? survey.spec.concat(formData) : [formData];\n      await updateSurvey(newSpec);\n      history.push(match.url.replace('/add', ''));\n    } catch (err) {\n      setFormError(err);\n    }\n  };\n\n  const handleCancel = () => {\n    history.push(match.url.replace('/add', ''));\n  };\n\n  return (\n    <CardBody>\n      <SurveyQuestionForm\n        handleSubmit={handleSubmit}\n        handleCancel={handleCancel}\n        submitError={formError}\n      />\n    </CardBody>\n  );\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}