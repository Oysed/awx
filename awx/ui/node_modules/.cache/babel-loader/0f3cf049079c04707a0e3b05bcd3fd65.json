{"ast":null,"code":"import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import React,{useState,useEffect,useCallback}from'react';import{Card,PageSection}from'@patternfly/react-core';import{useHistory}from'react-router-dom';import{CardBody}from'components/Card';import{InstanceGroupsAPI}from'api';import useRequest from'hooks/useRequest';import ContentError from'components/ContentError';import ContentLoading from'components/ContentLoading';import{jsonToYaml,isJsonString}from'util/yaml';import ContainerGroupForm from'../shared/ContainerGroupForm';import{jsx as _jsx}from\"react/jsx-runtime\";function ContainerGroupAdd(){var history=useHistory();var _useState=useState(null),_useState2=_slicedToArray(_useState,2),submitError=_useState2[0],setSubmitError=_useState2[1];var getPodSpecValue=function getPodSpecValue(value){if(isJsonString(value)){value=jsonToYaml(value);}if(value!==jsonToYaml(JSON.stringify(initialPodSpec))){return value;}return null;};var handleSubmit=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(values){var _values$credential,_yield$InstanceGroups,response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return InstanceGroupsAPI.create({name:values.name,max_forks:values.max_forks?values.max_forks:0,max_concurrent_jobs:values.max_concurrent_jobs?values.max_concurrent_jobs:0,credential:values===null||values===void 0?void 0:(_values$credential=values.credential)===null||_values$credential===void 0?void 0:_values$credential.id,pod_spec_override:values.override?getPodSpecValue(values.pod_spec_override):null,is_container_group:true});case 3:_yield$InstanceGroups=_context.sent;response=_yield$InstanceGroups.data;history.push(\"/instance_groups/container_group/\".concat(response.id,\"/details\"));_context.next=11;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](0);setSubmitError(_context.t0);case 11:case\"end\":return _context.stop();}}},_callee,null,[[0,8]]);}));return function handleSubmit(_x){return _ref.apply(this,arguments);};}();var handleCancel=function handleCancel(){history.push(\"/instance_groups\");};var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var _yield$InstanceGroups2,data;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return InstanceGroupsAPI.readOptions();case 2:_yield$InstanceGroups2=_context2.sent;data=_yield$InstanceGroups2.data;return _context2.abrupt(\"return\",data.actions.POST.pod_spec_override.default);case 5:case\"end\":return _context2.stop();}}},_callee2);})),[]),{initialPodSpec:{}}),fetchError=_useRequest.error,isLoading=_useRequest.isLoading,fetchInitialPodSpec=_useRequest.request,initialPodSpec=_useRequest.result;useEffect(function(){fetchInitialPodSpec();},[fetchInitialPodSpec]);if(fetchError){return/*#__PURE__*/_jsx(PageSection,{children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(CardBody,{children:/*#__PURE__*/_jsx(ContentError,{error:fetchError})})})});}if(isLoading){return/*#__PURE__*/_jsx(PageSection,{children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(CardBody,{children:/*#__PURE__*/_jsx(ContentLoading,{})})})});}return/*#__PURE__*/_jsx(PageSection,{children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(CardBody,{children:/*#__PURE__*/_jsx(ContainerGroupForm,{initialPodSpec:initialPodSpec,onSubmit:handleSubmit,submitError:submitError,onCancel:handleCancel})})})});}export default ContainerGroupAdd;","map":{"version":3,"names":["React","useState","useEffect","useCallback","Card","PageSection","useHistory","CardBody","InstanceGroupsAPI","useRequest","ContentError","ContentLoading","jsonToYaml","isJsonString","ContainerGroupForm","jsx","_jsx","ContainerGroupAdd","history","_useState","_useState2","_slicedToArray","submitError","setSubmitError","getPodSpecValue","value","JSON","stringify","initialPodSpec","handleSubmit","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","values","_values$credential","_yield$InstanceGroups","response","wrap","_callee$","_context","prev","next","create","name","max_forks","max_concurrent_jobs","credential","id","pod_spec_override","override","is_container_group","sent","data","push","concat","t0","stop","_x","apply","arguments","handleCancel","_useRequest","_callee2","_yield$InstanceGroups2","_callee2$","_context2","readOptions","abrupt","actions","POST","default","fetchError","error","isLoading","fetchInitialPodSpec","request","result","children","onSubmit","onCancel"],"sources":["/awx_devel/awx/ui/src/screens/InstanceGroup/ContainerGroupAdd/ContainerGroupAdd.js"],"sourcesContent":["import React, { useState, useEffect, useCallback } from 'react';\nimport { Card, PageSection } from '@patternfly/react-core';\nimport { useHistory } from 'react-router-dom';\n\nimport { CardBody } from 'components/Card';\nimport { InstanceGroupsAPI } from 'api';\nimport useRequest from 'hooks/useRequest';\nimport ContentError from 'components/ContentError';\nimport ContentLoading from 'components/ContentLoading';\nimport { jsonToYaml, isJsonString } from 'util/yaml';\n\nimport ContainerGroupForm from '../shared/ContainerGroupForm';\n\nfunction ContainerGroupAdd() {\n  const history = useHistory();\n  const [submitError, setSubmitError] = useState(null);\n\n  const getPodSpecValue = (value) => {\n    if (isJsonString(value)) {\n      value = jsonToYaml(value);\n    }\n    if (value !== jsonToYaml(JSON.stringify(initialPodSpec))) {\n      return value;\n    }\n    return null;\n  };\n\n  const handleSubmit = async (values) => {\n    try {\n      const { data: response } = await InstanceGroupsAPI.create({\n        name: values.name,\n        max_forks: values.max_forks ? values.max_forks : 0,\n        max_concurrent_jobs: values.max_concurrent_jobs\n          ? values.max_concurrent_jobs\n          : 0,\n        credential: values?.credential?.id,\n        pod_spec_override: values.override\n          ? getPodSpecValue(values.pod_spec_override)\n          : null,\n        is_container_group: true,\n      });\n      history.push(`/instance_groups/container_group/${response.id}/details`);\n    } catch (error) {\n      setSubmitError(error);\n    }\n  };\n\n  const handleCancel = () => {\n    history.push(`/instance_groups`);\n  };\n\n  const {\n    error: fetchError,\n    isLoading,\n    request: fetchInitialPodSpec,\n    result: initialPodSpec,\n  } = useRequest(\n    useCallback(async () => {\n      const { data } = await InstanceGroupsAPI.readOptions();\n      return data.actions.POST.pod_spec_override.default;\n    }, []),\n    {\n      initialPodSpec: {},\n    }\n  );\n\n  useEffect(() => {\n    fetchInitialPodSpec();\n  }, [fetchInitialPodSpec]);\n\n  if (fetchError) {\n    return (\n      <PageSection>\n        <Card>\n          <CardBody>\n            <ContentError error={fetchError} />\n          </CardBody>\n        </Card>\n      </PageSection>\n    );\n  }\n\n  if (isLoading) {\n    return (\n      <PageSection>\n        <Card>\n          <CardBody>\n            <ContentLoading />\n          </CardBody>\n        </Card>\n      </PageSection>\n    );\n  }\n\n  return (\n    <PageSection>\n      <Card>\n        <CardBody>\n          <ContainerGroupForm\n            initialPodSpec={initialPodSpec}\n            onSubmit={handleSubmit}\n            submitError={submitError}\n            onCancel={handleCancel}\n          />\n        </CardBody>\n      </Card>\n    </PageSection>\n  );\n}\n\nexport default ContainerGroupAdd;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}