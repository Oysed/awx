{"ast":null,"code":"import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{i18n}from\"@lingui/core\";import React,{useState}from'react';import{useParams,Link}from'react-router-dom';import{Select,SelectOption,SelectGroup,SelectVariant,Chip}from'@patternfly/react-core';import ChipGroup from'components/ChipGroup';import{stringIsUUID}from'util/strings';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var JOB_URL_SEGMENT_MAP={job:'playbook',project_update:'project',system_job:'management',system:'system_job',inventory_update:'inventory',workflow_job:'workflow'};function WorkflowOutputNavigation(_ref){var relatedJobs=_ref.relatedJobs,parentRef=_ref.parentRef;var _useParams=useParams(),id=_useParams.id;var relevantResults=relatedJobs.filter(function(_ref2){var jobId=_ref2.job,summary_fields=_ref2.summary_fields;return jobId&&\"\".concat(jobId)!==id&&summary_fields.job.type!=='workflow_approval';});var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isOpen=_useState2[0],setIsOpen=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),filterBy=_useState4[0],setFilterBy=_useState4[1];var _useState5=useState(relevantResults),_useState6=_slicedToArray(_useState5,2),sortedJobs=_useState6[0],setSortedJobs=_useState6[1];var handleFilter=function handleFilter(v){if(filterBy===v){setSortedJobs(relevantResults);setFilterBy();}else{setFilterBy(v);setSortedJobs(relevantResults.filter(function(node){return node.summary_fields.job.status===v.toLowerCase()&&\"\".concat(node.job)!==id;}));}};var numSuccessJobs=relevantResults.filter(function(node){return node.summary_fields.job.status==='successful';}).length;var numFailedJobs=relevantResults.length-numSuccessJobs;return/*#__PURE__*/_jsx(Select,{variant:SelectVariant.typeaheadMulti,menuAppendTo:parentRef===null||parentRef===void 0?void 0:parentRef.current,onToggle:function onToggle(){setIsOpen(!isOpen);},selections:filterBy,onSelect:function onSelect(e,v){if(v!=='Failed'&&v!=='Successful')return;handleFilter(v);},isOpen:isOpen,isGrouped:true,hasInlineFilter:true,placeholderText:/*i18n*/i18n._(\"Workflow Job 1/{0}\",{0:relevantResults.length}),chipGroupComponent:/*#__PURE__*/_jsx(ChipGroup,{numChips:1,totalChips:1,children:/*#__PURE__*/_jsx(Chip,{onClick:function onClick(){return handleFilter(filterBy);},children:[filterBy]},filterBy)}),children:[/*#__PURE__*/_jsxs(SelectGroup,{label:/*i18n*/i18n._(\"Workflow Statuses\"),children:[/*#__PURE__*/_jsx(SelectOption,{description:/*i18n*/i18n._(\"Filter by failed jobs\"),value:/*i18n*/i18n._(\"Failed\"),itemCount:numFailedJobs},\"failed\"),/*#__PURE__*/_jsx(SelectOption,{description:/*i18n*/i18n._(\"Filter by successful jobs\"),value:/*i18n*/i18n._(\"Successful\"),itemCount:numSuccessJobs},\"successful\")]},\"status\"),/*#__PURE__*/_jsx(SelectGroup,{label:/*i18n*/i18n._(\"Workflow Nodes\"),children:sortedJobs===null||sortedJobs===void 0?void 0:sortedJobs.map(function(node){var _node$summary_fields$;return/*#__PURE__*/_jsx(SelectOption,{to:\"/jobs/\".concat(JOB_URL_SEGMENT_MAP[node.summary_fields.job.type],\"/\").concat((_node$summary_fields$=node.summary_fields.job)===null||_node$summary_fields$===void 0?void 0:_node$summary_fields$.id,\"/output\"),component:Link,value:node.summary_fields.job.name,children:stringIsUUID(node.identifier)?node.summary_fields.job.name:node.identifier},node.id);})},\"nodes\")]},\"\".concat(id));}export default WorkflowOutputNavigation;","map":{"version":3,"names":["React","useState","useParams","Link","Select","SelectOption","SelectGroup","SelectVariant","Chip","ChipGroup","stringIsUUID","jsx","_jsx","jsxs","_jsxs","JOB_URL_SEGMENT_MAP","job","project_update","system_job","system","inventory_update","workflow_job","WorkflowOutputNavigation","_ref","relatedJobs","parentRef","_useParams","id","relevantResults","filter","_ref2","jobId","summary_fields","concat","type","_useState","_useState2","_slicedToArray","isOpen","setIsOpen","_useState3","_useState4","filterBy","setFilterBy","_useState5","_useState6","sortedJobs","setSortedJobs","handleFilter","v","node","status","toLowerCase","numSuccessJobs","length","numFailedJobs","variant","typeaheadMulti","menuAppendTo","current","onToggle","selections","onSelect","e","isGrouped","hasInlineFilter","placeholderText","i18n","_","0","chipGroupComponent","numChips","totalChips","children","onClick","label","description","value","itemCount","map","_node$summary_fields$","to","component","name","identifier"],"sources":["/awx_devel/awx/ui/src/components/WorkflowOutputNavigation/WorkflowOutputNavigation.js"],"sourcesContent":["import React, { useState } from 'react';\nimport { useParams, Link } from 'react-router-dom';\nimport { t } from '@lingui/macro';\nimport {\n  Select,\n  SelectOption,\n  SelectGroup,\n  SelectVariant,\n  Chip,\n} from '@patternfly/react-core';\nimport ChipGroup from 'components/ChipGroup';\nimport { stringIsUUID } from 'util/strings';\n\nconst JOB_URL_SEGMENT_MAP = {\n  job: 'playbook',\n  project_update: 'project',\n  system_job: 'management',\n  system: 'system_job',\n  inventory_update: 'inventory',\n  workflow_job: 'workflow',\n};\n\nfunction WorkflowOutputNavigation({ relatedJobs, parentRef }) {\n  const { id } = useParams();\n\n  const relevantResults = relatedJobs.filter(\n    ({ job: jobId, summary_fields }) =>\n      jobId &&\n      `${jobId}` !== id &&\n      summary_fields.job.type !== 'workflow_approval'\n  );\n\n  const [isOpen, setIsOpen] = useState(false);\n  const [filterBy, setFilterBy] = useState();\n  const [sortedJobs, setSortedJobs] = useState(relevantResults);\n\n  const handleFilter = (v) => {\n    if (filterBy === v) {\n      setSortedJobs(relevantResults);\n      setFilterBy();\n    } else {\n      setFilterBy(v);\n      setSortedJobs(\n        relevantResults.filter(\n          (node) =>\n            node.summary_fields.job.status === v.toLowerCase() &&\n            `${node.job}` !== id\n        )\n      );\n    }\n  };\n\n  const numSuccessJobs = relevantResults.filter(\n    (node) => node.summary_fields.job.status === 'successful'\n  ).length;\n  const numFailedJobs = relevantResults.length - numSuccessJobs;\n\n  return (\n    <Select\n      key={`${id}`}\n      variant={SelectVariant.typeaheadMulti}\n      menuAppendTo={parentRef?.current}\n      onToggle={() => {\n        setIsOpen(!isOpen);\n      }}\n      selections={filterBy}\n      onSelect={(e, v) => {\n        if (v !== 'Failed' && v !== 'Successful') return;\n        handleFilter(v);\n      }}\n      isOpen={isOpen}\n      isGrouped\n      hasInlineFilter\n      placeholderText={t`Workflow Job 1/${relevantResults.length}`}\n      chipGroupComponent={\n        <ChipGroup numChips={1} totalChips={1}>\n          <Chip key={filterBy} onClick={() => handleFilter(filterBy)}>\n            {[filterBy]}\n          </Chip>\n        </ChipGroup>\n      }\n    >\n      {[\n        <SelectGroup label={t`Workflow Statuses`} key=\"status\">\n          <SelectOption\n            description={t`Filter by failed jobs`}\n            key=\"failed\"\n            value={t`Failed`}\n            itemCount={numFailedJobs}\n          />\n          <SelectOption\n            description={t`Filter by successful jobs`}\n            key=\"successful\"\n            value={t`Successful`}\n            itemCount={numSuccessJobs}\n          />\n        </SelectGroup>,\n        <SelectGroup label={t`Workflow Nodes`} key=\"nodes\">\n          {sortedJobs?.map((node) => (\n            <SelectOption\n              key={node.id}\n              to={`/jobs/${JOB_URL_SEGMENT_MAP[node.summary_fields.job.type]}/${\n                node.summary_fields.job?.id\n              }/output`}\n              component={Link}\n              value={node.summary_fields.job.name}\n            >\n              {stringIsUUID(node.identifier)\n                ? node.summary_fields.job.name\n                : node.identifier}\n            </SelectOption>\n          ))}\n        </SelectGroup>,\n      ]}\n    </Select>\n  );\n}\n\nexport default WorkflowOutputNavigation;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}