{"ast":null,"code":"import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{i18n}from\"@lingui/core\";import React,{useState}from'react';import{useField}from'formik';import{jsonToYaml,yamlToJson}from'util/yaml';import OtherPromptsStep from'./OtherPromptsStep';import StepName from'./StepName';import{jsx as _jsx}from\"react/jsx-runtime\";var STEP_ID='other';export var YAML_MODE='yaml';export var JSON_MODE='javascript';var getVariablesData=function getVariablesData(resource){if(resource!==null&&resource!==void 0&&resource.extra_data){return jsonToYaml(JSON.stringify(resource.extra_data));}if(resource!==null&&resource!==void 0&&resource.extra_vars&&(resource===null||resource===void 0?void 0:resource.extra_vars)!=='---'){return resource.extra_vars;}return'---';};var FIELD_NAMES=['job_type','limit','verbosity','diff_mode','job_tags','skip_tags','extra_vars','labels','timeout','job_slice_count','forks','labels'];export default function useOtherPromptsStep(launchConfig,resource,labels){var _useField=useField('extra_vars'),_useField2=_slicedToArray(_useField,1),variablesField=_useField2[0];var _useState=useState(null),_useState2=_slicedToArray(_useState,2),variablesMode=_useState2[0],setVariablesMode=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isTouched=_useState4[0],setIsTouched=_useState4[1];var handleModeChange=function handleModeChange(mode){setVariablesMode(mode);};var validateVariables=function validateVariables(){if(!isTouched){return false;}try{if(variablesMode===JSON_MODE){JSON.parse(variablesField.value);}else{yamlToJson(variablesField.value);}}catch(error){return true;}return false;};var hasError=launchConfig.ask_variables_on_launch?validateVariables():false;return{step:getStep(launchConfig,hasError,variablesMode,handleModeChange),initialValues:getInitialValues(launchConfig,resource,labels),isReady:true,contentError:null,hasError:hasError,setTouched:function setTouched(setFieldTouched){setIsTouched(true);FIELD_NAMES.forEach(function(fieldName){return setFieldTouched(fieldName,true,false);});},validate:function validate(){}};}function getStep(launchConfig,hasError,variablesMode,handleModeChange){if(!shouldShowPrompt(launchConfig)){return null;}return{id:STEP_ID,key:5,name:/*#__PURE__*/_jsx(StepName,{hasErrors:hasError,id:\"other-prompts-step\",children:/*i18n*/i18n._(\"Other prompts\")}),component:/*#__PURE__*/_jsx(OtherPromptsStep,{launchConfig:launchConfig,variablesMode:variablesMode,onVarModeChange:handleModeChange}),enableNext:true};}function shouldShowPrompt(launchConfig){return launchConfig.ask_job_type_on_launch||launchConfig.ask_limit_on_launch||launchConfig.ask_verbosity_on_launch||launchConfig.ask_tags_on_launch||launchConfig.ask_skip_tags_on_launch||launchConfig.ask_variables_on_launch||launchConfig.ask_scm_branch_on_launch||launchConfig.ask_diff_mode_on_launch||launchConfig.ask_labels_on_launch||launchConfig.ask_forks_on_launch||launchConfig.ask_job_slice_count_on_launch||launchConfig.ask_timeout_on_launch;}function getInitialValues(launchConfig,resource,labels){var initialValues={};if(!launchConfig){return initialValues;}if(launchConfig.ask_job_type_on_launch){initialValues.job_type=(resource===null||resource===void 0?void 0:resource.job_type)||'';}if(launchConfig.ask_limit_on_launch){initialValues.limit=(resource===null||resource===void 0?void 0:resource.limit)||null;}if(launchConfig.ask_verbosity_on_launch){initialValues.verbosity=(resource===null||resource===void 0?void 0:resource.verbosity)||0;}if(launchConfig.ask_tags_on_launch){initialValues.job_tags=(resource===null||resource===void 0?void 0:resource.job_tags)||'';}if(launchConfig.ask_skip_tags_on_launch){initialValues.skip_tags=(resource===null||resource===void 0?void 0:resource.skip_tags)||'';}if(launchConfig.ask_variables_on_launch){initialValues.extra_vars=getVariablesData(resource);}if(launchConfig.ask_scm_branch_on_launch){initialValues.scm_branch=(resource===null||resource===void 0?void 0:resource.scm_branch)||'';}if(launchConfig.ask_diff_mode_on_launch){initialValues.diff_mode=(resource===null||resource===void 0?void 0:resource.diff_mode)||false;}if(launchConfig.ask_forks_on_launch){initialValues.forks=(resource===null||resource===void 0?void 0:resource.forks)||0;}if(launchConfig.ask_job_slice_count_on_launch){initialValues.job_slice_count=(resource===null||resource===void 0?void 0:resource.job_slice_count)||1;}if(launchConfig.ask_timeout_on_launch){initialValues.timeout=(resource===null||resource===void 0?void 0:resource.timeout)||0;}if(launchConfig.ask_labels_on_launch){initialValues.labels=labels||[];}return initialValues;}","map":{"version":3,"names":["React","useState","useField","jsonToYaml","yamlToJson","OtherPromptsStep","StepName","jsx","_jsx","STEP_ID","YAML_MODE","JSON_MODE","getVariablesData","resource","extra_data","JSON","stringify","extra_vars","FIELD_NAMES","useOtherPromptsStep","launchConfig","labels","_useField","_useField2","_slicedToArray","variablesField","_useState","_useState2","variablesMode","setVariablesMode","_useState3","_useState4","isTouched","setIsTouched","handleModeChange","mode","validateVariables","parse","value","error","hasError","ask_variables_on_launch","step","getStep","initialValues","getInitialValues","isReady","contentError","setTouched","setFieldTouched","forEach","fieldName","validate","shouldShowPrompt","id","key","name","hasErrors","children","i18n","_","component","onVarModeChange","enableNext","ask_job_type_on_launch","ask_limit_on_launch","ask_verbosity_on_launch","ask_tags_on_launch","ask_skip_tags_on_launch","ask_scm_branch_on_launch","ask_diff_mode_on_launch","ask_labels_on_launch","ask_forks_on_launch","ask_job_slice_count_on_launch","ask_timeout_on_launch","job_type","limit","verbosity","job_tags","skip_tags","scm_branch","diff_mode","forks","job_slice_count","timeout"],"sources":["/awx_devel/awx/ui/src/components/LaunchPrompt/steps/useOtherPromptsStep.js"],"sourcesContent":["import React, { useState } from 'react';\nimport { t } from '@lingui/macro';\nimport { useField } from 'formik';\nimport { jsonToYaml, yamlToJson } from 'util/yaml';\nimport OtherPromptsStep from './OtherPromptsStep';\nimport StepName from './StepName';\n\nconst STEP_ID = 'other';\nexport const YAML_MODE = 'yaml';\nexport const JSON_MODE = 'javascript';\n\nconst getVariablesData = (resource) => {\n  if (resource?.extra_data) {\n    return jsonToYaml(JSON.stringify(resource.extra_data));\n  }\n  if (resource?.extra_vars && resource?.extra_vars !== '---') {\n    return resource.extra_vars;\n  }\n  return '---';\n};\n\nconst FIELD_NAMES = [\n  'job_type',\n  'limit',\n  'verbosity',\n  'diff_mode',\n  'job_tags',\n  'skip_tags',\n  'extra_vars',\n  'labels',\n  'timeout',\n  'job_slice_count',\n  'forks',\n  'labels',\n];\n\nexport default function useOtherPromptsStep(launchConfig, resource, labels) {\n  const [variablesField] = useField('extra_vars');\n  const [variablesMode, setVariablesMode] = useState(null);\n  const [isTouched, setIsTouched] = useState(false);\n\n  const handleModeChange = (mode) => {\n    setVariablesMode(mode);\n  };\n\n  const validateVariables = () => {\n    if (!isTouched) {\n      return false;\n    }\n    try {\n      if (variablesMode === JSON_MODE) {\n        JSON.parse(variablesField.value);\n      } else {\n        yamlToJson(variablesField.value);\n      }\n    } catch (error) {\n      return true;\n    }\n    return false;\n  };\n  const hasError = launchConfig.ask_variables_on_launch\n    ? validateVariables()\n    : false;\n\n  return {\n    step: getStep(launchConfig, hasError, variablesMode, handleModeChange),\n    initialValues: getInitialValues(launchConfig, resource, labels),\n    isReady: true,\n    contentError: null,\n    hasError,\n    setTouched: (setFieldTouched) => {\n      setIsTouched(true);\n      FIELD_NAMES.forEach((fieldName) =>\n        setFieldTouched(fieldName, true, false)\n      );\n    },\n    validate: () => {},\n  };\n}\n\nfunction getStep(launchConfig, hasError, variablesMode, handleModeChange) {\n  if (!shouldShowPrompt(launchConfig)) {\n    return null;\n  }\n  return {\n    id: STEP_ID,\n    key: 5,\n    name: (\n      <StepName hasErrors={hasError} id=\"other-prompts-step\">\n        {t`Other prompts`}\n      </StepName>\n    ),\n    component: (\n      <OtherPromptsStep\n        launchConfig={launchConfig}\n        variablesMode={variablesMode}\n        onVarModeChange={handleModeChange}\n      />\n    ),\n    enableNext: true,\n  };\n}\n\nfunction shouldShowPrompt(launchConfig) {\n  return (\n    launchConfig.ask_job_type_on_launch ||\n    launchConfig.ask_limit_on_launch ||\n    launchConfig.ask_verbosity_on_launch ||\n    launchConfig.ask_tags_on_launch ||\n    launchConfig.ask_skip_tags_on_launch ||\n    launchConfig.ask_variables_on_launch ||\n    launchConfig.ask_scm_branch_on_launch ||\n    launchConfig.ask_diff_mode_on_launch ||\n    launchConfig.ask_labels_on_launch ||\n    launchConfig.ask_forks_on_launch ||\n    launchConfig.ask_job_slice_count_on_launch ||\n    launchConfig.ask_timeout_on_launch\n  );\n}\n\nfunction getInitialValues(launchConfig, resource, labels) {\n  const initialValues = {};\n\n  if (!launchConfig) {\n    return initialValues;\n  }\n\n  if (launchConfig.ask_job_type_on_launch) {\n    initialValues.job_type = resource?.job_type || '';\n  }\n  if (launchConfig.ask_limit_on_launch) {\n    initialValues.limit = resource?.limit || null;\n  }\n  if (launchConfig.ask_verbosity_on_launch) {\n    initialValues.verbosity = resource?.verbosity || 0;\n  }\n  if (launchConfig.ask_tags_on_launch) {\n    initialValues.job_tags = resource?.job_tags || '';\n  }\n  if (launchConfig.ask_skip_tags_on_launch) {\n    initialValues.skip_tags = resource?.skip_tags || '';\n  }\n  if (launchConfig.ask_variables_on_launch) {\n    initialValues.extra_vars = getVariablesData(resource);\n  }\n  if (launchConfig.ask_scm_branch_on_launch) {\n    initialValues.scm_branch = resource?.scm_branch || '';\n  }\n  if (launchConfig.ask_diff_mode_on_launch) {\n    initialValues.diff_mode = resource?.diff_mode || false;\n  }\n  if (launchConfig.ask_forks_on_launch) {\n    initialValues.forks = resource?.forks || 0;\n  }\n  if (launchConfig.ask_job_slice_count_on_launch) {\n    initialValues.job_slice_count = resource?.job_slice_count || 1;\n  }\n  if (launchConfig.ask_timeout_on_launch) {\n    initialValues.timeout = resource?.timeout || 0;\n  }\n  if (launchConfig.ask_labels_on_launch) {\n    initialValues.labels = labels || [];\n  }\n  return initialValues;\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}