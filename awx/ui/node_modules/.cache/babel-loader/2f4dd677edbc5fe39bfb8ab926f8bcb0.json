{"ast":null,"code":"import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{i18n}from\"@lingui/core\";import React,{useEffect,useCallback,useState}from'react';import{useLocation}from'react-router-dom';import DataListToolbar from'components/DataListToolbar';import PaginatedTable,{HeaderRow,HeaderCell}from'components/PaginatedTable';import useRequest from'hooks/useRequest';import useSelected from'hooks/useSelected';import{getQSConfig,parseQueryString}from'util/qs';import{InventoriesAPI}from'api';import{Inventory}from'types';import AdHocCommands from'components/AdHocCommands/AdHocCommands';import AdvancedInventoryHostListItem from'./AdvancedInventoryHostListItem';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var QS_CONFIG=getQSConfig('host',{page:1,page_size:20,order_by:'name'});function AdvancedInventoryHostList(_ref){var inventory=_ref.inventory;var location=useLocation();var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isAdHocLaunchLoading=_useState2[0],setIsAdHocLaunchLoading=_useState2[1];var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var params,_yield$Promise$all,_yield$Promise$all2,_yield$Promise$all2$,results,hostCount,adHocOptions;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:params=parseQueryString(QS_CONFIG,location.search);_context.next=3;return Promise.all([InventoriesAPI.readHosts(inventory.id,params),InventoriesAPI.readAdHocOptions(inventory.id)]);case 3:_yield$Promise$all=_context.sent;_yield$Promise$all2=_slicedToArray(_yield$Promise$all,2);_yield$Promise$all2$=_yield$Promise$all2[0].data;results=_yield$Promise$all2$.results;hostCount=_yield$Promise$all2$.count;adHocOptions=_yield$Promise$all2[1];return _context.abrupt(\"return\",{hosts:results,count:hostCount,moduleOptions:adHocOptions.data.actions.GET.module_name.choices});case 10:case\"end\":return _context.stop();}}},_callee);})),[location.search,inventory.id]),{hosts:[],count:0,moduleOptions:[]}),_useRequest$result=_useRequest.result,hosts=_useRequest$result.hosts,count=_useRequest$result.count,moduleOptions=_useRequest$result.moduleOptions,contentError=_useRequest.error,isLoading=_useRequest.isLoading,fetchHosts=_useRequest.request;var _useSelected=useSelected(hosts),selected=_useSelected.selected,isAllSelected=_useSelected.isAllSelected,handleSelect=_useSelected.handleSelect,clearSelected=_useSelected.clearSelected,selectAll=_useSelected.selectAll;useEffect(function(){fetchHosts();},[fetchHosts]);var inventoryType=inventory.kind==='constructed'?'constructed_inventory':'smart_inventory';return/*#__PURE__*/_jsx(PaginatedTable,{contentError:contentError,hasContentLoading:isLoading||isAdHocLaunchLoading,items:hosts,itemCount:count,pluralizedItemName:/*i18n*/i18n._(\"Hosts\"),qsConfig:QS_CONFIG,clearSelected:clearSelected,toolbarSearchColumns:[{name:/*i18n*/i18n._(\"Name\"),key:'name__icontains',isDefault:true},{name:/*i18n*/i18n._(\"Created by (username)\"),key:'created_by__username'},{name:/*i18n*/i18n._(\"Modified by (username)\"),key:'modified_by__username'}],renderToolbar:function renderToolbar(props){var _inventory$summary_fi,_inventory$summary_fi2;return/*#__PURE__*/_jsx(DataListToolbar,_objectSpread(_objectSpread({},props),{},{isAllSelected:isAllSelected,onSelectAll:selectAll,qsConfig:QS_CONFIG,additionalControls:inventory!==null&&inventory!==void 0&&(_inventory$summary_fi=inventory.summary_fields)!==null&&_inventory$summary_fi!==void 0&&(_inventory$summary_fi2=_inventory$summary_fi.user_capabilities)!==null&&_inventory$summary_fi2!==void 0&&_inventory$summary_fi2.adhoc?[/*#__PURE__*/_jsx(AdHocCommands,{adHocItems:selected,hasListItems:count>0,onLaunchLoading:setIsAdHocLaunchLoading,moduleOptions:moduleOptions})]:[]}));},headerRow:/*#__PURE__*/_jsxs(HeaderRow,{qsConfig:QS_CONFIG,children:[/*#__PURE__*/_jsx(HeaderCell,{sortKey:\"name\",children:/*i18n*/i18n._(\"Name\")}),/*#__PURE__*/_jsx(HeaderCell,{children:/*i18n*/i18n._(\"Recent jobs\")}),/*#__PURE__*/_jsx(HeaderCell,{children:/*i18n*/i18n._(\"Inventory\")})]}),renderRow:function renderRow(host,index){return/*#__PURE__*/_jsx(AdvancedInventoryHostListItem,{host:host,inventoryType:inventoryType,detailUrl:\"/inventories/\".concat(inventoryType,\"/\").concat(inventory.id,\"/hosts/\").concat(host.id,\"/details\"),isSelected:selected.some(function(row){return row.id===host.id;}),onSelect:function onSelect(){return handleSelect(host);},rowIndex:index},host.id);}});}export default AdvancedInventoryHostList;","map":{"version":3,"names":["React","useEffect","useCallback","useState","useLocation","DataListToolbar","PaginatedTable","HeaderRow","HeaderCell","useRequest","useSelected","getQSConfig","parseQueryString","InventoriesAPI","Inventory","AdHocCommands","AdvancedInventoryHostListItem","jsx","_jsx","jsxs","_jsxs","QS_CONFIG","page","page_size","order_by","AdvancedInventoryHostList","_ref","inventory","location","_useState","_useState2","_slicedToArray","isAdHocLaunchLoading","setIsAdHocLaunchLoading","_useRequest","_asyncToGenerator","_regeneratorRuntime","mark","_callee","params","_yield$Promise$all","_yield$Promise$all2","_yield$Promise$all2$","results","hostCount","adHocOptions","wrap","_callee$","_context","prev","next","search","Promise","all","readHosts","id","readAdHocOptions","sent","data","count","abrupt","hosts","moduleOptions","actions","GET","module_name","choices","stop","_useRequest$result","result","contentError","error","isLoading","fetchHosts","request","_useSelected","selected","isAllSelected","handleSelect","clearSelected","selectAll","inventoryType","kind","hasContentLoading","items","itemCount","pluralizedItemName","i18n","_","qsConfig","toolbarSearchColumns","name","key","isDefault","renderToolbar","props","_inventory$summary_fi","_inventory$summary_fi2","_objectSpread","onSelectAll","additionalControls","summary_fields","user_capabilities","adhoc","adHocItems","hasListItems","onLaunchLoading","headerRow","children","sortKey","renderRow","host","index","detailUrl","concat","isSelected","some","row","onSelect","rowIndex"],"sources":["/awx_devel/awx/ui/src/screens/Inventory/AdvancedInventoryHosts/AdvancedInventoryHostList.js"],"sourcesContent":["import React, { useEffect, useCallback, useState } from 'react';\nimport { useLocation } from 'react-router-dom';\n\nimport { t } from '@lingui/macro';\nimport DataListToolbar from 'components/DataListToolbar';\nimport PaginatedTable, {\n  HeaderRow,\n  HeaderCell,\n} from 'components/PaginatedTable';\nimport useRequest from 'hooks/useRequest';\nimport useSelected from 'hooks/useSelected';\nimport { getQSConfig, parseQueryString } from 'util/qs';\nimport { InventoriesAPI } from 'api';\nimport { Inventory } from 'types';\nimport AdHocCommands from 'components/AdHocCommands/AdHocCommands';\nimport AdvancedInventoryHostListItem from './AdvancedInventoryHostListItem';\n\nconst QS_CONFIG = getQSConfig('host', {\n  page: 1,\n  page_size: 20,\n  order_by: 'name',\n});\n\nfunction AdvancedInventoryHostList({ inventory }) {\n  const location = useLocation();\n  const [isAdHocLaunchLoading, setIsAdHocLaunchLoading] = useState(false);\n  const {\n    result: { hosts, count, moduleOptions },\n    error: contentError,\n    isLoading,\n    request: fetchHosts,\n  } = useRequest(\n    useCallback(async () => {\n      const params = parseQueryString(QS_CONFIG, location.search);\n      const [\n        {\n          data: { results, count: hostCount },\n        },\n        adHocOptions,\n      ] = await Promise.all([\n        InventoriesAPI.readHosts(inventory.id, params),\n        InventoriesAPI.readAdHocOptions(inventory.id),\n      ]);\n\n      return {\n        hosts: results,\n        count: hostCount,\n        moduleOptions: adHocOptions.data.actions.GET.module_name.choices,\n      };\n    }, [location.search, inventory.id]),\n    {\n      hosts: [],\n      count: 0,\n      moduleOptions: [],\n    }\n  );\n\n  const { selected, isAllSelected, handleSelect, clearSelected, selectAll } =\n    useSelected(hosts);\n\n  useEffect(() => {\n    fetchHosts();\n  }, [fetchHosts]);\n  const inventoryType =\n    inventory.kind === 'constructed'\n      ? 'constructed_inventory'\n      : 'smart_inventory';\n  return (\n    <PaginatedTable\n      contentError={contentError}\n      hasContentLoading={isLoading || isAdHocLaunchLoading}\n      items={hosts}\n      itemCount={count}\n      pluralizedItemName={t`Hosts`}\n      qsConfig={QS_CONFIG}\n      clearSelected={clearSelected}\n      toolbarSearchColumns={[\n        {\n          name: t`Name`,\n          key: 'name__icontains',\n          isDefault: true,\n        },\n        {\n          name: t`Created by (username)`,\n          key: 'created_by__username',\n        },\n        {\n          name: t`Modified by (username)`,\n          key: 'modified_by__username',\n        },\n      ]}\n      renderToolbar={(props) => (\n        <DataListToolbar\n          {...props}\n          isAllSelected={isAllSelected}\n          onSelectAll={selectAll}\n          qsConfig={QS_CONFIG}\n          additionalControls={\n            inventory?.summary_fields?.user_capabilities?.adhoc\n              ? [\n                  <AdHocCommands\n                    adHocItems={selected}\n                    hasListItems={count > 0}\n                    onLaunchLoading={setIsAdHocLaunchLoading}\n                    moduleOptions={moduleOptions}\n                  />,\n                ]\n              : []\n          }\n        />\n      )}\n      headerRow={\n        <HeaderRow qsConfig={QS_CONFIG}>\n          <HeaderCell sortKey=\"name\">{t`Name`}</HeaderCell>\n          <HeaderCell>{t`Recent jobs`}</HeaderCell>\n          <HeaderCell>{t`Inventory`}</HeaderCell>\n        </HeaderRow>\n      }\n      renderRow={(host, index) => (\n        <AdvancedInventoryHostListItem\n          key={host.id}\n          host={host}\n          inventoryType={inventoryType}\n          detailUrl={`/inventories/${inventoryType}/${inventory.id}/hosts/${host.id}/details`}\n          isSelected={selected.some((row) => row.id === host.id)}\n          onSelect={() => handleSelect(host)}\n          rowIndex={index}\n        />\n      )}\n    />\n  );\n}\n\nAdvancedInventoryHostList.propTypes = {\n  inventory: Inventory.isRequired,\n};\n\nexport default AdvancedInventoryHostList;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}