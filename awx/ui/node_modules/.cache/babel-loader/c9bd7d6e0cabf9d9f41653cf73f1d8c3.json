{"ast":null,"code":"import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{i18n}from\"@lingui/core\";import React from'react';import{useField}from'formik';import CredentialsStep from'./CredentialsStep';import StepName from'./StepName';import credentialsValidator from'./credentialsValidator';import{jsx as _jsx}from\"react/jsx-runtime\";var STEP_ID='credentials';export default function useCredentialsStep(launchConfig,resource){var resourceDefaultCredentials=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];var allowCredentialsWithPasswords=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var _useField=useField('credentials'),_useField2=_slicedToArray(_useField,3),field=_useField2[0],meta=_useField2[1],helpers=_useField2[2];var formError=!resource||(resource===null||resource===void 0?void 0:resource.type)==='workflow_job_template'?false:meta.error;return{step:getStep(launchConfig,allowCredentialsWithPasswords,formError,resourceDefaultCredentials),initialValues:getInitialValues(launchConfig,resourceDefaultCredentials),isReady:true,contentError:null,hasError:launchConfig.ask_credential_on_launch&&formError,setTouched:function setTouched(setFieldTouched){setFieldTouched('credentials',true,false);},validate:function validate(){helpers.setError(credentialsValidator(allowCredentialsWithPasswords,field.value,resourceDefaultCredentials));}};}function getStep(launchConfig,allowCredentialsWithPasswords,formError,resourceDefaultCredentials){if(!launchConfig.ask_credential_on_launch){return null;}return{id:STEP_ID,key:4,name:/*#__PURE__*/_jsx(StepName,{hasErrors:formError,id:\"credentials-step\",children:/*i18n*/i18n._(\"Credentials\")}),component:/*#__PURE__*/_jsx(CredentialsStep,{allowCredentialsWithPasswords:allowCredentialsWithPasswords,defaultCredentials:resourceDefaultCredentials}),enableNext:true};}function getInitialValues(launchConfig,resourceDefaultCredentials){if(!launchConfig.ask_credential_on_launch){return{};}return{credentials:resourceDefaultCredentials};}","map":{"version":3,"names":["React","useField","CredentialsStep","StepName","credentialsValidator","jsx","_jsx","STEP_ID","useCredentialsStep","launchConfig","resource","resourceDefaultCredentials","arguments","length","undefined","allowCredentialsWithPasswords","_useField","_useField2","_slicedToArray","field","meta","helpers","formError","type","error","step","getStep","initialValues","getInitialValues","isReady","contentError","hasError","ask_credential_on_launch","setTouched","setFieldTouched","validate","setError","value","id","key","name","hasErrors","children","i18n","_","component","defaultCredentials","enableNext","credentials"],"sources":["/awx_devel/awx/ui/src/components/LaunchPrompt/steps/useCredentialsStep.js"],"sourcesContent":["import React from 'react';\nimport { t } from '@lingui/macro';\nimport { useField } from 'formik';\nimport CredentialsStep from './CredentialsStep';\nimport StepName from './StepName';\nimport credentialsValidator from './credentialsValidator';\n\nconst STEP_ID = 'credentials';\n\nexport default function useCredentialsStep(\n  launchConfig,\n  resource,\n  resourceDefaultCredentials = [],\n  allowCredentialsWithPasswords = false\n) {\n  const [field, meta, helpers] = useField('credentials');\n  const formError =\n    !resource || resource?.type === 'workflow_job_template'\n      ? false\n      : meta.error;\n  return {\n    step: getStep(\n      launchConfig,\n      allowCredentialsWithPasswords,\n      formError,\n      resourceDefaultCredentials\n    ),\n    initialValues: getInitialValues(launchConfig, resourceDefaultCredentials),\n    isReady: true,\n    contentError: null,\n    hasError: launchConfig.ask_credential_on_launch && formError,\n    setTouched: (setFieldTouched) => {\n      setFieldTouched('credentials', true, false);\n    },\n    validate: () => {\n      helpers.setError(\n        credentialsValidator(\n          allowCredentialsWithPasswords,\n          field.value,\n          resourceDefaultCredentials\n        )\n      );\n    },\n  };\n}\n\nfunction getStep(\n  launchConfig,\n\n  allowCredentialsWithPasswords,\n  formError,\n  resourceDefaultCredentials\n) {\n  if (!launchConfig.ask_credential_on_launch) {\n    return null;\n  }\n  return {\n    id: STEP_ID,\n    key: 4,\n    name: (\n      <StepName hasErrors={formError} id=\"credentials-step\">\n        {t`Credentials`}\n      </StepName>\n    ),\n    component: (\n      <CredentialsStep\n        allowCredentialsWithPasswords={allowCredentialsWithPasswords}\n        defaultCredentials={resourceDefaultCredentials}\n      />\n    ),\n    enableNext: true,\n  };\n}\n\nfunction getInitialValues(launchConfig, resourceDefaultCredentials) {\n  if (!launchConfig.ask_credential_on_launch) {\n    return {};\n  }\n\n  return {\n    credentials: resourceDefaultCredentials,\n  };\n}\n"],"mappings":"sIAAA,MAAO,CAAAA,KAAK,KAAM,OAAO,CAEzB,OAASC,QAAQ,KAAQ,QAAQ,CACjC,MAAO,CAAAC,eAAe,KAAM,mBAAmB,CAC/C,MAAO,CAAAC,QAAQ,KAAM,YAAY,CACjC,MAAO,CAAAC,oBAAoB,KAAM,wBAAwB,CAAC,OAAAC,GAAA,IAAAC,IAAA,yBAE1D,GAAM,CAAAC,OAAO,CAAG,aAAa,CAE7B,cAAe,SAAS,CAAAC,kBAAkBA,CACxCC,YAAY,CACZC,QAAQ,CAGR,IAFA,CAAAC,0BAA0B,CAAAC,SAAA,CAAAC,MAAA,IAAAD,SAAA,MAAAE,SAAA,CAAAF,SAAA,IAAG,EAAE,IAC/B,CAAAG,6BAA6B,CAAAH,SAAA,CAAAC,MAAA,IAAAD,SAAA,MAAAE,SAAA,CAAAF,SAAA,IAAG,KAAK,CAErC,IAAAI,SAAA,CAA+Bf,QAAQ,CAAC,aAAa,CAAC,CAAAgB,UAAA,CAAAC,cAAA,CAAAF,SAAA,IAA/CG,KAAK,CAAAF,UAAA,IAAEG,IAAI,CAAAH,UAAA,IAAEI,OAAO,CAAAJ,UAAA,IAC3B,GAAM,CAAAK,SAAS,CACb,CAACZ,QAAQ,EAAI,CAAAA,QAAQ,SAARA,QAAQ,iBAARA,QAAQ,CAAEa,IAAI,IAAK,uBAAuB,CACnD,KAAK,CACLH,IAAI,CAACI,KAAK,CAChB,MAAO,CACLC,IAAI,CAAEC,OAAO,CACXjB,YAAY,CACZM,6BAA6B,CAC7BO,SAAS,CACTX,0BACF,CAAC,CACDgB,aAAa,CAAEC,gBAAgB,CAACnB,YAAY,CAAEE,0BAA0B,CAAC,CACzEkB,OAAO,CAAE,IAAI,CACbC,YAAY,CAAE,IAAI,CAClBC,QAAQ,CAAEtB,YAAY,CAACuB,wBAAwB,EAAIV,SAAS,CAC5DW,UAAU,CAAE,SAAAA,WAACC,eAAe,CAAK,CAC/BA,eAAe,CAAC,aAAa,CAAE,IAAI,CAAE,KAAK,CAAC,CAC7C,CAAC,CACDC,QAAQ,CAAE,SAAAA,SAAA,CAAM,CACdd,OAAO,CAACe,QAAQ,CACdhC,oBAAoB,CAClBW,6BAA6B,CAC7BI,KAAK,CAACkB,KAAK,CACX1B,0BACF,CACF,CAAC,CACH,CACF,CAAC,CACH,CAEA,QAAS,CAAAe,OAAOA,CACdjB,YAAY,CAEZM,6BAA6B,CAC7BO,SAAS,CACTX,0BAA0B,CAC1B,CACA,GAAI,CAACF,YAAY,CAACuB,wBAAwB,CAAE,CAC1C,MAAO,KAAI,CACb,CACA,MAAO,CACLM,EAAE,CAAE/B,OAAO,CACXgC,GAAG,CAAE,CAAC,CACNC,IAAI,cACFlC,IAAA,CAACH,QAAQ,EAACsC,SAAS,CAAEnB,SAAU,CAACgB,EAAE,CAAC,kBAAkB,CAAAI,QAAA,SAClDC,IAAA,CAAAC,CAAA,cAAa,CAAC,CACP,CACX,CACDC,SAAS,cACPvC,IAAA,CAACJ,eAAe,EACda,6BAA6B,CAAEA,6BAA8B,CAC7D+B,kBAAkB,CAAEnC,0BAA2B,CAChD,CACF,CACDoC,UAAU,CAAE,IACd,CAAC,CACH,CAEA,QAAS,CAAAnB,gBAAgBA,CAACnB,YAAY,CAAEE,0BAA0B,CAAE,CAClE,GAAI,CAACF,YAAY,CAACuB,wBAAwB,CAAE,CAC1C,MAAO,CAAC,CAAC,CACX,CAEA,MAAO,CACLgB,WAAW,CAAErC,0BACf,CAAC,CACH"},"metadata":{},"sourceType":"module"}