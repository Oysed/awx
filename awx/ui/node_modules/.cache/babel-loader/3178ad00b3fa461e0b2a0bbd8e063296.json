{"ast":null,"code":"import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{i18n}from\"@lingui/core\";import React,{useCallback,useEffect}from'react';import{useHistory}from'react-router-dom';import{useField}from'formik';import{InstanceGroupsAPI}from'api';import{getSearchableKeys}from'components/PaginatedTable';import{getQSConfig,parseQueryString}from'util/qs';import useRequest from'hooks/useRequest';import useSelected from'hooks/useSelected';import OptionsList from'../../OptionsList';import ContentLoading from'../../ContentLoading';import ContentError from'../../ContentError';import{jsx as _jsx}from\"react/jsx-runtime\";var QS_CONFIG=getQSConfig('instance-groups',{page:1,page_size:5,order_by:'name'});function InstanceGroupsStep(){var _useField=useField('instance_groups'),_useField2=_slicedToArray(_useField,3),field=_useField2[0],helpers=_useField2[2];var _useSelected=useSelected([],field.value),selected=_useSelected.selected,handleSelect=_useSelected.handleSelect,setSelected=_useSelected.setSelected;var history=useHistory();var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _actionsResponse$data,_actionsResponse$data2;var params,_yield$Promise$all,_yield$Promise$all2,data,actionsResponse;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:params=parseQueryString(QS_CONFIG,history.location.search);_context.next=3;return Promise.all([InstanceGroupsAPI.read(params),InstanceGroupsAPI.readOptions()]);case 3:_yield$Promise$all=_context.sent;_yield$Promise$all2=_slicedToArray(_yield$Promise$all,2);data=_yield$Promise$all2[0].data;actionsResponse=_yield$Promise$all2[1];return _context.abrupt(\"return\",{instance_groups:data.results,count:data.count,relatedSearchableKeys:((actionsResponse===null||actionsResponse===void 0?void 0:(_actionsResponse$data=actionsResponse.data)===null||_actionsResponse$data===void 0?void 0:_actionsResponse$data.related_search_fields)||[]).map(function(val){return val.slice(0,-8);}),searchableKeys:getSearchableKeys((_actionsResponse$data2=actionsResponse.data.actions)===null||_actionsResponse$data2===void 0?void 0:_actionsResponse$data2.GET)});case 8:case\"end\":return _context.stop();}}},_callee);})),[history.location]),{instance_groups:[],count:0,relatedSearchableKeys:[],searchableKeys:[]}),_useRequest$result=_useRequest.result,instance_groups=_useRequest$result.instance_groups,count=_useRequest$result.count,relatedSearchableKeys=_useRequest$result.relatedSearchableKeys,searchableKeys=_useRequest$result.searchableKeys,fetchInstanceGroups=_useRequest.request,error=_useRequest.error,isLoading=_useRequest.isLoading;useEffect(function(){fetchInstanceGroups();},[fetchInstanceGroups]);useEffect(function(){helpers.setValue(selected);},[selected]);// eslint-disable-line react-hooks/exhaustive-deps\nif(isLoading){return/*#__PURE__*/_jsx(ContentLoading,{});}if(error){return/*#__PURE__*/_jsx(ContentError,{error:error});}return/*#__PURE__*/_jsx(\"div\",{\"data-cy\":\"instance-groups-prompt\",children:/*#__PURE__*/_jsx(OptionsList,{value:selected,options:instance_groups,optionCount:count,searchColumns:[{name:/*i18n*/i18n._(\"Name\"),key:'name__icontains',isDefault:true},{name:/*i18n*/i18n._(\"Credential Name\"),key:'credential__name__icontains'}],sortColumns:[{name:/*i18n*/i18n._(\"Name\"),key:'name'}],searchableKeys:searchableKeys,relatedSearchableKeys:relatedSearchableKeys,multiple:true,header:/*i18n*/i18n._(\"Instance Groups\"),name:\"instanceGroups\",qsConfig:QS_CONFIG,selectItem:handleSelect,deselectItem:handleSelect,sortSelectedItems:function sortSelectedItems(selectedItems){return setSelected(selectedItems);},isSelectedDraggable:true})});}export default InstanceGroupsStep;","map":{"version":3,"names":["React","useCallback","useEffect","useHistory","useField","InstanceGroupsAPI","getSearchableKeys","getQSConfig","parseQueryString","useRequest","useSelected","OptionsList","ContentLoading","ContentError","jsx","_jsx","QS_CONFIG","page","page_size","order_by","InstanceGroupsStep","_useField","_useField2","_slicedToArray","field","helpers","_useSelected","value","selected","handleSelect","setSelected","history","_useRequest","_asyncToGenerator","_regeneratorRuntime","mark","_callee","_actionsResponse$data","_actionsResponse$data2","params","_yield$Promise$all","_yield$Promise$all2","data","actionsResponse","wrap","_callee$","_context","prev","next","location","search","Promise","all","read","readOptions","sent","abrupt","instance_groups","results","count","relatedSearchableKeys","related_search_fields","map","val","slice","searchableKeys","actions","GET","stop","_useRequest$result","result","fetchInstanceGroups","request","error","isLoading","setValue","children","options","optionCount","searchColumns","name","i18n","_","key","isDefault","sortColumns","multiple","header","qsConfig","selectItem","deselectItem","sortSelectedItems","selectedItems","isSelectedDraggable"],"sources":["/awx_devel/awx/ui/src/components/LaunchPrompt/steps/InstanceGroupsStep.js"],"sourcesContent":["import React, { useCallback, useEffect } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport { t } from '@lingui/macro';\nimport { useField } from 'formik';\nimport { InstanceGroupsAPI } from 'api';\nimport { getSearchableKeys } from 'components/PaginatedTable';\nimport { getQSConfig, parseQueryString } from 'util/qs';\nimport useRequest from 'hooks/useRequest';\nimport useSelected from 'hooks/useSelected';\nimport OptionsList from '../../OptionsList';\nimport ContentLoading from '../../ContentLoading';\nimport ContentError from '../../ContentError';\n\nconst QS_CONFIG = getQSConfig('instance-groups', {\n  page: 1,\n  page_size: 5,\n  order_by: 'name',\n});\n\nfunction InstanceGroupsStep() {\n  const [field, , helpers] = useField('instance_groups');\n  const { selected, handleSelect, setSelected } = useSelected([], field.value);\n\n  const history = useHistory();\n\n  const {\n    result: { instance_groups, count, relatedSearchableKeys, searchableKeys },\n    request: fetchInstanceGroups,\n    error,\n    isLoading,\n  } = useRequest(\n    useCallback(async () => {\n      const params = parseQueryString(QS_CONFIG, history.location.search);\n      const [{ data }, actionsResponse] = await Promise.all([\n        InstanceGroupsAPI.read(params),\n        InstanceGroupsAPI.readOptions(),\n      ]);\n      return {\n        instance_groups: data.results,\n        count: data.count,\n        relatedSearchableKeys: (\n          actionsResponse?.data?.related_search_fields || []\n        ).map((val) => val.slice(0, -8)),\n        searchableKeys: getSearchableKeys(actionsResponse.data.actions?.GET),\n      };\n    }, [history.location]),\n    {\n      instance_groups: [],\n      count: 0,\n      relatedSearchableKeys: [],\n      searchableKeys: [],\n    }\n  );\n\n  useEffect(() => {\n    fetchInstanceGroups();\n  }, [fetchInstanceGroups]);\n\n  useEffect(() => {\n    helpers.setValue(selected);\n  }, [selected]); // eslint-disable-line react-hooks/exhaustive-deps\n\n  if (isLoading) {\n    return <ContentLoading />;\n  }\n  if (error) {\n    return <ContentError error={error} />;\n  }\n\n  return (\n    <div data-cy=\"instance-groups-prompt\">\n      <OptionsList\n        value={selected}\n        options={instance_groups}\n        optionCount={count}\n        searchColumns={[\n          {\n            name: t`Name`,\n            key: 'name__icontains',\n            isDefault: true,\n          },\n          {\n            name: t`Credential Name`,\n            key: 'credential__name__icontains',\n          },\n        ]}\n        sortColumns={[\n          {\n            name: t`Name`,\n            key: 'name',\n          },\n        ]}\n        searchableKeys={searchableKeys}\n        relatedSearchableKeys={relatedSearchableKeys}\n        multiple\n        header={t`Instance Groups`}\n        name=\"instanceGroups\"\n        qsConfig={QS_CONFIG}\n        selectItem={handleSelect}\n        deselectItem={handleSelect}\n        sortSelectedItems={(selectedItems) => setSelected(selectedItems)}\n        isSelectedDraggable\n      />\n    </div>\n  );\n}\n\nexport default InstanceGroupsStep;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}