{"ast":null,"code":"import _toConsumableArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useState,useEffect}from'react';import useWebsocket from'hooks/useWebsocket';export default function useWsProjects(initialProjects){var _useState=useState(initialProjects),_useState2=_slicedToArray(_useState,2),projects=_useState2[0],setProjects=_useState2[1];var lastMessage=useWebsocket({jobs:['status_changed'],control:['limit_reached_1']});useEffect(function(){setProjects(initialProjects);},[initialProjects]);useEffect(function(){if(!(lastMessage!==null&&lastMessage!==void 0&&lastMessage.unified_job_id)||lastMessage.type!=='project_update'){return;}var index=projects.findIndex(function(p){return p.id===lastMessage.project_id;});if(index===-1){return;}var project=projects[index];var updatedProject=_objectSpread(_objectSpread({},project),{},{summary_fields:_objectSpread(_objectSpread({},project.summary_fields),{},{current_job:{id:lastMessage.unified_job_id,status:lastMessage.status,finished:lastMessage.finished}})});if(lastMessage.finished){updatedProject.scm_revision=null;}setProjects([].concat(_toConsumableArray(projects.slice(0,index)),[updatedProject],_toConsumableArray(projects.slice(index+1))));},[lastMessage]);// eslint-disable-line react-hooks/exhaustive-deps\nreturn projects;}","map":{"version":3,"names":["useState","useEffect","useWebsocket","useWsProjects","initialProjects","_useState","_useState2","_slicedToArray","projects","setProjects","lastMessage","jobs","control","unified_job_id","type","index","findIndex","p","id","project_id","project","updatedProject","_objectSpread","summary_fields","current_job","status","finished","scm_revision","concat","_toConsumableArray","slice"],"sources":["/awx_devel/awx/ui/src/screens/Project/ProjectList/useWsProjects.js"],"sourcesContent":["import { useState, useEffect } from 'react';\nimport useWebsocket from 'hooks/useWebsocket';\n\nexport default function useWsProjects(initialProjects) {\n  const [projects, setProjects] = useState(initialProjects);\n  const lastMessage = useWebsocket({\n    jobs: ['status_changed'],\n    control: ['limit_reached_1'],\n  });\n\n  useEffect(() => {\n    setProjects(initialProjects);\n  }, [initialProjects]);\n\n  useEffect(() => {\n    if (!lastMessage?.unified_job_id || lastMessage.type !== 'project_update') {\n      return;\n    }\n    const index = projects.findIndex((p) => p.id === lastMessage.project_id);\n    if (index === -1) {\n      return;\n    }\n\n    const project = projects[index];\n    const updatedProject = {\n      ...project,\n      summary_fields: {\n        ...project.summary_fields,\n        current_job: {\n          id: lastMessage.unified_job_id,\n          status: lastMessage.status,\n          finished: lastMessage.finished,\n        },\n      },\n    };\n\n    if (lastMessage.finished) {\n      updatedProject.scm_revision = null;\n    }\n\n    setProjects([\n      ...projects.slice(0, index),\n      updatedProject,\n      ...projects.slice(index + 1),\n    ]);\n  }, [lastMessage]); // eslint-disable-line react-hooks/exhaustive-deps\n\n  return projects;\n}\n"],"mappings":"4TAAA,OAASA,QAAQ,CAAEC,SAAS,KAAQ,OAAO,CAC3C,MAAO,CAAAC,YAAY,KAAM,oBAAoB,CAE7C,cAAe,SAAS,CAAAC,aAAaA,CAACC,eAAe,CAAE,CACrD,IAAAC,SAAA,CAAgCL,QAAQ,CAACI,eAAe,CAAC,CAAAE,UAAA,CAAAC,cAAA,CAAAF,SAAA,IAAlDG,QAAQ,CAAAF,UAAA,IAAEG,WAAW,CAAAH,UAAA,IAC5B,GAAM,CAAAI,WAAW,CAAGR,YAAY,CAAC,CAC/BS,IAAI,CAAE,CAAC,gBAAgB,CAAC,CACxBC,OAAO,CAAE,CAAC,iBAAiB,CAC7B,CAAC,CAAC,CAEFX,SAAS,CAAC,UAAM,CACdQ,WAAW,CAACL,eAAe,CAAC,CAC9B,CAAC,CAAE,CAACA,eAAe,CAAC,CAAC,CAErBH,SAAS,CAAC,UAAM,CACd,GAAI,EAACS,WAAW,SAAXA,WAAW,WAAXA,WAAW,CAAEG,cAAc,GAAIH,WAAW,CAACI,IAAI,GAAK,gBAAgB,CAAE,CACzE,OACF,CACA,GAAM,CAAAC,KAAK,CAAGP,QAAQ,CAACQ,SAAS,CAAC,SAACC,CAAC,QAAK,CAAAA,CAAC,CAACC,EAAE,GAAKR,WAAW,CAACS,UAAU,GAAC,CACxE,GAAIJ,KAAK,GAAK,CAAC,CAAC,CAAE,CAChB,OACF,CAEA,GAAM,CAAAK,OAAO,CAAGZ,QAAQ,CAACO,KAAK,CAAC,CAC/B,GAAM,CAAAM,cAAc,CAAAC,aAAA,CAAAA,aAAA,IACfF,OAAO,MACVG,cAAc,CAAAD,aAAA,CAAAA,aAAA,IACTF,OAAO,CAACG,cAAc,MACzBC,WAAW,CAAE,CACXN,EAAE,CAAER,WAAW,CAACG,cAAc,CAC9BY,MAAM,CAAEf,WAAW,CAACe,MAAM,CAC1BC,QAAQ,CAAEhB,WAAW,CAACgB,QACxB,CAAC,EACF,EACF,CAED,GAAIhB,WAAW,CAACgB,QAAQ,CAAE,CACxBL,cAAc,CAACM,YAAY,CAAG,IAAI,CACpC,CAEAlB,WAAW,IAAAmB,MAAA,CAAAC,kBAAA,CACNrB,QAAQ,CAACsB,KAAK,CAAC,CAAC,CAAEf,KAAK,CAAC,GAC3BM,cAAc,EAAAQ,kBAAA,CACXrB,QAAQ,CAACsB,KAAK,CAACf,KAAK,CAAG,CAAC,CAAC,EAC7B,CAAC,CACJ,CAAC,CAAE,CAACL,WAAW,CAAC,CAAC,CAAE;AAEnB,MAAO,CAAAF,QAAQ,CACjB"},"metadata":{},"sourceType":"module"}