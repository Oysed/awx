{"ast":null,"code":"import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _styled from\"styled-components\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{i18n}from\"@lingui/core\";import React,{useState,useEffect,useCallback}from'react';import{Switch,Tooltip}from'@patternfly/react-core';import useRequest from'hooks/useRequest';import{SchedulesAPI}from'api';import AlertModal from'../../AlertModal';import ErrorDetail from'../../ErrorDetail';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var _StyledSwitch=_styled(Switch).withConfig({displayName:\"ScheduleToggle___StyledSwitch\",componentId:\"sc-1htabee-0\"})([\"display:inline-flex;\"]);function ScheduleToggle(_ref){var schedule=_ref.schedule,onToggle=_ref.onToggle,className=_ref.className,isDisabled=_ref.isDisabled;var _useState=useState(schedule.enabled),_useState2=_slicedToArray(_useState,2),isEnabled=_useState2[0],setIsEnabled=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),showError=_useState4[0],setShowError=_useState4[1];var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return SchedulesAPI.update(schedule.id,{enabled:!isEnabled});case 2:return _context.abrupt(\"return\",!isEnabled);case 3:case\"end\":return _context.stop();}}},_callee);})),[schedule,isEnabled]),schedule.enabled),result=_useRequest.result,isLoading=_useRequest.isLoading,error=_useRequest.error,toggleSchedule=_useRequest.request;useEffect(function(){if(result!==isEnabled){setIsEnabled(result);if(onToggle){onToggle(result);}}},[result,isEnabled,onToggle]);useEffect(function(){if(error){setShowError(true);}},[error]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Tooltip,{content:schedule.enabled?/*i18n*/i18n._(\"Schedule is active\"):/*i18n*/i18n._(\"Schedule is inactive\"),position:\"top\",children:/*#__PURE__*/_jsx(_StyledSwitch,{className:className,id:\"schedule-\".concat(schedule.id,\"-toggle\"),label:/*i18n*/i18n._(\"On\"),labelOff:/*i18n*/i18n._(\"Off\"),isChecked:isEnabled,isDisabled:isLoading||!schedule.summary_fields.user_capabilities.edit||isDisabled,onChange:toggleSchedule,\"aria-label\":/*i18n*/i18n._(\"Toggle schedule\"),ouiaId:\"schedule-\".concat(schedule.id,\"-toggle\")})}),showError&&error&&!isLoading&&/*#__PURE__*/_jsxs(AlertModal,{variant:\"error\",title:/*i18n*/i18n._(\"Error!\"),isOpen:error&&!isLoading,onClose:function onClose(){return setShowError(false);},children:[/*i18n*/i18n._(\"Failed to toggle schedule.\"),/*#__PURE__*/_jsx(ErrorDetail,{error:error})]})]});}export default ScheduleToggle;","map":{"version":3,"names":["React","useState","useEffect","useCallback","Switch","Tooltip","useRequest","SchedulesAPI","AlertModal","ErrorDetail","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","_StyledSwitch","_styled","withConfig","displayName","componentId","ScheduleToggle","_ref","schedule","onToggle","className","isDisabled","_useState","enabled","_useState2","_slicedToArray","isEnabled","setIsEnabled","_useState3","_useState4","showError","setShowError","_useRequest","_asyncToGenerator","_regeneratorRuntime","mark","_callee","wrap","_callee$","_context","prev","next","update","id","abrupt","stop","result","isLoading","error","toggleSchedule","request","children","content","i18n","_","position","concat","label","labelOff","isChecked","summary_fields","user_capabilities","edit","onChange","ouiaId","variant","title","isOpen","onClose"],"sources":["/awx_devel/awx/ui/src/components/Schedule/ScheduleToggle/ScheduleToggle.js"],"sourcesContent":["import 'styled-components/macro';\nimport React, { useState, useEffect, useCallback } from 'react';\n\nimport { t } from '@lingui/macro';\nimport { Switch, Tooltip } from '@patternfly/react-core';\nimport useRequest from 'hooks/useRequest';\nimport { SchedulesAPI } from 'api';\nimport AlertModal from '../../AlertModal';\nimport ErrorDetail from '../../ErrorDetail';\n\nfunction ScheduleToggle({ schedule, onToggle, className, isDisabled }) {\n  const [isEnabled, setIsEnabled] = useState(schedule.enabled);\n  const [showError, setShowError] = useState(false);\n\n  const {\n    result,\n    isLoading,\n    error,\n    request: toggleSchedule,\n  } = useRequest(\n    useCallback(async () => {\n      await SchedulesAPI.update(schedule.id, {\n        enabled: !isEnabled,\n      });\n      return !isEnabled;\n    }, [schedule, isEnabled]),\n    schedule.enabled\n  );\n\n  useEffect(() => {\n    if (result !== isEnabled) {\n      setIsEnabled(result);\n      if (onToggle) {\n        onToggle(result);\n      }\n    }\n  }, [result, isEnabled, onToggle]);\n\n  useEffect(() => {\n    if (error) {\n      setShowError(true);\n    }\n  }, [error]);\n\n  return (\n    <>\n      <Tooltip\n        content={\n          schedule.enabled ? t`Schedule is active` : t`Schedule is inactive`\n        }\n        position=\"top\"\n      >\n        <Switch\n          className={className}\n          css=\"display: inline-flex;\"\n          id={`schedule-${schedule.id}-toggle`}\n          label={t`On`}\n          labelOff={t`Off`}\n          isChecked={isEnabled}\n          isDisabled={\n            isLoading ||\n            !schedule.summary_fields.user_capabilities.edit ||\n            isDisabled\n          }\n          onChange={toggleSchedule}\n          aria-label={t`Toggle schedule`}\n          ouiaId={`schedule-${schedule.id}-toggle`}\n        />\n      </Tooltip>\n      {showError && error && !isLoading && (\n        <AlertModal\n          variant=\"error\"\n          title={t`Error!`}\n          isOpen={error && !isLoading}\n          onClose={() => setShowError(false)}\n        >\n          {t`Failed to toggle schedule.`}\n          <ErrorDetail error={error} />\n        </AlertModal>\n      )}\n    </>\n  );\n}\n\nexport default ScheduleToggle;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}