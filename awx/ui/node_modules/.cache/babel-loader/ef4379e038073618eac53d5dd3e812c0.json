{"ast":null,"code":"import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _taggedTemplateLiteral from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral.js\";var _templateObject;import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{i18n}from\"@lingui/core\";import React,{useCallback,useEffect}from'react';import{useHistory}from'react-router-dom';import{useField}from'formik';import styled from'styled-components';import{Alert}from'@patternfly/react-core';import{InventoriesAPI}from'api';import{getSearchableKeys}from'components/PaginatedTable';import{getQSConfig,parseQueryString}from'util/qs';import useRequest from'hooks/useRequest';import OptionsList from'../../OptionsList';import ContentLoading from'../../ContentLoading';import ContentError from'../../ContentError';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var InventoryErrorAlert=styled(Alert)(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  margin-bottom: 20px;\\n\"])));var QS_CONFIG=getQSConfig('inventory',{page:1,page_size:5,order_by:'name',role_level:'use_role'});function InventoryStep(_ref){var _ref$warningMessage=_ref.warningMessage,warningMessage=_ref$warningMessage===void 0?null:_ref$warningMessage;var _useField=useField('inventory'),_useField2=_slicedToArray(_useField,3),field=_useField2[0],meta=_useField2[1],helpers=_useField2[2];var history=useHistory();var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _actionsResponse$data,_actionsResponse$data2;var params,_yield$Promise$all,_yield$Promise$all2,data,actionsResponse;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:params=parseQueryString(QS_CONFIG,history.location.search);_context.next=3;return Promise.all([InventoriesAPI.read(params),InventoriesAPI.readOptions()]);case 3:_yield$Promise$all=_context.sent;_yield$Promise$all2=_slicedToArray(_yield$Promise$all,2);data=_yield$Promise$all2[0].data;actionsResponse=_yield$Promise$all2[1];return _context.abrupt(\"return\",{inventories:data.results,count:data.count,relatedSearchableKeys:((actionsResponse===null||actionsResponse===void 0?void 0:(_actionsResponse$data=actionsResponse.data)===null||_actionsResponse$data===void 0?void 0:_actionsResponse$data.related_search_fields)||[]).map(function(val){return val.slice(0,-8);}),searchableKeys:getSearchableKeys((_actionsResponse$data2=actionsResponse.data.actions)===null||_actionsResponse$data2===void 0?void 0:_actionsResponse$data2.GET)});case 8:case\"end\":return _context.stop();}}},_callee);})),[history.location]),{count:0,inventories:[],relatedSearchableKeys:[],searchableKeys:[]}),isLoading=_useRequest.isLoading,error=_useRequest.error,_useRequest$result=_useRequest.result,inventories=_useRequest$result.inventories,count=_useRequest$result.count,relatedSearchableKeys=_useRequest$result.relatedSearchableKeys,searchableKeys=_useRequest$result.searchableKeys,fetchInventories=_useRequest.request;useEffect(function(){fetchInventories();},[fetchInventories]);if(isLoading){return/*#__PURE__*/_jsx(ContentLoading,{});}if(error){return/*#__PURE__*/_jsx(ContentError,{error:error});}return/*#__PURE__*/_jsxs(\"div\",{\"data-cy\":\"inventory-prompt\",children:[meta.touched&&meta.error&&/*#__PURE__*/_jsx(InventoryErrorAlert,{variant:\"danger\",isInline:true,title:meta.error}),warningMessage,/*#__PURE__*/_jsx(OptionsList,{value:field.value?[field.value]:[],options:inventories,optionCount:count,searchColumns:[{name:/*i18n*/i18n._(\"Name\"),key:'name__icontains',isDefault:true},{name:/*i18n*/i18n._(\"Created By (Username)\"),key:'created_by__username__icontains'},{name:/*i18n*/i18n._(\"Modified By (Username)\"),key:'modified_by__username__icontains'}],sortColumns:[{name:/*i18n*/i18n._(\"Name\"),key:'name'}],searchableKeys:searchableKeys,relatedSearchableKeys:relatedSearchableKeys,header:/*i18n*/i18n._(\"Inventory\"),name:\"inventory\",qsConfig:QS_CONFIG,readOnly:true,selectItem:helpers.setValue,deselectItem:function deselectItem(){return field.onChange(null);}})]});}export default InventoryStep;","map":{"version":3,"names":["React","useCallback","useEffect","useHistory","useField","styled","Alert","InventoriesAPI","getSearchableKeys","getQSConfig","parseQueryString","useRequest","OptionsList","ContentLoading","ContentError","jsx","_jsx","jsxs","_jsxs","InventoryErrorAlert","_templateObject","_taggedTemplateLiteral","QS_CONFIG","page","page_size","order_by","role_level","InventoryStep","_ref","_ref$warningMessage","warningMessage","_useField","_useField2","_slicedToArray","field","meta","helpers","history","_useRequest","_asyncToGenerator","_regeneratorRuntime","mark","_callee","_actionsResponse$data","_actionsResponse$data2","params","_yield$Promise$all","_yield$Promise$all2","data","actionsResponse","wrap","_callee$","_context","prev","next","location","search","Promise","all","read","readOptions","sent","abrupt","inventories","results","count","relatedSearchableKeys","related_search_fields","map","val","slice","searchableKeys","actions","GET","stop","isLoading","error","_useRequest$result","result","fetchInventories","request","children","touched","variant","isInline","title","value","options","optionCount","searchColumns","name","i18n","_","key","isDefault","sortColumns","header","qsConfig","readOnly","selectItem","setValue","deselectItem","onChange"],"sources":["/awx_devel/awx/ui/src/components/LaunchPrompt/steps/InventoryStep.js"],"sourcesContent":["import React, { useCallback, useEffect } from 'react';\nimport { useHistory } from 'react-router-dom';\n\nimport { t } from '@lingui/macro';\nimport { useField } from 'formik';\nimport styled from 'styled-components';\nimport { Alert } from '@patternfly/react-core';\nimport { InventoriesAPI } from 'api';\nimport { getSearchableKeys } from 'components/PaginatedTable';\nimport { getQSConfig, parseQueryString } from 'util/qs';\nimport useRequest from 'hooks/useRequest';\nimport OptionsList from '../../OptionsList';\nimport ContentLoading from '../../ContentLoading';\nimport ContentError from '../../ContentError';\n\nconst InventoryErrorAlert = styled(Alert)`\n  margin-bottom: 20px;\n`;\n\nconst QS_CONFIG = getQSConfig('inventory', {\n  page: 1,\n  page_size: 5,\n  order_by: 'name',\n  role_level: 'use_role',\n});\n\nfunction InventoryStep({ warningMessage = null }) {\n  const [field, meta, helpers] = useField('inventory');\n\n  const history = useHistory();\n\n  const {\n    isLoading,\n    error,\n    result: { inventories, count, relatedSearchableKeys, searchableKeys },\n    request: fetchInventories,\n  } = useRequest(\n    useCallback(async () => {\n      const params = parseQueryString(QS_CONFIG, history.location.search);\n      const [{ data }, actionsResponse] = await Promise.all([\n        InventoriesAPI.read(params),\n        InventoriesAPI.readOptions(),\n      ]);\n      return {\n        inventories: data.results,\n        count: data.count,\n        relatedSearchableKeys: (\n          actionsResponse?.data?.related_search_fields || []\n        ).map((val) => val.slice(0, -8)),\n        searchableKeys: getSearchableKeys(actionsResponse.data.actions?.GET),\n      };\n    }, [history.location]),\n    {\n      count: 0,\n      inventories: [],\n      relatedSearchableKeys: [],\n      searchableKeys: [],\n    }\n  );\n\n  useEffect(() => {\n    fetchInventories();\n  }, [fetchInventories]);\n\n  if (isLoading) {\n    return <ContentLoading />;\n  }\n  if (error) {\n    return <ContentError error={error} />;\n  }\n\n  return (\n    <div data-cy=\"inventory-prompt\">\n      {meta.touched && meta.error && (\n        <InventoryErrorAlert variant=\"danger\" isInline title={meta.error} />\n      )}\n      {warningMessage}\n      <OptionsList\n        value={field.value ? [field.value] : []}\n        options={inventories}\n        optionCount={count}\n        searchColumns={[\n          {\n            name: t`Name`,\n            key: 'name__icontains',\n            isDefault: true,\n          },\n          {\n            name: t`Created By (Username)`,\n            key: 'created_by__username__icontains',\n          },\n          {\n            name: t`Modified By (Username)`,\n            key: 'modified_by__username__icontains',\n          },\n        ]}\n        sortColumns={[\n          {\n            name: t`Name`,\n            key: 'name',\n          },\n        ]}\n        searchableKeys={searchableKeys}\n        relatedSearchableKeys={relatedSearchableKeys}\n        header={t`Inventory`}\n        name=\"inventory\"\n        qsConfig={QS_CONFIG}\n        readOnly\n        selectItem={helpers.setValue}\n        deselectItem={() => field.onChange(null)}\n      />\n    </div>\n  );\n}\n\nexport default InventoryStep;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}