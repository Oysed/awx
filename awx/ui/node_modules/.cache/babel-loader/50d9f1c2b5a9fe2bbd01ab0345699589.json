{"ast":null,"code":"import _toConsumableArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useState,useEffect}from'react';import useWebsocket from'hooks/useWebsocket';export default function useWsInventorySources(initialSources){var _useState=useState(initialSources),_useState2=_slicedToArray(_useState,2),sources=_useState2[0],setSources=_useState2[1];var lastMessage=useWebsocket({jobs:['status_changed'],control:['limit_reached_1']});useEffect(function(){setSources(initialSources);},[initialSources]);useEffect(function(){if(!(lastMessage!==null&&lastMessage!==void 0&&lastMessage.unified_job_id)||!(lastMessage!==null&&lastMessage!==void 0&&lastMessage.inventory_source_id)){return;}var sourceId=lastMessage.inventory_source_id;var index=sources.findIndex(function(s){return s.id===sourceId;});if(index>-1){setSources(updateSource(sources,index,lastMessage));}},[lastMessage]// eslint-disable-line react-hooks/exhaustive-deps\n);return sources;}function updateSource(sources,index,message){var source=_objectSpread(_objectSpread({},sources[index]),{},{status:message.status,last_updated:message.finished,summary_fields:_objectSpread(_objectSpread({},sources[index].summary_fields),{},{current_job:{id:message.unified_job_id,status:message.status,finished:message.finished}})});return[].concat(_toConsumableArray(sources.slice(0,index)),[source],_toConsumableArray(sources.slice(index+1)));}","map":{"version":3,"names":["useState","useEffect","useWebsocket","useWsInventorySources","initialSources","_useState","_useState2","_slicedToArray","sources","setSources","lastMessage","jobs","control","unified_job_id","inventory_source_id","sourceId","index","findIndex","s","id","updateSource","message","source","_objectSpread","status","last_updated","finished","summary_fields","current_job","concat","_toConsumableArray","slice"],"sources":["/awx_devel/awx/ui/src/screens/Inventory/InventorySources/useWsInventorySources.js"],"sourcesContent":["import { useState, useEffect } from 'react';\nimport useWebsocket from 'hooks/useWebsocket';\n\nexport default function useWsInventorySources(initialSources) {\n  const [sources, setSources] = useState(initialSources);\n  const lastMessage = useWebsocket({\n    jobs: ['status_changed'],\n    control: ['limit_reached_1'],\n  });\n\n  useEffect(() => {\n    setSources(initialSources);\n  }, [initialSources]);\n\n  useEffect(\n    () => {\n      if (!lastMessage?.unified_job_id || !lastMessage?.inventory_source_id) {\n        return;\n      }\n\n      const sourceId = lastMessage.inventory_source_id;\n      const index = sources.findIndex((s) => s.id === sourceId);\n      if (index > -1) {\n        setSources(updateSource(sources, index, lastMessage));\n      }\n    },\n    [lastMessage] // eslint-disable-line react-hooks/exhaustive-deps\n  );\n\n  return sources;\n}\n\nfunction updateSource(sources, index, message) {\n  const source = {\n    ...sources[index],\n    status: message.status,\n    last_updated: message.finished,\n    summary_fields: {\n      ...sources[index].summary_fields,\n      current_job: {\n        id: message.unified_job_id,\n        status: message.status,\n        finished: message.finished,\n      },\n    },\n  };\n  return [...sources.slice(0, index), source, ...sources.slice(index + 1)];\n}\n"],"mappings":"4TAAA,OAASA,QAAQ,CAAEC,SAAS,KAAQ,OAAO,CAC3C,MAAO,CAAAC,YAAY,KAAM,oBAAoB,CAE7C,cAAe,SAAS,CAAAC,qBAAqBA,CAACC,cAAc,CAAE,CAC5D,IAAAC,SAAA,CAA8BL,QAAQ,CAACI,cAAc,CAAC,CAAAE,UAAA,CAAAC,cAAA,CAAAF,SAAA,IAA/CG,OAAO,CAAAF,UAAA,IAAEG,UAAU,CAAAH,UAAA,IAC1B,GAAM,CAAAI,WAAW,CAAGR,YAAY,CAAC,CAC/BS,IAAI,CAAE,CAAC,gBAAgB,CAAC,CACxBC,OAAO,CAAE,CAAC,iBAAiB,CAC7B,CAAC,CAAC,CAEFX,SAAS,CAAC,UAAM,CACdQ,UAAU,CAACL,cAAc,CAAC,CAC5B,CAAC,CAAE,CAACA,cAAc,CAAC,CAAC,CAEpBH,SAAS,CACP,UAAM,CACJ,GAAI,EAACS,WAAW,SAAXA,WAAW,WAAXA,WAAW,CAAEG,cAAc,GAAI,EAACH,WAAW,SAAXA,WAAW,WAAXA,WAAW,CAAEI,mBAAmB,EAAE,CACrE,OACF,CAEA,GAAM,CAAAC,QAAQ,CAAGL,WAAW,CAACI,mBAAmB,CAChD,GAAM,CAAAE,KAAK,CAAGR,OAAO,CAACS,SAAS,CAAC,SAACC,CAAC,QAAK,CAAAA,CAAC,CAACC,EAAE,GAAKJ,QAAQ,GAAC,CACzD,GAAIC,KAAK,CAAG,CAAC,CAAC,CAAE,CACdP,UAAU,CAACW,YAAY,CAACZ,OAAO,CAAEQ,KAAK,CAAEN,WAAW,CAAC,CAAC,CACvD,CACF,CAAC,CACD,CAACA,WAAW,CAAE;AAChB,CAAC,CAED,MAAO,CAAAF,OAAO,CAChB,CAEA,QAAS,CAAAY,YAAYA,CAACZ,OAAO,CAAEQ,KAAK,CAAEK,OAAO,CAAE,CAC7C,GAAM,CAAAC,MAAM,CAAAC,aAAA,CAAAA,aAAA,IACPf,OAAO,CAACQ,KAAK,CAAC,MACjBQ,MAAM,CAAEH,OAAO,CAACG,MAAM,CACtBC,YAAY,CAAEJ,OAAO,CAACK,QAAQ,CAC9BC,cAAc,CAAAJ,aAAA,CAAAA,aAAA,IACTf,OAAO,CAACQ,KAAK,CAAC,CAACW,cAAc,MAChCC,WAAW,CAAE,CACXT,EAAE,CAAEE,OAAO,CAACR,cAAc,CAC1BW,MAAM,CAAEH,OAAO,CAACG,MAAM,CACtBE,QAAQ,CAAEL,OAAO,CAACK,QACpB,CAAC,EACF,EACF,CACD,SAAAG,MAAA,CAAAC,kBAAA,CAAWtB,OAAO,CAACuB,KAAK,CAAC,CAAC,CAAEf,KAAK,CAAC,GAAEM,MAAM,EAAAQ,kBAAA,CAAKtB,OAAO,CAACuB,KAAK,CAACf,KAAK,CAAG,CAAC,CAAC,GACzE"},"metadata":{},"sourceType":"module"}