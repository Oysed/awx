{"ast":null,"code":"import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _objectWithoutProperties from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";var _excluded=[\"initialPodSpec\",\"instanceGroup\",\"onSubmit\",\"onCancel\",\"submitError\"];import{i18n}from\"@lingui/core\";import React,{useCallback}from'react';import{Formik,useField,useFormikContext}from'formik';import{Form,FormGroup}from'@patternfly/react-core';import{jsonToYaml}from'util/yaml';import FormField,{FormSubmitError,CheckboxField}from'components/FormField';import FormActionGroup from'components/FormActionGroup';import{required,minMaxValue}from'util/validators';import{FormColumnLayout,FormFullWidthLayout,FormCheckboxLayout,SubFormLayout}from'components/FormLayout';import CredentialLookup from'components/Lookup/CredentialLookup';import{VariablesField}from'components/CodeEditor';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function ContainerGroupFormFields(_ref){var instanceGroup=_ref.instanceGroup;var _useFormikContext=useFormikContext(),setFieldValue=_useFormikContext.setFieldValue,setFieldTouched=_useFormikContext.setFieldTouched;var _useField=useField('credential'),_useField2=_slicedToArray(_useField,3),credentialField=_useField2[0],credentialMeta=_useField2[1],credentialHelpers=_useField2[2];var _useField3=useField('override'),_useField4=_slicedToArray(_useField3,1),overrideField=_useField4[0];var handleCredentialUpdate=useCallback(function(value){setFieldValue('credential',value);setFieldTouched('credential',true,false);},[setFieldValue,setFieldTouched]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(FormField,{name:\"name\",id:\"container-group-name\",label:/*i18n*/i18n._(\"Name\"),type:\"text\",validate:required(null),isRequired:true}),/*#__PURE__*/_jsx(CredentialLookup,{label:/*i18n*/i18n._(\"Credential\"),credentialTypeKind:\"kubernetes\",helperTextInvalid:credentialMeta.error,isValid:!credentialMeta.touched||!credentialMeta.error,onBlur:function onBlur(){return credentialHelpers.setTouched();},onChange:handleCredentialUpdate,value:credentialField.value,tooltip:/*i18n*/i18n._(\"Credential to authenticate with Kubernetes or OpenShift. Must be of type \\\"Kubernetes/OpenShift API Bearer Token\\\". If left blank, the underlying Pod's service account will be used.\"),autoPopulate:!(instanceGroup!==null&&instanceGroup!==void 0&&instanceGroup.id)}),/*#__PURE__*/_jsx(FormField,{id:\"instance-group-max-concurrent-jobs\",label:/*i18n*/i18n._(\"Max concurrent jobs\"),name:\"max_concurrent_jobs\",type:\"number\",min:\"0\",validate:minMaxValue(0,2147483647),tooltip:/*i18n*/i18n._(\"Maximum number of jobs to run concurrently on this group.\\nZero means no limit will be enforced.\")}),/*#__PURE__*/_jsx(FormField,{id:\"instance-group-max-forks\",label:/*i18n*/i18n._(\"Max forks\"),name:\"max_forks\",type:\"number\",min:\"0\",validate:minMaxValue(0,2147483647),tooltip:/*i18n*/i18n._(\"Maximum number of forks to allow across all jobs running concurrently on this group.\\nZero means no limit will be enforced.\")}),/*#__PURE__*/_jsx(FormGroup,{fieldId:\"container-groups-option-checkbox\",label:/*i18n*/i18n._(\"Options\"),children:/*#__PURE__*/_jsx(FormCheckboxLayout,{children:/*#__PURE__*/_jsx(CheckboxField,{name:\"override\",\"aria-label\":/*i18n*/i18n._(\"Customize pod specification\"),label:/*i18n*/i18n._(\"Customize pod specification\"),id:\"container-groups-override-pod-specification\"})})}),overrideField.value&&/*#__PURE__*/_jsx(SubFormLayout,{children:/*#__PURE__*/_jsx(FormFullWidthLayout,{children:/*#__PURE__*/_jsx(VariablesField,{tooltip:/*i18n*/i18n._(\"Field for passing a custom Kubernetes or OpenShift Pod specification.\"),id:\"custom-pod-spec\",name:\"pod_spec_override\",label:/*i18n*/i18n._(\"Custom pod spec\")})})})]});}function ContainerGroupForm(_ref2){var _instanceGroup$summar;var initialPodSpec=_ref2.initialPodSpec,instanceGroup=_ref2.instanceGroup,_onSubmit=_ref2.onSubmit,onCancel=_ref2.onCancel,submitError=_ref2.submitError,rest=_objectWithoutProperties(_ref2,_excluded);var isCheckboxChecked=Boolean(instanceGroup===null||instanceGroup===void 0?void 0:instanceGroup.pod_spec_override)||false;var initialValues={name:(instanceGroup===null||instanceGroup===void 0?void 0:instanceGroup.name)||'',max_concurrent_jobs:instanceGroup.max_concurrent_jobs||0,max_forks:instanceGroup.max_forks||0,credential:instanceGroup===null||instanceGroup===void 0?void 0:(_instanceGroup$summar=instanceGroup.summary_fields)===null||_instanceGroup$summar===void 0?void 0:_instanceGroup$summar.credential,pod_spec_override:isCheckboxChecked?instanceGroup===null||instanceGroup===void 0?void 0:instanceGroup.pod_spec_override:jsonToYaml(JSON.stringify(initialPodSpec)),override:isCheckboxChecked};return/*#__PURE__*/_jsx(Formik,{initialValues:initialValues,onSubmit:function onSubmit(values){_onSubmit(values);},children:function children(formik){return/*#__PURE__*/_jsx(Form,{autoComplete:\"off\",onSubmit:formik.handleSubmit,children:/*#__PURE__*/_jsxs(FormColumnLayout,{children:[/*#__PURE__*/_jsx(ContainerGroupFormFields,_objectSpread({instanceGroup:instanceGroup},rest)),submitError&&/*#__PURE__*/_jsx(FormSubmitError,{error:submitError}),/*#__PURE__*/_jsx(FormActionGroup,{onCancel:onCancel,onSubmit:formik.handleSubmit})]})});}});}ContainerGroupForm.defaultProps={instanceGroup:{},submitError:null,initialPodSpec:{}};export default ContainerGroupForm;","map":{"version":3,"names":["React","useCallback","Formik","useField","useFormikContext","Form","FormGroup","jsonToYaml","FormField","FormSubmitError","CheckboxField","FormActionGroup","required","minMaxValue","FormColumnLayout","FormFullWidthLayout","FormCheckboxLayout","SubFormLayout","CredentialLookup","VariablesField","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","ContainerGroupFormFields","_ref","instanceGroup","_useFormikContext","setFieldValue","setFieldTouched","_useField","_useField2","_slicedToArray","credentialField","credentialMeta","credentialHelpers","_useField3","_useField4","overrideField","handleCredentialUpdate","value","children","name","id","label","i18n","_","type","validate","isRequired","credentialTypeKind","helperTextInvalid","error","isValid","touched","onBlur","setTouched","onChange","tooltip","autoPopulate","min","fieldId","ContainerGroupForm","_ref2","_instanceGroup$summar","initialPodSpec","onSubmit","onCancel","submitError","rest","_objectWithoutProperties","_excluded","isCheckboxChecked","Boolean","pod_spec_override","initialValues","max_concurrent_jobs","max_forks","credential","summary_fields","JSON","stringify","override","values","formik","autoComplete","handleSubmit","_objectSpread","defaultProps"],"sources":["/awx_devel/awx/ui/src/screens/InstanceGroup/shared/ContainerGroupForm.js"],"sourcesContent":["import React, { useCallback } from 'react';\nimport { func, shape } from 'prop-types';\nimport { Formik, useField, useFormikContext } from 'formik';\n\nimport { t } from '@lingui/macro';\nimport { Form, FormGroup } from '@patternfly/react-core';\nimport { jsonToYaml } from 'util/yaml';\n\nimport FormField, {\n  FormSubmitError,\n  CheckboxField,\n} from 'components/FormField';\nimport FormActionGroup from 'components/FormActionGroup';\nimport { required, minMaxValue } from 'util/validators';\nimport {\n  FormColumnLayout,\n  FormFullWidthLayout,\n  FormCheckboxLayout,\n  SubFormLayout,\n} from 'components/FormLayout';\nimport CredentialLookup from 'components/Lookup/CredentialLookup';\nimport { VariablesField } from 'components/CodeEditor';\n\nfunction ContainerGroupFormFields({ instanceGroup }) {\n  const { setFieldValue, setFieldTouched } = useFormikContext();\n  const [credentialField, credentialMeta, credentialHelpers] =\n    useField('credential');\n\n  const [overrideField] = useField('override');\n\n  const handleCredentialUpdate = useCallback(\n    (value) => {\n      setFieldValue('credential', value);\n      setFieldTouched('credential', true, false);\n    },\n    [setFieldValue, setFieldTouched]\n  );\n\n  return (\n    <>\n      <FormField\n        name=\"name\"\n        id=\"container-group-name\"\n        label={t`Name`}\n        type=\"text\"\n        validate={required(null)}\n        isRequired\n      />\n      <CredentialLookup\n        label={t`Credential`}\n        credentialTypeKind=\"kubernetes\"\n        helperTextInvalid={credentialMeta.error}\n        isValid={!credentialMeta.touched || !credentialMeta.error}\n        onBlur={() => credentialHelpers.setTouched()}\n        onChange={handleCredentialUpdate}\n        value={credentialField.value}\n        tooltip={t`Credential to authenticate with Kubernetes or OpenShift. Must be of type \"Kubernetes/OpenShift API Bearer Token\". If left blank, the underlying Pod's service account will be used.`}\n        autoPopulate={!instanceGroup?.id}\n      />\n      <FormField\n        id=\"instance-group-max-concurrent-jobs\"\n        label={t`Max concurrent jobs`}\n        name=\"max_concurrent_jobs\"\n        type=\"number\"\n        min=\"0\"\n        validate={minMaxValue(0, 2147483647)}\n        tooltip={t`Maximum number of jobs to run concurrently on this group.\n          Zero means no limit will be enforced.`}\n      />\n      <FormField\n        id=\"instance-group-max-forks\"\n        label={t`Max forks`}\n        name=\"max_forks\"\n        type=\"number\"\n        min=\"0\"\n        validate={minMaxValue(0, 2147483647)}\n        tooltip={t`Maximum number of forks to allow across all jobs running concurrently on this group.\n          Zero means no limit will be enforced.`}\n      />\n\n      <FormGroup fieldId=\"container-groups-option-checkbox\" label={t`Options`}>\n        <FormCheckboxLayout>\n          <CheckboxField\n            name=\"override\"\n            aria-label={t`Customize pod specification`}\n            label={t`Customize pod specification`}\n            id=\"container-groups-override-pod-specification\"\n          />\n        </FormCheckboxLayout>\n      </FormGroup>\n\n      {overrideField.value && (\n        <SubFormLayout>\n          <FormFullWidthLayout>\n            <VariablesField\n              tooltip={t`Field for passing a custom Kubernetes or OpenShift Pod specification.`}\n              id=\"custom-pod-spec\"\n              name=\"pod_spec_override\"\n              label={t`Custom pod spec`}\n            />\n          </FormFullWidthLayout>\n        </SubFormLayout>\n      )}\n    </>\n  );\n}\n\nfunction ContainerGroupForm({\n  initialPodSpec,\n  instanceGroup,\n  onSubmit,\n  onCancel,\n  submitError,\n  ...rest\n}) {\n  const isCheckboxChecked = Boolean(instanceGroup?.pod_spec_override) || false;\n\n  const initialValues = {\n    name: instanceGroup?.name || '',\n    max_concurrent_jobs: instanceGroup.max_concurrent_jobs || 0,\n    max_forks: instanceGroup.max_forks || 0,\n    credential: instanceGroup?.summary_fields?.credential,\n    pod_spec_override: isCheckboxChecked\n      ? instanceGroup?.pod_spec_override\n      : jsonToYaml(JSON.stringify(initialPodSpec)),\n    override: isCheckboxChecked,\n  };\n\n  return (\n    <Formik\n      initialValues={initialValues}\n      onSubmit={(values) => {\n        onSubmit(values);\n      }}\n    >\n      {(formik) => (\n        <Form autoComplete=\"off\" onSubmit={formik.handleSubmit}>\n          <FormColumnLayout>\n            <ContainerGroupFormFields instanceGroup={instanceGroup} {...rest} />\n            {submitError && <FormSubmitError error={submitError} />}\n            <FormActionGroup\n              onCancel={onCancel}\n              onSubmit={formik.handleSubmit}\n            />\n          </FormColumnLayout>\n        </Form>\n      )}\n    </Formik>\n  );\n}\n\nContainerGroupForm.propTypes = {\n  instanceGroup: shape({}),\n  onCancel: func.isRequired,\n  onSubmit: func.isRequired,\n  submitError: shape({}),\n  initialPodSpec: shape({}),\n};\n\nContainerGroupForm.defaultProps = {\n  instanceGroup: {},\n  submitError: null,\n  initialPodSpec: {},\n};\n\nexport default ContainerGroupForm;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}