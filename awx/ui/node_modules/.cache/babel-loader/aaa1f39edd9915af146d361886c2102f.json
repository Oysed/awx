{"ast":null,"code":"import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{i18n}from\"@lingui/core\";import React,{useCallback,useState}from'react';import{MinusCircleIcon}from'@patternfly/react-icons';import{Button,Tooltip}from'@patternfly/react-core';import{getJobModel}from'util/jobs';import useRequest,{useDismissableError}from'hooks/useRequest';import AlertModal from'../AlertModal';import ErrorDetail from'../ErrorDetail';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";function JobCancelButton(_ref){var _cancelError$response;var errorTitle=_ref.errorTitle,title=_ref.title,showIconButton=_ref.showIconButton,errorMessage=_ref.errorMessage,buttonText=_ref.buttonText,_ref$style=_ref.style,style=_ref$style===void 0?{}:_ref$style,_ref$job=_ref.job,job=_ref$job===void 0?{}:_ref$job,isDisabled=_ref.isDisabled,tooltip=_ref.tooltip,cancelationMessage=_ref.cancelationMessage,onCancelWorkflow=_ref.onCancelWorkflow;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isOpen=_useState2[0],setIsOpen=_useState2[1];var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setIsOpen(false);_context.next=3;return getJobModel(job.type).cancel(job.id);case 3:if(onCancelWorkflow){onCancelWorkflow();}case 4:case\"end\":return _context.stop();}}},_callee);})),[job.id,job.type,onCancelWorkflow]),{}),cancelError=_useRequest.error,cancelJob=_useRequest.request;var _useDismissableError=useDismissableError(cancelError),error=_useDismissableError.error,dismissCancelError=_useDismissableError.dismissError;var isAlreadyCancelled=(cancelError===null||cancelError===void 0?void 0:(_cancelError$response=cancelError.response)===null||_cancelError$response===void 0?void 0:_cancelError$response.status)===405;var renderTooltip=function renderTooltip(){if(tooltip){return tooltip;}return isAlreadyCancelled?null:title;};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Tooltip,{content:renderTooltip(),children:/*#__PURE__*/_jsx(\"div\",{children:showIconButton?/*#__PURE__*/_jsx(Button,{isDisabled:isDisabled||isAlreadyCancelled,\"aria-label\":title,ouiaId:\"cancel-job-button\",onClick:function onClick(){return setIsOpen(true);},variant:\"plain\",style:style,children:/*#__PURE__*/_jsx(MinusCircleIcon,{})}):/*#__PURE__*/_jsx(Button,{isDisabled:isDisabled||isAlreadyCancelled,\"aria-label\":title,variant:\"secondary\",ouiaId:\"cancel-job-button\",onClick:function onClick(){return setIsOpen(true);},style:style,children:buttonText||/*i18n*/i18n._(\"Cancel Job\")})})}),isOpen&&/*#__PURE__*/_jsx(AlertModal,{isOpen:isOpen,variant:\"danger\",onClose:function onClose(){return setIsOpen(false);},title:title,label:title,actions:[/*#__PURE__*/_jsx(Button,{id:\"cancel-job-confirm-button\",variant:\"danger\",\"aria-label\":/*i18n*/i18n._(\"Confirm cancel job\"),ouiaId:\"cancel-job-confirm-button\",onClick:cancelJob,children:/*i18n*/i18n._(\"Confirm cancellation\")},\"delete\"),/*#__PURE__*/_jsx(Button,{id:\"cancel-job-return-button\",ouiaId:\"return\",\"aria-label\":/*i18n*/i18n._(\"Return\"),variant:\"secondary\",onClick:function onClick(){return setIsOpen(false);},children:/*i18n*/i18n._(\"Return\")},\"cancel\")],children:cancelationMessage!==null&&cancelationMessage!==void 0?cancelationMessage:/*i18n*/i18n._(\"Are you sure you want to cancel this job?\")}),error&&!isAlreadyCancelled&&/*#__PURE__*/_jsxs(AlertModal,{isOpen:error,variant:\"danger\",onClose:dismissCancelError,title:errorTitle,label:errorTitle,children:[errorMessage,/*#__PURE__*/_jsx(ErrorDetail,{error:error})]})]});}export default JobCancelButton;","map":{"version":3,"names":["React","useCallback","useState","MinusCircleIcon","Button","Tooltip","getJobModel","useRequest","useDismissableError","AlertModal","ErrorDetail","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","JobCancelButton","_ref","_cancelError$response","errorTitle","title","showIconButton","errorMessage","buttonText","_ref$style","style","_ref$job","job","isDisabled","tooltip","cancelationMessage","onCancelWorkflow","_useState","_useState2","_slicedToArray","isOpen","setIsOpen","_useRequest","_asyncToGenerator","_regeneratorRuntime","mark","_callee","wrap","_callee$","_context","prev","next","type","cancel","id","stop","cancelError","error","cancelJob","request","_useDismissableError","dismissCancelError","dismissError","isAlreadyCancelled","response","status","renderTooltip","children","content","ouiaId","onClick","variant","i18n","_","onClose","label","actions"],"sources":["/awx_devel/awx/ui/src/components/JobCancelButton/JobCancelButton.js"],"sourcesContent":["import React, { useCallback, useState } from 'react';\nimport { t } from '@lingui/macro';\nimport { MinusCircleIcon } from '@patternfly/react-icons';\nimport { Button, Tooltip } from '@patternfly/react-core';\nimport { getJobModel } from 'util/jobs';\nimport useRequest, { useDismissableError } from 'hooks/useRequest';\nimport AlertModal from '../AlertModal';\nimport ErrorDetail from '../ErrorDetail';\n\nfunction JobCancelButton({\n  errorTitle,\n  title,\n  showIconButton,\n  errorMessage,\n  buttonText,\n  style = {},\n  job = {},\n  isDisabled,\n  tooltip,\n  cancelationMessage,\n  onCancelWorkflow,\n}) {\n  const [isOpen, setIsOpen] = useState(false);\n  const { error: cancelError, request: cancelJob } = useRequest(\n    useCallback(async () => {\n      setIsOpen(false);\n      await getJobModel(job.type).cancel(job.id);\n\n      if (onCancelWorkflow) {\n        onCancelWorkflow();\n      }\n    }, [job.id, job.type, onCancelWorkflow]),\n    {}\n  );\n  const { error, dismissError: dismissCancelError } =\n    useDismissableError(cancelError);\n\n  const isAlreadyCancelled = cancelError?.response?.status === 405;\n  const renderTooltip = () => {\n    if (tooltip) {\n      return tooltip;\n    }\n    return isAlreadyCancelled ? null : title;\n  };\n  return (\n    <>\n      <Tooltip content={renderTooltip()}>\n        <div>\n          {showIconButton ? (\n            <Button\n              isDisabled={isDisabled || isAlreadyCancelled}\n              aria-label={title}\n              ouiaId=\"cancel-job-button\"\n              onClick={() => setIsOpen(true)}\n              variant=\"plain\"\n              style={style}\n            >\n              <MinusCircleIcon />\n            </Button>\n          ) : (\n            <Button\n              isDisabled={isDisabled || isAlreadyCancelled}\n              aria-label={title}\n              variant=\"secondary\"\n              ouiaId=\"cancel-job-button\"\n              onClick={() => setIsOpen(true)}\n              style={style}\n            >\n              {buttonText || t`Cancel Job`}\n            </Button>\n          )}\n        </div>\n      </Tooltip>\n      {isOpen && (\n        <AlertModal\n          isOpen={isOpen}\n          variant=\"danger\"\n          onClose={() => setIsOpen(false)}\n          title={title}\n          label={title}\n          actions={[\n            <Button\n              id=\"cancel-job-confirm-button\"\n              key=\"delete\"\n              variant=\"danger\"\n              aria-label={t`Confirm cancel job`}\n              ouiaId=\"cancel-job-confirm-button\"\n              onClick={cancelJob}\n            >\n              {t`Confirm cancellation`}\n            </Button>,\n            <Button\n              id=\"cancel-job-return-button\"\n              key=\"cancel\"\n              ouiaId=\"return\"\n              aria-label={t`Return`}\n              variant=\"secondary\"\n              onClick={() => setIsOpen(false)}\n            >\n              {t`Return`}\n            </Button>,\n          ]}\n        >\n          {cancelationMessage ?? t`Are you sure you want to cancel this job?`}\n        </AlertModal>\n      )}\n      {error && !isAlreadyCancelled && (\n        <AlertModal\n          isOpen={error}\n          variant=\"danger\"\n          onClose={dismissCancelError}\n          title={errorTitle}\n          label={errorTitle}\n        >\n          {errorMessage}\n          <ErrorDetail error={error} />\n        </AlertModal>\n      )}\n    </>\n  );\n}\n\nexport default JobCancelButton;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}