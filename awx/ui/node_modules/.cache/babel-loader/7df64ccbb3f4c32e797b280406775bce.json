{"ast":null,"code":"import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{i18n}from\"@lingui/core\";import React,{useCallback,useEffect}from'react';import{useLocation}from'react-router-dom';import useRequest from'hooks/useRequest';import{SearchColumns,SortColumns}from'types';import{getQSConfig,parseQueryString}from'util/qs';import DataListToolbar from'../DataListToolbar';import CheckboxListItem from'../CheckboxListItem';import{SelectedList}from'../SelectedList';import PaginatedTable,{HeaderCell,HeaderRow,getSearchableKeys}from'../PaginatedTable';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var QS_Config=function QS_Config(sortColumns){return getQSConfig('resource',{page:1,page_size:5,order_by:\"\".concat(sortColumns.filter(function(col){return col.key==='name';}).length?'name':'username')});};function SelectResourceStep(_ref){var searchColumns=_ref.searchColumns,sortColumns=_ref.sortColumns,displayKey=_ref.displayKey,onRowClick=_ref.onRowClick,selectedLabel=_ref.selectedLabel,selectedResourceRows=_ref.selectedResourceRows,fetchItems=_ref.fetchItems,fetchOptions=_ref.fetchOptions;var location=useLocation();var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _actionsResponse$data,_actionsResponse$data2;var queryParams,_yield$Promise$all,_yield$Promise$all2,_yield$Promise$all2$,count,results,actionsResponse;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:queryParams=parseQueryString(QS_Config(sortColumns),location.search);_context.next=3;return Promise.all([fetchItems(queryParams),fetchOptions()]);case 3:_yield$Promise$all=_context.sent;_yield$Promise$all2=_slicedToArray(_yield$Promise$all,2);_yield$Promise$all2$=_yield$Promise$all2[0].data;count=_yield$Promise$all2$.count;results=_yield$Promise$all2$.results;actionsResponse=_yield$Promise$all2[1];return _context.abrupt(\"return\",{resources:results,itemCount:count,relatedSearchableKeys:((actionsResponse===null||actionsResponse===void 0?void 0:(_actionsResponse$data=actionsResponse.data)===null||_actionsResponse$data===void 0?void 0:_actionsResponse$data.related_search_fields)||[]).map(function(val){return val.slice(0,-8);}),searchableKeys:getSearchableKeys((_actionsResponse$data2=actionsResponse.data.actions)===null||_actionsResponse$data2===void 0?void 0:_actionsResponse$data2.GET)});case 10:case\"end\":return _context.stop();}}},_callee);})),[location,fetchItems,fetchOptions,sortColumns]),{resources:[],itemCount:0,relatedSearchableKeys:[],searchableKeys:[]}),isLoading=_useRequest.isLoading,error=_useRequest.error,readResourceList=_useRequest.request,_useRequest$result=_useRequest.result,resources=_useRequest$result.resources,itemCount=_useRequest$result.itemCount,relatedSearchableKeys=_useRequest$result.relatedSearchableKeys,searchableKeys=_useRequest$result.searchableKeys;useEffect(function(){readResourceList();},[readResourceList]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{children:/*i18n*/i18n._(\"Choose the resources that will be receiving new roles.  You'll be able to select the roles to apply in the next step.  Note that the resources chosen here will receive all roles chosen in the next step.\")}),selectedResourceRows.length>0&&/*#__PURE__*/_jsx(SelectedList,{displayKey:displayKey,label:selectedLabel,onRemove:onRowClick,selected:selectedResourceRows}),/*#__PURE__*/_jsx(PaginatedTable,{hasContentLoading:isLoading,contentError:error,items:resources,itemCount:itemCount,qsConfig:QS_Config(sortColumns),onRowClick:onRowClick,toolbarSearchColumns:searchColumns,toolbarSortColumns:sortColumns,toolbarSearchableKeys:searchableKeys,toolbarRelatedSearchableKeys:relatedSearchableKeys,headerRow:/*#__PURE__*/_jsx(HeaderRow,{qsConfig:QS_Config(sortColumns),children:sortColumns.map(function(_ref3){var name=_ref3.name,key=_ref3.key;return/*#__PURE__*/_jsx(HeaderCell,{sortKey:key,children:name},key);})}),renderRow:function renderRow(item,index){return/*#__PURE__*/_jsx(CheckboxListItem,{isSelected:selectedResourceRows.some(function(i){return i.id===item.id;}),itemId:item.id,item:item,rowIndex:index,columns:sortColumns,name:item[displayKey],label:item[displayKey],onSelect:function onSelect(){return onRowClick(item);},onDeselect:function onDeselect(){return onRowClick(item);}},item.id);},renderToolbar:function renderToolbar(props){return/*#__PURE__*/_jsx(DataListToolbar,_objectSpread(_objectSpread({},props),{},{fillWidth:true}));},showPageSizeOptions:false})]});}SelectResourceStep.defaultProps={searchColumns:null,sortColumns:null,displayKey:'name',onRowClick:function onRowClick(){},selectedLabel:null,selectedResourceRows:[]};export{SelectResourceStep as _SelectResourceStep};export default SelectResourceStep;","map":{"version":3,"names":["React","useCallback","useEffect","useLocation","useRequest","SearchColumns","SortColumns","getQSConfig","parseQueryString","DataListToolbar","CheckboxListItem","SelectedList","PaginatedTable","HeaderCell","HeaderRow","getSearchableKeys","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","QS_Config","sortColumns","page","page_size","order_by","concat","filter","col","key","length","SelectResourceStep","_ref","searchColumns","displayKey","onRowClick","selectedLabel","selectedResourceRows","fetchItems","fetchOptions","location","_useRequest","_asyncToGenerator","_regeneratorRuntime","mark","_callee","_actionsResponse$data","_actionsResponse$data2","queryParams","_yield$Promise$all","_yield$Promise$all2","_yield$Promise$all2$","count","results","actionsResponse","wrap","_callee$","_context","prev","next","search","Promise","all","sent","_slicedToArray","data","abrupt","resources","itemCount","relatedSearchableKeys","related_search_fields","map","val","slice","searchableKeys","actions","GET","stop","isLoading","error","readResourceList","request","_useRequest$result","result","children","i18n","_","label","onRemove","selected","hasContentLoading","contentError","items","qsConfig","toolbarSearchColumns","toolbarSortColumns","toolbarSearchableKeys","toolbarRelatedSearchableKeys","headerRow","_ref3","name","sortKey","renderRow","item","index","isSelected","some","i","id","itemId","rowIndex","columns","onSelect","onDeselect","renderToolbar","props","_objectSpread","fillWidth","showPageSizeOptions","defaultProps","_SelectResourceStep"],"sources":["/awx_devel/awx/ui/src/components/AddRole/SelectResourceStep.js"],"sourcesContent":["import React, { useCallback, useEffect } from 'react';\nimport PropTypes from 'prop-types';\nimport { useLocation } from 'react-router-dom';\nimport { t } from '@lingui/macro';\nimport useRequest from 'hooks/useRequest';\nimport { SearchColumns, SortColumns } from 'types';\nimport { getQSConfig, parseQueryString } from 'util/qs';\nimport DataListToolbar from '../DataListToolbar';\nimport CheckboxListItem from '../CheckboxListItem';\nimport { SelectedList } from '../SelectedList';\nimport PaginatedTable, {\n  HeaderCell,\n  HeaderRow,\n  getSearchableKeys,\n} from '../PaginatedTable';\n\nconst QS_Config = (sortColumns) =>\n  getQSConfig('resource', {\n    page: 1,\n    page_size: 5,\n    order_by: `${\n      sortColumns.filter((col) => col.key === 'name').length\n        ? 'name'\n        : 'username'\n    }`,\n  });\nfunction SelectResourceStep({\n  searchColumns,\n  sortColumns,\n  displayKey,\n  onRowClick,\n  selectedLabel,\n  selectedResourceRows,\n  fetchItems,\n  fetchOptions,\n}) {\n  const location = useLocation();\n\n  const {\n    isLoading,\n    error,\n    request: readResourceList,\n    result: { resources, itemCount, relatedSearchableKeys, searchableKeys },\n  } = useRequest(\n    useCallback(async () => {\n      const queryParams = parseQueryString(\n        QS_Config(sortColumns),\n        location.search\n      );\n\n      const [\n        {\n          data: { count, results },\n        },\n        actionsResponse,\n      ] = await Promise.all([fetchItems(queryParams), fetchOptions()]);\n      return {\n        resources: results,\n        itemCount: count,\n        relatedSearchableKeys: (\n          actionsResponse?.data?.related_search_fields || []\n        ).map((val) => val.slice(0, -8)),\n        searchableKeys: getSearchableKeys(actionsResponse.data.actions?.GET),\n      };\n    }, [location, fetchItems, fetchOptions, sortColumns]),\n    {\n      resources: [],\n      itemCount: 0,\n      relatedSearchableKeys: [],\n      searchableKeys: [],\n    }\n  );\n\n  useEffect(() => {\n    readResourceList();\n  }, [readResourceList]);\n\n  return (\n    <>\n      <div>\n        {t`Choose the resources that will be receiving new roles.  You'll be able to select the roles to apply in the next step.  Note that the resources chosen here will receive all roles chosen in the next step.`}\n      </div>\n      {selectedResourceRows.length > 0 && (\n        <SelectedList\n          displayKey={displayKey}\n          label={selectedLabel}\n          onRemove={onRowClick}\n          selected={selectedResourceRows}\n        />\n      )}\n\n      <PaginatedTable\n        hasContentLoading={isLoading}\n        contentError={error}\n        items={resources}\n        itemCount={itemCount}\n        qsConfig={QS_Config(sortColumns)}\n        onRowClick={onRowClick}\n        toolbarSearchColumns={searchColumns}\n        toolbarSortColumns={sortColumns}\n        toolbarSearchableKeys={searchableKeys}\n        toolbarRelatedSearchableKeys={relatedSearchableKeys}\n        headerRow={\n          <HeaderRow qsConfig={QS_Config(sortColumns)}>\n            {sortColumns.map(({ name, key }) => (\n              <HeaderCell sortKey={key} key={key}>\n                {name}\n              </HeaderCell>\n            ))}\n          </HeaderRow>\n        }\n        renderRow={(item, index) => (\n          <CheckboxListItem\n            isSelected={selectedResourceRows.some((i) => i.id === item.id)}\n            itemId={item.id}\n            item={item}\n            rowIndex={index}\n            key={item.id}\n            columns={sortColumns}\n            name={item[displayKey]}\n            label={item[displayKey]}\n            onSelect={() => onRowClick(item)}\n            onDeselect={() => onRowClick(item)}\n          />\n        )}\n        renderToolbar={(props) => <DataListToolbar {...props} fillWidth />}\n        showPageSizeOptions={false}\n      />\n    </>\n  );\n}\n\nSelectResourceStep.propTypes = {\n  searchColumns: SearchColumns,\n  sortColumns: SortColumns,\n  displayKey: PropTypes.string,\n  onRowClick: PropTypes.func,\n  fetchItems: PropTypes.func.isRequired,\n  selectedLabel: PropTypes.string,\n  selectedResourceRows: PropTypes.arrayOf(PropTypes.object),\n};\n\nSelectResourceStep.defaultProps = {\n  searchColumns: null,\n  sortColumns: null,\n  displayKey: 'name',\n  onRowClick: () => {},\n  selectedLabel: null,\n  selectedResourceRows: [],\n};\n\nexport { SelectResourceStep as _SelectResourceStep };\nexport default SelectResourceStep;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}