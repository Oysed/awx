{"ast":null,"code":"import _defineProperty from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";var ws;export default function connectJobSocket(_ref,onMessage){var type=_ref.type,id=_ref.id;ws=new WebSocket(\"\".concat(window.location.protocol==='http:'?'ws:':'wss:',\"//\").concat(window.location.host).concat(window.location.pathname,\"websocket/\"));ws.onopen=function(){var xrftoken=\"; \".concat(document.cookie).split('; csrftoken=').pop().split(';').shift();var eventGroup=\"\".concat(type,\"_events\");ws.send(JSON.stringify({xrftoken:xrftoken,groups:_defineProperty({jobs:['summary','status_changed']},eventGroup,[id])}));};ws.onmessage=function(e){onMessage(JSON.parse(e.data));};ws.onclose=function(e){if(e.code!==1000){// eslint-disable-next-line no-console\nconsole.debug('Socket closed. Reconnecting...',e);setTimeout(function(){connectJobSocket({type:type,id:id},onMessage);},1000);}};ws.onerror=function(err){// eslint-disable-next-line no-console\nconsole.debug('Socket error: ',err,'Disconnecting...');ws.close();};}export function closeWebSocket(){if(ws){ws.close();}}","map":{"version":3,"names":["ws","connectJobSocket","_ref","onMessage","type","id","WebSocket","concat","window","location","protocol","host","pathname","onopen","xrftoken","document","cookie","split","pop","shift","eventGroup","send","JSON","stringify","groups","_defineProperty","jobs","onmessage","e","parse","data","onclose","code","console","debug","setTimeout","onerror","err","close","closeWebSocket"],"sources":["/awx_devel/awx/ui/src/screens/Job/JobOutput/connectJobSocket.js"],"sourcesContent":["let ws;\n\nexport default function connectJobSocket({ type, id }, onMessage) {\n  ws = new WebSocket(\n    `${window.location.protocol === 'http:' ? 'ws:' : 'wss:'}//${\n      window.location.host\n    }${window.location.pathname}websocket/`\n  );\n\n  ws.onopen = () => {\n    const xrftoken = `; ${document.cookie}`\n      .split('; csrftoken=')\n      .pop()\n      .split(';')\n      .shift();\n    const eventGroup = `${type}_events`;\n    ws.send(\n      JSON.stringify({\n        xrftoken,\n        groups: { jobs: ['summary', 'status_changed'], [eventGroup]: [id] },\n      })\n    );\n  };\n\n  ws.onmessage = (e) => {\n    onMessage(JSON.parse(e.data));\n  };\n\n  ws.onclose = (e) => {\n    if (e.code !== 1000) {\n      // eslint-disable-next-line no-console\n      console.debug('Socket closed. Reconnecting...', e);\n      setTimeout(() => {\n        connectJobSocket({ type, id }, onMessage);\n      }, 1000);\n    }\n  };\n\n  ws.onerror = (err) => {\n    // eslint-disable-next-line no-console\n    console.debug('Socket error: ', err, 'Disconnecting...');\n    ws.close();\n  };\n}\n\nexport function closeWebSocket() {\n  if (ws) {\n    ws.close();\n  }\n}\n"],"mappings":"yGAAA,GAAI,CAAAA,EAAE,CAEN,cAAe,SAAS,CAAAC,gBAAgBA,CAAAC,IAAA,CAAeC,SAAS,CAAE,IAAvB,CAAAC,IAAI,CAAAF,IAAA,CAAJE,IAAI,CAAEC,EAAE,CAAAH,IAAA,CAAFG,EAAE,CACjDL,EAAE,CAAG,GAAI,CAAAM,SAAS,IAAAC,MAAA,CACbC,MAAM,CAACC,QAAQ,CAACC,QAAQ,GAAK,OAAO,CAAG,KAAK,CAAG,MAAM,OAAAH,MAAA,CACtDC,MAAM,CAACC,QAAQ,CAACE,IAAI,EAAAJ,MAAA,CACnBC,MAAM,CAACC,QAAQ,CAACG,QAAQ,cAC7B,CAAC,CAEDZ,EAAE,CAACa,MAAM,CAAG,UAAM,CAChB,GAAM,CAAAC,QAAQ,CAAG,KAAAP,MAAA,CAAKQ,QAAQ,CAACC,MAAM,EAClCC,KAAK,CAAC,cAAc,CAAC,CACrBC,GAAG,CAAC,CAAC,CACLD,KAAK,CAAC,GAAG,CAAC,CACVE,KAAK,CAAC,CAAC,CACV,GAAM,CAAAC,UAAU,IAAAb,MAAA,CAAMH,IAAI,WAAS,CACnCJ,EAAE,CAACqB,IAAI,CACLC,IAAI,CAACC,SAAS,CAAC,CACbT,QAAQ,CAARA,QAAQ,CACRU,MAAM,CAAAC,eAAA,EAAIC,IAAI,CAAE,CAAC,SAAS,CAAE,gBAAgB,CAAC,EAAGN,UAAU,CAAG,CAACf,EAAE,CAAC,CACnE,CAAC,CACH,CAAC,CACH,CAAC,CAEDL,EAAE,CAAC2B,SAAS,CAAG,SAACC,CAAC,CAAK,CACpBzB,SAAS,CAACmB,IAAI,CAACO,KAAK,CAACD,CAAC,CAACE,IAAI,CAAC,CAAC,CAC/B,CAAC,CAED9B,EAAE,CAAC+B,OAAO,CAAG,SAACH,CAAC,CAAK,CAClB,GAAIA,CAAC,CAACI,IAAI,GAAK,IAAI,CAAE,CACnB;AACAC,OAAO,CAACC,KAAK,CAAC,gCAAgC,CAAEN,CAAC,CAAC,CAClDO,UAAU,CAAC,UAAM,CACflC,gBAAgB,CAAC,CAAEG,IAAI,CAAJA,IAAI,CAAEC,EAAE,CAAFA,EAAG,CAAC,CAAEF,SAAS,CAAC,CAC3C,CAAC,CAAE,IAAI,CAAC,CACV,CACF,CAAC,CAEDH,EAAE,CAACoC,OAAO,CAAG,SAACC,GAAG,CAAK,CACpB;AACAJ,OAAO,CAACC,KAAK,CAAC,gBAAgB,CAAEG,GAAG,CAAE,kBAAkB,CAAC,CACxDrC,EAAE,CAACsC,KAAK,CAAC,CAAC,CACZ,CAAC,CACH,CAEA,MAAO,SAAS,CAAAC,cAAcA,CAAA,CAAG,CAC/B,GAAIvC,EAAE,CAAE,CACNA,EAAE,CAACsC,KAAK,CAAC,CAAC,CACZ,CACF"},"metadata":{},"sourceType":"module"}