{"ast":null,"code":"import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import React,{useState}from'react';import{useHistory}from'react-router-dom';import{Card}from'@patternfly/react-core';import{CardBody}from'components/Card';import{ProjectsAPI}from'api';import ProjectForm from'../shared/ProjectForm';import{jsx as _jsx}from\"react/jsx-runtime\";function ProjectEdit(_ref){var project=_ref.project;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),formSubmitError=_useState2[0],setFormSubmitError=_useState2[1];var history=useHistory();var handleSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(values){var _values$default_envir,_yield$ProjectsAPI$up,id;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(values.scm_type==='manual'){values.scm_type='';}if(!values.credential){// Depending on the permissions of the user submitting the form,\n// the API might throw an unexpected error if our creation request\n// has a zero-length string as its credential field. As a work-around,\n// normalize falsey credential fields by deleting them.\nvalues.credential=null;}else if(typeof values.credential.id==='number'){values.credential=values.credential.id;}if(!values.signature_validation_credential){values.signature_validation_credential=null;}else if(typeof values.signature_validation_credential.id==='number'){values.signature_validation_credential=values.signature_validation_credential.id;}_context.prev=3;_context.next=6;return ProjectsAPI.update(project.id,_objectSpread(_objectSpread({},values),{},{organization:values.organization.id,default_environment:((_values$default_envir=values.default_environment)===null||_values$default_envir===void 0?void 0:_values$default_envir.id)||null}));case 6:_yield$ProjectsAPI$up=_context.sent;id=_yield$ProjectsAPI$up.data.id;history.push(\"/projects/\".concat(id,\"/details\"));_context.next=14;break;case 11:_context.prev=11;_context.t0=_context[\"catch\"](3);setFormSubmitError(_context.t0);case 14:case\"end\":return _context.stop();}}},_callee,null,[[3,11]]);}));return function handleSubmit(_x){return _ref2.apply(this,arguments);};}();var handleCancel=function handleCancel(){history.push(\"/projects/\".concat(project.id,\"/details\"));};return/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(CardBody,{children:/*#__PURE__*/_jsx(ProjectForm,{project:project,handleCancel:handleCancel,handleSubmit:handleSubmit,submitError:formSubmitError})})});}export default ProjectEdit;","map":{"version":3,"names":["React","useState","useHistory","Card","CardBody","ProjectsAPI","ProjectForm","jsx","_jsx","ProjectEdit","_ref","project","_useState","_useState2","_slicedToArray","formSubmitError","setFormSubmitError","history","handleSubmit","_ref2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","values","_values$default_envir","_yield$ProjectsAPI$up","id","wrap","_callee$","_context","prev","next","scm_type","credential","signature_validation_credential","update","_objectSpread","organization","default_environment","sent","data","push","concat","t0","stop","_x","apply","arguments","handleCancel","children","submitError"],"sources":["/awx_devel/awx/ui/src/screens/Project/ProjectEdit/ProjectEdit.js"],"sourcesContent":["import React, { useState } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport { Card } from '@patternfly/react-core';\nimport { CardBody } from 'components/Card';\nimport { ProjectsAPI } from 'api';\nimport ProjectForm from '../shared/ProjectForm';\n\nfunction ProjectEdit({ project }) {\n  const [formSubmitError, setFormSubmitError] = useState(null);\n  const history = useHistory();\n\n  const handleSubmit = async (values) => {\n    if (values.scm_type === 'manual') {\n      values.scm_type = '';\n    }\n    if (!values.credential) {\n      // Depending on the permissions of the user submitting the form,\n      // the API might throw an unexpected error if our creation request\n      // has a zero-length string as its credential field. As a work-around,\n      // normalize falsey credential fields by deleting them.\n      values.credential = null;\n    } else if (typeof values.credential.id === 'number') {\n      values.credential = values.credential.id;\n    }\n    if (!values.signature_validation_credential) {\n      values.signature_validation_credential = null;\n    } else if (typeof values.signature_validation_credential.id === 'number') {\n      values.signature_validation_credential =\n        values.signature_validation_credential.id;\n    }\n\n    try {\n      const {\n        data: { id },\n      } = await ProjectsAPI.update(project.id, {\n        ...values,\n        organization: values.organization.id,\n        default_environment: values.default_environment?.id || null,\n      });\n      history.push(`/projects/${id}/details`);\n    } catch (error) {\n      setFormSubmitError(error);\n    }\n  };\n\n  const handleCancel = () => {\n    history.push(`/projects/${project.id}/details`);\n  };\n\n  return (\n    <Card>\n      <CardBody>\n        <ProjectForm\n          project={project}\n          handleCancel={handleCancel}\n          handleSubmit={handleSubmit}\n          submitError={formSubmitError}\n        />\n      </CardBody>\n    </Card>\n  );\n}\n\nexport default ProjectEdit;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}