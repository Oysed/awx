{"ast":null,"code":"import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{useState,useEffect}from'react';import useWebsocket from'hooks/useWebsocket';import useThrottle from'hooks/useThrottle';export default function useWsPendingApprovalCount(initialCount,fetchApprovalsCount){var _useState=useState(initialCount),_useState2=_slicedToArray(_useState,2),pendingApprovalCount=_useState2[0],setPendingApprovalCount=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),reloadCount=_useState4[0],setReloadCount=_useState4[1];var throttledFetch=useThrottle(reloadCount,1000);var lastMessage=useWebsocket({jobs:['status_changed'],control:['limit_reached_1']});useEffect(function(){setPendingApprovalCount(initialCount);},[initialCount]);useEffect(function(){_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(throttledFetch){_context.next=2;break;}return _context.abrupt(\"return\");case 2:setReloadCount(false);fetchApprovalsCount();case 4:case\"end\":return _context.stop();}}},_callee);}))();},[throttledFetch,fetchApprovalsCount]);useEffect(function(){if((lastMessage===null||lastMessage===void 0?void 0:lastMessage.type)==='workflow_approval'){setReloadCount(true);}},[lastMessage]);return pendingApprovalCount;}","map":{"version":3,"names":["useState","useEffect","useWebsocket","useThrottle","useWsPendingApprovalCount","initialCount","fetchApprovalsCount","_useState","_useState2","_slicedToArray","pendingApprovalCount","setPendingApprovalCount","_useState3","_useState4","reloadCount","setReloadCount","throttledFetch","lastMessage","jobs","control","_asyncToGenerator","_regeneratorRuntime","mark","_callee","wrap","_callee$","_context","prev","next","abrupt","stop","type"],"sources":["/awx_devel/awx/ui/src/components/AppContainer/useWsPendingApprovalCount.js"],"sourcesContent":["import { useState, useEffect } from 'react';\nimport useWebsocket from 'hooks/useWebsocket';\nimport useThrottle from 'hooks/useThrottle';\n\nexport default function useWsPendingApprovalCount(\n  initialCount,\n  fetchApprovalsCount\n) {\n  const [pendingApprovalCount, setPendingApprovalCount] =\n    useState(initialCount);\n  const [reloadCount, setReloadCount] = useState(false);\n  const throttledFetch = useThrottle(reloadCount, 1000);\n  const lastMessage = useWebsocket({\n    jobs: ['status_changed'],\n    control: ['limit_reached_1'],\n  });\n\n  useEffect(() => {\n    setPendingApprovalCount(initialCount);\n  }, [initialCount]);\n\n  useEffect(() => {\n    (async () => {\n      if (!throttledFetch) {\n        return;\n      }\n      setReloadCount(false);\n      fetchApprovalsCount();\n    })();\n  }, [throttledFetch, fetchApprovalsCount]);\n\n  useEffect(() => {\n    if (lastMessage?.type === 'workflow_approval') {\n      setReloadCount(true);\n    }\n  }, [lastMessage]);\n\n  return pendingApprovalCount;\n}\n"],"mappings":"wTAAA,OAASA,QAAQ,CAAEC,SAAS,KAAQ,OAAO,CAC3C,MAAO,CAAAC,YAAY,KAAM,oBAAoB,CAC7C,MAAO,CAAAC,WAAW,KAAM,mBAAmB,CAE3C,cAAe,SAAS,CAAAC,yBAAyBA,CAC/CC,YAAY,CACZC,mBAAmB,CACnB,CACA,IAAAC,SAAA,CACEP,QAAQ,CAACK,YAAY,CAAC,CAAAG,UAAA,CAAAC,cAAA,CAAAF,SAAA,IADjBG,oBAAoB,CAAAF,UAAA,IAAEG,uBAAuB,CAAAH,UAAA,IAEpD,IAAAI,UAAA,CAAsCZ,QAAQ,CAAC,KAAK,CAAC,CAAAa,UAAA,CAAAJ,cAAA,CAAAG,UAAA,IAA9CE,WAAW,CAAAD,UAAA,IAAEE,cAAc,CAAAF,UAAA,IAClC,GAAM,CAAAG,cAAc,CAAGb,WAAW,CAACW,WAAW,CAAE,IAAI,CAAC,CACrD,GAAM,CAAAG,WAAW,CAAGf,YAAY,CAAC,CAC/BgB,IAAI,CAAE,CAAC,gBAAgB,CAAC,CACxBC,OAAO,CAAE,CAAC,iBAAiB,CAC7B,CAAC,CAAC,CAEFlB,SAAS,CAAC,UAAM,CACdU,uBAAuB,CAACN,YAAY,CAAC,CACvC,CAAC,CAAE,CAACA,YAAY,CAAC,CAAC,CAElBJ,SAAS,CAAC,UAAM,CACdmB,iBAAA,cAAAC,mBAAA,CAAAC,IAAA,CAAC,SAAAC,QAAA,SAAAF,mBAAA,CAAAG,IAAA,UAAAC,SAAAC,QAAA,kBAAAA,QAAA,CAAAC,IAAA,CAAAD,QAAA,CAAAE,IAAA,YACMZ,cAAc,EAAAU,QAAA,CAAAE,IAAA,iBAAAF,QAAA,CAAAG,MAAA,kBAGnBd,cAAc,CAAC,KAAK,CAAC,CACrBT,mBAAmB,CAAC,CAAC,CAAC,wBAAAoB,QAAA,CAAAI,IAAA,OAAAP,OAAA,GACvB,GAAE,CAAC,CACN,CAAC,CAAE,CAACP,cAAc,CAAEV,mBAAmB,CAAC,CAAC,CAEzCL,SAAS,CAAC,UAAM,CACd,GAAI,CAAAgB,WAAW,SAAXA,WAAW,iBAAXA,WAAW,CAAEc,IAAI,IAAK,mBAAmB,CAAE,CAC7ChB,cAAc,CAAC,IAAI,CAAC,CACtB,CACF,CAAC,CAAE,CAACE,WAAW,CAAC,CAAC,CAEjB,MAAO,CAAAP,oBAAoB,CAC7B"},"metadata":{},"sourceType":"module"}