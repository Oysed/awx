{"ast":null,"code":"import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{i18n}from\"@lingui/core\";import React,{useState}from'react';import{Link,useHistory}from'react-router-dom';import{Button,Tooltip}from'@patternfly/react-core';import{Tr,Td}from'@patternfly/react-table';import{RocketIcon}from'@patternfly/react-icons';import{SystemJobTemplatesAPI}from'api';import AlertModal from'components/AlertModal';import ErrorDetail from'components/ErrorDetail';import{ActionsTd,ActionItem}from'components/PaginatedTable';import LaunchManagementPrompt from'./LaunchManagementPrompt';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function ManagementJobListItem(_ref){var onLaunchError=_ref.onLaunchError,isPrompted=_ref.isPrompted,isSuperUser=_ref.isSuperUser,id=_ref.id,jobType=_ref.jobType,name=_ref.name,description=_ref.description;var detailsUrl=\"/management_jobs/\".concat(id);var history=useHistory();var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isLaunchLoading=_useState2[0],setIsLaunchLoading=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isManagementPromptOpen=_useState4[0],setIsManagementPromptOpen=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isManagementPromptLoading=_useState6[0],setIsManagementPromptLoading=_useState6[1];var _useState7=useState(null),_useState8=_slicedToArray(_useState7,2),managementPromptError=_useState8[0],setManagementPromptError=_useState8[1];var handleManagementPromptClick=function handleManagementPromptClick(){return setIsManagementPromptOpen(true);};var handleManagementPromptClose=function handleManagementPromptClose(){return setIsManagementPromptOpen(false);};var handleManagementPromptConfirm=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(days){var _yield$SystemJobTempl,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setIsManagementPromptLoading(true);_context.prev=1;_context.next=4;return SystemJobTemplatesAPI.launch(id,{extra_vars:{days:days}});case 4:_yield$SystemJobTempl=_context.sent;data=_yield$SystemJobTempl.data;history.push(\"/jobs/management/\".concat(data.id,\"/output\"));_context.next=12;break;case 9:_context.prev=9;_context.t0=_context[\"catch\"](1);setManagementPromptError(_context.t0);case 12:_context.prev=12;setIsManagementPromptLoading(false);return _context.finish(12);case 15:case\"end\":return _context.stop();}}},_callee,null,[[1,9,12,15]]);}));return function handleManagementPromptConfirm(_x){return _ref2.apply(this,arguments);};}();var handleLaunch=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var _yield$SystemJobTempl2,data;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:setIsLaunchLoading(true);_context2.prev=1;_context2.next=4;return SystemJobTemplatesAPI.launch(id);case 4:_yield$SystemJobTempl2=_context2.sent;data=_yield$SystemJobTempl2.data;history.push(\"/jobs/management/\".concat(data.id,\"/output\"));_context2.next=12;break;case 9:_context2.prev=9;_context2.t0=_context2[\"catch\"](1);onLaunchError(_context2.t0);case 12:_context2.prev=12;setIsLaunchLoading(false);return _context2.finish(12);case 15:case\"end\":return _context2.stop();}}},_callee2,null,[[1,9,12,15]]);}));return function handleLaunch(){return _ref3.apply(this,arguments);};}();var rowId=\"mgmt-jobs-row-\".concat(jobType?jobType.replace('_','-'):'');return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(Tr,{id:rowId,ouiaId:rowId,children:[/*#__PURE__*/_jsx(Td,{}),/*#__PURE__*/_jsx(Td,{dataLabel:/*i18n*/i18n._(\"Name\"),children:/*#__PURE__*/_jsx(Link,{to:\"\".concat(detailsUrl),children:/*#__PURE__*/_jsx(\"b\",{children:name})})}),/*#__PURE__*/_jsx(Td,{dataLabel:/*i18n*/i18n._(\"Description\"),children:description}),/*#__PURE__*/_jsx(ActionsTd,{dataLabel:/*i18n*/i18n._(\"Actions\"),children:/*#__PURE__*/_jsx(ActionItem,{visible:isSuperUser,children:isSuperUser?/*#__PURE__*/_jsxs(_Fragment,{children:[isPrompted?/*#__PURE__*/_jsx(LaunchManagementPrompt,{isOpen:isManagementPromptOpen,isLoading:isManagementPromptLoading,onClick:handleManagementPromptClick,onClose:handleManagementPromptClose,onConfirm:handleManagementPromptConfirm,defaultDays:30}):/*#__PURE__*/_jsx(Tooltip,{content:/*i18n*/i18n._(\"Launch management job\"),position:\"left\",children:/*#__PURE__*/_jsx(Button,{ouiaId:\"\".concat(id,\"-launch-button\"),\"aria-label\":/*i18n*/i18n._(\"Launch management job\"),variant:\"plain\",onClick:handleLaunch,isDisabled:isLaunchLoading,children:/*#__PURE__*/_jsx(RocketIcon,{})})}),' ']}):null})})]}),managementPromptError&&/*#__PURE__*/_jsx(AlertModal,{isOpen:managementPromptError,variant:\"danger\",onClose:function onClose(){return setManagementPromptError(null);},title:/*i18n*/i18n._(\"Management job launch error\"),label:/*i18n*/i18n._(\"Management job launch error\"),children:/*#__PURE__*/_jsx(ErrorDetail,{error:managementPromptError})})]});}export default ManagementJobListItem;","map":{"version":3,"names":["React","useState","Link","useHistory","Button","Tooltip","Tr","Td","RocketIcon","SystemJobTemplatesAPI","AlertModal","ErrorDetail","ActionsTd","ActionItem","LaunchManagementPrompt","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","ManagementJobListItem","_ref","onLaunchError","isPrompted","isSuperUser","id","jobType","name","description","detailsUrl","concat","history","_useState","_useState2","_slicedToArray","isLaunchLoading","setIsLaunchLoading","_useState3","_useState4","isManagementPromptOpen","setIsManagementPromptOpen","_useState5","_useState6","isManagementPromptLoading","setIsManagementPromptLoading","_useState7","_useState8","managementPromptError","setManagementPromptError","handleManagementPromptClick","handleManagementPromptClose","handleManagementPromptConfirm","_ref2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","days","_yield$SystemJobTempl","data","wrap","_callee$","_context","prev","next","launch","extra_vars","sent","push","t0","finish","stop","_x","apply","arguments","handleLaunch","_ref3","_callee2","_yield$SystemJobTempl2","_callee2$","_context2","rowId","replace","children","ouiaId","dataLabel","i18n","_","to","visible","isOpen","isLoading","onClick","onClose","onConfirm","defaultDays","content","position","variant","isDisabled","title","label","error"],"sources":["/awx_devel/awx/ui/src/screens/ManagementJob/ManagementJobList/ManagementJobListItem.js"],"sourcesContent":["import React, { useState } from 'react';\n\nimport { t } from '@lingui/macro';\nimport { Link, useHistory } from 'react-router-dom';\nimport { Button, Tooltip } from '@patternfly/react-core';\nimport { Tr, Td } from '@patternfly/react-table';\nimport { RocketIcon } from '@patternfly/react-icons';\n\nimport { SystemJobTemplatesAPI } from 'api';\nimport AlertModal from 'components/AlertModal';\nimport ErrorDetail from 'components/ErrorDetail';\nimport { ActionsTd, ActionItem } from 'components/PaginatedTable';\nimport LaunchManagementPrompt from './LaunchManagementPrompt';\n\nfunction ManagementJobListItem({\n  onLaunchError,\n  isPrompted,\n  isSuperUser,\n  id,\n  jobType,\n  name,\n  description,\n}) {\n  const detailsUrl = `/management_jobs/${id}`;\n\n  const history = useHistory();\n  const [isLaunchLoading, setIsLaunchLoading] = useState(false);\n\n  const [isManagementPromptOpen, setIsManagementPromptOpen] = useState(false);\n  const [isManagementPromptLoading, setIsManagementPromptLoading] =\n    useState(false);\n  const [managementPromptError, setManagementPromptError] = useState(null);\n  const handleManagementPromptClick = () => setIsManagementPromptOpen(true);\n  const handleManagementPromptClose = () => setIsManagementPromptOpen(false);\n\n  const handleManagementPromptConfirm = async (days) => {\n    setIsManagementPromptLoading(true);\n    try {\n      const { data } = await SystemJobTemplatesAPI.launch(id, {\n        extra_vars: { days },\n      });\n      history.push(`/jobs/management/${data.id}/output`);\n    } catch (error) {\n      setManagementPromptError(error);\n    } finally {\n      setIsManagementPromptLoading(false);\n    }\n  };\n\n  const handleLaunch = async () => {\n    setIsLaunchLoading(true);\n    try {\n      const { data } = await SystemJobTemplatesAPI.launch(id);\n      history.push(`/jobs/management/${data.id}/output`);\n    } catch (error) {\n      onLaunchError(error);\n    } finally {\n      setIsLaunchLoading(false);\n    }\n  };\n\n  const rowId = `mgmt-jobs-row-${jobType ? jobType.replace('_', '-') : ''}`;\n  return (\n    <>\n      <Tr id={rowId} ouiaId={rowId}>\n        <Td />\n        <Td dataLabel={t`Name`}>\n          <Link to={`${detailsUrl}`}>\n            <b>{name}</b>\n          </Link>\n        </Td>\n        <Td dataLabel={t`Description`}>{description}</Td>\n        <ActionsTd dataLabel={t`Actions`}>\n          <ActionItem visible={isSuperUser}>\n            {isSuperUser ? (\n              <>\n                {isPrompted ? (\n                  <LaunchManagementPrompt\n                    isOpen={isManagementPromptOpen}\n                    isLoading={isManagementPromptLoading}\n                    onClick={handleManagementPromptClick}\n                    onClose={handleManagementPromptClose}\n                    onConfirm={handleManagementPromptConfirm}\n                    defaultDays={30}\n                  />\n                ) : (\n                  <Tooltip content={t`Launch management job`} position=\"left\">\n                    <Button\n                      ouiaId={`${id}-launch-button`}\n                      aria-label={t`Launch management job`}\n                      variant=\"plain\"\n                      onClick={handleLaunch}\n                      isDisabled={isLaunchLoading}\n                    >\n                      <RocketIcon />\n                    </Button>\n                  </Tooltip>\n                )}{' '}\n              </>\n            ) : null}\n          </ActionItem>\n        </ActionsTd>\n      </Tr>\n      {managementPromptError && (\n        <AlertModal\n          isOpen={managementPromptError}\n          variant=\"danger\"\n          onClose={() => setManagementPromptError(null)}\n          title={t`Management job launch error`}\n          label={t`Management job launch error`}\n        >\n          <ErrorDetail error={managementPromptError} />\n        </AlertModal>\n      )}\n    </>\n  );\n}\n\nexport default ManagementJobListItem;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}