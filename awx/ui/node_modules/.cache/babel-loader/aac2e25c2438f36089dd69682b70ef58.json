{"ast":null,"code":"import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{RootAPI,UsersAPI}from'api';import bootstrapPendo from'./bootstrapPendo';function buildPendoOptions(config,pendoApiKey){var towerVersion=config.version.split('-')[0];var trial=config.trial?config.trial:false;return{apiKey:pendoApiKey,visitor:{id:0,role:null},account:{id:'tower.ansible.com',planLevel:config.license_type,planPrice:config.instance_count,creationDate:config.license_date,trial:trial,tower_version:towerVersion,ansible_version:config.ansible_version}};}function buildPendoOptionsRole(_x,_x2){return _buildPendoOptionsRole.apply(this,arguments);}function _buildPendoOptionsRole(){_buildPendoOptionsRole=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(options,config){var _yield$UsersAPI$readA,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;if(!config.me.is_superuser){_context.next=5;break;}options.visitor.role='admin';_context.next=10;break;case 5:_context.next=7;return UsersAPI.readAdminOfOrganizations(config.me.id);case 7:_yield$UsersAPI$readA=_context.sent;data=_yield$UsersAPI$readA.data;if(data.count>0){options.visitor.role='orgadmin';}else{options.visitor.role='user';}case 10:return _context.abrupt(\"return\",options);case 13:_context.prev=13;_context.t0=_context[\"catch\"](0);throw new Error(_context.t0);case 16:case\"end\":return _context.stop();}}},_callee,null,[[0,13]]);}));return _buildPendoOptionsRole.apply(this,arguments);}function issuePendoIdentity(_x3){return _issuePendoIdentity.apply(this,arguments);}function _issuePendoIdentity(){_issuePendoIdentity=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(config){var _yield$RootAPI$readAs,PENDO_API_KEY,pendoOptions,pendoOptionsWithRole;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!('license_info'in config)){config.license_info={};}config.license_info.analytics_status=config.analytics_status;config.license_info.version=config.version;config.license_info.ansible_version=config.ansible_version;if(!(config.analytics_status!=='off')){_context2.next=16;break;}_context2.next=7;return RootAPI.readAssetVariables();case 7:_yield$RootAPI$readAs=_context2.sent;PENDO_API_KEY=_yield$RootAPI$readAs.data.PENDO_API_KEY;if(!(PENDO_API_KEY&&PENDO_API_KEY!=='')){_context2.next=16;break;}bootstrapPendo(PENDO_API_KEY);pendoOptions=buildPendoOptions(config,PENDO_API_KEY);_context2.next=14;return buildPendoOptionsRole(pendoOptions,config);case 14:pendoOptionsWithRole=_context2.sent;window.pendo.initialize(pendoOptionsWithRole);case 16:case\"end\":return _context2.stop();}}},_callee2);}));return _issuePendoIdentity.apply(this,arguments);}export default issuePendoIdentity;","map":{"version":3,"names":["RootAPI","UsersAPI","bootstrapPendo","buildPendoOptions","config","pendoApiKey","towerVersion","version","split","trial","apiKey","visitor","id","role","account","planLevel","license_type","planPrice","instance_count","creationDate","license_date","tower_version","ansible_version","buildPendoOptionsRole","_x","_x2","_buildPendoOptionsRole","apply","arguments","_asyncToGenerator","_regeneratorRuntime","mark","_callee","options","_yield$UsersAPI$readA","data","wrap","_callee$","_context","prev","next","me","is_superuser","readAdminOfOrganizations","sent","count","abrupt","t0","Error","stop","issuePendoIdentity","_x3","_issuePendoIdentity","_callee2","_yield$RootAPI$readAs","PENDO_API_KEY","pendoOptions","pendoOptionsWithRole","_callee2$","_context2","license_info","analytics_status","readAssetVariables","window","pendo","initialize"],"sources":["/awx_devel/awx/ui/src/util/issuePendoIdentity.js"],"sourcesContent":["import { RootAPI, UsersAPI } from 'api';\nimport bootstrapPendo from './bootstrapPendo';\n\nfunction buildPendoOptions(config, pendoApiKey) {\n  const towerVersion = config.version.split('-')[0];\n  const trial = config.trial ? config.trial : false;\n\n  return {\n    apiKey: pendoApiKey,\n    visitor: {\n      id: 0,\n      role: null,\n    },\n    account: {\n      id: 'tower.ansible.com',\n      planLevel: config.license_type,\n      planPrice: config.instance_count,\n      creationDate: config.license_date,\n      trial,\n      tower_version: towerVersion,\n      ansible_version: config.ansible_version,\n    },\n  };\n}\n\nasync function buildPendoOptionsRole(options, config) {\n  try {\n    if (config.me.is_superuser) {\n      options.visitor.role = 'admin';\n    } else {\n      const { data } = await UsersAPI.readAdminOfOrganizations(config.me.id);\n      if (data.count > 0) {\n        options.visitor.role = 'orgadmin';\n      } else {\n        options.visitor.role = 'user';\n      }\n    }\n    return options;\n  } catch (error) {\n    throw new Error(error);\n  }\n}\n\nasync function issuePendoIdentity(config) {\n  if (!('license_info' in config)) {\n    config.license_info = {};\n  }\n  config.license_info.analytics_status = config.analytics_status;\n  config.license_info.version = config.version;\n  config.license_info.ansible_version = config.ansible_version;\n\n  if (config.analytics_status !== 'off') {\n    const {\n      data: { PENDO_API_KEY },\n    } = await RootAPI.readAssetVariables();\n    if (PENDO_API_KEY && PENDO_API_KEY !== '') {\n      bootstrapPendo(PENDO_API_KEY);\n      const pendoOptions = buildPendoOptions(config, PENDO_API_KEY);\n      const pendoOptionsWithRole = await buildPendoOptionsRole(\n        pendoOptions,\n        config\n      );\n      window.pendo.initialize(pendoOptionsWithRole);\n    }\n  }\n}\n\nexport default issuePendoIdentity;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}