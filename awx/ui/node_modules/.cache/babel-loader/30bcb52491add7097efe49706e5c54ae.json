{"ast":null,"code":"import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useState,useEffect,useRef}from'react';export default function useWebsocket(subscribeGroups){var _useState=useState(null),_useState2=_slicedToArray(_useState,2),lastMessage=_useState2[0],setLastMessage=_useState2[1];var ws=useRef(null);useEffect(function(){ws.current=new WebSocket(\"\".concat(window.location.protocol==='http:'?'ws:':'wss:',\"//\").concat(window.location.host).concat(window.location.pathname,\"websocket/\"));var connect=function connect(){var xrftoken=\"; \".concat(document.cookie).split('; csrftoken=').pop().split(';').shift();ws.current.send(JSON.stringify({xrftoken:xrftoken,groups:subscribeGroups}));};ws.current.onopen=connect;ws.current.onmessage=function(e){setLastMessage(JSON.parse(e.data));};ws.current.onclose=function(e){if(e.code!==1000){// eslint-disable-next-line no-console\nconsole.debug('Socket closed. Reconnecting...',e);setTimeout(function(){connect();},1000);}};ws.current.onerror=function(err){// eslint-disable-next-line no-console\nconsole.debug('Socket error: ',err,'Disconnecting...');ws.current.close();};return function(){ws.current.close();};},[]);// eslint-disable-line react-hooks/exhaustive-deps\nreturn lastMessage;}","map":{"version":3,"names":["useState","useEffect","useRef","useWebsocket","subscribeGroups","_useState","_useState2","_slicedToArray","lastMessage","setLastMessage","ws","current","WebSocket","concat","window","location","protocol","host","pathname","connect","xrftoken","document","cookie","split","pop","shift","send","JSON","stringify","groups","onopen","onmessage","e","parse","data","onclose","code","console","debug","setTimeout","onerror","err","close"],"sources":["/awx_devel/awx/ui/src/hooks/useWebsocket.js"],"sourcesContent":["import { useState, useEffect, useRef } from 'react';\n\nexport default function useWebsocket(subscribeGroups) {\n  const [lastMessage, setLastMessage] = useState(null);\n  const ws = useRef(null);\n\n  useEffect(() => {\n    ws.current = new WebSocket(\n      `${window.location.protocol === 'http:' ? 'ws:' : 'wss:'}//${\n        window.location.host\n      }${window.location.pathname}websocket/`\n    );\n\n    const connect = () => {\n      const xrftoken = `; ${document.cookie}`\n        .split('; csrftoken=')\n        .pop()\n        .split(';')\n        .shift();\n      ws.current.send(\n        JSON.stringify({\n          xrftoken,\n          groups: subscribeGroups,\n        })\n      );\n    };\n    ws.current.onopen = connect;\n\n    ws.current.onmessage = (e) => {\n      setLastMessage(JSON.parse(e.data));\n    };\n\n    ws.current.onclose = (e) => {\n      if (e.code !== 1000) {\n        // eslint-disable-next-line no-console\n        console.debug('Socket closed. Reconnecting...', e);\n        setTimeout(() => {\n          connect();\n        }, 1000);\n      }\n    };\n\n    ws.current.onerror = (err) => {\n      // eslint-disable-next-line no-console\n      console.debug('Socket error: ', err, 'Disconnecting...');\n      ws.current.close();\n    };\n\n    return () => {\n      ws.current.close();\n    };\n  }, []); // eslint-disable-line react-hooks/exhaustive-deps\n\n  return lastMessage;\n}\n"],"mappings":"uGAAA,OAASA,QAAQ,CAAEC,SAAS,CAAEC,MAAM,KAAQ,OAAO,CAEnD,cAAe,SAAS,CAAAC,YAAYA,CAACC,eAAe,CAAE,CACpD,IAAAC,SAAA,CAAsCL,QAAQ,CAAC,IAAI,CAAC,CAAAM,UAAA,CAAAC,cAAA,CAAAF,SAAA,IAA7CG,WAAW,CAAAF,UAAA,IAAEG,cAAc,CAAAH,UAAA,IAClC,GAAM,CAAAI,EAAE,CAAGR,MAAM,CAAC,IAAI,CAAC,CAEvBD,SAAS,CAAC,UAAM,CACdS,EAAE,CAACC,OAAO,CAAG,GAAI,CAAAC,SAAS,IAAAC,MAAA,CACrBC,MAAM,CAACC,QAAQ,CAACC,QAAQ,GAAK,OAAO,CAAG,KAAK,CAAG,MAAM,OAAAH,MAAA,CACtDC,MAAM,CAACC,QAAQ,CAACE,IAAI,EAAAJ,MAAA,CACnBC,MAAM,CAACC,QAAQ,CAACG,QAAQ,cAC7B,CAAC,CAED,GAAM,CAAAC,OAAO,CAAG,QAAV,CAAAA,OAAOA,CAAA,CAAS,CACpB,GAAM,CAAAC,QAAQ,CAAG,KAAAP,MAAA,CAAKQ,QAAQ,CAACC,MAAM,EAClCC,KAAK,CAAC,cAAc,CAAC,CACrBC,GAAG,CAAC,CAAC,CACLD,KAAK,CAAC,GAAG,CAAC,CACVE,KAAK,CAAC,CAAC,CACVf,EAAE,CAACC,OAAO,CAACe,IAAI,CACbC,IAAI,CAACC,SAAS,CAAC,CACbR,QAAQ,CAARA,QAAQ,CACRS,MAAM,CAAEzB,eACV,CAAC,CACH,CAAC,CACH,CAAC,CACDM,EAAE,CAACC,OAAO,CAACmB,MAAM,CAAGX,OAAO,CAE3BT,EAAE,CAACC,OAAO,CAACoB,SAAS,CAAG,SAACC,CAAC,CAAK,CAC5BvB,cAAc,CAACkB,IAAI,CAACM,KAAK,CAACD,CAAC,CAACE,IAAI,CAAC,CAAC,CACpC,CAAC,CAEDxB,EAAE,CAACC,OAAO,CAACwB,OAAO,CAAG,SAACH,CAAC,CAAK,CAC1B,GAAIA,CAAC,CAACI,IAAI,GAAK,IAAI,CAAE,CACnB;AACAC,OAAO,CAACC,KAAK,CAAC,gCAAgC,CAAEN,CAAC,CAAC,CAClDO,UAAU,CAAC,UAAM,CACfpB,OAAO,CAAC,CAAC,CACX,CAAC,CAAE,IAAI,CAAC,CACV,CACF,CAAC,CAEDT,EAAE,CAACC,OAAO,CAAC6B,OAAO,CAAG,SAACC,GAAG,CAAK,CAC5B;AACAJ,OAAO,CAACC,KAAK,CAAC,gBAAgB,CAAEG,GAAG,CAAE,kBAAkB,CAAC,CACxD/B,EAAE,CAACC,OAAO,CAAC+B,KAAK,CAAC,CAAC,CACpB,CAAC,CAED,MAAO,WAAM,CACXhC,EAAE,CAACC,OAAO,CAAC+B,KAAK,CAAC,CAAC,CACpB,CAAC,CACH,CAAC,CAAE,EAAE,CAAC,CAAE;AAER,MAAO,CAAAlC,WAAW,CACpB"},"metadata":{},"sourceType":"module"}