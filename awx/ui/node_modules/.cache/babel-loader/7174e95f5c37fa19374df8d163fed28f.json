{"ast":null,"code":"import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _objectWithoutProperties from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";var _excluded=[\"instance_groups\",\"organization\"];import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import React,{useCallback,useEffect}from'react';import{useHistory}from'react-router-dom';import{Inventory}from'types';import useRequest from'hooks/useRequest';import{InventoriesAPI}from'api';import{CardBody}from'components/Card';import ContentError from'components/ContentError';import ContentLoading from'components/ContentLoading';import SmartInventoryForm from'../shared/SmartInventoryForm';import parseHostFilter from'../shared/utils';import{jsx as _jsx}from\"react/jsx-runtime\";function SmartInventoryEdit(_ref){var inventory=_ref.inventory;var history=useHistory();var detailsUrl=\"/inventories/smart_inventory/\".concat(inventory.id,\"/details\");var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _yield$InventoriesAPI,results;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return InventoriesAPI.readInstanceGroups(inventory.id);case 2:_yield$InventoriesAPI=_context.sent;results=_yield$InventoriesAPI.data.results;return _context.abrupt(\"return\",results);case 5:case\"end\":return _context.stop();}}},_callee);})),[inventory.id]),[]),contentError=_useRequest.error,hasContentLoading=_useRequest.isLoading,fetchInstanceGroups=_useRequest.request,initialInstanceGroups=_useRequest.result;useEffect(function(){fetchInstanceGroups();},[fetchInstanceGroups]);var _useRequest2=useRequest(useCallback(/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(values,groupsToAssociate,groupsToDisassociate){var _yield$InventoriesAPI2,data;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return InventoriesAPI.update(inventory.id,values);case 2:_yield$InventoriesAPI2=_context2.sent;data=_yield$InventoriesAPI2.data;_context2.next=6;return InventoriesAPI.orderInstanceGroups(inventory.id,groupsToAssociate,groupsToDisassociate);case 6:return _context2.abrupt(\"return\",data);case 7:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x,_x2,_x3){return _ref3.apply(this,arguments);};}(),[inventory.id])),submitError=_useRequest2.error,submitRequest=_useRequest2.request,submitResult=_useRequest2.result;useEffect(function(){if(submitResult){history.push({pathname:detailsUrl,search:''});}},[submitResult,detailsUrl,history]);var handleSubmit=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(form){var modifiedForm,instance_groups,organization,remainingForm;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:modifiedForm=parseHostFilter(form);instance_groups=modifiedForm.instance_groups,organization=modifiedForm.organization,remainingForm=_objectWithoutProperties(modifiedForm,_excluded);_context3.next=4;return submitRequest(_objectSpread({organization:organization===null||organization===void 0?void 0:organization.id},remainingForm),instance_groups,initialInstanceGroups);case 4:case\"end\":return _context3.stop();}}},_callee3);}));return function handleSubmit(_x4){return _ref4.apply(this,arguments);};}();var handleCancel=function handleCancel(){history.push({pathname:detailsUrl,search:''});};if(hasContentLoading){return/*#__PURE__*/_jsx(ContentLoading,{});}if(contentError){return/*#__PURE__*/_jsx(ContentError,{error:contentError});}return/*#__PURE__*/_jsx(CardBody,{children:/*#__PURE__*/_jsx(SmartInventoryForm,{inventory:inventory,instanceGroups:initialInstanceGroups,onCancel:handleCancel,onSubmit:handleSubmit,submitError:submitError})});}export default SmartInventoryEdit;","map":{"version":3,"names":["React","useCallback","useEffect","useHistory","Inventory","useRequest","InventoriesAPI","CardBody","ContentError","ContentLoading","SmartInventoryForm","parseHostFilter","jsx","_jsx","SmartInventoryEdit","_ref","inventory","history","detailsUrl","concat","id","_useRequest","_asyncToGenerator","_regeneratorRuntime","mark","_callee","_yield$InventoriesAPI","results","wrap","_callee$","_context","prev","next","readInstanceGroups","sent","data","abrupt","stop","contentError","error","hasContentLoading","isLoading","fetchInstanceGroups","request","initialInstanceGroups","result","_useRequest2","_ref3","_callee2","values","groupsToAssociate","groupsToDisassociate","_yield$InventoriesAPI2","_callee2$","_context2","update","orderInstanceGroups","_x","_x2","_x3","apply","arguments","submitError","submitRequest","submitResult","push","pathname","search","handleSubmit","_ref4","_callee3","form","modifiedForm","instance_groups","organization","remainingForm","_callee3$","_context3","_objectWithoutProperties","_excluded","_objectSpread","_x4","handleCancel","children","instanceGroups","onCancel","onSubmit"],"sources":["/awx_devel/awx/ui/src/screens/Inventory/SmartInventoryEdit/SmartInventoryEdit.js"],"sourcesContent":["import React, { useCallback, useEffect } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport { Inventory } from 'types';\nimport useRequest from 'hooks/useRequest';\nimport { InventoriesAPI } from 'api';\nimport { CardBody } from 'components/Card';\nimport ContentError from 'components/ContentError';\nimport ContentLoading from 'components/ContentLoading';\nimport SmartInventoryForm from '../shared/SmartInventoryForm';\nimport parseHostFilter from '../shared/utils';\n\nfunction SmartInventoryEdit({ inventory }) {\n  const history = useHistory();\n  const detailsUrl = `/inventories/smart_inventory/${inventory.id}/details`;\n\n  const {\n    error: contentError,\n    isLoading: hasContentLoading,\n    request: fetchInstanceGroups,\n    result: initialInstanceGroups,\n  } = useRequest(\n    useCallback(async () => {\n      const {\n        data: { results },\n      } = await InventoriesAPI.readInstanceGroups(inventory.id);\n      return results;\n    }, [inventory.id]),\n    []\n  );\n\n  useEffect(() => {\n    fetchInstanceGroups();\n  }, [fetchInstanceGroups]);\n\n  const {\n    error: submitError,\n    request: submitRequest,\n    result: submitResult,\n  } = useRequest(\n    useCallback(\n      async (values, groupsToAssociate, groupsToDisassociate) => {\n        const { data } = await InventoriesAPI.update(inventory.id, values);\n        await InventoriesAPI.orderInstanceGroups(\n          inventory.id,\n          groupsToAssociate,\n          groupsToDisassociate\n        );\n        return data;\n      },\n      [inventory.id]\n    )\n  );\n\n  useEffect(() => {\n    if (submitResult) {\n      history.push({\n        pathname: detailsUrl,\n        search: '',\n      });\n    }\n  }, [submitResult, detailsUrl, history]);\n\n  const handleSubmit = async (form) => {\n    const modifiedForm = parseHostFilter(form);\n    const { instance_groups, organization, ...remainingForm } = modifiedForm;\n\n    await submitRequest(\n      {\n        organization: organization?.id,\n        ...remainingForm,\n      },\n      instance_groups,\n      initialInstanceGroups\n    );\n  };\n\n  const handleCancel = () => {\n    history.push({\n      pathname: detailsUrl,\n      search: '',\n    });\n  };\n\n  if (hasContentLoading) {\n    return <ContentLoading />;\n  }\n\n  if (contentError) {\n    return <ContentError error={contentError} />;\n  }\n\n  return (\n    <CardBody>\n      <SmartInventoryForm\n        inventory={inventory}\n        instanceGroups={initialInstanceGroups}\n        onCancel={handleCancel}\n        onSubmit={handleSubmit}\n        submitError={submitError}\n      />\n    </CardBody>\n  );\n}\n\nSmartInventoryEdit.propTypes = {\n  inventory: Inventory.isRequired,\n};\n\nexport default SmartInventoryEdit;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}