{"ast":null,"code":"import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{useState,useEffect}from'react';import useWebsocket from'hooks/useWebsocket';import{ProjectsAPI}from'api';export default function useWsProjects(initialProject){var _useState=useState(initialProject),_useState2=_slicedToArray(_useState,2),project=_useState2[0],setProject=_useState2[1];var lastMessage=useWebsocket({jobs:['status_changed'],control:['limit_reached_1']});var refreshProject=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _yield$ProjectsAPI$re,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return ProjectsAPI.readDetail(project.id);case 2:_yield$ProjectsAPI$re=_context.sent;data=_yield$ProjectsAPI$re.data;setProject(data);case 5:case\"end\":return _context.stop();}}},_callee);}));return function refreshProject(){return _ref.apply(this,arguments);};}();useEffect(function(){setProject(initialProject);},[initialProject]);useEffect(function(){if(!project||!(lastMessage!==null&&lastMessage!==void 0&&lastMessage.unified_job_id)||lastMessage.type!=='project_update'){return;}if(lastMessage.finished){refreshProject();return;}var updatedProject=_objectSpread(_objectSpread({},project),{},{summary_fields:_objectSpread(_objectSpread({},project.summary_fields),{},{current_job:{id:lastMessage.unified_job_id,status:lastMessage.status,finished:lastMessage.finished}})});setProject(updatedProject);},[lastMessage]// eslint-disable-line react-hooks/exhaustive-deps\n);return project;}","map":{"version":3,"names":["useState","useEffect","useWebsocket","ProjectsAPI","useWsProjects","initialProject","_useState","_useState2","_slicedToArray","project","setProject","lastMessage","jobs","control","refreshProject","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","_yield$ProjectsAPI$re","data","wrap","_callee$","_context","prev","next","readDetail","id","sent","stop","apply","arguments","unified_job_id","type","finished","updatedProject","_objectSpread","summary_fields","current_job","status"],"sources":["/awx_devel/awx/ui/src/screens/Project/ProjectDetail/useWsProject.js"],"sourcesContent":["import { useState, useEffect } from 'react';\nimport useWebsocket from 'hooks/useWebsocket';\nimport { ProjectsAPI } from 'api';\n\nexport default function useWsProjects(initialProject) {\n  const [project, setProject] = useState(initialProject);\n  const lastMessage = useWebsocket({\n    jobs: ['status_changed'],\n    control: ['limit_reached_1'],\n  });\n\n  const refreshProject = async () => {\n    const { data } = await ProjectsAPI.readDetail(project.id);\n    setProject(data);\n  };\n\n  useEffect(() => {\n    setProject(initialProject);\n  }, [initialProject]);\n\n  useEffect(\n    () => {\n      if (\n        !project ||\n        !lastMessage?.unified_job_id ||\n        lastMessage.type !== 'project_update'\n      ) {\n        return;\n      }\n\n      if (lastMessage.finished) {\n        refreshProject();\n        return;\n      }\n\n      const updatedProject = {\n        ...project,\n        summary_fields: {\n          ...project.summary_fields,\n          current_job: {\n            id: lastMessage.unified_job_id,\n            status: lastMessage.status,\n            finished: lastMessage.finished,\n          },\n        },\n      };\n      setProject(updatedProject);\n    },\n    [lastMessage] // eslint-disable-line react-hooks/exhaustive-deps\n  );\n\n  return project;\n}\n"],"mappings":"8ZAAA,OAASA,QAAQ,CAAEC,SAAS,KAAQ,OAAO,CAC3C,MAAO,CAAAC,YAAY,KAAM,oBAAoB,CAC7C,OAASC,WAAW,KAAQ,KAAK,CAEjC,cAAe,SAAS,CAAAC,aAAaA,CAACC,cAAc,CAAE,CACpD,IAAAC,SAAA,CAA8BN,QAAQ,CAACK,cAAc,CAAC,CAAAE,UAAA,CAAAC,cAAA,CAAAF,SAAA,IAA/CG,OAAO,CAAAF,UAAA,IAAEG,UAAU,CAAAH,UAAA,IAC1B,GAAM,CAAAI,WAAW,CAAGT,YAAY,CAAC,CAC/BU,IAAI,CAAE,CAAC,gBAAgB,CAAC,CACxBC,OAAO,CAAE,CAAC,iBAAiB,CAC7B,CAAC,CAAC,CAEF,GAAM,CAAAC,cAAc,6BAAAC,IAAA,CAAAC,iBAAA,cAAAC,mBAAA,CAAAC,IAAA,CAAG,SAAAC,QAAA,MAAAC,qBAAA,CAAAC,IAAA,QAAAJ,mBAAA,CAAAK,IAAA,UAAAC,SAAAC,QAAA,kBAAAA,QAAA,CAAAC,IAAA,CAAAD,QAAA,CAAAE,IAAA,SAAAF,QAAA,CAAAE,IAAA,SACE,CAAAvB,WAAW,CAACwB,UAAU,CAAClB,OAAO,CAACmB,EAAE,CAAC,QAAAR,qBAAA,CAAAI,QAAA,CAAAK,IAAA,CAAjDR,IAAI,CAAAD,qBAAA,CAAJC,IAAI,CACZX,UAAU,CAACW,IAAI,CAAC,CAAC,wBAAAG,QAAA,CAAAM,IAAA,OAAAX,OAAA,GAClB,kBAHK,CAAAL,cAAcA,CAAA,SAAAC,IAAA,CAAAgB,KAAA,MAAAC,SAAA,OAGnB,CAED/B,SAAS,CAAC,UAAM,CACdS,UAAU,CAACL,cAAc,CAAC,CAC5B,CAAC,CAAE,CAACA,cAAc,CAAC,CAAC,CAEpBJ,SAAS,CACP,UAAM,CACJ,GACE,CAACQ,OAAO,EACR,EAACE,WAAW,SAAXA,WAAW,WAAXA,WAAW,CAAEsB,cAAc,GAC5BtB,WAAW,CAACuB,IAAI,GAAK,gBAAgB,CACrC,CACA,OACF,CAEA,GAAIvB,WAAW,CAACwB,QAAQ,CAAE,CACxBrB,cAAc,CAAC,CAAC,CAChB,OACF,CAEA,GAAM,CAAAsB,cAAc,CAAAC,aAAA,CAAAA,aAAA,IACf5B,OAAO,MACV6B,cAAc,CAAAD,aAAA,CAAAA,aAAA,IACT5B,OAAO,CAAC6B,cAAc,MACzBC,WAAW,CAAE,CACXX,EAAE,CAAEjB,WAAW,CAACsB,cAAc,CAC9BO,MAAM,CAAE7B,WAAW,CAAC6B,MAAM,CAC1BL,QAAQ,CAAExB,WAAW,CAACwB,QACxB,CAAC,EACF,EACF,CACDzB,UAAU,CAAC0B,cAAc,CAAC,CAC5B,CAAC,CACD,CAACzB,WAAW,CAAE;AAChB,CAAC,CAED,MAAO,CAAAF,OAAO,CAChB"},"metadata":{},"sourceType":"module"}