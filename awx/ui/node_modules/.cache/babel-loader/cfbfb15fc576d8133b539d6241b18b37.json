{"ast":null,"code":"import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{i18n}from\"@lingui/core\";import React,{useCallback}from'react';import{useRouteMatch}from'react-router-dom';import{Button,Tooltip}from'@patternfly/react-core';import{SyncIcon}from'@patternfly/react-icons';import useRequest,{useDismissableError}from'hooks/useRequest';import AlertModal from'components/AlertModal';import ErrorDetail from'components/ErrorDetail';import{ProjectsAPI}from'api';import getProjectHelpStrings from'./Project.helptext';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";function ProjectSyncButton(_ref){var projectId=_ref.projectId,_ref$lastJobStatus=_ref.lastJobStatus,lastJobStatus=_ref$lastJobStatus===void 0?null:_ref$lastJobStatus;var projectHelpStrings=getProjectHelpStrings();var match=useRouteMatch();var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return ProjectsAPI.sync(projectId);case 2:case\"end\":return _context.stop();}}},_callee);})),[projectId]),null),handleSync=_useRequest.request,syncError=_useRequest.error;var _useDismissableError=useDismissableError(syncError),error=_useDismissableError.error,dismissError=_useDismissableError.dismissError;var isDetailsView=match.url.endsWith('/details');var isDisabled=['pending','waiting','running'].includes(lastJobStatus);return/*#__PURE__*/_jsxs(_Fragment,{children:[isDisabled?/*#__PURE__*/_jsx(Tooltip,{content:projectHelpStrings.syncButtonDisabled,position:\"top\",children:/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(Button,{ouiaId:\"\".concat(projectId,\"-sync-button\"),\"aria-label\":/*i18n*/i18n._(\"Sync Project\"),variant:isDetailsView?'secondary':'plain',isDisabled:isDisabled,children:match.url.endsWith('/details')?/*i18n*/i18n._(\"Sync\"):/*#__PURE__*/_jsx(SyncIcon,{})})})}):/*#__PURE__*/_jsx(Button,{ouiaId:\"\".concat(projectId,\"-sync-button\"),\"aria-label\":/*i18n*/i18n._(\"Sync Project\"),variant:isDetailsView?'secondary':'plain',isDisabled:isDisabled,onClick:handleSync,children:match.url.endsWith('/details')?/*i18n*/i18n._(\"Sync\"):/*#__PURE__*/_jsx(SyncIcon,{})}),error&&/*#__PURE__*/_jsxs(AlertModal,{isOpen:error,variant:\"error\",title:/*i18n*/i18n._(\"Error!\"),onClose:dismissError,children:[/*i18n*/i18n._(\"Failed to sync project.\"),/*#__PURE__*/_jsx(ErrorDetail,{error:error})]})]});}export default ProjectSyncButton;","map":{"version":3,"names":["React","useCallback","useRouteMatch","Button","Tooltip","SyncIcon","useRequest","useDismissableError","AlertModal","ErrorDetail","ProjectsAPI","getProjectHelpStrings","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","ProjectSyncButton","_ref","projectId","_ref$lastJobStatus","lastJobStatus","projectHelpStrings","match","_useRequest","_asyncToGenerator","_regeneratorRuntime","mark","_callee","wrap","_callee$","_context","prev","next","sync","stop","handleSync","request","syncError","error","_useDismissableError","dismissError","isDetailsView","url","endsWith","isDisabled","includes","children","content","syncButtonDisabled","position","ouiaId","concat","i18n","_","variant","onClick","isOpen","title","onClose"],"sources":["/awx_devel/awx/ui/src/screens/Project/shared/ProjectSyncButton.js"],"sourcesContent":["import React, { useCallback } from 'react';\nimport { useRouteMatch } from 'react-router-dom';\nimport { Button, Tooltip } from '@patternfly/react-core';\nimport { SyncIcon } from '@patternfly/react-icons';\n\nimport { number } from 'prop-types';\n\nimport { t } from '@lingui/macro';\nimport useRequest, { useDismissableError } from 'hooks/useRequest';\n\nimport AlertModal from 'components/AlertModal';\nimport ErrorDetail from 'components/ErrorDetail';\nimport { ProjectsAPI } from 'api';\nimport getProjectHelpStrings from './Project.helptext';\n\nfunction ProjectSyncButton({ projectId, lastJobStatus = null }) {\n  const projectHelpStrings = getProjectHelpStrings();\n  const match = useRouteMatch();\n\n  const { request: handleSync, error: syncError } = useRequest(\n    useCallback(async () => {\n      await ProjectsAPI.sync(projectId);\n    }, [projectId]),\n    null\n  );\n  const { error, dismissError } = useDismissableError(syncError);\n  const isDetailsView = match.url.endsWith('/details');\n  const isDisabled = ['pending', 'waiting', 'running'].includes(lastJobStatus);\n\n  return (\n    <>\n      {isDisabled ? (\n        <Tooltip content={projectHelpStrings.syncButtonDisabled} position=\"top\">\n          <div>\n            <Button\n              ouiaId={`${projectId}-sync-button`}\n              aria-label={t`Sync Project`}\n              variant={isDetailsView ? 'secondary' : 'plain'}\n              isDisabled={isDisabled}\n            >\n              {match.url.endsWith('/details') ? t`Sync` : <SyncIcon />}\n            </Button>\n          </div>\n        </Tooltip>\n      ) : (\n        <Button\n          ouiaId={`${projectId}-sync-button`}\n          aria-label={t`Sync Project`}\n          variant={isDetailsView ? 'secondary' : 'plain'}\n          isDisabled={isDisabled}\n          onClick={handleSync}\n        >\n          {match.url.endsWith('/details') ? t`Sync` : <SyncIcon />}\n        </Button>\n      )}\n      {error && (\n        <AlertModal\n          isOpen={error}\n          variant=\"error\"\n          title={t`Error!`}\n          onClose={dismissError}\n        >\n          {t`Failed to sync project.`}\n          <ErrorDetail error={error} />\n        </AlertModal>\n      )}\n    </>\n  );\n}\n\nProjectSyncButton.propTypes = {\n  projectId: number.isRequired,\n};\n\nexport default ProjectSyncButton;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}