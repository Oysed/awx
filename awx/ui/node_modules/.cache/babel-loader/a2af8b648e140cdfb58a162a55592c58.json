{"ast":null,"code":"import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{i18n}from\"@lingui/core\";import React,{useEffect,useCallback}from'react';import{useLocation}from'react-router-dom';import{SystemJobTemplatesAPI}from'api';import{getQSConfig,parseQueryString}from'util/qs';import useRequest from'hooks/useRequest';import DataListToolbar from'components/DataListToolbar';import CheckboxListItem from'components/CheckboxListItem';import PaginatedTable,{HeaderCell,HeaderRow,getSearchableKeys}from'components/PaginatedTable';import{jsx as _jsx}from\"react/jsx-runtime\";var QS_CONFIG=getQSConfig('system-job-templates',{page:1,page_size:5,order_by:'name'});function SystemJobTemplatesList(_ref){var nodeResource=_ref.nodeResource,onUpdateNodeResource=_ref.onUpdateNodeResource;var location=useLocation();var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _actionsResponse$data,_actionsResponse$data2;var params,_yield$Promise$all,_yield$Promise$all2,response,actionsResponse;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:params=parseQueryString(QS_CONFIG,location.search);_context.next=3;return Promise.all([SystemJobTemplatesAPI.read(params,{role_level:'execute_role'}),SystemJobTemplatesAPI.readOptions()]);case 3:_yield$Promise$all=_context.sent;_yield$Promise$all2=_slicedToArray(_yield$Promise$all,2);response=_yield$Promise$all2[0];actionsResponse=_yield$Promise$all2[1];return _context.abrupt(\"return\",{systemJobTemplates:response.data.results,count:response.data.count,relatedSearchableKeys:((actionsResponse===null||actionsResponse===void 0?void 0:(_actionsResponse$data=actionsResponse.data)===null||_actionsResponse$data===void 0?void 0:_actionsResponse$data.related_search_fields)||[]).map(function(val){return val.slice(0,-8);}),searchableKeys:getSearchableKeys((_actionsResponse$data2=actionsResponse.data.actions)===null||_actionsResponse$data2===void 0?void 0:_actionsResponse$data2.GET)});case 8:case\"end\":return _context.stop();}}},_callee);})),[location]),{systemJobTemplates:[],count:0,relatedSearchableKeys:[],searchableKeys:[]}),_useRequest$result=_useRequest.result,systemJobTemplates=_useRequest$result.systemJobTemplates,count=_useRequest$result.count,relatedSearchableKeys=_useRequest$result.relatedSearchableKeys,searchableKeys=_useRequest$result.searchableKeys,error=_useRequest.error,isLoading=_useRequest.isLoading,fetchWorkflowJobTemplates=_useRequest.request;useEffect(function(){fetchWorkflowJobTemplates();},[fetchWorkflowJobTemplates]);return/*#__PURE__*/_jsx(PaginatedTable,{contentError:error,hasContentLoading:isLoading,itemCount:count,items:systemJobTemplates,qsConfig:QS_CONFIG,headerRow:/*#__PURE__*/_jsx(HeaderRow,{isExpandable:false,qsConfig:QS_CONFIG,children:/*#__PURE__*/_jsx(HeaderCell,{sortKey:\"name\",children:/*i18n*/i18n._(\"Name\")})}),renderRow:function renderRow(item,index){return/*#__PURE__*/_jsx(CheckboxListItem,{rowIndex:index,isSelected:!!(nodeResource&&nodeResource.id===item.id),itemId:item.id,name:item.name,label:item.name,onSelect:function onSelect(){return onUpdateNodeResource(item);},onDeselect:function onDeselect(){return onUpdateNodeResource(null);},isRadio:true},item.id);},renderToolbar:function renderToolbar(props){return/*#__PURE__*/_jsx(DataListToolbar,_objectSpread(_objectSpread({},props),{},{fillWidth:true}));},showPageSizeOptions:false,toolbarSearchColumns:[{name:/*i18n*/i18n._(\"Name\"),key:'name__icontains',isDefault:true}],toolbarSearchableKeys:searchableKeys,toolbarRelatedSearchableKeys:relatedSearchableKeys});}SystemJobTemplatesList.defaultProps={nodeResource:null};export default SystemJobTemplatesList;","map":{"version":3,"names":["React","useEffect","useCallback","useLocation","SystemJobTemplatesAPI","getQSConfig","parseQueryString","useRequest","DataListToolbar","CheckboxListItem","PaginatedTable","HeaderCell","HeaderRow","getSearchableKeys","jsx","_jsx","QS_CONFIG","page","page_size","order_by","SystemJobTemplatesList","_ref","nodeResource","onUpdateNodeResource","location","_useRequest","_asyncToGenerator","_regeneratorRuntime","mark","_callee","_actionsResponse$data","_actionsResponse$data2","params","_yield$Promise$all","_yield$Promise$all2","response","actionsResponse","wrap","_callee$","_context","prev","next","search","Promise","all","read","role_level","readOptions","sent","_slicedToArray","abrupt","systemJobTemplates","data","results","count","relatedSearchableKeys","related_search_fields","map","val","slice","searchableKeys","actions","GET","stop","_useRequest$result","result","error","isLoading","fetchWorkflowJobTemplates","request","contentError","hasContentLoading","itemCount","items","qsConfig","headerRow","isExpandable","children","sortKey","i18n","_","renderRow","item","index","rowIndex","isSelected","id","itemId","name","label","onSelect","onDeselect","isRadio","renderToolbar","props","_objectSpread","fillWidth","showPageSizeOptions","toolbarSearchColumns","key","isDefault","toolbarSearchableKeys","toolbarRelatedSearchableKeys","defaultProps"],"sources":["/awx_devel/awx/ui/src/screens/Template/WorkflowJobTemplateVisualizer/Modals/NodeModals/NodeTypeStep/SystemJobTemplatesList.js"],"sourcesContent":["import React, { useEffect, useCallback } from 'react';\nimport { useLocation } from 'react-router-dom';\nimport { t } from '@lingui/macro';\nimport { func, shape } from 'prop-types';\nimport { SystemJobTemplatesAPI } from 'api';\nimport { getQSConfig, parseQueryString } from 'util/qs';\nimport useRequest from 'hooks/useRequest';\nimport DataListToolbar from 'components/DataListToolbar';\nimport CheckboxListItem from 'components/CheckboxListItem';\nimport PaginatedTable, {\n  HeaderCell,\n  HeaderRow,\n  getSearchableKeys,\n} from 'components/PaginatedTable';\n\nconst QS_CONFIG = getQSConfig('system-job-templates', {\n  page: 1,\n  page_size: 5,\n  order_by: 'name',\n});\n\nfunction SystemJobTemplatesList({ nodeResource, onUpdateNodeResource }) {\n  const location = useLocation();\n\n  const {\n    result: {\n      systemJobTemplates,\n      count,\n      relatedSearchableKeys,\n      searchableKeys,\n    },\n    error,\n    isLoading,\n    request: fetchWorkflowJobTemplates,\n  } = useRequest(\n    useCallback(async () => {\n      const params = parseQueryString(QS_CONFIG, location.search);\n      const [response, actionsResponse] = await Promise.all([\n        SystemJobTemplatesAPI.read(params, {\n          role_level: 'execute_role',\n        }),\n        SystemJobTemplatesAPI.readOptions(),\n      ]);\n      return {\n        systemJobTemplates: response.data.results,\n        count: response.data.count,\n        relatedSearchableKeys: (\n          actionsResponse?.data?.related_search_fields || []\n        ).map((val) => val.slice(0, -8)),\n        searchableKeys: getSearchableKeys(actionsResponse.data.actions?.GET),\n      };\n    }, [location]),\n    {\n      systemJobTemplates: [],\n      count: 0,\n      relatedSearchableKeys: [],\n      searchableKeys: [],\n    }\n  );\n\n  useEffect(() => {\n    fetchWorkflowJobTemplates();\n  }, [fetchWorkflowJobTemplates]);\n\n  return (\n    <PaginatedTable\n      contentError={error}\n      hasContentLoading={isLoading}\n      itemCount={count}\n      items={systemJobTemplates}\n      qsConfig={QS_CONFIG}\n      headerRow={\n        <HeaderRow isExpandable={false} qsConfig={QS_CONFIG}>\n          <HeaderCell sortKey=\"name\">{t`Name`}</HeaderCell>\n        </HeaderRow>\n      }\n      renderRow={(item, index) => (\n        <CheckboxListItem\n          rowIndex={index}\n          isSelected={!!(nodeResource && nodeResource.id === item.id)}\n          itemId={item.id}\n          key={item.id}\n          name={item.name}\n          label={item.name}\n          onSelect={() => onUpdateNodeResource(item)}\n          onDeselect={() => onUpdateNodeResource(null)}\n          isRadio\n        />\n      )}\n      renderToolbar={(props) => <DataListToolbar {...props} fillWidth />}\n      showPageSizeOptions={false}\n      toolbarSearchColumns={[\n        {\n          name: t`Name`,\n          key: 'name__icontains',\n          isDefault: true,\n        },\n      ]}\n      toolbarSearchableKeys={searchableKeys}\n      toolbarRelatedSearchableKeys={relatedSearchableKeys}\n    />\n  );\n}\n\nSystemJobTemplatesList.propTypes = {\n  nodeResource: shape(),\n  onUpdateNodeResource: func.isRequired,\n};\n\nSystemJobTemplatesList.defaultProps = {\n  nodeResource: null,\n};\n\nexport default SystemJobTemplatesList;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}