{"ast":null,"code":"import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{i18n}from\"@lingui/core\";import React,{useCallback,useContext,useEffect,useMemo}from'react';import{useRouteMatch}from'react-router-dom';import{ConfigAPI,MeAPI,UsersAPI,OrganizationsAPI}from'api';import useRequest,{useDismissableError}from'hooks/useRequest';import AlertModal from'components/AlertModal';import ErrorDetail from'components/ErrorDetail';import{useSession}from'./Session';import{SettingsAPI}from'../api';// eslint-disable-next-line import/prefer-default-export\nimport{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export var ConfigContext=/*#__PURE__*/React.createContext({});ConfigContext.displayName='ConfigContext';export var Config=ConfigContext.Consumer;export var useConfig=function useConfig(){var context=useContext(ConfigContext);if(context===undefined){throw new Error('useConfig must be used within a ConfigProvider');}return context;};export var ConfigProvider=function ConfigProvider(_ref){var children=_ref.children;var _useSession=useSession(),logout=_useSession.logout;var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _yield$Promise$all,_yield$Promise$all2,data,_yield$Promise$all2$,me,systemConfig,_yield$SettingsAPI$re,systemConfigResults,_yield$Promise$all3,_yield$Promise$all4,adminOrgCount,notifAdminCount,execEnvAdminCount;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return Promise.all([ConfigAPI.read(),MeAPI.read()]);case 2:_yield$Promise$all=_context.sent;_yield$Promise$all2=_slicedToArray(_yield$Promise$all,2);data=_yield$Promise$all2[0].data;_yield$Promise$all2$=_slicedToArray(_yield$Promise$all2[1].data.results,1);me=_yield$Promise$all2$[0];systemConfig={};if(!(me!==null&&me!==void 0&&me.is_superuser||me!==null&&me!==void 0&&me.is_system_auditor)){_context.next=14;break;}_context.next=11;return SettingsAPI.readSystem();case 11:_yield$SettingsAPI$re=_context.sent;systemConfigResults=_yield$SettingsAPI$re.data;systemConfig=systemConfigResults;case 14:_context.next=16;return Promise.all([UsersAPI.readAdminOfOrganizations(me===null||me===void 0?void 0:me.id),OrganizationsAPI.read({page_size:1,role_level:'notification_admin_role'}),OrganizationsAPI.read({page_size:1,role_level:'execution_environment_admin_role'})]);case 16:_yield$Promise$all3=_context.sent;_yield$Promise$all4=_slicedToArray(_yield$Promise$all3,3);adminOrgCount=_yield$Promise$all4[0].data.count;notifAdminCount=_yield$Promise$all4[1].data.count;execEnvAdminCount=_yield$Promise$all4[2].data.count;return _context.abrupt(\"return\",_objectSpread(_objectSpread({},data),{},{me:me,adminOrgCount:adminOrgCount,notifAdminCount:notifAdminCount,execEnvAdminCount:execEnvAdminCount,systemConfig:systemConfig}));case 22:case\"end\":return _context.stop();}}},_callee);})),[]),{adminOrgCount:0,notifAdminCount:0,execEnvAdminCount:0,systemConfig:{}}),configError=_useRequest.error,isLoading=_useRequest.isLoading,request=_useRequest.request,config=_useRequest.result;var _useDismissableError=useDismissableError(configError),error=_useDismissableError.error,dismissError=_useDismissableError.dismissError;useEffect(function(){request();},[request]);useEffect(function(){var _error$response;if((error===null||error===void 0?void 0:(_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.status)===401){logout();}},[error,logout]);var value=useMemo(function(){return _objectSpread(_objectSpread({},config),{},{request:request,isLoading:isLoading});},[config,request,isLoading]);return/*#__PURE__*/_jsxs(ConfigContext.Provider,{value:value,children:[error&&/*#__PURE__*/_jsxs(AlertModal,{isOpen:error,variant:\"error\",title:/*i18n*/i18n._(\"Error!\"),onClose:dismissError,ouiaId:\"config-error-modal\",children:[/*i18n*/i18n._(\"Failed to retrieve configuration.\"),/*#__PURE__*/_jsx(ErrorDetail,{error:error})]}),children]});};export var useUserProfile=function useUserProfile(){var _config$me,_config$me2;var config=useConfig();return{isSuperUser:!!((_config$me=config.me)!==null&&_config$me!==void 0&&_config$me.is_superuser),isSystemAuditor:!!((_config$me2=config.me)!==null&&_config$me2!==void 0&&_config$me2.is_system_auditor),isOrgAdmin:config.adminOrgCount,isNotificationAdmin:config.notifAdminCount,isExecEnvAdmin:config.execEnvAdminCount,systemConfig:config.systemConfig};};export var useAuthorizedPath=function useAuthorizedPath(){var _config$license_info;var config=useConfig();var subscriptionMgmtRoute=useRouteMatch({path:'/subscription_management'});return!!((_config$license_info=config.license_info)!==null&&_config$license_info!==void 0&&_config$license_info.valid_key)&&!subscriptionMgmtRoute;};","map":{"version":3,"names":["React","useCallback","useContext","useEffect","useMemo","useRouteMatch","ConfigAPI","MeAPI","UsersAPI","OrganizationsAPI","useRequest","useDismissableError","AlertModal","ErrorDetail","useSession","SettingsAPI","jsx","_jsx","jsxs","_jsxs","ConfigContext","createContext","displayName","Config","Consumer","useConfig","context","undefined","Error","ConfigProvider","_ref","children","_useSession","logout","_useRequest","_asyncToGenerator","_regeneratorRuntime","mark","_callee","_yield$Promise$all","_yield$Promise$all2","data","_yield$Promise$all2$","me","systemConfig","_yield$SettingsAPI$re","systemConfigResults","_yield$Promise$all3","_yield$Promise$all4","adminOrgCount","notifAdminCount","execEnvAdminCount","wrap","_callee$","_context","prev","next","Promise","all","read","sent","_slicedToArray","results","is_superuser","is_system_auditor","readSystem","readAdminOfOrganizations","id","page_size","role_level","count","abrupt","_objectSpread","stop","configError","error","isLoading","request","config","result","_useDismissableError","dismissError","_error$response","response","status","value","Provider","isOpen","variant","title","i18n","_","onClose","ouiaId","useUserProfile","_config$me","_config$me2","isSuperUser","isSystemAuditor","isOrgAdmin","isNotificationAdmin","isExecEnvAdmin","useAuthorizedPath","_config$license_info","subscriptionMgmtRoute","path","license_info","valid_key"],"sources":["/awx_devel/awx/ui/src/contexts/Config.js"],"sourcesContent":["import React, { useCallback, useContext, useEffect, useMemo } from 'react';\nimport { useRouteMatch } from 'react-router-dom';\n\nimport { t } from '@lingui/macro';\n\nimport { ConfigAPI, MeAPI, UsersAPI, OrganizationsAPI } from 'api';\nimport useRequest, { useDismissableError } from 'hooks/useRequest';\nimport AlertModal from 'components/AlertModal';\nimport ErrorDetail from 'components/ErrorDetail';\nimport { useSession } from './Session';\nimport { SettingsAPI } from '../api';\n\n// eslint-disable-next-line import/prefer-default-export\nexport const ConfigContext = React.createContext({});\nConfigContext.displayName = 'ConfigContext';\n\nexport const Config = ConfigContext.Consumer;\nexport const useConfig = () => {\n  const context = useContext(ConfigContext);\n  if (context === undefined) {\n    throw new Error('useConfig must be used within a ConfigProvider');\n  }\n  return context;\n};\n\nexport const ConfigProvider = ({ children }) => {\n  const { logout } = useSession();\n\n  const {\n    error: configError,\n    isLoading,\n    request,\n    result: config,\n  } = useRequest(\n    useCallback(async () => {\n      const [\n        { data },\n        {\n          data: {\n            results: [me],\n          },\n        },\n      ] = await Promise.all([ConfigAPI.read(), MeAPI.read()]);\n      let systemConfig = {};\n      if (me?.is_superuser || me?.is_system_auditor) {\n        const { data: systemConfigResults } = await SettingsAPI.readSystem();\n        systemConfig = systemConfigResults;\n      }\n\n      const [\n        {\n          data: { count: adminOrgCount },\n        },\n        {\n          data: { count: notifAdminCount },\n        },\n        {\n          data: { count: execEnvAdminCount },\n        },\n      ] = await Promise.all([\n        UsersAPI.readAdminOfOrganizations(me?.id),\n        OrganizationsAPI.read({\n          page_size: 1,\n          role_level: 'notification_admin_role',\n        }),\n        OrganizationsAPI.read({\n          page_size: 1,\n          role_level: 'execution_environment_admin_role',\n        }),\n      ]);\n      return {\n        ...data,\n        me,\n        adminOrgCount,\n        notifAdminCount,\n        execEnvAdminCount,\n        systemConfig,\n      };\n    }, []),\n    {\n      adminOrgCount: 0,\n      notifAdminCount: 0,\n      execEnvAdminCount: 0,\n      systemConfig: {},\n    }\n  );\n\n  const { error, dismissError } = useDismissableError(configError);\n\n  useEffect(() => {\n    request();\n  }, [request]);\n\n  useEffect(() => {\n    if (error?.response?.status === 401) {\n      logout();\n    }\n  }, [error, logout]);\n\n  const value = useMemo(\n    () => ({ ...config, request, isLoading }),\n    [config, request, isLoading]\n  );\n\n  return (\n    <ConfigContext.Provider value={value}>\n      {error && (\n        <AlertModal\n          isOpen={error}\n          variant=\"error\"\n          title={t`Error!`}\n          onClose={dismissError}\n          ouiaId=\"config-error-modal\"\n        >\n          {t`Failed to retrieve configuration.`}\n          <ErrorDetail error={error} />\n        </AlertModal>\n      )}\n      {children}\n    </ConfigContext.Provider>\n  );\n};\n\nexport const useUserProfile = () => {\n  const config = useConfig();\n  return {\n    isSuperUser: !!config.me?.is_superuser,\n    isSystemAuditor: !!config.me?.is_system_auditor,\n    isOrgAdmin: config.adminOrgCount,\n    isNotificationAdmin: config.notifAdminCount,\n    isExecEnvAdmin: config.execEnvAdminCount,\n    systemConfig: config.systemConfig,\n  };\n};\n\nexport const useAuthorizedPath = () => {\n  const config = useConfig();\n  const subscriptionMgmtRoute = useRouteMatch({\n    path: '/subscription_management',\n  });\n  return !!config.license_info?.valid_key && !subscriptionMgmtRoute;\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}