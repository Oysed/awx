{"ast":null,"code":"import _createForOfIteratorHelper from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import React,{useState}from'react';import{useHistory}from'react-router-dom';import{CardBody}from'components/Card';import{OrganizationsAPI}from'api';import OrganizationForm from'../shared/OrganizationForm';import{jsx as _jsx}from\"react/jsx-runtime\";var isEqual=function isEqual(array1,array2){return array1.length===array2.length&&array1.every(function(element,index){return element.id===array2[index].id;});};function OrganizationEdit(_ref){var organization=_ref.organization;var detailsUrl=\"/organizations/\".concat(organization.id,\"/details\");var history=useHistory();var _useState=useState(null),_useState2=_slicedToArray(_useState,2),formError=_useState2[0],setFormError=_useState2[1];var handleSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(values,groupsToAssociate,groupsToDisassociate){var _values$default_envir,_iterator,_step,credential,_iterator2,_step2,_credential;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return OrganizationsAPI.update(organization.id,_objectSpread(_objectSpread({},values),{},{default_environment:((_values$default_envir=values.default_environment)===null||_values$default_envir===void 0?void 0:_values$default_envir.id)||null}));case 3:_context.next=5;return OrganizationsAPI.orderInstanceGroups(organization.id,groupsToAssociate,groupsToDisassociate);case 5:if(isEqual(organization.galaxy_credentials,values.galaxy_credentials)){_context.next=40;break;}_iterator=_createForOfIteratorHelper(organization.galaxy_credentials);_context.prev=7;_iterator.s();case 9:if((_step=_iterator.n()).done){_context.next=15;break;}credential=_step.value;_context.next=13;return OrganizationsAPI.disassociateGalaxyCredential(organization.id,credential.id);case 13:_context.next=9;break;case 15:_context.next=20;break;case 17:_context.prev=17;_context.t0=_context[\"catch\"](7);_iterator.e(_context.t0);case 20:_context.prev=20;_iterator.f();return _context.finish(20);case 23:_iterator2=_createForOfIteratorHelper(values.galaxy_credentials);_context.prev=24;_iterator2.s();case 26:if((_step2=_iterator2.n()).done){_context.next=32;break;}_credential=_step2.value;_context.next=30;return OrganizationsAPI.associateGalaxyCredential(organization.id,_credential.id);case 30:_context.next=26;break;case 32:_context.next=37;break;case 34:_context.prev=34;_context.t1=_context[\"catch\"](24);_iterator2.e(_context.t1);case 37:_context.prev=37;_iterator2.f();return _context.finish(37);case 40:/* eslint-enable no-await-in-loop, no-restricted-syntax */history.push(detailsUrl);_context.next=46;break;case 43:_context.prev=43;_context.t2=_context[\"catch\"](0);setFormError(_context.t2);case 46:case\"end\":return _context.stop();}}},_callee,null,[[0,43],[7,17,20,23],[24,34,37,40]]);}));return function handleSubmit(_x,_x2,_x3){return _ref2.apply(this,arguments);};}();var handleCancel=function handleCancel(){history.push(detailsUrl);};return/*#__PURE__*/_jsx(CardBody,{children:/*#__PURE__*/_jsx(OrganizationForm,{organization:organization,onSubmit:handleSubmit,onCancel:handleCancel,submitError:formError})});}export{OrganizationEdit as _OrganizationEdit};export default OrganizationEdit;","map":{"version":3,"names":["React","useState","useHistory","CardBody","OrganizationsAPI","OrganizationForm","jsx","_jsx","isEqual","array1","array2","length","every","element","index","id","OrganizationEdit","_ref","organization","detailsUrl","concat","history","_useState","_useState2","_slicedToArray","formError","setFormError","handleSubmit","_ref2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","values","groupsToAssociate","groupsToDisassociate","_values$default_envir","_iterator","_step","credential","_iterator2","_step2","_credential","wrap","_callee$","_context","prev","next","update","_objectSpread","default_environment","orderInstanceGroups","galaxy_credentials","_createForOfIteratorHelper","s","n","done","value","disassociateGalaxyCredential","t0","e","f","finish","associateGalaxyCredential","t1","push","t2","stop","_x","_x2","_x3","apply","arguments","handleCancel","children","onSubmit","onCancel","submitError","_OrganizationEdit"],"sources":["/awx_devel/awx/ui/src/screens/Organization/OrganizationEdit/OrganizationEdit.js"],"sourcesContent":["import React, { useState } from 'react';\nimport PropTypes from 'prop-types';\nimport { useHistory } from 'react-router-dom';\nimport { CardBody } from 'components/Card';\nimport { OrganizationsAPI } from 'api';\nimport OrganizationForm from '../shared/OrganizationForm';\n\nconst isEqual = (array1, array2) =>\n  array1.length === array2.length &&\n  array1.every((element, index) => element.id === array2[index].id);\n\nfunction OrganizationEdit({ organization }) {\n  const detailsUrl = `/organizations/${organization.id}/details`;\n  const history = useHistory();\n  const [formError, setFormError] = useState(null);\n\n  const handleSubmit = async (\n    values,\n    groupsToAssociate,\n    groupsToDisassociate\n  ) => {\n    try {\n      await OrganizationsAPI.update(organization.id, {\n        ...values,\n        default_environment: values.default_environment?.id || null,\n      });\n      await OrganizationsAPI.orderInstanceGroups(\n        organization.id,\n        groupsToAssociate,\n        groupsToDisassociate\n      );\n\n      /* eslint-disable no-await-in-loop, no-restricted-syntax */\n      // Resolve Promises sequentially to avoid race condition\n      if (\n        !isEqual(organization.galaxy_credentials, values.galaxy_credentials)\n      ) {\n        for (const credential of organization.galaxy_credentials) {\n          await OrganizationsAPI.disassociateGalaxyCredential(\n            organization.id,\n            credential.id\n          );\n        }\n        for (const credential of values.galaxy_credentials) {\n          await OrganizationsAPI.associateGalaxyCredential(\n            organization.id,\n            credential.id\n          );\n        }\n      }\n      /* eslint-enable no-await-in-loop, no-restricted-syntax */\n      history.push(detailsUrl);\n    } catch (error) {\n      setFormError(error);\n    }\n  };\n\n  const handleCancel = () => {\n    history.push(detailsUrl);\n  };\n\n  return (\n    <CardBody>\n      <OrganizationForm\n        organization={organization}\n        onSubmit={handleSubmit}\n        onCancel={handleCancel}\n        submitError={formError}\n      />\n    </CardBody>\n  );\n}\n\nOrganizationEdit.propTypes = {\n  organization: PropTypes.shape().isRequired,\n};\n\nexport { OrganizationEdit as _OrganizationEdit };\nexport default OrganizationEdit;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}