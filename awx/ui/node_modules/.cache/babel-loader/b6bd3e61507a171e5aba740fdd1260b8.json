{"ast":null,"code":"import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{i18n}from\"@lingui/core\";import React,{useCallback,useEffect}from'react';import{useHistory}from'react-router-dom';import{useField}from'formik';import{CredentialsAPI}from'api';import CheckboxListItem from'components/CheckboxListItem';import ContentError from'components/ContentError';import DataListToolbar from'components/DataListToolbar';import{getQSConfig,parseQueryString}from'util/qs';import useRequest from'hooks/useRequest';import PaginatedTable,{HeaderCell,HeaderRow,getSearchableKeys}from'components/PaginatedTable';import{jsx as _jsx}from\"react/jsx-runtime\";var QS_CONFIG=getQSConfig('credential',{page:1,page_size:5,order_by:'name',credential_type__kind:'external'});function CredentialsStep(){var _useField=useField('credential'),_useField2=_slicedToArray(_useField,3),selectedCredential=_useField2[0],selectedCredentialHelper=_useField2[2];var history=useHistory();var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _actionsResponse$data,_actionsResponse$data2;var params,_yield$Promise$all,_yield$Promise$all2,data,actionsResponse;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:params=parseQueryString(QS_CONFIG,history.location.search);_context.next=3;return Promise.all([CredentialsAPI.read(_objectSpread({},params)),CredentialsAPI.readOptions()]);case 3:_yield$Promise$all=_context.sent;_yield$Promise$all2=_slicedToArray(_yield$Promise$all,2);data=_yield$Promise$all2[0].data;actionsResponse=_yield$Promise$all2[1];return _context.abrupt(\"return\",{credentials:data.results,count:data.count,relatedSearchableKeys:((actionsResponse===null||actionsResponse===void 0?void 0:(_actionsResponse$data=actionsResponse.data)===null||_actionsResponse$data===void 0?void 0:_actionsResponse$data.related_search_fields)||[]).map(function(val){return val.slice(0,-8);}),searchableKeys:getSearchableKeys((_actionsResponse$data2=actionsResponse.data.actions)===null||_actionsResponse$data2===void 0?void 0:_actionsResponse$data2.GET)});case 8:case\"end\":return _context.stop();}}},_callee);})),[history.location.search]),{credentials:[],count:0,relatedSearchableKeys:[],searchableKeys:[]}),_useRequest$result=_useRequest.result,credentials=_useRequest$result.credentials,count=_useRequest$result.count,relatedSearchableKeys=_useRequest$result.relatedSearchableKeys,searchableKeys=_useRequest$result.searchableKeys,credentialsError=_useRequest.error,isCredentialsLoading=_useRequest.isLoading,fetchCredentials=_useRequest.request;useEffect(function(){fetchCredentials();},[fetchCredentials]);if(credentialsError){return/*#__PURE__*/_jsx(ContentError,{error:credentialsError});}return/*#__PURE__*/_jsx(PaginatedTable,{contentError:credentialsError,hasContentLoading:isCredentialsLoading,itemCount:count,items:credentials,qsConfig:QS_CONFIG,headerRow:/*#__PURE__*/_jsx(HeaderRow,{isExpandable:false,qsConfig:QS_CONFIG,children:/*#__PURE__*/_jsx(HeaderCell,{sortKey:\"name\",children:/*i18n*/i18n._(\"Name\")})}),renderRow:function renderRow(credential,index){var _selectedCredential$v;return/*#__PURE__*/_jsx(CheckboxListItem,{rowIndex:index,isSelected:(selectedCredential===null||selectedCredential===void 0?void 0:(_selectedCredential$v=selectedCredential.value)===null||_selectedCredential$v===void 0?void 0:_selectedCredential$v.id)===credential.id,itemId:credential.id,name:credential.name,label:credential.name,onSelect:function onSelect(){return selectedCredentialHelper.setValue(credential);},onDeselect:function onDeselect(){return selectedCredentialHelper.setValue(null);},isRadio:true},credential.id);},renderToolbar:function renderToolbar(props){return/*#__PURE__*/_jsx(DataListToolbar,_objectSpread(_objectSpread({},props),{},{fillWidth:true}));},showPageSizeOptions:false,toolbarSearchColumns:[{name:/*i18n*/i18n._(\"Name\"),key:'name__icontains',isDefault:true},{name:/*i18n*/i18n._(\"Created By (Username)\"),key:'created_by__username__icontains'},{name:/*i18n*/i18n._(\"Modified By (Username)\"),key:'modified_by__username__icontains'}],toolbarSearchableKeys:searchableKeys,toolbarRelatedSearchableKeys:relatedSearchableKeys});}export default CredentialsStep;","map":{"version":3,"names":["React","useCallback","useEffect","useHistory","useField","CredentialsAPI","CheckboxListItem","ContentError","DataListToolbar","getQSConfig","parseQueryString","useRequest","PaginatedTable","HeaderCell","HeaderRow","getSearchableKeys","jsx","_jsx","QS_CONFIG","page","page_size","order_by","credential_type__kind","CredentialsStep","_useField","_useField2","_slicedToArray","selectedCredential","selectedCredentialHelper","history","_useRequest","_asyncToGenerator","_regeneratorRuntime","mark","_callee","_actionsResponse$data","_actionsResponse$data2","params","_yield$Promise$all","_yield$Promise$all2","data","actionsResponse","wrap","_callee$","_context","prev","next","location","search","Promise","all","read","_objectSpread","readOptions","sent","abrupt","credentials","results","count","relatedSearchableKeys","related_search_fields","map","val","slice","searchableKeys","actions","GET","stop","_useRequest$result","result","credentialsError","error","isCredentialsLoading","isLoading","fetchCredentials","request","contentError","hasContentLoading","itemCount","items","qsConfig","headerRow","isExpandable","children","sortKey","i18n","_","renderRow","credential","index","_selectedCredential$v","rowIndex","isSelected","value","id","itemId","name","label","onSelect","setValue","onDeselect","isRadio","renderToolbar","props","fillWidth","showPageSizeOptions","toolbarSearchColumns","key","isDefault","toolbarSearchableKeys","toolbarRelatedSearchableKeys"],"sources":["/awx_devel/awx/ui/src/screens/Credential/shared/CredentialPlugins/CredentialPluginPrompt/CredentialsStep.js"],"sourcesContent":["import React, { useCallback, useEffect } from 'react';\nimport { useHistory } from 'react-router-dom';\n\nimport { t } from '@lingui/macro';\nimport { useField } from 'formik';\nimport { CredentialsAPI } from 'api';\nimport CheckboxListItem from 'components/CheckboxListItem';\nimport ContentError from 'components/ContentError';\nimport DataListToolbar from 'components/DataListToolbar';\nimport { getQSConfig, parseQueryString } from 'util/qs';\nimport useRequest from 'hooks/useRequest';\nimport PaginatedTable, {\n  HeaderCell,\n  HeaderRow,\n  getSearchableKeys,\n} from 'components/PaginatedTable';\n\nconst QS_CONFIG = getQSConfig('credential', {\n  page: 1,\n  page_size: 5,\n  order_by: 'name',\n  credential_type__kind: 'external',\n});\n\nfunction CredentialsStep() {\n  const [selectedCredential, , selectedCredentialHelper] =\n    useField('credential');\n  const history = useHistory();\n\n  const {\n    result: { credentials, count, relatedSearchableKeys, searchableKeys },\n    error: credentialsError,\n    isLoading: isCredentialsLoading,\n    request: fetchCredentials,\n  } = useRequest(\n    useCallback(async () => {\n      const params = parseQueryString(QS_CONFIG, history.location.search);\n      const [{ data }, actionsResponse] = await Promise.all([\n        CredentialsAPI.read({ ...params }),\n        CredentialsAPI.readOptions(),\n      ]);\n      return {\n        credentials: data.results,\n        count: data.count,\n        relatedSearchableKeys: (\n          actionsResponse?.data?.related_search_fields || []\n        ).map((val) => val.slice(0, -8)),\n        searchableKeys: getSearchableKeys(actionsResponse.data.actions?.GET),\n      };\n    }, [history.location.search]),\n    { credentials: [], count: 0, relatedSearchableKeys: [], searchableKeys: [] }\n  );\n\n  useEffect(() => {\n    fetchCredentials();\n  }, [fetchCredentials]);\n\n  if (credentialsError) {\n    return <ContentError error={credentialsError} />;\n  }\n\n  return (\n    <PaginatedTable\n      contentError={credentialsError}\n      hasContentLoading={isCredentialsLoading}\n      itemCount={count}\n      items={credentials}\n      qsConfig={QS_CONFIG}\n      headerRow={\n        <HeaderRow isExpandable={false} qsConfig={QS_CONFIG}>\n          <HeaderCell sortKey=\"name\">{t`Name`}</HeaderCell>\n        </HeaderRow>\n      }\n      renderRow={(credential, index) => (\n        <CheckboxListItem\n          rowIndex={index}\n          isSelected={selectedCredential?.value?.id === credential.id}\n          itemId={credential.id}\n          key={credential.id}\n          name={credential.name}\n          label={credential.name}\n          onSelect={() => selectedCredentialHelper.setValue(credential)}\n          onDeselect={() => selectedCredentialHelper.setValue(null)}\n          isRadio\n        />\n      )}\n      renderToolbar={(props) => <DataListToolbar {...props} fillWidth />}\n      showPageSizeOptions={false}\n      toolbarSearchColumns={[\n        {\n          name: t`Name`,\n          key: 'name__icontains',\n          isDefault: true,\n        },\n        {\n          name: t`Created By (Username)`,\n          key: 'created_by__username__icontains',\n        },\n        {\n          name: t`Modified By (Username)`,\n          key: 'modified_by__username__icontains',\n        },\n      ]}\n      toolbarSearchableKeys={searchableKeys}\n      toolbarRelatedSearchableKeys={relatedSearchableKeys}\n    />\n  );\n}\n\nexport default CredentialsStep;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}