{"ast":null,"code":"import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{i18n}from\"@lingui/core\";import React,{useCallback,useEffect}from'react';import{useHistory}from'react-router-dom';import{useField}from'formik';import{ExecutionEnvironmentsAPI}from'api';import{getSearchableKeys}from'components/PaginatedTable';import{getQSConfig,parseQueryString}from'util/qs';import useRequest from'hooks/useRequest';import OptionsList from'../../OptionsList';import ContentLoading from'../../ContentLoading';import ContentError from'../../ContentError';import{jsx as _jsx}from\"react/jsx-runtime\";var QS_CONFIG=getQSConfig('execution_environment',{page:1,page_size:5});function ExecutionEnvironmentStep(){var _useField=useField('execution_environment'),_useField2=_slicedToArray(_useField,3),field=_useField2[0],helpers=_useField2[2];var history=useHistory();var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _actionsResponse$data,_actionsResponse$data2;var params,_yield$Promise$all,_yield$Promise$all2,data,actionsResponse;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:params=parseQueryString(QS_CONFIG,history.location.search);_context.next=3;return Promise.all([ExecutionEnvironmentsAPI.read(params),ExecutionEnvironmentsAPI.readOptions()]);case 3:_yield$Promise$all=_context.sent;_yield$Promise$all2=_slicedToArray(_yield$Promise$all,2);data=_yield$Promise$all2[0].data;actionsResponse=_yield$Promise$all2[1];return _context.abrupt(\"return\",{execution_environments:data.results,count:data.count,relatedSearchableKeys:((actionsResponse===null||actionsResponse===void 0?void 0:(_actionsResponse$data=actionsResponse.data)===null||_actionsResponse$data===void 0?void 0:_actionsResponse$data.related_search_fields)||[]).map(function(val){return val.slice(0,-8);}),searchableKeys:getSearchableKeys((_actionsResponse$data2=actionsResponse.data.actions)===null||_actionsResponse$data2===void 0?void 0:_actionsResponse$data2.GET)});case 8:case\"end\":return _context.stop();}}},_callee);})),[history.location]),{count:0,execution_environments:[],relatedSearchableKeys:[],searchableKeys:[]}),isLoading=_useRequest.isLoading,error=_useRequest.error,_useRequest$result=_useRequest.result,execution_environments=_useRequest$result.execution_environments,count=_useRequest$result.count,relatedSearchableKeys=_useRequest$result.relatedSearchableKeys,searchableKeys=_useRequest$result.searchableKeys,fetchExecutionEnvironments=_useRequest.request;useEffect(function(){fetchExecutionEnvironments();},[fetchExecutionEnvironments]);if(isLoading){return/*#__PURE__*/_jsx(ContentLoading,{});}if(error){return/*#__PURE__*/_jsx(ContentError,{error:error});}return/*#__PURE__*/_jsx(\"div\",{\"data-cy\":\"execution-environment-prompt\",children:/*#__PURE__*/_jsx(OptionsList,{value:field.value?[field.value]:[],options:execution_environments,optionCount:count,columns:[{name:/*i18n*/i18n._(\"Name\"),key:'name'},{name:/*i18n*/i18n._(\"Image\"),key:'image'}],searchColumns:[{name:/*i18n*/i18n._(\"Name\"),key:'name__icontains',isDefault:true},{name:/*i18n*/i18n._(\"Image\"),key:'image__icontains'}],sortColumns:[{name:/*i18n*/i18n._(\"Name\"),key:'name'},{name:/*i18n*/i18n._(\"Image\"),key:'image'}],searchableKeys:searchableKeys,relatedSearchableKeys:relatedSearchableKeys,header:/*i18n*/i18n._(\"Execution Environments\"),name:\"execution_environment\",qsConfig:QS_CONFIG,readOnly:true,selectItem:helpers.setValue,deselectItem:function deselectItem(){return helpers.setValue(null);}})});}export default ExecutionEnvironmentStep;","map":{"version":3,"names":["React","useCallback","useEffect","useHistory","useField","ExecutionEnvironmentsAPI","getSearchableKeys","getQSConfig","parseQueryString","useRequest","OptionsList","ContentLoading","ContentError","jsx","_jsx","QS_CONFIG","page","page_size","ExecutionEnvironmentStep","_useField","_useField2","_slicedToArray","field","helpers","history","_useRequest","_asyncToGenerator","_regeneratorRuntime","mark","_callee","_actionsResponse$data","_actionsResponse$data2","params","_yield$Promise$all","_yield$Promise$all2","data","actionsResponse","wrap","_callee$","_context","prev","next","location","search","Promise","all","read","readOptions","sent","abrupt","execution_environments","results","count","relatedSearchableKeys","related_search_fields","map","val","slice","searchableKeys","actions","GET","stop","isLoading","error","_useRequest$result","result","fetchExecutionEnvironments","request","children","value","options","optionCount","columns","name","i18n","_","key","searchColumns","isDefault","sortColumns","header","qsConfig","readOnly","selectItem","setValue","deselectItem"],"sources":["/awx_devel/awx/ui/src/components/LaunchPrompt/steps/ExecutionEnvironmentStep.js"],"sourcesContent":["import React, { useCallback, useEffect } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport { t } from '@lingui/macro';\nimport { useField } from 'formik';\nimport { ExecutionEnvironmentsAPI } from 'api';\nimport { getSearchableKeys } from 'components/PaginatedTable';\nimport { getQSConfig, parseQueryString } from 'util/qs';\nimport useRequest from 'hooks/useRequest';\nimport OptionsList from '../../OptionsList';\nimport ContentLoading from '../../ContentLoading';\nimport ContentError from '../../ContentError';\n\nconst QS_CONFIG = getQSConfig('execution_environment', {\n  page: 1,\n  page_size: 5,\n});\n\nfunction ExecutionEnvironmentStep() {\n  const [field, , helpers] = useField('execution_environment');\n\n  const history = useHistory();\n\n  const {\n    isLoading,\n    error,\n    result: {\n      execution_environments,\n      count,\n      relatedSearchableKeys,\n      searchableKeys,\n    },\n    request: fetchExecutionEnvironments,\n  } = useRequest(\n    useCallback(async () => {\n      const params = parseQueryString(QS_CONFIG, history.location.search);\n      const [{ data }, actionsResponse] = await Promise.all([\n        ExecutionEnvironmentsAPI.read(params),\n        ExecutionEnvironmentsAPI.readOptions(),\n      ]);\n      return {\n        execution_environments: data.results,\n        count: data.count,\n        relatedSearchableKeys: (\n          actionsResponse?.data?.related_search_fields || []\n        ).map((val) => val.slice(0, -8)),\n        searchableKeys: getSearchableKeys(actionsResponse.data.actions?.GET),\n      };\n    }, [history.location]),\n    {\n      count: 0,\n      execution_environments: [],\n      relatedSearchableKeys: [],\n      searchableKeys: [],\n    }\n  );\n\n  useEffect(() => {\n    fetchExecutionEnvironments();\n  }, [fetchExecutionEnvironments]);\n\n  if (isLoading) {\n    return <ContentLoading />;\n  }\n  if (error) {\n    return <ContentError error={error} />;\n  }\n\n  return (\n    <div data-cy=\"execution-environment-prompt\">\n      <OptionsList\n        value={field.value ? [field.value] : []}\n        options={execution_environments}\n        optionCount={count}\n        columns={[\n          {\n            name: t`Name`,\n            key: 'name',\n          },\n          {\n            name: t`Image`,\n            key: 'image',\n          },\n        ]}\n        searchColumns={[\n          {\n            name: t`Name`,\n            key: 'name__icontains',\n            isDefault: true,\n          },\n          {\n            name: t`Image`,\n            key: 'image__icontains',\n          },\n        ]}\n        sortColumns={[\n          {\n            name: t`Name`,\n            key: 'name',\n          },\n          {\n            name: t`Image`,\n            key: 'image',\n          },\n        ]}\n        searchableKeys={searchableKeys}\n        relatedSearchableKeys={relatedSearchableKeys}\n        header={t`Execution Environments`}\n        name=\"execution_environment\"\n        qsConfig={QS_CONFIG}\n        readOnly\n        selectItem={helpers.setValue}\n        deselectItem={() => helpers.setValue(null)}\n      />\n    </div>\n  );\n}\n\nexport default ExecutionEnvironmentStep;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}