{"ast":null,"code":"import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{i18n}from\"@lingui/core\";import React,{useState,useEffect}from'react';import{Chip,ChipGroup,Select,SelectOption,SelectVariant}from'@patternfly/react-core';import{LabelsAPI}from'api';import useIsMounted from'hooks/useIsMounted';import{useSyncedSelectValue}from'../MultiSelect';import{jsx as _jsx}from\"react/jsx-runtime\";function loadLabelOptions(_x,_x2,_x3){return _loadLabelOptions.apply(this,arguments);}function _loadLabelOptions(){_loadLabelOptions=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(setLabels,onError,isMounted){var labels,_yield$LabelsAPI$read,data,_yield$LabelsAPI$read2,results;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(isMounted.current){_context2.next=2;break;}return _context2.abrupt(\"return\");case 2:_context2.prev=2;_context2.next=5;return LabelsAPI.read({page:1,page_size:200,order_by:'name'});case 5:_yield$LabelsAPI$read=_context2.sent;data=_yield$LabelsAPI$read.data;labels=data.results;setLabels(labels);if(!(data.next&&data.next.includes('page=2'))){_context2.next=15;break;}_context2.next=12;return LabelsAPI.read({page:2,page_size:200,order_by:'name'});case 12:_yield$LabelsAPI$read2=_context2.sent;results=_yield$LabelsAPI$read2.data.results;setLabels(labels.concat(results));case 15:_context2.next=20;break;case 17:_context2.prev=17;_context2.t0=_context2[\"catch\"](2);onError(_context2.t0);case 20:case\"end\":return _context2.stop();}}},_callee2,null,[[2,17]]);}));return _loadLabelOptions.apply(this,arguments);}function LabelSelect(_ref){var value=_ref.value,placeholder=_ref.placeholder,onChange=_ref.onChange,onError=_ref.onError,createText=_ref.createText;var _useState=useState(true),_useState2=_slicedToArray(_useState,2),isLoading=_useState2[0],setIsLoading=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isExpanded=_useState4[0],setIsExpanded=_useState4[1];var isMounted=useIsMounted();var _useSyncedSelectValue=useSyncedSelectValue(value,onChange),selections=_useSyncedSelectValue.selections,_onSelect=_useSyncedSelectValue.onSelect,options=_useSyncedSelectValue.options,setOptions=_useSyncedSelectValue.setOptions;var toggleExpanded=function toggleExpanded(toggleValue){setIsExpanded(toggleValue);};useEffect(function(){_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return loadLabelOptions(setOptions,onError,isMounted);case 2:if(isMounted.current){_context.next=4;break;}return _context.abrupt(\"return\");case 4:setIsLoading(false);case 5:case\"end\":return _context.stop();}}},_callee);}))();/* eslint-disable-next-line react-hooks/exhaustive-deps */},[]);var renderOptions=function renderOptions(opts){return opts.map(function(option){return/*#__PURE__*/_jsx(SelectOption,{\"aria-label\":option.name,value:option,isDisabled:option.isReadOnly,children:option.name},option.id);});};var onFilter=function onFilter(event){if(event){var str=event.target.value.toLowerCase();var matches=options.filter(function(o){return o.name.toLowerCase().includes(str);});return renderOptions(matches);}return null;};var chipGroupComponent=function chipGroupComponent(){return/*#__PURE__*/_jsx(ChipGroup,{children:(selections||[]).map(function(currentChip){return/*#__PURE__*/_jsx(Chip,{isReadOnly:currentChip.isReadOnly,onClick:function onClick(e){_onSelect(e,currentChip);},children:currentChip.name},currentChip.name);})});};return/*#__PURE__*/_jsx(Select,{variant:SelectVariant.typeaheadMulti,onToggle:toggleExpanded,onSelect:function onSelect(e,item){if(typeof item==='string'){item={id:item,name:item};}_onSelect(e,item);},onClear:function onClear(){return onChange(selections.filter(function(label){return label.isReadOnly;}));},onFilter:onFilter,isCreatable:true,onCreateOption:function onCreateOption(label){label=label.trim();if(!options.includes(label)){setOptions(options.concat({name:label,id:label}));}return label;},isDisabled:isLoading,selections:selections,isOpen:isExpanded,typeAheadAriaLabel:/*i18n*/i18n._(\"Select Labels\"),placeholderText:placeholder,createText:createText,noResultsFoundText:/*i18n*/i18n._(\"No results found\"),ouiaId:\"template-label-select\",chipGroupComponent:chipGroupComponent(),children:renderOptions(options)});}LabelSelect.defaultProps={placeholder:''};export default LabelSelect;","map":{"version":3,"names":["React","useState","useEffect","Chip","ChipGroup","Select","SelectOption","SelectVariant","LabelsAPI","useIsMounted","useSyncedSelectValue","jsx","_jsx","loadLabelOptions","_x","_x2","_x3","_loadLabelOptions","apply","arguments","_asyncToGenerator","_regeneratorRuntime","mark","_callee2","setLabels","onError","isMounted","labels","_yield$LabelsAPI$read","data","_yield$LabelsAPI$read2","results","wrap","_callee2$","_context2","prev","next","current","abrupt","read","page","page_size","order_by","sent","includes","concat","t0","stop","LabelSelect","_ref","value","placeholder","onChange","createText","_useState","_useState2","_slicedToArray","isLoading","setIsLoading","_useState3","_useState4","isExpanded","setIsExpanded","_useSyncedSelectValue","selections","onSelect","options","setOptions","toggleExpanded","toggleValue","_callee","_callee$","_context","renderOptions","opts","map","option","name","isDisabled","isReadOnly","children","id","onFilter","event","str","target","toLowerCase","matches","filter","o","chipGroupComponent","currentChip","onClick","e","variant","typeaheadMulti","onToggle","item","onClear","label","isCreatable","onCreateOption","trim","isOpen","typeAheadAriaLabel","i18n","_","placeholderText","noResultsFoundText","ouiaId","defaultProps"],"sources":["/awx_devel/awx/ui/src/components/LabelSelect/LabelSelect.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { func, arrayOf, number, shape, string, oneOfType } from 'prop-types';\nimport {\n  Chip,\n  ChipGroup,\n  Select,\n  SelectOption,\n  SelectVariant,\n} from '@patternfly/react-core';\nimport { t } from '@lingui/macro';\nimport { LabelsAPI } from 'api';\nimport useIsMounted from 'hooks/useIsMounted';\nimport { useSyncedSelectValue } from '../MultiSelect';\n\nasync function loadLabelOptions(setLabels, onError, isMounted) {\n  if (!isMounted.current) {\n    return;\n  }\n  let labels;\n  try {\n    const { data } = await LabelsAPI.read({\n      page: 1,\n      page_size: 200,\n      order_by: 'name',\n    });\n    labels = data.results;\n    setLabels(labels);\n    if (data.next && data.next.includes('page=2')) {\n      const {\n        data: { results },\n      } = await LabelsAPI.read({\n        page: 2,\n        page_size: 200,\n        order_by: 'name',\n      });\n      setLabels(labels.concat(results));\n    }\n  } catch (err) {\n    onError(err);\n  }\n}\n\nfunction LabelSelect({ value, placeholder, onChange, onError, createText }) {\n  const [isLoading, setIsLoading] = useState(true);\n  const [isExpanded, setIsExpanded] = useState(false);\n  const isMounted = useIsMounted();\n  const { selections, onSelect, options, setOptions } = useSyncedSelectValue(\n    value,\n    onChange\n  );\n\n  const toggleExpanded = (toggleValue) => {\n    setIsExpanded(toggleValue);\n  };\n\n  useEffect(() => {\n    (async () => {\n      await loadLabelOptions(setOptions, onError, isMounted);\n      if (!isMounted.current) {\n        return;\n      }\n      setIsLoading(false);\n    })();\n    /* eslint-disable-next-line react-hooks/exhaustive-deps */\n  }, []);\n\n  const renderOptions = (opts) =>\n    opts.map((option) => (\n      <SelectOption\n        key={option.id}\n        aria-label={option.name}\n        value={option}\n        isDisabled={option.isReadOnly}\n      >\n        {option.name}\n      </SelectOption>\n    ));\n\n  const onFilter = (event) => {\n    if (event) {\n      const str = event.target.value.toLowerCase();\n      const matches = options.filter((o) => o.name.toLowerCase().includes(str));\n      return renderOptions(matches);\n    }\n    return null;\n  };\n\n  const chipGroupComponent = () => (\n    <ChipGroup>\n      {(selections || []).map((currentChip) => (\n        <Chip\n          isReadOnly={currentChip.isReadOnly}\n          key={currentChip.name}\n          onClick={(e) => {\n            onSelect(e, currentChip);\n          }}\n        >\n          {currentChip.name}\n        </Chip>\n      ))}\n    </ChipGroup>\n  );\n\n  return (\n    <Select\n      variant={SelectVariant.typeaheadMulti}\n      onToggle={toggleExpanded}\n      onSelect={(e, item) => {\n        if (typeof item === 'string') {\n          item = { id: item, name: item };\n        }\n        onSelect(e, item);\n      }}\n      onClear={() => onChange(selections.filter((label) => label.isReadOnly))}\n      onFilter={onFilter}\n      isCreatable\n      onCreateOption={(label) => {\n        label = label.trim();\n        if (!options.includes(label)) {\n          setOptions(options.concat({ name: label, id: label }));\n        }\n        return label;\n      }}\n      isDisabled={isLoading}\n      selections={selections}\n      isOpen={isExpanded}\n      typeAheadAriaLabel={t`Select Labels`}\n      placeholderText={placeholder}\n      createText={createText}\n      noResultsFoundText={t`No results found`}\n      ouiaId=\"template-label-select\"\n      chipGroupComponent={chipGroupComponent()}\n    >\n      {renderOptions(options)}\n    </Select>\n  );\n}\nLabelSelect.propTypes = {\n  value: arrayOf(\n    shape({\n      id: oneOfType([number, string]).isRequired,\n      name: string.isRequired,\n    })\n  ).isRequired,\n  placeholder: string,\n  onChange: func.isRequired,\n  onError: func.isRequired,\n};\nLabelSelect.defaultProps = {\n  placeholder: '',\n};\n\nexport default LabelSelect;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}