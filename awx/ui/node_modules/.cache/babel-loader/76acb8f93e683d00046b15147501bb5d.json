{"ast":null,"code":"import _createForOfIteratorHelper from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import React,{useCallback,useEffect,useState}from'react';import{useHistory}from'react-router-dom';import{Card,PageSection}from'@patternfly/react-core';import{ConstructedInventoriesAPI,InventoriesAPI}from'api';import useRequest from'hooks/useRequest';import{CardBody}from'components/Card';import ContentError from'components/ContentError';import ContentLoading from'components/ContentLoading';import ConstructedInventoryForm from'../shared/ConstructedInventoryForm';import{jsx as _jsx}from\"react/jsx-runtime\";function ConstructedInventoryAdd(){var history=useHistory();var _useState=useState(null),_useState2=_slicedToArray(_useState,2),submitError=_useState2[0],setSubmitError=_useState2[1];var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var res,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return ConstructedInventoriesAPI.readOptions();case 2:res=_context.sent;data=res.data;return _context.abrupt(\"return\",data.actions.POST);case 5:case\"end\":return _context.stop();}}},_callee);})),[]),null),isLoadingOptions=_useRequest.isLoading,optionsError=_useRequest.error,fetchOptions=_useRequest.request,options=_useRequest.result;useEffect(function(){fetchOptions();},[fetchOptions]);if(isLoadingOptions||!options&&!optionsError){return/*#__PURE__*/_jsx(ContentLoading,{});}if(optionsError){return/*#__PURE__*/_jsx(ContentError,{error:optionsError});}var handleCancel=function handleCancel(){history.push('/inventories');};var handleSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(values){var _values$organization,_yield$ConstructedInv,inventoryId,_iterator,_step,inputInventory,_iterator2,_step2,instanceGroup;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return ConstructedInventoriesAPI.create(_objectSpread(_objectSpread({},values),{},{organization:(_values$organization=values.organization)===null||_values$organization===void 0?void 0:_values$organization.id,kind:'constructed'}));case 3:_yield$ConstructedInv=_context2.sent;inventoryId=_yield$ConstructedInv.data.id;/* eslint-disable no-await-in-loop, no-restricted-syntax */_iterator=_createForOfIteratorHelper(values.inputInventories);_context2.prev=6;_iterator.s();case 8:if((_step=_iterator.n()).done){_context2.next=14;break;}inputInventory=_step.value;_context2.next=12;return InventoriesAPI.associateInventory(inventoryId,inputInventory.id);case 12:_context2.next=8;break;case 14:_context2.next=19;break;case 16:_context2.prev=16;_context2.t0=_context2[\"catch\"](6);_iterator.e(_context2.t0);case 19:_context2.prev=19;_iterator.f();return _context2.finish(19);case 22:_iterator2=_createForOfIteratorHelper(values.instanceGroups);_context2.prev=23;_iterator2.s();case 25:if((_step2=_iterator2.n()).done){_context2.next=31;break;}instanceGroup=_step2.value;_context2.next=29;return InventoriesAPI.associateInstanceGroup(inventoryId,instanceGroup.id);case 29:_context2.next=25;break;case 31:_context2.next=36;break;case 33:_context2.prev=33;_context2.t1=_context2[\"catch\"](23);_iterator2.e(_context2.t1);case 36:_context2.prev=36;_iterator2.f();return _context2.finish(36);case 39:/* eslint-enable no-await-in-loop, no-restricted-syntax */history.push(\"/inventories/constructed_inventory/\".concat(inventoryId,\"/details\"));_context2.next=45;break;case 42:_context2.prev=42;_context2.t2=_context2[\"catch\"](0);setSubmitError(_context2.t2);case 45:case\"end\":return _context2.stop();}}},_callee2,null,[[0,42],[6,16,19,22],[23,33,36,39]]);}));return function handleSubmit(_x){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsx(PageSection,{children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(CardBody,{children:/*#__PURE__*/_jsx(ConstructedInventoryForm,{onCancel:handleCancel,onSubmit:handleSubmit,submitError:submitError,options:options})})})});}export default ConstructedInventoryAdd;","map":{"version":3,"names":["React","useCallback","useEffect","useState","useHistory","Card","PageSection","ConstructedInventoriesAPI","InventoriesAPI","useRequest","CardBody","ContentError","ContentLoading","ConstructedInventoryForm","jsx","_jsx","ConstructedInventoryAdd","history","_useState","_useState2","_slicedToArray","submitError","setSubmitError","_useRequest","_asyncToGenerator","_regeneratorRuntime","mark","_callee","res","data","wrap","_callee$","_context","prev","next","readOptions","sent","abrupt","actions","POST","stop","isLoadingOptions","isLoading","optionsError","error","fetchOptions","request","options","result","handleCancel","push","handleSubmit","_ref2","_callee2","values","_values$organization","_yield$ConstructedInv","inventoryId","_iterator","_step","inputInventory","_iterator2","_step2","instanceGroup","_callee2$","_context2","create","_objectSpread","organization","id","kind","_createForOfIteratorHelper","inputInventories","s","n","done","value","associateInventory","t0","e","f","finish","instanceGroups","associateInstanceGroup","t1","concat","t2","_x","apply","arguments","children","onCancel","onSubmit"],"sources":["/awx_devel/awx/ui/src/screens/Inventory/ConstructedInventoryAdd/ConstructedInventoryAdd.js"],"sourcesContent":["import React, { useCallback, useEffect, useState } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport { Card, PageSection } from '@patternfly/react-core';\nimport { ConstructedInventoriesAPI, InventoriesAPI } from 'api';\nimport useRequest from 'hooks/useRequest';\nimport { CardBody } from 'components/Card';\nimport ContentError from 'components/ContentError';\nimport ContentLoading from 'components/ContentLoading';\nimport ConstructedInventoryForm from '../shared/ConstructedInventoryForm';\n\nfunction ConstructedInventoryAdd() {\n  const history = useHistory();\n  const [submitError, setSubmitError] = useState(null);\n\n  const {\n    isLoading: isLoadingOptions,\n    error: optionsError,\n    request: fetchOptions,\n    result: options,\n  } = useRequest(\n    useCallback(async () => {\n      const res = await ConstructedInventoriesAPI.readOptions();\n      const { data } = res;\n      return data.actions.POST;\n    }, []),\n    null\n  );\n\n  useEffect(() => {\n    fetchOptions();\n  }, [fetchOptions]);\n\n  if (isLoadingOptions || (!options && !optionsError)) {\n    return <ContentLoading />;\n  }\n\n  if (optionsError) {\n    return <ContentError error={optionsError} />;\n  }\n\n  const handleCancel = () => {\n    history.push('/inventories');\n  };\n\n  const handleSubmit = async (values) => {\n    try {\n      const {\n        data: { id: inventoryId },\n      } = await ConstructedInventoriesAPI.create({\n        ...values,\n        organization: values.organization?.id,\n        kind: 'constructed',\n      });\n      /* eslint-disable no-await-in-loop, no-restricted-syntax */\n      for (const inputInventory of values.inputInventories) {\n        await InventoriesAPI.associateInventory(inventoryId, inputInventory.id);\n      }\n      for (const instanceGroup of values.instanceGroups) {\n        await InventoriesAPI.associateInstanceGroup(\n          inventoryId,\n          instanceGroup.id\n        );\n      }\n      /* eslint-enable no-await-in-loop, no-restricted-syntax */\n\n      history.push(`/inventories/constructed_inventory/${inventoryId}/details`);\n    } catch (error) {\n      setSubmitError(error);\n    }\n  };\n\n  return (\n    <PageSection>\n      <Card>\n        <CardBody>\n          <ConstructedInventoryForm\n            onCancel={handleCancel}\n            onSubmit={handleSubmit}\n            submitError={submitError}\n            options={options}\n          />\n        </CardBody>\n      </Card>\n    </PageSection>\n  );\n}\n\nexport default ConstructedInventoryAdd;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}