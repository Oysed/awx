{"ast":null,"code":"import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _objectWithoutProperties from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";var _excluded=[\"credential\",\"source_path\",\"source_project\",\"source_script\",\"execution_environment\"];import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import React,{useCallback,useEffect}from'react';import{useHistory}from'react-router-dom';import{Card}from'@patternfly/react-core';import{CardBody}from'components/Card';import useRequest from'hooks/useRequest';import{InventorySourcesAPI}from'api';import InventorySourceForm from'../shared/InventorySourceForm';import{jsx as _jsx}from\"react/jsx-runtime\";function InventorySourceEdit(_ref){var source=_ref.source,inventory=_ref.inventory;var history=useHistory();var id=inventory.id,organization=inventory.organization;var detailsUrl=\"/inventories/inventory/\".concat(id,\"/sources/\").concat(source.id,\"/details\");var _useRequest=useRequest(useCallback(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(values){var _yield$InventorySourc,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return InventorySourcesAPI.replace(source.id,values);case 2:_yield$InventorySourc=_context.sent;data=_yield$InventorySourc.data;return _context.abrupt(\"return\",data);case 5:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref2.apply(this,arguments);};}(),[source.id]),null),error=_useRequest.error,request=_useRequest.request,result=_useRequest.result;useEffect(function(){if(result){history.push(detailsUrl);}},[result,detailsUrl,history]);var handleSubmit=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(form){var credential,source_path,source_project,source_script,execution_environment,remainingForm,sourcePath,sourceProject;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:credential=form.credential,source_path=form.source_path,source_project=form.source_project,source_script=form.source_script,execution_environment=form.execution_environment,remainingForm=_objectWithoutProperties(form,_excluded);sourcePath={};sourceProject={};if(form.source==='scm'){sourcePath.source_path=source_path==='/ (project root)'?'':source_path;sourceProject.source_project=source_project.id;}_context2.next=6;return request(_objectSpread(_objectSpread(_objectSpread({credential:(credential===null||credential===void 0?void 0:credential.id)||null,inventory:id,source_script:(source_script===null||source_script===void 0?void 0:source_script.id)||null,execution_environment:(execution_environment===null||execution_environment===void 0?void 0:execution_environment.id)||null},sourcePath),sourceProject),remainingForm));case 6:case\"end\":return _context2.stop();}}},_callee2);}));return function handleSubmit(_x2){return _ref3.apply(this,arguments);};}();var handleCancel=function handleCancel(){history.push(detailsUrl);};return/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(CardBody,{children:/*#__PURE__*/_jsx(InventorySourceForm,{source:source,onCancel:handleCancel,onSubmit:handleSubmit,submitError:error,organizationId:organization})})});}export default InventorySourceEdit;","map":{"version":3,"names":["React","useCallback","useEffect","useHistory","Card","CardBody","useRequest","InventorySourcesAPI","InventorySourceForm","jsx","_jsx","InventorySourceEdit","_ref","source","inventory","history","id","organization","detailsUrl","concat","_useRequest","_ref2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","values","_yield$InventorySourc","data","wrap","_callee$","_context","prev","next","replace","sent","abrupt","stop","_x","apply","arguments","error","request","result","push","handleSubmit","_ref3","_callee2","form","credential","source_path","source_project","source_script","execution_environment","remainingForm","sourcePath","sourceProject","_callee2$","_context2","_objectWithoutProperties","_excluded","_objectSpread","_x2","handleCancel","children","onCancel","onSubmit","submitError","organizationId"],"sources":["/awx_devel/awx/ui/src/screens/Inventory/InventorySourceEdit/InventorySourceEdit.js"],"sourcesContent":["import React, { useCallback, useEffect } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport { Card } from '@patternfly/react-core';\nimport { CardBody } from 'components/Card';\nimport useRequest from 'hooks/useRequest';\nimport { InventorySourcesAPI } from 'api';\nimport InventorySourceForm from '../shared/InventorySourceForm';\n\nfunction InventorySourceEdit({ source, inventory }) {\n  const history = useHistory();\n  const { id, organization } = inventory;\n  const detailsUrl = `/inventories/inventory/${id}/sources/${source.id}/details`;\n\n  const { error, request, result } = useRequest(\n    useCallback(\n      async (values) => {\n        const { data } = await InventorySourcesAPI.replace(source.id, values);\n        return data;\n      },\n      [source.id]\n    ),\n    null\n  );\n\n  useEffect(() => {\n    if (result) {\n      history.push(detailsUrl);\n    }\n  }, [result, detailsUrl, history]);\n\n  const handleSubmit = async (form) => {\n    const {\n      credential,\n      source_path,\n      source_project,\n      source_script,\n      execution_environment,\n      ...remainingForm\n    } = form;\n\n    const sourcePath = {};\n    const sourceProject = {};\n    if (form.source === 'scm') {\n      sourcePath.source_path =\n        source_path === '/ (project root)' ? '' : source_path;\n      sourceProject.source_project = source_project.id;\n    }\n\n    await request({\n      credential: credential?.id || null,\n      inventory: id,\n      source_script: source_script?.id || null,\n      execution_environment: execution_environment?.id || null,\n      ...sourcePath,\n      ...sourceProject,\n      ...remainingForm,\n    });\n  };\n\n  const handleCancel = () => {\n    history.push(detailsUrl);\n  };\n\n  return (\n    <Card>\n      <CardBody>\n        <InventorySourceForm\n          source={source}\n          onCancel={handleCancel}\n          onSubmit={handleSubmit}\n          submitError={error}\n          organizationId={organization}\n        />\n      </CardBody>\n    </Card>\n  );\n}\n\nexport default InventorySourceEdit;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}