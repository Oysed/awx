{"ast":null,"code":"import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _styled from\"styled-components\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{i18n}from\"@lingui/core\";import React,{useState,useEffect,useCallback}from'react';import{Switch,Tooltip}from'@patternfly/react-core';import useRequest from'hooks/useRequest';import{HostsAPI}from'api';import AlertModal from'../AlertModal';import ErrorDetail from'../ErrorDetail';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var _StyledSwitch=_styled(Switch).withConfig({displayName:\"HostToggle___StyledSwitch\",componentId:\"sc-18nbgru-0\"})([\"display:inline-flex;\"]);function HostToggle(_ref){var className=_ref.className,host=_ref.host,_ref$isDisabled=_ref.isDisabled,isDisabled=_ref$isDisabled===void 0?false:_ref$isDisabled,onToggle=_ref.onToggle,_ref$tooltip=_ref.tooltip,tooltip=_ref$tooltip===void 0?/*i18n*/i18n._(\"Indicates if a host is available and should be included in running\\njobs.  For hosts that are part of an external inventory, this may be\\nreset by the inventory sync process.\"):_ref$tooltip;var _useState=useState(host.enabled),_useState2=_slicedToArray(_useState,2),isEnabled=_useState2[0],setIsEnabled=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),showError=_useState4[0],setShowError=_useState4[1];var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return HostsAPI.update(host.id,{enabled:!isEnabled});case 2:return _context.abrupt(\"return\",!isEnabled);case 3:case\"end\":return _context.stop();}}},_callee);})),[host,isEnabled]),host.enabled),result=_useRequest.result,isLoading=_useRequest.isLoading,error=_useRequest.error,toggleHost=_useRequest.request;useEffect(function(){if(result!==isEnabled){setIsEnabled(result);if(onToggle){onToggle(result);}}},[result,isEnabled,onToggle]);useEffect(function(){if(error){setShowError(true);}},[error]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Tooltip,{content:tooltip,position:\"top\",children:/*#__PURE__*/_jsx(_StyledSwitch,{className:className,id:\"host-\".concat(host.id,\"-toggle\"),label:/*i18n*/i18n._(\"On\"),labelOff:/*i18n*/i18n._(\"Off\"),isChecked:isEnabled,isDisabled:isLoading||isDisabled||!host.summary_fields.user_capabilities.edit,onChange:toggleHost,ouiaId:\"host-\".concat(host.id,\"-toggle\"),\"aria-label\":/*i18n*/i18n._(\"Toggle host\")})}),showError&&error&&!isLoading&&/*#__PURE__*/_jsxs(AlertModal,{variant:\"error\",title:/*i18n*/i18n._(\"Error!\"),isOpen:error&&!isLoading,onClose:function onClose(){return setShowError(false);},children:[/*i18n*/i18n._(\"Failed to toggle host.\"),/*#__PURE__*/_jsx(ErrorDetail,{error:error})]})]});}export default HostToggle;","map":{"version":3,"names":["React","useState","useEffect","useCallback","Switch","Tooltip","useRequest","HostsAPI","AlertModal","ErrorDetail","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","_StyledSwitch","_styled","withConfig","displayName","componentId","HostToggle","_ref","className","host","_ref$isDisabled","isDisabled","onToggle","_ref$tooltip","tooltip","i18n","_","_useState","enabled","_useState2","_slicedToArray","isEnabled","setIsEnabled","_useState3","_useState4","showError","setShowError","_useRequest","_asyncToGenerator","_regeneratorRuntime","mark","_callee","wrap","_callee$","_context","prev","next","update","id","abrupt","stop","result","isLoading","error","toggleHost","request","children","content","position","concat","label","labelOff","isChecked","summary_fields","user_capabilities","edit","onChange","ouiaId","variant","title","isOpen","onClose"],"sources":["/awx_devel/awx/ui/src/components/HostToggle/HostToggle.js"],"sourcesContent":["import 'styled-components/macro';\nimport React, { useState, useEffect, useCallback } from 'react';\n\nimport { t } from '@lingui/macro';\nimport { Switch, Tooltip } from '@patternfly/react-core';\nimport useRequest from 'hooks/useRequest';\nimport { HostsAPI } from 'api';\nimport AlertModal from '../AlertModal';\nimport ErrorDetail from '../ErrorDetail';\n\nfunction HostToggle({\n  className,\n  host,\n  isDisabled = false,\n  onToggle,\n  tooltip = t`Indicates if a host is available and should be included in running\n    jobs.  For hosts that are part of an external inventory, this may be\n    reset by the inventory sync process.`,\n}) {\n  const [isEnabled, setIsEnabled] = useState(host.enabled);\n  const [showError, setShowError] = useState(false);\n\n  const {\n    result,\n    isLoading,\n    error,\n    request: toggleHost,\n  } = useRequest(\n    useCallback(async () => {\n      await HostsAPI.update(host.id, {\n        enabled: !isEnabled,\n      });\n      return !isEnabled;\n    }, [host, isEnabled]),\n    host.enabled\n  );\n\n  useEffect(() => {\n    if (result !== isEnabled) {\n      setIsEnabled(result);\n      if (onToggle) {\n        onToggle(result);\n      }\n    }\n  }, [result, isEnabled, onToggle]);\n\n  useEffect(() => {\n    if (error) {\n      setShowError(true);\n    }\n  }, [error]);\n\n  return (\n    <>\n      <Tooltip content={tooltip} position=\"top\">\n        <Switch\n          className={className}\n          css=\"display: inline-flex;\"\n          id={`host-${host.id}-toggle`}\n          label={t`On`}\n          labelOff={t`Off`}\n          isChecked={isEnabled}\n          isDisabled={\n            isLoading ||\n            isDisabled ||\n            !host.summary_fields.user_capabilities.edit\n          }\n          onChange={toggleHost}\n          ouiaId={`host-${host.id}-toggle`}\n          aria-label={t`Toggle host`}\n        />\n      </Tooltip>\n      {showError && error && !isLoading && (\n        <AlertModal\n          variant=\"error\"\n          title={t`Error!`}\n          isOpen={error && !isLoading}\n          onClose={() => setShowError(false)}\n        >\n          {t`Failed to toggle host.`}\n          <ErrorDetail error={error} />\n        </AlertModal>\n      )}\n    </>\n  );\n}\n\nexport default HostToggle;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}