{"ast":null,"code":"import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _objectWithoutProperties from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js\";import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";var _excluded=[\"credential\",\"source_path\",\"source_project\",\"source_script\",\"execution_environment\"];import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import React,{useCallback,useEffect}from'react';import{useHistory}from'react-router-dom';import{Card}from'@patternfly/react-core';import{InventorySourcesAPI}from'api';import useRequest from'hooks/useRequest';import{CardBody}from'components/Card';import InventorySourceForm from'../shared/InventorySourceForm';import{jsx as _jsx}from\"react/jsx-runtime\";function InventorySourceAdd(_ref){var inventory=_ref.inventory;var history=useHistory();var id=inventory.id,organization=inventory.organization;var _useRequest=useRequest(useCallback(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(values){var _yield$InventorySourc,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return InventorySourcesAPI.create(values);case 2:_yield$InventorySourc=_context.sent;data=_yield$InventorySourc.data;return _context.abrupt(\"return\",data);case 5:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref2.apply(this,arguments);};}(),[])),error=_useRequest.error,request=_useRequest.request,result=_useRequest.result;useEffect(function(){if(result){history.push(\"/inventories/inventory/\".concat(result.inventory,\"/sources/\").concat(result.id,\"/details\"));}},[result,history]);var handleSubmit=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(form){var credential,source_path,source_project,source_script,execution_environment,remainingForm,sourcePath,sourceProject;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:credential=form.credential,source_path=form.source_path,source_project=form.source_project,source_script=form.source_script,execution_environment=form.execution_environment,remainingForm=_objectWithoutProperties(form,_excluded);sourcePath={};sourceProject={};if(form.source==='scm'){sourcePath.source_path=source_path==='/ (project root)'?'':source_path;sourceProject.source_project=source_project.id;}_context2.next=6;return request(_objectSpread(_objectSpread(_objectSpread({credential:(credential===null||credential===void 0?void 0:credential.id)||null,inventory:id,source_script:(source_script===null||source_script===void 0?void 0:source_script.id)||null,execution_environment:(execution_environment===null||execution_environment===void 0?void 0:execution_environment.id)||null},sourcePath),sourceProject),remainingForm));case 6:case\"end\":return _context2.stop();}}},_callee2);}));return function handleSubmit(_x2){return _ref3.apply(this,arguments);};}();var handleCancel=function handleCancel(){history.push(\"/inventories/inventory/\".concat(id,\"/sources\"));};return/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(CardBody,{children:/*#__PURE__*/_jsx(InventorySourceForm,{onCancel:handleCancel,onSubmit:handleSubmit,submitError:error,organizationId:organization})})});}export default InventorySourceAdd;","map":{"version":3,"names":["React","useCallback","useEffect","useHistory","Card","InventorySourcesAPI","useRequest","CardBody","InventorySourceForm","jsx","_jsx","InventorySourceAdd","_ref","inventory","history","id","organization","_useRequest","_ref2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","values","_yield$InventorySourc","data","wrap","_callee$","_context","prev","next","create","sent","abrupt","stop","_x","apply","arguments","error","request","result","push","concat","handleSubmit","_ref3","_callee2","form","credential","source_path","source_project","source_script","execution_environment","remainingForm","sourcePath","sourceProject","_callee2$","_context2","_objectWithoutProperties","_excluded","source","_objectSpread","_x2","handleCancel","children","onCancel","onSubmit","submitError","organizationId"],"sources":["/awx_devel/awx/ui/src/screens/Inventory/InventorySourceAdd/InventorySourceAdd.js"],"sourcesContent":["import React, { useCallback, useEffect } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport { Card } from '@patternfly/react-core';\nimport { InventorySourcesAPI } from 'api';\nimport useRequest from 'hooks/useRequest';\nimport { CardBody } from 'components/Card';\nimport InventorySourceForm from '../shared/InventorySourceForm';\n\nfunction InventorySourceAdd({ inventory }) {\n  const history = useHistory();\n  const { id, organization } = inventory;\n\n  const { error, request, result } = useRequest(\n    useCallback(async (values) => {\n      const { data } = await InventorySourcesAPI.create(values);\n      return data;\n    }, [])\n  );\n\n  useEffect(() => {\n    if (result) {\n      history.push(\n        `/inventories/inventory/${result.inventory}/sources/${result.id}/details`\n      );\n    }\n  }, [result, history]);\n\n  const handleSubmit = async (form) => {\n    const {\n      credential,\n      source_path,\n      source_project,\n      source_script,\n      execution_environment,\n      ...remainingForm\n    } = form;\n\n    const sourcePath = {};\n    const sourceProject = {};\n    if (form.source === 'scm') {\n      sourcePath.source_path =\n        source_path === '/ (project root)' ? '' : source_path;\n      sourceProject.source_project = source_project.id;\n    }\n\n    await request({\n      credential: credential?.id || null,\n      inventory: id,\n      source_script: source_script?.id || null,\n      execution_environment: execution_environment?.id || null,\n      ...sourcePath,\n      ...sourceProject,\n      ...remainingForm,\n    });\n  };\n\n  const handleCancel = () => {\n    history.push(`/inventories/inventory/${id}/sources`);\n  };\n\n  return (\n    <Card>\n      <CardBody>\n        <InventorySourceForm\n          onCancel={handleCancel}\n          onSubmit={handleSubmit}\n          submitError={error}\n          organizationId={organization}\n        />\n      </CardBody>\n    </Card>\n  );\n}\n\nexport default InventorySourceAdd;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}