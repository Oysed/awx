{"ast":null,"code":"import _asyncToGenerator from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _regeneratorRuntime from\"/awx_devel/awx/ui/node_modules/@babel/runtime/regenerator/index.js\";import{i18n}from\"@lingui/core\";import React,{useCallback,useEffect}from'react';import{Link,useHistory}from'react-router-dom';import{Button}from'@patternfly/react-core';import{VariablesDetail}from'components/CodeEditor';import AlertModal from'components/AlertModal';import{CardBody,CardActionsRow}from'components/Card';import DeleteButton from'components/DeleteButton';import{Detail,DetailList,UserDateDetail}from'components/DetailList';import useRequest,{useDismissableError}from'hooks/useRequest';import{CredentialTypesAPI}from'api';import{jsonToYaml}from'util/yaml';import{relatedResourceDeleteRequests,getRelatedResourceDeleteCounts}from'util/getRelatedResourceDeleteDetails';import ErrorDetail from'components/ErrorDetail';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function CredentialTypeDetails(_ref){var credentialType=_ref.credentialType;var id=credentialType.id,name=credentialType.name,description=credentialType.description,injectors=credentialType.injectors,inputs=credentialType.inputs;var history=useHistory();var _useRequest=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return CredentialTypesAPI.destroy(id);case 2:history.push(\"/credential_types\");case 3:case\"end\":return _context.stop();}}},_callee);})),[id,history])),deleteCredentialType=_useRequest.request,isLoading=_useRequest.isLoading,deleteError=_useRequest.error;var _useRequest2=useRequest(useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var _yield$getRelatedReso,deleteDetails,error;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return getRelatedResourceDeleteCounts(relatedResourceDeleteRequests.credentialType(credentialType));case 2:_yield$getRelatedReso=_context2.sent;deleteDetails=_yield$getRelatedReso.results;error=_yield$getRelatedReso.error;if(!error){_context2.next=7;break;}throw new Error(error);case 7:if(!deleteDetails){_context2.next=9;break;}return _context2.abrupt(\"return\",{isDeleteDisabled:true});case 9:return _context2.abrupt(\"return\",{isDeleteDisabled:false});case 10:case\"end\":return _context2.stop();}}},_callee2);})),[credentialType]),{isDeleteDisabled:false}),isDeleteDisabled=_useRequest2.result.isDeleteDisabled,deleteDetailsError=_useRequest2.error,fetchDeleteDetails=_useRequest2.request;useEffect(function(){fetchDeleteDetails();},[fetchDeleteDetails]);var _useDismissableError=useDismissableError(deleteError||deleteDetailsError),error=_useDismissableError.error,dismissError=_useDismissableError.dismissError;return/*#__PURE__*/_jsxs(CardBody,{children:[/*#__PURE__*/_jsxs(DetailList,{children:[/*#__PURE__*/_jsx(Detail,{label:/*i18n*/i18n._(\"Name\"),value:name,dataCy:\"credential-type-detail-name\"}),/*#__PURE__*/_jsx(Detail,{label:/*i18n*/i18n._(\"Description\"),value:description}),/*#__PURE__*/_jsx(VariablesDetail,{label:/*i18n*/i18n._(\"Input configuration\"),value:jsonToYaml(JSON.stringify(inputs)),rows:6,name:\"input\",dataCy:\"credential-type-detail-input\",helpText:/*i18n*/i18n._(\"Input schema which defines a set of ordered fields for that type.\")}),/*#__PURE__*/_jsx(VariablesDetail,{label:/*i18n*/i18n._(\"Injector configuration\"),value:jsonToYaml(JSON.stringify(injectors)),rows:6,name:\"injector\",dataCy:\"credential-type-detail-injector\",helpText:/*i18n*/i18n._(\"Environment variables or extra variables that specify the values a credential type can inject.\")}),/*#__PURE__*/_jsx(UserDateDetail,{label:/*i18n*/i18n._(\"Created\"),date:credentialType.created,user:credentialType.summary_fields.created_by}),/*#__PURE__*/_jsx(UserDateDetail,{label:/*i18n*/i18n._(\"Last Modified\"),date:credentialType.modified,user:credentialType.summary_fields.modified_by})]}),/*#__PURE__*/_jsxs(CardActionsRow,{children:[credentialType.summary_fields.user_capabilities&&credentialType.summary_fields.user_capabilities.edit&&/*#__PURE__*/_jsx(Button,{ouiaId:\"credential-type-detail-edit-button\",\"aria-label\":/*i18n*/i18n._(\"edit\"),component:Link,to:\"/credential_types/\".concat(id,\"/edit\"),children:/*i18n*/i18n._(\"Edit\")}),credentialType.summary_fields.user_capabilities&&credentialType.summary_fields.user_capabilities.delete&&/*#__PURE__*/_jsx(DeleteButton,{name:name,modalTitle:/*i18n*/i18n._(\"Delete credential type\"),onConfirm:deleteCredentialType,isDisabled:isLoading||isDeleteDisabled,disabledTooltip:isDeleteDisabled&&/*i18n*/i18n._(\"This credential type is currently being used by some credentials and cannot be deleted\"),children:/*i18n*/i18n._(\"Delete\")})]}),error&&/*#__PURE__*/_jsx(AlertModal,{isOpen:error,onClose:dismissError,title:/*i18n*/i18n._(\"Error\"),variant:\"error\",children:/*#__PURE__*/_jsx(ErrorDetail,{error:error})})]});}export default CredentialTypeDetails;","map":{"version":3,"names":["React","useCallback","useEffect","Link","useHistory","Button","VariablesDetail","AlertModal","CardBody","CardActionsRow","DeleteButton","Detail","DetailList","UserDateDetail","useRequest","useDismissableError","CredentialTypesAPI","jsonToYaml","relatedResourceDeleteRequests","getRelatedResourceDeleteCounts","ErrorDetail","jsx","_jsx","jsxs","_jsxs","CredentialTypeDetails","_ref","credentialType","id","name","description","injectors","inputs","history","_useRequest","_asyncToGenerator","_regeneratorRuntime","mark","_callee","wrap","_callee$","_context","prev","next","destroy","push","stop","deleteCredentialType","request","isLoading","deleteError","error","_useRequest2","_callee2","_yield$getRelatedReso","deleteDetails","_callee2$","_context2","sent","results","Error","abrupt","isDeleteDisabled","result","deleteDetailsError","fetchDeleteDetails","_useDismissableError","dismissError","children","label","i18n","_","value","dataCy","JSON","stringify","rows","helpText","date","created","user","summary_fields","created_by","modified","modified_by","user_capabilities","edit","ouiaId","component","to","concat","delete","modalTitle","onConfirm","isDisabled","disabledTooltip","isOpen","onClose","title","variant"],"sources":["/awx_devel/awx/ui/src/screens/CredentialType/CredentialTypeDetails/CredentialTypeDetails.js"],"sourcesContent":["import React, { useCallback, useEffect } from 'react';\n\nimport { t } from '@lingui/macro';\nimport { Link, useHistory } from 'react-router-dom';\nimport { Button } from '@patternfly/react-core';\n\nimport { VariablesDetail } from 'components/CodeEditor';\nimport AlertModal from 'components/AlertModal';\nimport { CardBody, CardActionsRow } from 'components/Card';\nimport DeleteButton from 'components/DeleteButton';\nimport { Detail, DetailList, UserDateDetail } from 'components/DetailList';\nimport useRequest, { useDismissableError } from 'hooks/useRequest';\nimport { CredentialTypesAPI } from 'api';\nimport { jsonToYaml } from 'util/yaml';\nimport {\n  relatedResourceDeleteRequests,\n  getRelatedResourceDeleteCounts,\n} from 'util/getRelatedResourceDeleteDetails';\nimport ErrorDetail from 'components/ErrorDetail';\n\nfunction CredentialTypeDetails({ credentialType }) {\n  const { id, name, description, injectors, inputs } = credentialType;\n  const history = useHistory();\n\n  const {\n    request: deleteCredentialType,\n    isLoading,\n    error: deleteError,\n  } = useRequest(\n    useCallback(async () => {\n      await CredentialTypesAPI.destroy(id);\n      history.push(`/credential_types`);\n    }, [id, history])\n  );\n\n  const {\n    result: { isDeleteDisabled },\n    error: deleteDetailsError,\n    request: fetchDeleteDetails,\n  } = useRequest(\n    useCallback(async () => {\n      const { results: deleteDetails, error } =\n        await getRelatedResourceDeleteCounts(\n          relatedResourceDeleteRequests.credentialType(credentialType)\n        );\n      if (error) {\n        throw new Error(error);\n      }\n      if (deleteDetails) {\n        return { isDeleteDisabled: true };\n      }\n      return { isDeleteDisabled: false };\n    }, [credentialType]),\n    { isDeleteDisabled: false }\n  );\n\n  useEffect(() => {\n    fetchDeleteDetails();\n  }, [fetchDeleteDetails]);\n  const { error, dismissError } = useDismissableError(\n    deleteError || deleteDetailsError\n  );\n\n  return (\n    <CardBody>\n      <DetailList>\n        <Detail\n          label={t`Name`}\n          value={name}\n          dataCy=\"credential-type-detail-name\"\n        />\n        <Detail label={t`Description`} value={description} />\n        <VariablesDetail\n          label={t`Input configuration`}\n          value={jsonToYaml(JSON.stringify(inputs))}\n          rows={6}\n          name=\"input\"\n          dataCy=\"credential-type-detail-input\"\n          helpText={t`Input schema which defines a set of ordered fields for that type.`}\n        />\n        <VariablesDetail\n          label={t`Injector configuration`}\n          value={jsonToYaml(JSON.stringify(injectors))}\n          rows={6}\n          name=\"injector\"\n          dataCy=\"credential-type-detail-injector\"\n          helpText={t`Environment variables or extra variables that specify the values a credential type can inject.`}\n        />\n        <UserDateDetail\n          label={t`Created`}\n          date={credentialType.created}\n          user={credentialType.summary_fields.created_by}\n        />\n        <UserDateDetail\n          label={t`Last Modified`}\n          date={credentialType.modified}\n          user={credentialType.summary_fields.modified_by}\n        />\n      </DetailList>\n      <CardActionsRow>\n        {credentialType.summary_fields.user_capabilities &&\n          credentialType.summary_fields.user_capabilities.edit && (\n            <Button\n              ouiaId=\"credential-type-detail-edit-button\"\n              aria-label={t`edit`}\n              component={Link}\n              to={`/credential_types/${id}/edit`}\n            >\n              {t`Edit`}\n            </Button>\n          )}\n        {credentialType.summary_fields.user_capabilities &&\n          credentialType.summary_fields.user_capabilities.delete && (\n            <DeleteButton\n              name={name}\n              modalTitle={t`Delete credential type`}\n              onConfirm={deleteCredentialType}\n              isDisabled={isLoading || isDeleteDisabled}\n              disabledTooltip={\n                isDeleteDisabled &&\n                t`This credential type is currently being used by some credentials and cannot be deleted`\n              }\n            >\n              {t`Delete`}\n            </DeleteButton>\n          )}\n      </CardActionsRow>\n\n      {error && (\n        <AlertModal\n          isOpen={error}\n          onClose={dismissError}\n          title={t`Error`}\n          variant=\"error\"\n        >\n          <ErrorDetail error={error} />\n        </AlertModal>\n      )}\n    </CardBody>\n  );\n}\n\nexport default CredentialTypeDetails;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}