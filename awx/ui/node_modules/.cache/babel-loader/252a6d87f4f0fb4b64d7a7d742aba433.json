{"ast":null,"code":"import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _taggedTemplateLiteral from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral.js\";var _templateObject,_templateObject2;import{i18n}from\"@lingui/core\";import React from'react';import styled from'styled-components';import{ExclamationCircleIcon as PFExclamationCircleIcon}from'@patternfly/react-icons';import{Tooltip}from'@patternfly/react-core';import{useFormikContext}from'formik';import yaml from'js-yaml';import mergeExtraVars,{maskPasswords}from'util/prompt/mergeExtraVars';import getSurveyValues from'util/prompt/getSurveyValues';import PromptDetail from'../../PromptDetail';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var ExclamationCircleIcon=styled(PFExclamationCircleIcon)(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  margin-left: 10px;\\n  margin-top: -2px;\\n\"])));var ErrorMessageWrapper=styled.div(_templateObject2||(_templateObject2=_taggedTemplateLiteral([\"\\n  align-items: center;\\n  color: var(--pf-global--danger-color--200);\\n  display: flex;\\n  font-weight: var(--pf-global--FontWeight--bold);\\n  margin-bottom: 10px;\\n\"])));function PreviewStep(_ref){var resource=_ref.resource,launchConfig=_ref.launchConfig,surveyConfig=_ref.surveyConfig,formErrors=_ref.formErrors;var _useFormikContext=useFormikContext(),values=_useFormikContext.values;var surveyValues=getSurveyValues(values);var overrides=_objectSpread({},values);if(launchConfig.ask_variables_on_launch||launchConfig.survey_enabled){try{var initialExtraVars=launchConfig.ask_variables_on_launch&&(overrides.extra_vars||'---');if(surveyConfig!==null&&surveyConfig!==void 0&&surveyConfig.spec){var passwordFields=surveyConfig.spec.filter(function(q){return q.type==='password';}).map(function(q){return q.variable;});var masked=maskPasswords(surveyValues,passwordFields);overrides.extra_vars=yaml.dump(mergeExtraVars(initialExtraVars,masked));}else{overrides.extra_vars=yaml.dump(mergeExtraVars(initialExtraVars,{}));}}catch(e){//\n}}return/*#__PURE__*/_jsxs(\"div\",{\"data-cy\":\"prompt-preview\",children:[formErrors&&/*#__PURE__*/_jsxs(ErrorMessageWrapper,{children:[/*i18n*/i18n._(\"Some of the previous step(s) have errors\"),/*#__PURE__*/_jsx(Tooltip,{position:\"right\",content:/*i18n*/i18n._(\"See errors on the left\"),trigger:\"click mouseenter focus\",children:/*#__PURE__*/_jsx(ExclamationCircleIcon,{})})]}),/*#__PURE__*/_jsx(PromptDetail,{resource:resource,launchConfig:launchConfig,overrides:overrides})]});}export default PreviewStep;","map":{"version":3,"names":["React","styled","ExclamationCircleIcon","PFExclamationCircleIcon","Tooltip","useFormikContext","yaml","mergeExtraVars","maskPasswords","getSurveyValues","PromptDetail","jsx","_jsx","jsxs","_jsxs","_templateObject","_taggedTemplateLiteral","ErrorMessageWrapper","div","_templateObject2","PreviewStep","_ref","resource","launchConfig","surveyConfig","formErrors","_useFormikContext","values","surveyValues","overrides","_objectSpread","ask_variables_on_launch","survey_enabled","initialExtraVars","extra_vars","spec","passwordFields","filter","q","type","map","variable","masked","dump","e","children","i18n","_","position","content","trigger"],"sources":["/awx_devel/awx/ui/src/components/LaunchPrompt/steps/PreviewStep.js"],"sourcesContent":["import React from 'react';\nimport styled from 'styled-components';\nimport { ExclamationCircleIcon as PFExclamationCircleIcon } from '@patternfly/react-icons';\nimport { Tooltip } from '@patternfly/react-core';\nimport { t } from '@lingui/macro';\nimport { useFormikContext } from 'formik';\n\nimport yaml from 'js-yaml';\nimport mergeExtraVars, { maskPasswords } from 'util/prompt/mergeExtraVars';\nimport getSurveyValues from 'util/prompt/getSurveyValues';\nimport PromptDetail from '../../PromptDetail';\n\nconst ExclamationCircleIcon = styled(PFExclamationCircleIcon)`\n  margin-left: 10px;\n  margin-top: -2px;\n`;\n\nconst ErrorMessageWrapper = styled.div`\n  align-items: center;\n  color: var(--pf-global--danger-color--200);\n  display: flex;\n  font-weight: var(--pf-global--FontWeight--bold);\n  margin-bottom: 10px;\n`;\n\nfunction PreviewStep({ resource, launchConfig, surveyConfig, formErrors }) {\n  const { values } = useFormikContext();\n  const surveyValues = getSurveyValues(values);\n\n  const overrides = {\n    ...values,\n  };\n\n  if (launchConfig.ask_variables_on_launch || launchConfig.survey_enabled) {\n    try {\n      const initialExtraVars =\n        launchConfig.ask_variables_on_launch && (overrides.extra_vars || '---');\n      if (surveyConfig?.spec) {\n        const passwordFields = surveyConfig.spec\n          .filter((q) => q.type === 'password')\n          .map((q) => q.variable);\n        const masked = maskPasswords(surveyValues, passwordFields);\n        overrides.extra_vars = yaml.dump(\n          mergeExtraVars(initialExtraVars, masked)\n        );\n      } else {\n        overrides.extra_vars = yaml.dump(mergeExtraVars(initialExtraVars, {}));\n      }\n    } catch (e) {\n      //\n    }\n  }\n\n  return (\n    <div data-cy=\"prompt-preview\">\n      {formErrors && (\n        <ErrorMessageWrapper>\n          {t`Some of the previous step(s) have errors`}\n          <Tooltip\n            position=\"right\"\n            content={t`See errors on the left`}\n            trigger=\"click mouseenter focus\"\n          >\n            <ExclamationCircleIcon />\n          </Tooltip>\n        </ErrorMessageWrapper>\n      )}\n      <PromptDetail\n        resource={resource}\n        launchConfig={launchConfig}\n        overrides={overrides}\n      />\n    </div>\n  );\n}\n\nexport default PreviewStep;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}