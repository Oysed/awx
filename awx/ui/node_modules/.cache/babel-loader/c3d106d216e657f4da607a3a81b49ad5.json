{"ast":null,"code":"import _objectSpread from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _toConsumableArray from\"/awx_devel/awx/ui/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import Ansi from'ansi-to-html';import hasAnsi from'has-ansi';import{encode}from'html-entities';var EVENT_START_TASK='playbook_on_task_start';var EVENT_START_PLAY='playbook_on_play_start';var EVENT_STATS_PLAY='playbook_on_stats';var TIME_EVENTS=[EVENT_START_TASK,EVENT_START_PLAY,EVENT_STATS_PLAY];var ansi=new Ansi({stream:true,colors:{0:'#000',1:'#A30000',2:'#486B00',3:'#795600',4:'#00A',5:'#A0A',6:'#004368',7:'#AAA',8:'#555',9:'#F55',10:'#5F5',11:'#FF5',12:'#55F',13:'#F5F',14:'#5FF',15:'#FFF'}});function getTimestamp(_ref){var created=_ref.created;var date=new Date(created);var dateHours=date.getHours();var dateMinutes=date.getMinutes();var dateSeconds=date.getSeconds();var stampHours=dateHours<10?\"0\".concat(dateHours):dateHours;var stampMinutes=dateMinutes<10?\"0\".concat(dateMinutes):dateMinutes;var stampSeconds=dateSeconds<10?\"0\".concat(dateSeconds):dateSeconds;return\"\".concat(stampHours,\":\").concat(stampMinutes,\":\").concat(stampSeconds);}function createStyleAttrHash(styleAttr){var hash=0;for(var i=0;i<styleAttr.length;i++){hash=(hash<<5)-hash;// eslint-disable-line no-bitwise\nhash+=styleAttr.charCodeAt(i);hash&=hash;// eslint-disable-line no-bitwise\n}return\"\".concat(hash);}var styleAttrPattern=new RegExp('style=\"[^\"]*\"','g');function replaceStyleAttrs(html){var allStyleAttrs=_toConsumableArray(new Set(html.match(styleAttrPattern)));var cssMap={};var result=html;for(var i=0;i<allStyleAttrs.length;i++){var styleAttr=allStyleAttrs[i];var cssClassName=\"output-\".concat(createStyleAttrHash(styleAttr));cssMap[cssClassName]=styleAttr.replace('style=\"','').slice(0,-1);result=result.split(styleAttr).join(\"class=\\\"\".concat(cssClassName,\"\\\"\"));}return{cssMap:cssMap,result:result};}export default function getLineTextHtml(_ref2){var created=_ref2.created,event=_ref2.event,startLine=_ref2.start_line,stdout=_ref2.stdout;var sanitized=encode(stdout);var lineCssMap={};var lineTextHtml=[];sanitized.split('\\r\\n').forEach(function(lineText,index){var html;if(hasAnsi(lineText)){var _replaceStyleAttrs=replaceStyleAttrs(ansi.toHtml(lineText)),cssMap=_replaceStyleAttrs.cssMap,result=_replaceStyleAttrs.result;html=result;lineCssMap=_objectSpread(_objectSpread({},lineCssMap),cssMap);}else{html=lineText;}if(index===1&&TIME_EVENTS.includes(event)){var time=getTimestamp({created:created});html+=\"<span class=\\\"time\\\">\".concat(time,\"</span>\");}lineTextHtml.push({lineNumber:startLine+index,html:html});});return{lineCssMap:lineCssMap,lineTextHtml:lineTextHtml};}","map":{"version":3,"names":["Ansi","hasAnsi","encode","EVENT_START_TASK","EVENT_START_PLAY","EVENT_STATS_PLAY","TIME_EVENTS","ansi","stream","colors","getTimestamp","_ref","created","date","Date","dateHours","getHours","dateMinutes","getMinutes","dateSeconds","getSeconds","stampHours","concat","stampMinutes","stampSeconds","createStyleAttrHash","styleAttr","hash","i","length","charCodeAt","styleAttrPattern","RegExp","replaceStyleAttrs","html","allStyleAttrs","_toConsumableArray","Set","match","cssMap","result","cssClassName","replace","slice","split","join","getLineTextHtml","_ref2","event","startLine","start_line","stdout","sanitized","lineCssMap","lineTextHtml","forEach","lineText","index","_replaceStyleAttrs","toHtml","_objectSpread","includes","time","push","lineNumber"],"sources":["/awx_devel/awx/ui/src/screens/Job/JobOutput/getLineTextHtml.js"],"sourcesContent":["import Ansi from 'ansi-to-html';\nimport hasAnsi from 'has-ansi';\nimport { encode } from 'html-entities';\n\nconst EVENT_START_TASK = 'playbook_on_task_start';\nconst EVENT_START_PLAY = 'playbook_on_play_start';\nconst EVENT_STATS_PLAY = 'playbook_on_stats';\nconst TIME_EVENTS = [EVENT_START_TASK, EVENT_START_PLAY, EVENT_STATS_PLAY];\n\nconst ansi = new Ansi({\n  stream: true,\n  colors: {\n    0: '#000',\n    1: '#A30000',\n    2: '#486B00',\n    3: '#795600',\n    4: '#00A',\n    5: '#A0A',\n    6: '#004368',\n    7: '#AAA',\n    8: '#555',\n    9: '#F55',\n    10: '#5F5',\n    11: '#FF5',\n    12: '#55F',\n    13: '#F5F',\n    14: '#5FF',\n    15: '#FFF',\n  },\n});\n\nfunction getTimestamp({ created }) {\n  const date = new Date(created);\n\n  const dateHours = date.getHours();\n  const dateMinutes = date.getMinutes();\n  const dateSeconds = date.getSeconds();\n\n  const stampHours = dateHours < 10 ? `0${dateHours}` : dateHours;\n  const stampMinutes = dateMinutes < 10 ? `0${dateMinutes}` : dateMinutes;\n  const stampSeconds = dateSeconds < 10 ? `0${dateSeconds}` : dateSeconds;\n\n  return `${stampHours}:${stampMinutes}:${stampSeconds}`;\n}\n\nfunction createStyleAttrHash(styleAttr) {\n  let hash = 0;\n  for (let i = 0; i < styleAttr.length; i++) {\n    hash = (hash << 5) - hash; // eslint-disable-line no-bitwise\n    hash += styleAttr.charCodeAt(i);\n    hash &= hash; // eslint-disable-line no-bitwise\n  }\n  return `${hash}`;\n}\n\nconst styleAttrPattern = new RegExp('style=\"[^\"]*\"', 'g');\n\nfunction replaceStyleAttrs(html) {\n  const allStyleAttrs = [...new Set(html.match(styleAttrPattern))];\n  const cssMap = {};\n  let result = html;\n  for (let i = 0; i < allStyleAttrs.length; i++) {\n    const styleAttr = allStyleAttrs[i];\n    const cssClassName = `output-${createStyleAttrHash(styleAttr)}`;\n\n    cssMap[cssClassName] = styleAttr.replace('style=\"', '').slice(0, -1);\n    result = result.split(styleAttr).join(`class=\"${cssClassName}\"`);\n  }\n  return { cssMap, result };\n}\n\nexport default function getLineTextHtml({\n  created,\n  event,\n  start_line: startLine,\n  stdout,\n}) {\n  const sanitized = encode(stdout);\n  let lineCssMap = {};\n  const lineTextHtml = [];\n\n  sanitized.split('\\r\\n').forEach((lineText, index) => {\n    let html;\n    if (hasAnsi(lineText)) {\n      const { cssMap, result } = replaceStyleAttrs(ansi.toHtml(lineText));\n      html = result;\n      lineCssMap = { ...lineCssMap, ...cssMap };\n    } else {\n      html = lineText;\n    }\n\n    if (index === 1 && TIME_EVENTS.includes(event)) {\n      const time = getTimestamp({ created });\n      html += `<span class=\"time\">${time}</span>`;\n    }\n\n    lineTextHtml.push({\n      lineNumber: startLine + index,\n      html,\n    });\n  });\n\n  return {\n    lineCssMap,\n    lineTextHtml,\n  };\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}